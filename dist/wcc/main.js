/*! For license information please see main.js.LICENSE.txt */
(()=>{var t={676:function(t,e){!function(t){"use strict";function e(t){return Array.prototype.slice.call(t)}function i(t){return new Promise((function(e,i){t.onsuccess=function(){e(t.result)},t.onerror=function(){i(t.error)}}))}function r(t,e,r){var n,s=new Promise((function(s,a){i(n=t[e].apply(t,r)).then(s,a)}));return s.request=n,s}function n(t,e,i){var n=r(t,e,i);return n.then((function(t){if(t)return new c(t,n.request)}))}function s(t,e,i){i.forEach((function(i){Object.defineProperty(t.prototype,i,{get:function(){return this[e][i]},set:function(t){this[e][i]=t}})}))}function a(t,e,i,n){n.forEach((function(n){n in i.prototype&&(t.prototype[n]=function(){return r(this[e],n,arguments)})}))}function o(t,e,i,r){r.forEach((function(r){r in i.prototype&&(t.prototype[r]=function(){return this[e][r].apply(this[e],arguments)})}))}function l(t,e,i,r){r.forEach((function(r){r in i.prototype&&(t.prototype[r]=function(){return n(this[e],r,arguments)})}))}function u(t){this._index=t}function c(t,e){this._cursor=t,this._request=e}function h(t){this._store=t}function d(t){this._tx=t,this.complete=new Promise((function(e,i){t.oncomplete=function(){e()},t.onerror=function(){i(t.error)},t.onabort=function(){i(t.error)}}))}function f(t,e,i){this._db=t,this.oldVersion=e,this.transaction=new d(i)}function g(t){this._db=t}s(u,"_index",["name","keyPath","multiEntry","unique"]),a(u,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),l(u,"_index",IDBIndex,["openCursor","openKeyCursor"]),s(c,"_cursor",["direction","key","primaryKey","value"]),a(c,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach((function(t){t in IDBCursor.prototype&&(c.prototype[t]=function(){var e=this,r=arguments;return Promise.resolve().then((function(){return e._cursor[t].apply(e._cursor,r),i(e._request).then((function(t){if(t)return new c(t,e._request)}))}))})})),h.prototype.createIndex=function(){return new u(this._store.createIndex.apply(this._store,arguments))},h.prototype.index=function(){return new u(this._store.index.apply(this._store,arguments))},s(h,"_store",["name","keyPath","indexNames","autoIncrement"]),a(h,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),l(h,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),o(h,"_store",IDBObjectStore,["deleteIndex"]),d.prototype.objectStore=function(){return new h(this._tx.objectStore.apply(this._tx,arguments))},s(d,"_tx",["objectStoreNames","mode"]),o(d,"_tx",IDBTransaction,["abort"]),f.prototype.createObjectStore=function(){return new h(this._db.createObjectStore.apply(this._db,arguments))},s(f,"_db",["name","version","objectStoreNames"]),o(f,"_db",IDBDatabase,["deleteObjectStore","close"]),g.prototype.transaction=function(){return new d(this._db.transaction.apply(this._db,arguments))},s(g,"_db",["name","version","objectStoreNames"]),o(g,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach((function(t){[h,u].forEach((function(i){t in i.prototype&&(i.prototype[t.replace("open","iterate")]=function(){var i=e(arguments),r=i[i.length-1],n=this._store||this._index,s=n[t].apply(n,i.slice(0,-1));s.onsuccess=function(){r(s.result)}})}))})),[u,h].forEach((function(t){t.prototype.getAll||(t.prototype.getAll=function(t,e){var i=this,r=[];return new Promise((function(n){i.iterateCursor(t,(function(t){t?(r.push(t.value),void 0===e||r.length!=e?t.continue():n(r)):n(r)}))}))})})),t.openDb=function(t,e,i){var n=r(indexedDB,"open",[t,e]),s=n.request;return s&&(s.onupgradeneeded=function(t){i&&i(new f(s.result,t.oldVersion,s.transaction))}),n.then((function(t){return new g(t)}))},t.deleteDb=function(t){return r(indexedDB,"deleteDatabase",[t])},Object.defineProperty(t,"__esModule",{value:!0})}(e)},255:function(t){"undefined"!=typeof window&&(t.exports=function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/dist/",i(i.s=20)}([function(t,e,i){"use strict";var r;i.d(e,"a",(function(){return r})),function(t){t.MEDIA_ATTACHING="hlsMediaAttaching",t.MEDIA_ATTACHED="hlsMediaAttached",t.MEDIA_DETACHING="hlsMediaDetaching",t.MEDIA_DETACHED="hlsMediaDetached",t.BUFFER_RESET="hlsBufferReset",t.BUFFER_CODECS="hlsBufferCodecs",t.BUFFER_CREATED="hlsBufferCreated",t.BUFFER_APPENDING="hlsBufferAppending",t.BUFFER_APPENDED="hlsBufferAppended",t.BUFFER_EOS="hlsBufferEos",t.BUFFER_FLUSHING="hlsBufferFlushing",t.BUFFER_FLUSHED="hlsBufferFlushed",t.MANIFEST_LOADING="hlsManifestLoading",t.MANIFEST_LOADED="hlsManifestLoaded",t.MANIFEST_PARSED="hlsManifestParsed",t.LEVEL_SWITCHING="hlsLevelSwitching",t.LEVEL_SWITCHED="hlsLevelSwitched",t.LEVEL_LOADING="hlsLevelLoading",t.LEVEL_LOADED="hlsLevelLoaded",t.LEVEL_UPDATED="hlsLevelUpdated",t.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",t.LEVELS_UPDATED="hlsLevelsUpdated",t.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",t.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",t.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",t.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",t.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",t.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",t.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",t.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",t.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",t.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",t.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",t.CUES_PARSED="hlsCuesParsed",t.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",t.INIT_PTS_FOUND="hlsInitPtsFound",t.FRAG_LOADING="hlsFragLoading",t.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",t.FRAG_LOADED="hlsFragLoaded",t.FRAG_DECRYPTED="hlsFragDecrypted",t.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",t.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",t.FRAG_PARSING_METADATA="hlsFragParsingMetadata",t.FRAG_PARSED="hlsFragParsed",t.FRAG_BUFFERED="hlsFragBuffered",t.FRAG_CHANGED="hlsFragChanged",t.FPS_DROP="hlsFpsDrop",t.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",t.ERROR="hlsError",t.DESTROYING="hlsDestroying",t.KEY_LOADING="hlsKeyLoading",t.KEY_LOADED="hlsKeyLoaded",t.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",t.BACK_BUFFER_REACHED="hlsBackBufferReached"}(r||(r={}))},function(t,e,i){"use strict";i.d(e,"a",(function(){return o})),i.d(e,"b",(function(){return l}));var r=function(){},n={trace:r,debug:r,log:r,warn:r,info:r,error:r},s=n;function a(t){var e=self.console[t];return e?e.bind(self.console,"["+t+"] >"):r}function o(t){if(self.console&&!0===t||"object"==typeof t){!function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];i.forEach((function(e){s[e]=t[e]?t[e].bind(t):a(e)}))}(t,"debug","log","info","warn","error");try{s.log()}catch(t){s=n}}else s=n}var l=n},function(t,e,i){"use strict";var r,n;i.d(e,"b",(function(){return r})),i.d(e,"a",(function(){return n})),function(t){t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError"}(r||(r={})),function(t){t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",t.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException",t.INTERNAL_ABORTED="aborted",t.UNKNOWN="unknown"}(n||(n={}))},function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var r=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)};Number.MAX_SAFE_INTEGER},function(t,e,i){"use strict";var r,n;i.d(e,"a",(function(){return r})),i.d(e,"b",(function(){return n})),function(t){t.MANIFEST="manifest",t.LEVEL="level",t.AUDIO_TRACK="audioTrack",t.SUBTITLE_TRACK="subtitleTrack"}(r||(r={})),function(t){t.MAIN="main",t.AUDIO="audio",t.SUBTITLE="subtitle"}(n||(n={}))},function(t,e,i){"use strict";i.d(e,"a",(function(){return l})),i.d(e,"c",(function(){return g})),i.d(e,"k",(function(){return p})),i.d(e,"h",(function(){return m})),i.d(e,"e",(function(){return v})),i.d(e,"d",(function(){return y})),i.d(e,"f",(function(){return b})),i.d(e,"l",(function(){return E})),i.d(e,"b",(function(){return S})),i.d(e,"j",(function(){return w})),i.d(e,"i",(function(){return _})),i.d(e,"g",(function(){return A}));var r=i(9),n=i(6),s=i(7),a=Math.pow(2,32)-1,o=[].push,l={video:1,audio:2,id3:3,text:4};function u(t){return String.fromCharCode.apply(null,t)}function c(t,e){var i=t[e]<<8|t[e+1];return i<0?65536+i:i}function h(t,e){var i=d(t,e);return i<0?4294967296+i:i}function d(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function f(t,e,i){t[e]=i>>24,t[e+1]=i>>16&255,t[e+2]=i>>8&255,t[e+3]=255&i}function g(t,e){var i=[];if(!e.length)return i;for(var r=t.byteLength,n=0;n<r;){var s=h(t,n),a=s>1?n+s:r;if(u(t.subarray(n+4,n+8))===e[0])if(1===e.length)i.push(t.subarray(n+8,a));else{var l=g(t.subarray(n+8,a),e.slice(1));l.length&&o.apply(i,l)}n=a}return i}function p(t){var e=[],i=t[0],r=8,n=h(t,r);r+=4,r+=0===i?8:16,r+=2;var s=t.length+0,a=c(t,r);r+=2;for(var o=0;o<a;o++){var l=r,u=h(t,l);l+=4;var d=2147483647&u;if(1==(2147483648&u)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var f=h(t,l);l+=4,e.push({referenceSize:d,subsegmentDuration:f,info:{duration:f/n,start:s,end:s+d-1}}),s+=d,r=l+=4}return{earliestPresentationTime:0,timescale:n,version:i,referencesCount:a,references:e}}function m(t){for(var e=[],i=g(t,["moov","trak"]),r=0;r<i.length;r++){var s=i[r],a=g(s,["tkhd"])[0];if(a){var o=a[0],l=0===o?12:20,c=h(a,l),d=g(s,["mdia","mdhd"])[0];if(d){var f=h(d,l=0===(o=d[0])?12:20),p=g(s,["mdia","hdlr"])[0];if(p){var m=u(p.subarray(8,12)),v={soun:n.a.AUDIO,vide:n.a.VIDEO}[m];if(v){var y=g(s,["mdia","minf","stbl","stsd"])[0],T=void 0;y&&(T=u(y.subarray(12,16))),e[c]={timescale:f,type:v},e[v]={timescale:f,id:c,codec:T}}}}}}return g(t,["moov","mvex","trex"]).forEach((function(t){var i=h(t,4),r=e[i];r&&(r.default={duration:h(t,12),flags:h(t,20)})})),e}function v(t,e){return g(e,["moof","traf"]).reduce((function(e,i){var r=g(i,["tfdt"])[0],n=r[0],s=g(i,["tfhd"]).reduce((function(e,i){var s=h(i,4),a=t[s];if(a){var o=h(r,4);1===n&&(o*=Math.pow(2,32),o+=h(r,8));var l=o/(a.timescale||9e4);if(isFinite(l)&&(null===e||l<e))return l}return e}),null);return null!==s&&isFinite(s)&&(null===e||s<e)?s:e}),null)||0}function y(t,e){for(var i=0,r=0,s=0,a=g(t,["moof","traf"]),o=0;o<a.length;o++){var l=a[o],u=g(l,["tfhd"])[0],c=e[h(u,4)];if(c){var d=c.default,f=h(u,0)|(null==d?void 0:d.flags),m=null==d?void 0:d.duration;8&f&&(m=h(u,2&f?12:8));for(var v=c.timescale||9e4,y=g(l,["trun"]),b=0;b<y.length;b++)!(i=T(y[b]))&&m&&(i=m*h(y[b],4)),c.type===n.a.VIDEO?r+=i/v:c.type===n.a.AUDIO&&(s+=i/v)}}if(0===r&&0===s){for(var E=0,S=g(t,["sidx"]),w=0;w<S.length;w++){var I=p(S[w]);null!=I&&I.references&&(E+=I.references.reduce((function(t,e){return t+e.info.duration||0}),0))}return E}return r||s}function T(t){var e=h(t,0),i=8;1&e&&(i+=4),4&e&&(i+=4);for(var r=0,n=h(t,4),s=0;s<n;s++)256&e&&(r+=h(t,i),i+=4),512&e&&(i+=4),1024&e&&(i+=4),2048&e&&(i+=4);return r}function b(t,e,i){g(e,["moof","traf"]).forEach((function(e){g(e,["tfhd"]).forEach((function(r){var n=h(r,4),s=t[n];if(s){var o=s.timescale||9e4;g(e,["tfdt"]).forEach((function(t){var e=t[0],r=h(t,4);if(0===e)r-=i*o,f(t,4,r=Math.max(r,0));else{r*=Math.pow(2,32),r+=h(t,8),r-=i*o,r=Math.max(r,0);var n=Math.floor(r/(a+1)),s=Math.floor(r%(a+1));f(t,4,n),f(t,8,s)}}))}}))}))}function E(t){var e={valid:null,remainder:null},i=g(t,["moof"]);if(!i)return e;if(i.length<2)return e.remainder=t,e;var n=i[i.length-1];return e.valid=Object(r.a)(t,0,n.byteOffset-8),e.remainder=Object(r.a)(t,n.byteOffset-8),e}function S(t,e){var i=new Uint8Array(t.length+e.length);return i.set(t),i.set(e,t.length),i}function w(t,e){var i=[],r=e.samples,s=e.timescale,a=e.id,o=!1;return g(r,["moof"]).map((function(l){var u=l.byteOffset-8;g(l,["traf"]).map((function(l){var c=g(l,["tfdt"]).map((function(t){var e=t[0],i=h(t,4);return 1===e&&(i*=Math.pow(2,32),i+=h(t,8)),i/s}))[0];return void 0!==c&&(t=c),g(l,["tfhd"]).map((function(c){var f=h(c,4),p=16777215&h(c,0),m=0,v=0!=(16&p),y=0,T=0!=(32&p),b=8;f===a&&(0!=(1&p)&&(b+=8),0!=(2&p)&&(b+=4),0!=(8&p)&&(m=h(c,b),b+=4),v&&(y=h(c,b),b+=4),T&&(b+=4),"video"===e.type&&(o=function(t){if(!t)return!1;var e=t.indexOf("."),i=e<0?t:t.substring(0,e);return"hvc1"===i||"hev1"===i||"dvh1"===i||"dvhe"===i}(e.codec)),g(l,["trun"]).map((function(a){var l=a[0],c=16777215&h(a,0),f=0!=(1&c),g=0,p=0!=(4&c),v=0!=(256&c),T=0,b=0!=(512&c),E=0,S=0!=(1024&c),w=0!=(2048&c),A=0,k=h(a,4),D=8;f&&(g=h(a,D),D+=4),p&&(D+=4);for(var L=g+u,R=0;R<k;R++){if(v?(T=h(a,D),D+=4):T=m,b?(E=h(a,D),D+=4):E=y,S&&(D+=4),w&&(A=0===l?h(a,D):d(a,D),D+=4),e.type===n.a.VIDEO)for(var C=0;C<E;){var O=h(r,L),P=31&r[L+=4];I(o,P)&&_(r.subarray(L,L+O),t+A/s,i),L+=O,C+=O+4}t+=T/s}})))}))}))})),i}function I(t,e){return t?39===e||40===e:6===e}function _(t,e,i){var r=function(t){for(var e=t.byteLength,i=[],r=1;r<e-2;)0===t[r]&&0===t[r+1]&&3===t[r+2]?(i.push(r+2),r+=2):r++;if(0===i.length)return t;var n=e-i.length,s=new Uint8Array(n),a=0;for(r=0;r<n;a++,r++)a===i[0]&&(a++,i.shift()),s[r]=t[a];return s}(t),n=0;n++;for(var a=0,o=0,l=!1,u=0;n<r.length;){a=0;do{if(n>=r.length)break;a+=u=r[n++]}while(255===u);o=0;do{if(n>=r.length)break;o+=u=r[n++]}while(255===u);var d=r.length-n;if(!l&&4===a&&n<r.length){if(l=!0,181===r[n++]){var f=c(r,n);if(n+=2,49===f){var g=h(r,n);if(n+=4,1195456820===g){var p=r[n++];if(3===p){var m=r[n++],v=64&m,y=v?2+3*(31&m):0,T=new Uint8Array(y);if(v){T[0]=m;for(var b=1;b<y;b++)T[b]=r[n++]}i.push({type:p,payloadType:a,pts:e,bytes:T})}}}}}else if(5===a&&o<d){if(l=!0,o>16){for(var E=[],S=0;S<16;S++){var w=r[n++].toString(16);E.push(1==w.length?"0"+w:w),3!==S&&5!==S&&7!==S&&9!==S||E.push("-")}for(var I=o-16,_=new Uint8Array(I),A=0;A<I;A++)_[A]=r[n++];i.push({payloadType:a,pts:e,uuid:E.join(""),userData:Object(s.f)(_),userDataBytes:_})}}else if(o<d)n+=o;else if(o>d)break}}function A(t){var e=t[0],i="",r="",n=0,s=0,a=0,o=0,l=0,c=0;if(0===e){for(;"\0"!==u(t.subarray(c,c+1));)i+=u(t.subarray(c,c+1)),c+=1;for(i+=u(t.subarray(c,c+1)),c+=1;"\0"!==u(t.subarray(c,c+1));)r+=u(t.subarray(c,c+1)),c+=1;r+=u(t.subarray(c,c+1)),c+=1,n=h(t,12),s=h(t,16),o=h(t,20),l=h(t,24),c=28}else if(1===e){n=h(t,c+=4);var d=h(t,c+=4),f=h(t,c+=4);for(c+=4,a=Math.pow(2,32)*d+f,Number.isSafeInteger(a)||(a=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=h(t,c),l=h(t,c+=4),c+=4;"\0"!==u(t.subarray(c,c+1));)i+=u(t.subarray(c,c+1)),c+=1;for(i+=u(t.subarray(c,c+1)),c+=1;"\0"!==u(t.subarray(c,c+1));)r+=u(t.subarray(c,c+1)),c+=1;r+=u(t.subarray(c,c+1)),c+=1}return{schemeIdUri:i,value:r,timeScale:n,presentationTime:a,presentationTimeDelta:s,eventDuration:o,id:l,payload:t.subarray(c,t.byteLength)}}},function(t,e,i){"use strict";i.d(e,"a",(function(){return r})),i.d(e,"b",(function(){return g})),i.d(e,"c",(function(){return p}));var r,n=i(3),s=i(12),a=i(1),o=i(17),l=i(14);function u(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,c(t,e)}function c(t,e){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function d(t,e,i){return e&&h(t.prototype,e),i&&h(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}!function(t){t.AUDIO="audio",t.VIDEO="video",t.AUDIOVIDEO="audiovideo"}(r||(r={}));var f=function(){function t(t){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((e={})[r.AUDIO]=null,e[r.VIDEO]=null,e[r.AUDIOVIDEO]=null,e),this.baseurl=t}return t.prototype.setByteRange=function(t,e){var i=t.split("@",2),r=[];1===i.length?r[0]=e?e.byteRangeEndOffset:0:r[0]=parseInt(i[1]),r[1]=parseInt(i[0])+r[0],this._byteRange=r},d(t,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(s.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),t}(),g=function(t){function e(e,i){var r;return(r=t.call(this,i)||this)._decryptdata=null,r.rawProgramDateTime=null,r.programDateTime=null,r.tagList=[],r.duration=0,r.sn=0,r.levelkey=void 0,r.type=void 0,r.loader=null,r.level=-1,r.cc=0,r.startPTS=void 0,r.endPTS=void 0,r.appendedPTS=void 0,r.startDTS=void 0,r.endDTS=void 0,r.start=0,r.deltaPTS=void 0,r.maxStartPTS=void 0,r.minEndPTS=void 0,r.stats=new l.a,r.urlId=0,r.data=void 0,r.bitrateTest=!1,r.title=null,r.initSegment=null,r.type=e,r}u(e,t);var i=e.prototype;return i.createInitializationVector=function(t){for(var e=new Uint8Array(16),i=12;i<16;i++)e[i]=t>>8*(15-i)&255;return e},i.setDecryptDataFromLevelKey=function(t,e){var i=t;return"AES-128"===(null==t?void 0:t.method)&&t.uri&&!t.iv&&((i=o.a.fromURI(t.uri)).method=t.method,i.iv=this.createInitializationVector(e),i.keyFormat="identity"),i},i.setElementaryStreamInfo=function(t,e,i,r,n,s){void 0===s&&(s=!1);var a=this.elementaryStreams,o=a[t];o?(o.startPTS=Math.min(o.startPTS,e),o.endPTS=Math.max(o.endPTS,i),o.startDTS=Math.min(o.startDTS,r),o.endDTS=Math.max(o.endDTS,n)):a[t]={startPTS:e,endPTS:i,startDTS:r,endDTS:n,partial:s}},i.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[r.AUDIO]=null,t[r.VIDEO]=null,t[r.AUDIOVIDEO]=null},d(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var t=this.sn;"number"!=typeof t&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&a.b.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),t=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,t)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(n.a)(this.programDateTime))return null;var t=Object(n.a)(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;return!(null===(t=this.decryptdata)||void 0===t||!t.keyFormat||!this.decryptdata.uri)}}]),e}(f),p=function(t){function e(e,i,r,n,s){var a;(a=t.call(this,r)||this).fragOffset=0,a.duration=0,a.gap=!1,a.independent=!1,a.relurl=void 0,a.fragment=void 0,a.index=void 0,a.stats=new l.a,a.duration=e.decimalFloatingPoint("DURATION"),a.gap=e.bool("GAP"),a.independent=e.bool("INDEPENDENT"),a.relurl=e.enumeratedString("URI"),a.fragment=i,a.index=n;var o=e.enumeratedString("BYTERANGE");return o&&a.setByteRange(o,s),s&&(a.fragOffset=s.fragOffset+s.duration),a}return u(e,t),d(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),e}(f)},function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"a",(function(){return l})),i.d(e,"d",(function(){return u})),i.d(e,"e",(function(){return c})),i.d(e,"c",(function(){return d})),i.d(e,"f",(function(){return y}));var r,n=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},s=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},a=function(t,e){for(var i=e,r=0;n(t,e);)r+=10,r+=o(t,e+6),s(t,e+10)&&(r+=10),e+=r;if(r>0)return t.subarray(i,i+r)},o=function(t,e){var i=0;return i=(127&t[e])<<21,i|=(127&t[e+1])<<14,(i|=(127&t[e+2])<<7)|127&t[e+3]},l=function(t,e){return n(t,e)&&o(t,e+6)+10<=t.length-e},u=function(t){for(var e=d(t),i=0;i<e.length;i++){var r=e[i];if(c(r))return v(r)}},c=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},h=function(t){var e=String.fromCharCode(t[0],t[1],t[2],t[3]),i=o(t,4);return{type:e,size:i,data:t.subarray(10,10+i)}},d=function(t){for(var e=0,i=[];n(t,e);){for(var r=o(t,e+6),a=(e+=10)+r;e+8<a;){var l=h(t.subarray(e)),u=f(l);u&&i.push(u),e+=l.size+10}s(t,e)&&(e+=10)}return i},f=function(t){return"PRIV"===t.type?g(t):"W"===t.type[0]?m(t):p(t)},g=function(t){if(!(t.size<2)){var e=y(t.data,!0),i=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:i.buffer}}},p=function(t){if(!(t.size<2)){if("TXXX"===t.type){var e=1,i=y(t.data.subarray(e),!0);e+=i.length+1;var r=y(t.data.subarray(e));return{key:t.type,info:i,data:r}}var n=y(t.data.subarray(1));return{key:t.type,data:n}}},m=function(t){if("WXXX"===t.type){if(t.size<2)return;var e=1,i=y(t.data.subarray(e),!0);e+=i.length+1;var r=y(t.data.subarray(e));return{key:t.type,info:i,data:r}}var n=y(t.data);return{key:t.type,data:n}},v=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),i=1&e[3],r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,i&&(r+=47721858.84),Math.round(r)}},y=function(t,e){void 0===e&&(e=!1);var i=T();if(i){var r=i.decode(t);if(e){var n=r.indexOf("\0");return-1!==n?r.substring(0,n):r}return r.replace(/\0/g,"")}for(var s,a,o,l=t.length,u="",c=0;c<l;){if(0===(s=t[c++])&&e)return u;if(0!==s&&3!==s)switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(s);break;case 12:case 13:a=t[c++],u+=String.fromCharCode((31&s)<<6|63&a);break;case 14:a=t[c++],o=t[c++],u+=String.fromCharCode((15&s)<<12|(63&a)<<6|(63&o)<<0)}}return u};function T(){return r||void 0===self.TextDecoder||(r=new self.TextDecoder("utf-8")),r}},function(t,e,i){"use strict";var r;i.d(e,"a",(function(){return r})),function(t){t.audioId3="org.id3",t.dateRange="com.apple.quicktime.HLS",t.emsg="https://aomedia.org/emsg/ID3"}(r||(r={}))},function(t,e,i){"use strict";function r(t,e,i){return Uint8Array.prototype.slice?t.slice(e,i):new Uint8Array(Array.prototype.slice.call(t,e,i))}i.d(e,"a",(function(){return r}))},function(t,e,i){"use strict";i.d(e,"c",(function(){return it})),i.d(e,"d",(function(){return nt})),i.d(e,"a",(function(){return st})),i.d(e,"b",(function(){return at}));var r=i(0),n=i(2),s=i(16),a=i(3),o=i(7),l=i(8);function u(t,e){return void 0===t&&(t=""),void 0===e&&(e=9e4),{type:t,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}var c=i(5),h=i(9),d=function(){function t(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var e=t.prototype;return e.resetInitSegment=function(t,e,i,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},e.resetTimeStamp=function(t){this.initPTS=t,this.resetContiguity()},e.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},e.canParse=function(t,e){return!1},e.appendFrame=function(t,e,i){},e.demux=function(t,e){this.cachedData&&(t=Object(c.b)(this.cachedData,t),this.cachedData=null);var i,r,n=o.b(t,0),s=n?n.length:0,d=this._audioTrack,g=this._id3Track,p=n?o.d(n):void 0,m=t.length;for((null===this.basePTS||0===this.frameIndex&&Object(a.a)(p))&&(this.basePTS=f(p,e,this.initPTS)),n&&n.length>0&&g.samples.push({pts:this.basePTS,dts:this.basePTS,data:n,type:l.a.audioId3}),r=this.basePTS;s<m;){if(this.canParse(t,s)){var v=this.appendFrame(d,t,s);v?(this.frameIndex++,r=v.sample.pts,i=s+=v.length):s=m}else o.a(t,s)?(n=o.b(t,s),g.samples.push({pts:r,dts:r,data:n,type:l.a.audioId3}),i=s+=n.length):s++;if(s===m&&i!==m){var y=Object(h.a)(t,i);this.cachedData?this.cachedData=Object(c.b)(this.cachedData,y):this.cachedData=y}}return{audioTrack:d,videoTrack:u(),id3Track:g,textTrack:u()}},e.demuxSampleAes=function(t,e,i){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},e.flush=function(t){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),{audioTrack:this._audioTrack,videoTrack:u(),id3Track:this._id3Track,textTrack:u()}},e.destroy=function(){},t}(),f=function(t,e,i){return Object(a.a)(t)?90*t:9e4*e+(i||0)},g=d,p=i(1);function m(t,e){return 255===t[e]&&240==(246&t[e+1])}function v(t,e){return 1&t[e+1]?7:9}function y(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function T(t,e){return e+1<t.length&&m(t,e)}function b(t,e){if(T(t,e)){var i=v(t,e);if(e+i>=t.length)return!1;var r=y(t,e);if(r<=i)return!1;var n=e+r;return n===t.length||T(t,n)}return!1}function E(t,e,i,s,a){if(!t.samplerate){var o=function(t,e,i,s){var a,o,l,u,c=navigator.userAgent.toLowerCase(),h=s,d=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];a=1+((192&e[i+2])>>>6);var f=(60&e[i+2])>>>2;if(!(f>d.length-1))return l=(1&e[i+2])<<2,l|=(192&e[i+3])>>>6,p.b.log("manifest codec:"+s+", ADTS type:"+a+", samplingIndex:"+f),/firefox/i.test(c)?f>=6?(a=5,u=new Array(4),o=f-3):(a=2,u=new Array(2),o=f):-1!==c.indexOf("android")?(a=2,u=new Array(2),o=f):(a=5,u=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&f>=6?o=f-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(f>=6&&1===l||/vivaldi/i.test(c))||!s&&1===l)&&(a=2,u=new Array(2)),o=f)),u[0]=a<<3,u[0]|=(14&f)>>1,u[1]|=(1&f)<<7,u[1]|=l<<3,5===a&&(u[1]|=(14&o)>>1,u[2]=(1&o)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:d[f],channelCount:l,codec:"mp4a.40."+a,manifestCodec:h};t.trigger(r.a.ERROR,{type:n.b.MEDIA_ERROR,details:n.a.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+f})}(e,i,s,a);if(!o)return;t.config=o.config,t.samplerate=o.samplerate,t.channelCount=o.channelCount,t.codec=o.codec,t.manifestCodec=o.manifestCodec,p.b.log("parsed codec:"+t.codec+", rate:"+o.samplerate+", channels:"+o.channelCount)}}function S(t){return 9216e4/t}function w(t,e,i,r,n){var s,a=r+n*S(t.samplerate),o=function(t,e){var i=v(t,e);if(e+i<=t.length){var r=y(t,e)-i;if(r>0)return{headerLength:i,frameLength:r}}}(e,i);if(o){var l=o.frameLength,u=o.headerLength,c=u+l,h=Math.max(0,i+c-e.length);h?(s=new Uint8Array(c-u)).set(e.subarray(i+u,e.length),0):s=e.subarray(i+u,i+c);var d={unit:s,pts:a};return h||t.samples.push(d),{sample:d,length:c,missing:h}}var f=e.length-i;return(s=new Uint8Array(f)).set(e.subarray(i,e.length),0),{sample:{unit:s,pts:a},length:f,missing:-1}}function I(t,e){return(I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var _=function(t){var e,i;function r(e,i){var r;return(r=t.call(this)||this).observer=void 0,r.config=void 0,r.observer=e,r.config=i,r}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,I(e,i);var n=r.prototype;return n.resetInitSegment=function(e,i,r,n){t.prototype.resetInitSegment.call(this,e,i,r,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:i,duration:n,inputTimeScale:9e4,dropped:0}},r.probe=function(t){if(!t)return!1;for(var e=(o.b(t,0)||[]).length,i=t.length;e<i;e++)if(b(t,e))return p.b.log("ADTS sync word found !"),!0;return!1},n.canParse=function(t,e){return function(t,e){return function(t,e){return e+5<t.length}(t,e)&&m(t,e)&&y(t,e)<=t.length-e}(t,e)},n.appendFrame=function(t,e,i){E(t,this.observer,e,i,t.manifestCodec);var r=w(t,e,i,this.basePTS,this.frameIndex);if(r&&0===r.missing)return r},r}(g),A=/\/emsg[-/]ID3/i,k=function(){function t(t,e){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=e}var e=t.prototype;return e.resetTimeStamp=function(){},e.resetInitSegment=function(t,e,i,r){var n=Object(c.h)(t),s=this.videoTrack=u("video",1),a=this.audioTrack=u("audio",1),o=this.txtTrack=u("text",1);if(this.id3Track=u("id3",1),this.timeOffset=0,n.video){var l=n.video,h=l.id,d=l.timescale,f=l.codec;s.id=h,s.timescale=o.timescale=d,s.codec=f}if(n.audio){var g=n.audio,p=g.id,m=g.timescale,v=g.codec;a.id=p,a.timescale=m,a.codec=v}o.id=c.a.text,s.sampleDuration=0,s.duration=a.duration=r},e.resetContiguity=function(){},t.probe=function(t){return t=t.length>16384?t.subarray(0,16384):t,Object(c.c)(t,["moof"]).length>0},e.demux=function(t,e){this.timeOffset=e;var i=t,r=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=Object(c.b)(this.remainderData,t));var s=Object(c.l)(i);this.remainderData=s.remainder,r.samples=s.valid||new Uint8Array}else r.samples=i;var a=this.extractID3Track(r,e);return n.samples=Object(c.j)(e,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}},e.flush=function(){var t=this.timeOffset,e=this.videoTrack,i=this.txtTrack;e.samples=this.remainderData||new Uint8Array,this.remainderData=null;var r=this.extractID3Track(e,this.timeOffset);return i.samples=Object(c.j)(t,e),{videoTrack:e,audioTrack:u(),id3Track:r,textTrack:u()}},e.extractID3Track=function(t,e){var i=this.id3Track;if(t.samples.length){var r=Object(c.c)(t.samples,["emsg"]);r&&r.forEach((function(t){var r=Object(c.g)(t);if(A.test(r.schemeIdUri)){var n=Object(a.a)(r.presentationTime)?r.presentationTime/r.timeScale:e+r.presentationTimeDelta/r.timeScale,s=r.payload;i.samples.push({data:s,len:s.byteLength,dts:n,pts:n,type:l.a.emsg})}}))}return i},e.demuxSampleAes=function(t,e,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},e.destroy=function(){},t}(),D=null,L=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],R=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],C=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],O=[0,1,1,4];function P(t,e,i,r,n){if(!(i+24>e.length)){var s=x(e,i);if(s&&i+s.frameLength<=e.length){var a=r+n*(9e4*s.samplesPerFrame/s.sampleRate),o={unit:e.subarray(i,i+s.frameLength),pts:a,dts:a};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(o),{sample:o,length:s.frameLength,missing:0}}}}function x(t,e){var i=t[e+1]>>3&3,r=t[e+1]>>1&3,n=t[e+2]>>4&15,s=t[e+2]>>2&3;if(1!==i&&0!==n&&15!==n&&3!==s){var a=t[e+2]>>1&1,o=t[e+3]>>6,l=1e3*L[14*(3===i?3-r:3===r?3:4)+n-1],u=R[3*(3===i?0:2===i?1:2)+s],c=3===o?1:2,h=C[i][r],d=O[r],f=8*h*d,g=Math.floor(h*l/u+a)*d;if(null===D){var p=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);D=p?parseInt(p[1]):0}return!!D&&D<=87&&2===r&&l>=224e3&&0===o&&(t[e+3]=128|t[e+3]),{sampleRate:u,channelCount:c,frameLength:g,samplesPerFrame:f}}}function N(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])}function M(t,e){return e+1<t.length&&N(t,e)}function F(t,e){if(e+1<t.length&&N(t,e)){var i=x(t,e),r=4;null!=i&&i.frameLength&&(r=i.frameLength);var n=e+r;return n===t.length||M(t,n)}return!1}var U=function(){function t(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}var e=t.prototype;return e.loadWord=function(){var t=this.data,e=this.bytesAvailable,i=t.byteLength-e,r=new Uint8Array(4),n=Math.min(4,e);if(0===n)throw new Error("no bytes available");r.set(t.subarray(i,i+n)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n},e.skipBits=function(t){var e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},e.readBits=function(t){var e=Math.min(this.bitsAvailable,t),i=this.word>>>32-e;return t>32&&p.b.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),(e=t-e)>0&&this.bitsAvailable?i<<e|this.readBits(e):i},e.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},e.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.skipEG=function(){this.skipBits(1+this.skipLZ())},e.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},e.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},e.readBoolean=function(){return 1===this.readBits(1)},e.readUByte=function(){return this.readBits(8)},e.readUShort=function(){return this.readBits(16)},e.readUInt=function(){return this.readBits(32)},e.skipScalingList=function(t){for(var e=8,i=8,r=0;r<t;r++)0!==i&&(i=(e+this.readEG()+256)%256),e=0===i?e:i},e.readSPS=function(){var t,e,i,r=0,n=0,s=0,a=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),c=this.readBoolean.bind(this),h=this.skipBits.bind(this),d=this.skipEG.bind(this),f=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);o();var p=o();if(l(5),h(3),o(),f(),100===p||110===p||122===p||244===p||44===p||83===p||86===p||118===p||128===p){var m=u();if(3===m&&h(1),f(),f(),h(1),c())for(e=3!==m?8:12,i=0;i<e;i++)c()&&g(i<6?16:64)}f();var v=u();if(0===v)u();else if(1===v)for(h(1),d(),d(),t=u(),i=0;i<t;i++)d();f(),h(1);var y=u(),T=u(),b=l(1);0===b&&h(1),h(1),c()&&(r=u(),n=u(),s=u(),a=u());var E=[1,1];if(c()&&c())switch(o()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[o()<<8|o(),o()<<8|o()]}return{width:Math.ceil(16*(y+1)-2*r-2*n),height:(2-b)*(T+1)*16-(b?2:4)*(s+a),pixelRatio:E}},e.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}(),B=function(){function t(t,e,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new s.a(t,e,{removePKCS7Padding:!1})}var e=t.prototype;return e.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,e)},e.decryptAacSample=function(t,e,i,r){var n=t[e].unit;if(!(n.length<=16)){var s=n.subarray(16,n.length-n.length%16),a=s.buffer.slice(s.byteOffset,s.byteOffset+s.length),o=this;this.decryptBuffer(a,(function(s){var a=new Uint8Array(s);n.set(a,16),r||o.decryptAacSamples(t,e+1,i)}))}},e.decryptAacSamples=function(t,e,i){for(;;e++){if(e>=t.length)return void i();if(!(t[e].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(t,e,i,r),!r)return}}},e.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,i=new Int8Array(e),r=0,n=32;n<t.length-16;n+=160,r+=16)i.set(t.subarray(n,n+16),r);return i},e.getAvcDecryptedUnit=function(t,e){for(var i=new Uint8Array(e),r=0,n=32;n<t.length-16;n+=160,r+=16)t.set(i.subarray(r,r+16),n);return t},e.decryptAvcSample=function(t,e,i,r,n,s){var a=W(n.data),o=this.getAvcEncryptedData(a),l=this;this.decryptBuffer(o.buffer,(function(o){n.data=l.getAvcDecryptedUnit(a,o),s||l.decryptAvcSamples(t,e,i+1,r)}))},e.decryptAvcSamples=function(t,e,i,r){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,i=0){if(e>=t.length)return void r();for(var n=t[e].units;!(i>=n.length);i++){var s=n[i];if(!(s.data.length<=48||1!==s.type&&5!==s.type)){var a=this.decrypter.isSync();if(this.decryptAvcSample(t,e,i,r,s,a),!a)return}}}},t}();function V(){return(V=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}function j(t,e,i,r){return{key:t,frame:!1,pts:e,dts:i,units:[],debug:r,length:0}}function G(t,e){return(31&t[e+10])<<8|t[e+11]}function K(t,e,i,r){var n={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},s=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<s;){var a=(31&t[e+1])<<8|t[e+2];switch(t[e]){case 207:if(!r){p.b.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===n.audio&&(n.audio=a);break;case 21:-1===n.id3&&(n.id3=a);break;case 219:if(!r){p.b.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===n.avc&&(n.avc=a);break;case 3:case 4:!0!==i.mpeg&&!0!==i.mp3?p.b.log("MPEG audio found, not supported in this browser"):-1===n.audio&&(n.audio=a,n.segmentCodec="mp3");break;case 36:p.b.warn("Unsupported HEVC stream type found")}e+=5+((15&t[e+3])<<8|t[e+4])}return n}function H(t){var e,i,r,n,s,a=0,o=t.data;if(!t||0===t.size)return null;for(;o[0].length<19&&o.length>1;){var l=new Uint8Array(o[0].length+o[1].length);l.set(o[0]),l.set(o[1],o[0].length),o[0]=l,o.splice(1,1)}if(1===((e=o[0])[0]<<16)+(e[1]<<8)+e[2]){if((i=(e[4]<<8)+e[5])&&i>t.size-6)return null;var u=e[7];192&u&&(n=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&u?n-(s=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)>54e5&&(p.b.warn(Math.round((n-s)/9e4)+"s delta between PTS and DTS, align them"),n=s):s=n);var c=(r=e[8])+9;if(t.size<=c)return null;t.size-=c;for(var h=new Uint8Array(t.size),d=0,f=o.length;d<f;d++){var g=(e=o[d]).byteLength;if(c){if(c>g){c-=g;continue}e=e.subarray(c),g-=c,c=0}h.set(e,a),a+=g}return i&&(i-=r+3),{data:h,pts:n,dts:s,len:i}}return null}function q(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){var i=e.samples,r=i.length;if(!r)return void e.dropped++;var n=i[r-1];t.pts=n.pts,t.dts=n.dts}e.samples.push(t)}t.debug.length&&p.b.log(t.pts+"/"+t.dts+":"+t.debug)}function W(t){for(var e=t.byteLength,i=[],r=1;r<e-2;)0===t[r]&&0===t[r+1]&&3===t[r+2]?(i.push(r+2),r+=2):r++;if(0===i.length)return t;var n=e-i.length,s=new Uint8Array(n),a=0;for(r=0;r<n;a++,r++)a===i[0]&&(a++,i.shift()),s[r]=t[a];return s}var z=function(){function t(t,e,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=e,this.typeSupported=i}t.probe=function(t){return 71===t[0]&&71===t[188]},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:c.a[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}};var e=t.prototype;return e.resetInitSegment=function(e,i,r,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video"),this._audioTrack=t.createTrack("audio",n),this._id3Track=t.createTrack("id3"),this._txtTrack=t.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=i,this.videoCodec=r,this._duration=n},e.resetTimeStamp=function(){},e.resetContiguity=function(){var t=this._audioTrack,e=this._avcTrack,i=this._id3Track;t&&(t.pesData=null),e&&(e.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null},e.demux=function(t,e,i,s){var a;void 0===i&&(i=!1),void 0===s&&(s=!1),i||(this.sampleAes=null);var o=this._avcTrack,l=this._audioTrack,u=this._id3Track,h=this._txtTrack,d=o.pid,f=o.pesData,g=l.pid,m=u.pid,v=l.pesData,y=u.pesData,T=null,b=this.pmtParsed,E=this._pmtId,S=t.length;if(this.remainderData&&(S=(t=Object(c.b)(this.remainderData,t)).length,this.remainderData=null),S<188&&!s)return this.remainderData=t,{audioTrack:l,videoTrack:o,id3Track:u,textTrack:h};(S-=S%188)<t.byteLength&&!s&&(this.remainderData=new Uint8Array(t.buffer,S,t.buffer.byteLength-S));for(var w=0,I=0;I<S;I+=188)if(71===t[I]){var _=!!(64&t[I+1]),A=((31&t[I+1])<<8)+t[I+2],k=void 0;if((48&t[I+3])>>4>1){if((k=I+5+t[I+4])===I+188)continue}else k=I+4;switch(A){case d:_&&(f&&(a=H(f))&&this.parseAVCPES(o,h,a,!1),f={data:[],size:0}),f&&(f.data.push(t.subarray(k,I+188)),f.size+=I+188-k);break;case g:if(_){if(v&&(a=H(v)))switch(l.segmentCodec){case"aac":this.parseAACPES(l,a);break;case"mp3":this.parseMPEGPES(l,a)}v={data:[],size:0}}v&&(v.data.push(t.subarray(k,I+188)),v.size+=I+188-k);break;case m:_&&(y&&(a=H(y))&&this.parseID3PES(u,a),y={data:[],size:0}),y&&(y.data.push(t.subarray(k,I+188)),y.size+=I+188-k);break;case 0:_&&(k+=t[k]+1),E=this._pmtId=G(t,k);break;case E:_&&(k+=t[k]+1);var D=K(t,k,this.typeSupported,i);(d=D.avc)>0&&(o.pid=d),(g=D.audio)>0&&(l.pid=g,l.segmentCodec=D.segmentCodec),(m=D.id3)>0&&(u.pid=m),null===T||b||(p.b.log("unknown PID '"+T+"' in TS found"),T=null),b=this.pmtParsed=!0;break;case 17:case 8191:break;default:T=A}}else w++;w>0&&this.observer.emit(r.a.ERROR,r.a.ERROR,{type:n.b.MEDIA_ERROR,details:n.a.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+w+" TS packet/s that do not start with 0x47"}),o.pesData=f,l.pesData=v,u.pesData=y;var L={audioTrack:l,videoTrack:o,id3Track:u,textTrack:h};return s&&this.extractRemainingSamples(L),L},e.flush=function(){var t,e=this.remainderData;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},e.extractRemainingSamples=function(t){var e,i=t.audioTrack,r=t.videoTrack,n=t.id3Track,s=t.textTrack,a=r.pesData,o=i.pesData,l=n.pesData;if(a&&(e=H(a))?(this.parseAVCPES(r,s,e,!0),r.pesData=null):r.pesData=a,o&&(e=H(o))){switch(i.segmentCodec){case"aac":this.parseAACPES(i,e);break;case"mp3":this.parseMPEGPES(i,e)}i.pesData=null}else null!=o&&o.size&&p.b.log("last AAC PES packet truncated,might overlap between fragments"),i.pesData=o;l&&(e=H(l))?(this.parseID3PES(n,e),n.pesData=null):n.pesData=l},e.demuxSampleAes=function(t,e,i){var r=this.demux(t,i,!0,!this.config.progressive),n=this.sampleAes=new B(this.observer,this.config,e);return this.decrypt(r,n)},e.decrypt=function(t,e){return new Promise((function(i){var r=t.audioTrack,n=t.videoTrack;r.samples&&"aac"===r.segmentCodec?e.decryptAacSamples(r.samples,0,(function(){n.samples?e.decryptAvcSamples(n.samples,0,0,(function(){i(t)})):i(t)})):n.samples&&e.decryptAvcSamples(n.samples,0,0,(function(){i(t)}))}))},e.destroy=function(){this._duration=0},e.parseAVCPES=function(t,e,i,r){var n,s=this,a=this.parseAVCNALu(t,i.data),o=this.avcSample,l=!1;i.data=null,o&&a.length&&!t.audFound&&(q(o,t),o=this.avcSample=j(!1,i.pts,i.dts,"")),a.forEach((function(r){switch(r.type){case 1:n=!0,o||(o=s.avcSample=j(!0,i.pts,i.dts,"")),o.frame=!0;var a=r.data;if(l&&a.length>4){var u=new U(a).readSliceType();2!==u&&4!==u&&7!==u&&9!==u||(o.key=!0)}break;case 5:n=!0,o||(o=s.avcSample=j(!0,i.pts,i.dts,"")),o.key=!0,o.frame=!0;break;case 6:n=!0,Object(c.i)(W(r.data),i.pts,e.samples);break;case 7:if(n=!0,l=!0,!t.sps){var h=new U(r.data).readSPS();t.width=h.width,t.height=h.height,t.pixelRatio=h.pixelRatio,t.sps=[r.data],t.duration=s._duration;for(var d=r.data.subarray(1,4),f="avc1.",g=0;g<3;g++){var p=d[g].toString(16);p.length<2&&(p="0"+p),f+=p}t.codec=f}break;case 8:n=!0,t.pps||(t.pps=[r.data]);break;case 9:n=!1,t.audFound=!0,o&&q(o,t),o=s.avcSample=j(!1,i.pts,i.dts,"");break;case 12:n=!0;break;default:n=!1,o&&(o.debug+="unknown NAL "+r.type+" ")}o&&n&&o.units.push(r)})),r&&o&&(q(o,t),this.avcSample=null)},e.getLastNalUnit=function(t){var e,i,r=this.avcSample;if(r&&0!==r.units.length||(r=t[t.length-1]),null!==(e=r)&&void 0!==e&&e.units){var n=r.units;i=n[n.length-1]}return i},e.parseAVCNALu=function(t,e){var i,r,n=e.byteLength,s=t.naluState||0,a=s,o=[],l=0,u=-1,c=0;for(-1===s&&(u=0,c=31&e[0],s=0,l=1);l<n;)if(i=e[l++],s)if(1!==s)if(i)if(1===i){if(u>=0){var h={data:e.subarray(u,l-s-1),type:c};o.push(h)}else{var d=this.getLastNalUnit(t.samples);if(d&&(a&&l<=4-a&&d.state&&(d.data=d.data.subarray(0,d.data.byteLength-a)),(r=l-s-1)>0)){var f=new Uint8Array(d.data.byteLength+r);f.set(d.data,0),f.set(e.subarray(0,r),d.data.byteLength),d.data=f,d.state=0}}l<n?(u=l,c=31&e[l],s=0):s=-1}else s=0;else s=3;else s=i?0:2;else s=i?0:1;if(u>=0&&s>=0){var g={data:e.subarray(u,n),type:c,state:s};o.push(g)}if(0===o.length){var p=this.getLastNalUnit(t.samples);if(p){var m=new Uint8Array(p.data.byteLength+e.byteLength);m.set(p.data,0),m.set(e,p.data.byteLength),p.data=m}}return t.naluState=s,o},e.parseAACPES=function(t,e){var i,s,a,o,l,u=0,c=this.aacOverFlow,h=e.data;if(c){this.aacOverFlow=null;var d=c.missing,f=c.sample.unit.byteLength;if(-1===d){var g=new Uint8Array(f+h.byteLength);g.set(c.sample.unit,0),g.set(h,f),h=g}else{var m=f-d;c.sample.unit.set(h.subarray(0,d),m),t.samples.push(c.sample),u=c.missing}}for(i=u,s=h.length;i<s-1&&!T(h,i);i++);if(i===u||(i<s-1?(a="AAC PES did not start with ADTS header,offset:"+i,o=!1):(a="no ADTS header found in AAC PES",o=!0),p.b.warn("parsing error:"+a),this.observer.emit(r.a.ERROR,r.a.ERROR,{type:n.b.MEDIA_ERROR,details:n.a.FRAG_PARSING_ERROR,fatal:o,reason:a}),!o)){if(E(t,this.observer,h,i,this.audioCodec),void 0!==e.pts)l=e.pts;else{if(!c)return void p.b.warn("[tsdemuxer]: AAC PES unknown PTS");var v=S(t.samplerate);l=c.sample.pts+v}for(var y,b=0;i<s;){if(i+=(y=w(t,h,i,l,b)).length,y.missing){this.aacOverFlow=y;break}for(b++;i<s-1&&!T(h,i);i++);}}},e.parseMPEGPES=function(t,e){var i=e.data,r=i.length,n=0,s=0,a=e.pts;if(void 0!==a)for(;s<r;)if(M(i,s)){var o=P(t,i,s,a,n);if(!o)break;s+=o.length,n++}else s++;else p.b.warn("[tsdemuxer]: MPEG PES unknown PTS")},e.parseID3PES=function(t,e){if(void 0!==e.pts){var i=V({},e,{type:this._avcTrack?l.a.emsg:l.a.audioId3});t.samples.push(i)}else p.b.warn("[tsdemuxer]: ID3 PES unknown PTS")},t}();function Y(t,e){return(Y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var $=function(t){var e,i;function r(){return t.apply(this,arguments)||this}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,Y(e,i);var n=r.prototype;return n.resetInitSegment=function(e,i,r,n){t.prototype.resetInitSegment.call(this,e,i,r,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:i,duration:n,inputTimeScale:9e4,dropped:0}},r.probe=function(t){if(!t)return!1;for(var e=(o.b(t,0)||[]).length,i=t.length;e<i;e++)if(F(t,e))return p.b.log("MPEG Audio sync word found !"),!0;return!1},n.canParse=function(t,e){return function(t,e){return N(t,e)&&4<=t.length-e}(t,e)},n.appendFrame=function(t,e,i){if(null!==this.basePTS)return P(t,e,i,this.basePTS,this.frameIndex)},r}(g),X=i(13),Q=i(6);function J(t,e){var i=null==t?void 0:t.codec;return i&&i.length>4?i:"hvc1"===i||"hev1"===i?"hvc1.1.c.L120.90":"av01"===i?"av01.0.04M.08":"avc1"===i||e===Q.a.VIDEO?"avc1.42e01e":"mp4a.40.5"}var Z,tt=function(){function t(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){this.initPTS=t,this.lastEndTime=null},e.resetNextTimestamp=function(){this.lastEndTime=null},e.resetInitSegment=function(t,e,i){this.audioCodec=e,this.videoCodec=i,this.generateInitSegment(t),this.emitInitSegment=!0},e.generateInitSegment=function(t){var e=this.audioCodec,i=this.videoCodec;if(!t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var r=this.initData=Object(c.h)(t);e||(e=J(r.audio,Q.a.AUDIO)),i||(i=J(r.video,Q.a.VIDEO));var n={};r.audio&&r.video?n.audiovideo={container:"video/mp4",codec:e+","+i,initSegment:t,id:"main"}:r.audio?n.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:r.video?n.video={container:"video/mp4",codec:i,initSegment:t,id:"main"}:p.b.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n},e.remux=function(t,e,i,r,n){var s,o=this.initPTS,l=this.lastEndTime,u={audio:void 0,video:void 0,text:r,id3:i,initSegment:void 0};Object(a.a)(l)||(l=this.lastEndTime=n||0);var h=e.samples;if(!h||!h.length)return u;var d={initPTS:void 0,timescale:1},f=this.initData;if(f&&f.length||(this.generateInitSegment(h),f=this.initData),!f||!f.length)return p.b.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),u;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1);var g=Object(c.e)(f,h);Object(a.a)(o)||(this.initPTS=d.initPTS=o=g-n);var m=Object(c.d)(h,f),v=t?g-o:l,y=v+m;Object(c.f)(f,h,o),m>0?this.lastEndTime=y:(p.b.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var T=!!f.audio,b=!!f.video,E="";T&&(E+="audio"),b&&(E+="video");var S={data1:h,startPTS:v,startDTS:v,endPTS:y,endDTS:y,type:E,hasAudio:T,hasVideo:b,nb:1,dropped:0};u.audio="audio"===S.type?S:void 0,u.video="audio"!==S.type?S:void 0,u.initSegment=d;var w=null!=(s=this.initPTS)?s:0;return u.id3=Object(X.b)(i,n,w,w),r.samples.length&&(u.text=Object(X.c)(r,n,w)),u},t}();try{Z=self.performance.now.bind(self.performance)}catch(t){p.b.debug("Unable to use Performance API on this environment"),Z=self.Date.now}var et=[{demux:z,remux:X.a},{demux:k,remux:tt},{demux:_,remux:X.a},{demux:$,remux:X.a}],it=function(){function t(t,e,i,r,n){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=t,this.typeSupported=e,this.config=i,this.vendor=r,this.id=n}var e=t.prototype;return e.configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},e.push=function(t,e,i,r){var n=this,s=i.transmuxing;s.executeStart=Z();var a=new Uint8Array(t),o=this.config,l=this.currentTransmuxState,u=this.transmuxConfig;r&&(this.currentTransmuxState=r);var c=r||l,h=c.contiguous,d=c.discontinuity,f=c.trackSwitch,g=c.accurateTimeOffset,p=c.timeOffset,m=c.initSegmentChange,v=u.audioCodec,y=u.videoCodec,T=u.defaultInitPts,b=u.duration,E=u.initSegmentData;(d||f||m)&&this.resetInitSegment(E,v,y,b),(d||m)&&this.resetInitialTimestamp(T),h||this.resetContiguity();var S=function(t,e){var i=null;return t.byteLength>0&&null!=e&&null!=e.key&&null!==e.iv&&null!=e.method&&(i=e),i}(a,e);if(S&&"AES-128"===S.method){var w=this.getDecrypter();if(!o.enableSoftwareAES)return this.decryptionPromise=w.webCryptoDecrypt(a,S.key.buffer,S.iv.buffer).then((function(t){var e=n.push(t,null,i);return n.decryptionPromise=null,e})),this.decryptionPromise;var I=w.softwareDecrypt(a,S.key.buffer,S.iv.buffer);if(!I)return s.executeEnd=Z(),rt(i);a=new Uint8Array(I)}this.needsProbing(a,d,f)&&this.configureTransmuxer(a,u);var _=this.transmux(a,S,p,g,i),A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,s.executeEnd=Z(),_},e.flush=function(t){var e=this,i=t.transmuxing;i.executeStart=Z();var s=this.decrypter,a=this.currentTransmuxState,o=this.decryptionPromise;if(o)return o.then((function(){return e.flush(t)}));var l=[],u=a.timeOffset;if(s){var c=s.flush();c&&l.push(this.push(c,null,t))}var h=this.demuxer,d=this.remuxer;if(!h||!d)return this.observer.emit(r.a.ERROR,r.a.ERROR,{type:n.b.MEDIA_ERROR,details:n.a.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),i.executeEnd=Z(),[rt(t)];var f=h.flush(u);return nt(f)?f.then((function(i){return e.flushRemux(l,i,t),l})):(this.flushRemux(l,f,t),l)},e.flushRemux=function(t,e,i){var r=e.audioTrack,n=e.videoTrack,s=e.id3Track,a=e.textTrack,o=this.currentTransmuxState,l=o.accurateTimeOffset,u=o.timeOffset;p.b.log("[transmuxer.ts]: Flushed fragment "+i.sn+(i.part>-1?" p: "+i.part:"")+" of level "+i.level);var c=this.remuxer.remux(r,n,s,a,u,l,!0,this.id);t.push({remuxResult:c,chunkMeta:i}),i.transmuxing.executeEnd=Z()},e.resetInitialTimestamp=function(t){var e=this.demuxer,i=this.remuxer;e&&i&&(e.resetTimeStamp(t),i.resetTimeStamp(t))},e.resetContiguity=function(){var t=this.demuxer,e=this.remuxer;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())},e.resetInitSegment=function(t,e,i,r){var n=this.demuxer,s=this.remuxer;n&&s&&(n.resetInitSegment(t,e,i,r),s.resetInitSegment(t,e,i))},e.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},e.transmux=function(t,e,i,r,n){return e&&"SAMPLE-AES"===e.method?this.transmuxSampleAes(t,e,i,r,n):this.transmuxUnencrypted(t,i,r,n)},e.transmuxUnencrypted=function(t,e,i,r){var n=this.demuxer.demux(t,e,!1,!this.config.progressive),s=n.audioTrack,a=n.videoTrack,o=n.id3Track,l=n.textTrack;return{remuxResult:this.remuxer.remux(s,a,o,l,e,i,!1,this.id),chunkMeta:r}},e.transmuxSampleAes=function(t,e,i,r,n){var s=this;return this.demuxer.demuxSampleAes(t,e,i).then((function(t){return{remuxResult:s.remuxer.remux(t.audioTrack,t.videoTrack,t.id3Track,t.textTrack,i,r,!1,s.id),chunkMeta:n}}))},e.configureTransmuxer=function(t,e){for(var i,r=this.config,n=this.observer,s=this.typeSupported,a=this.vendor,o=e.audioCodec,l=e.defaultInitPts,u=e.duration,c=e.initSegmentData,h=e.videoCodec,d=0,f=et.length;d<f;d++)if(et[d].demux.probe(t)){i=et[d];break}i||(p.b.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),i={demux:k,remux:tt});var g=this.demuxer,m=this.remuxer,v=i.remux,y=i.demux;m&&m instanceof v||(this.remuxer=new v(n,r,s,a)),g&&g instanceof y||(this.demuxer=new y(n,r,s),this.probe=y.probe),this.resetInitSegment(c,o,h,u),this.resetInitialTimestamp(l)},e.needsProbing=function(t,e,i){return!this.demuxer||!this.remuxer||e||i},e.getDecrypter=function(){var t=this.decrypter;return t||(t=this.decrypter=new s.a(this.observer,this.config)),t},t}(),rt=function(t){return{remuxResult:{},chunkMeta:t}};function nt(t){return"then"in t&&t.then instanceof Function}var st=function(t,e,i,r,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=i,this.duration=r,this.defaultInitPts=n},at=function(t,e,i,r,n,s){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=i,this.trackSwitch=r,this.timeOffset=n,this.initSegmentChange=s}},function(t,e,i){"use strict";function r(t,e,i,r){void 0===i&&(i=1),void 0===r&&(r=!1);var n=t*e*i;return r?Math.round(n):n}function n(t,e,i,n){return void 0===i&&(i=1),void 0===n&&(n=!1),r(t,e,1/i,n)}function s(t,e){return void 0===e&&(e=!1),r(t,1e3,1/9e4,e)}function a(t,e){return void 0===e&&(e=1),r(t,9e4,1/e)}i.d(e,"c",(function(){return n})),i.d(e,"b",(function(){return s})),i.d(e,"a",(function(){return a}))},function(t,e,i){var r,n,s,a,o;r=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(t,e,i){if(i=i||{},t=t.trim(),!(e=e.trim())){if(!i.alwaysNormalize)return t;var r=o.parseURL(t);if(!r)throw new Error("Error trying to parse base URL.");return r.path=o.normalizePath(r.path),o.buildURLFromParts(r)}var s=o.parseURL(e);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return i.alwaysNormalize?(s.path=o.normalizePath(s.path),o.buildURLFromParts(s)):e;var a=o.parseURL(t);if(!a)throw new Error("Error trying to parse base URL.");if(!a.netLoc&&a.path&&"/"!==a.path[0]){var l=n.exec(a.path);a.netLoc=l[1],a.path=l[2]}a.netLoc&&!a.path&&(a.path="/");var u={scheme:a.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(u.netLoc=a.netLoc,"/"!==s.path[0]))if(s.path){var c=a.path,h=c.substring(0,c.lastIndexOf("/")+1)+s.path;u.path=o.normalizePath(h)}else u.path=a.path,s.params||(u.params=a.params,s.query||(u.query=a.query));return null===u.path&&(u.path=i.alwaysNormalize?o.normalizePath(s.path):s.path),o.buildURLFromParts(u)},parseURL:function(t){var e=r.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(s,"");t.length!==(t=t.replace(a,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=o},function(t,e,i){"use strict";i.d(e,"a",(function(){return v})),i.d(e,"d",(function(){return y})),i.d(e,"b",(function(){return T})),i.d(e,"c",(function(){return b}));var r=i(3),n=function(){function t(){}return t.getSilentFrame=function(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},t}(),s=Math.pow(2,32)-1,a=function(){function t(){}return t.init=function(){var e;for(e in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:i,audio:r};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=s,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,a,l,a,o),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,n))},t.box=function(t){for(var e=8,i=arguments.length,r=new Array(i>1?i-1:0),n=1;n<i;n++)r[n-1]=arguments[n];for(var s=r.length,a=s;s--;)e+=r[s].byteLength;var o=new Uint8Array(e);for(o[0]=e>>24&255,o[1]=e>>16&255,o[2]=e>>8&255,o[3]=255&e,o.set(t,4),s=0,e=8;s<a;s++)o.set(r[s],e),e+=r[s].byteLength;return o},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,i){i*=e;var r=Math.floor(i/(s+1)),n=Math.floor(i%(s+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,i,r){return t.box(t.types.moof,t.mfhd(e),t.traf(r,i))},t.moov=function(e){for(var i=e.length,r=[];i--;)r[i]=t.trak(e[i]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(t.mvex(e)))},t.mvex=function(e){for(var i=e.length,r=[];i--;)r[i]=t.trex(e[i]);return t.box.apply(null,[t.types.mvex].concat(r))},t.mvhd=function(e,i){i*=e;var r=Math.floor(i/(s+1)),n=Math.floor(i%(s+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,a)},t.sdtp=function(e){var i,r,n=e.samples||[],s=new Uint8Array(4+n.length);for(i=0;i<n.length;i++)r=n[i].flags,s[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return t.box(t.types.sdtp,s)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(e){var i,r,n,s=[],a=[];for(i=0;i<e.sps.length;i++)n=(r=e.sps[i]).byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(r));for(i=0;i<e.pps.length;i++)n=(r=e.pps[i]).byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(r));var o=t.box(t.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|e.sps.length].concat(s).concat([e.pps.length]).concat(a))),l=e.width,u=e.height,c=e.pixelRatio[0],h=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,h>>24,h>>16&255,h>>8&255,255&h])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.mp4a=function(e){var i=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){var i=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},t.stsd=function(e){return"audio"===e.type?"mp3"===e.segmentCodec&&"mp3"===e.codec?t.box(t.types.stsd,t.STSD,t.mp3(e)):t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))},t.tkhd=function(e){var i=e.id,r=e.duration*e.timescale,n=e.width,a=e.height,o=Math.floor(r/(s+1)),l=Math.floor(r%(s+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,255&n,0,0,a>>8&255,255&a,0,0]))},t.traf=function(e,i){var r=t.sdtp(e),n=e.id,a=Math.floor(i/(s+1)),o=Math.floor(i%(s+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,o>>24,o>>16&255,o>>8&255,255&o])),t.trun(e,r.length+16+20+8+16+8+8),r)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var i=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,i){var r,n,s,a,o,l,u=e.samples||[],c=u.length,h=12+16*c,d=new Uint8Array(h);for(i+=8+h,d.set(["video"===e.type?1:0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),r=0;r<c;r++)s=(n=u[r]).duration,a=n.size,o=n.flags,l=n.cts,d.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*r);return t.box(t.types.trun,d)},t.initSegment=function(e){t.types||t.init();var i=t.moov(e),r=new Uint8Array(t.FTYP.byteLength+i.byteLength);return r.set(t.FTYP),r.set(i,t.FTYP.byteLength),r},t}();a.types=void 0,a.HDLR_TYPES=void 0,a.STTS=void 0,a.STSC=void 0,a.STCO=void 0,a.STSZ=void 0,a.VMHD=void 0,a.SMHD=void 0,a.STSD=void 0,a.FTYP=void 0,a.DINF=void 0;var o=a,l=i(0),u=i(2),c=i(1),h=i(4),d=i(11);function f(){return(f=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}var g=null,p=null,m=!1,v=function(){function t(t,e,i,r){if(void 0===r&&(r=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=e,this.typeSupported=i,this.ISGenerated=!1,null===g){var n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);g=n?parseInt(n[1]):0}if(null===p){var s=navigator.userAgent.match(/Safari\/(\d+)/i);p=s?parseInt(s[1]):0}m=!(g&&g>=75||p&&p>=600)}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){c.b.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},e.resetNextTimestamp=function(){c.b.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},e.resetInitSegment=function(){c.b.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},e.getVideoStartPts=function(t){var e=!1,i=t.reduce((function(t,i){var r=i.pts-t;return r<-4294967296?(e=!0,y(t,i.pts)):r>0?t:i.pts}),t[0].pts);return e&&c.b.debug("PTS rollover detected"),i},e.remux=function(t,e,i,r,n,s,a,o){var l,u,d,f,g,p,m=n,v=n,E=t.pid>-1,S=e.pid>-1,w=e.samples.length,I=t.samples.length>0,_=a&&w>0||w>1;if((!E||I)&&(!S||_)||this.ISGenerated||a){this.ISGenerated||(d=this.generateIS(t,e,n));var A,k=this.isVideoContiguous,D=-1;if(_&&(D=function(t){for(var e=0;e<t.length;e++)if(t[e].key)return e;return-1}(e.samples),!k&&this.config.forceKeyFrameOnDiscontinuity))if(p=!0,D>0){c.b.warn("[mp4-remuxer]: Dropped "+D+" out of "+w+" video samples due to a missing keyframe");var L=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(D),e.dropped+=D,A=v+=(e.samples[0].pts-L)/e.inputTimeScale}else-1===D&&(c.b.warn("[mp4-remuxer]: No keyframe found out of "+w+" video samples"),p=!1);if(this.ISGenerated){if(I&&_){var R=this.getVideoStartPts(e.samples),C=(y(t.samples[0].pts,R)-R)/e.inputTimeScale;m+=Math.max(0,C),v+=Math.max(0,-C)}if(I){if(t.samplerate||(c.b.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(t,e,n)),u=this.remuxAudio(t,m,this.isAudioContiguous,s,S||_||o===h.b.AUDIO?v:void 0),_){var O=u?u.endPTS-u.startPTS:0;e.inputTimeScale||(c.b.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(t,e,n)),l=this.remuxVideo(e,v,k,O)}}else _&&(l=this.remuxVideo(e,v,k,0));l&&(l.firstKeyFrame=D,l.independent=-1!==D,l.firstKeyFramePTS=A)}}return this.ISGenerated&&(i.samples.length&&(g=T(i,n,this._initPTS,this._initDTS)),r.samples.length&&(f=b(r,n,this._initPTS))),{audio:u,video:l,initSegment:d,independent:p,text:f,id3:g}},e.generateIS=function(t,e,i){var n,s,a,l=t.samples,u=e.samples,c=this.typeSupported,h={},d=!Object(r.a)(this._initPTS),f="audio/mp4";if(d&&(n=s=1/0),t.config&&l.length&&("mp3"===(t.timescale=t.samplerate,t.segmentCodec)&&(c.mpeg?(f="audio/mpeg",t.codec=""):c.mp3&&(t.codec="mp3")),h.audio={id:"audio",container:f,codec:t.codec,initSegment:"mp3"===t.segmentCodec&&c.mpeg?new Uint8Array(0):o.initSegment([t]),metadata:{channelCount:t.channelCount}},d&&(a=t.inputTimeScale,n=s=l[0].pts-Math.round(a*i))),e.sps&&e.pps&&u.length&&(e.timescale=e.inputTimeScale,h.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:o.initSegment([e]),metadata:{width:e.width,height:e.height}},d)){a=e.inputTimeScale;var g=this.getVideoStartPts(u),p=Math.round(a*i);s=Math.min(s,y(u[0].dts,g)-p),n=Math.min(n,g-p)}if(Object.keys(h).length)return this.ISGenerated=!0,d&&(this._initPTS=n,this._initDTS=s),{tracks:h,initPTS:n,timescale:a}},e.remuxVideo=function(t,e,i,r){var n,s,a=t.inputTimeScale,h=t.samples,v=[],T=h.length,b=this._initPTS,S=this.nextAvcDts,w=8,I=this.videoSampleDuration,_=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,k=!1;i&&null!==S||(S=e*a-(h[0].pts-y(h[0].dts,h[0].pts)));for(var D=0;D<T;D++){var L=h[D];L.pts=y(L.pts-b,S),L.dts=y(L.dts-b,S),L.dts<h[D>0?D-1:D].dts&&(k=!0)}k&&h.sort((function(t,e){var i=t.dts-e.dts,r=t.pts-e.pts;return i||r})),n=h[0].dts;var R=h[h.length-1].dts-n,C=R?Math.round(R/(T-1)):I||t.inputTimeScale/30;if(i){var O=n-S,P=O>C;if(P||O<-1){P?c.b.warn("AVC: "+Object(d.b)(O,!0)+" ms ("+O+"dts) hole between fragments detected, filling it"):c.b.warn("AVC: "+Object(d.b)(-O,!0)+" ms ("+O+"dts) overlapping between fragments detected"),n=S;var x=h[0].pts-O;h[0].dts=n,h[0].pts=x,c.b.log("Video: First PTS/DTS adjusted: "+Object(d.b)(x,!0)+"/"+Object(d.b)(n,!0)+", delta: "+Object(d.b)(O,!0)+" ms")}}m&&(n=Math.max(0,n));for(var N=0,M=0,F=0;F<T;F++){for(var U=h[F],B=U.units,V=B.length,j=0,G=0;G<V;G++)j+=B[G].data.length;M+=j,N+=V,U.length=j,U.dts=Math.max(U.dts,n),_=Math.min(U.pts,_),A=Math.max(U.pts,A)}s=h[T-1].dts;var K,H=M+4*N+8;try{K=new Uint8Array(H)}catch(t){return void this.observer.emit(l.a.ERROR,l.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:H,reason:"fail allocating video mdat "+H})}var q=new DataView(K.buffer);q.setUint32(0,H),K.set(o.types.mdat,4);for(var W=!1,z=Number.POSITIVE_INFINITY,Y=Number.POSITIVE_INFINITY,$=Number.NEGATIVE_INFINITY,X=Number.NEGATIVE_INFINITY,Q=0;Q<T;Q++){for(var J=h[Q],Z=J.units,tt=0,et=0,it=Z.length;et<it;et++){var rt=Z[et],nt=rt.data,st=rt.data.byteLength;q.setUint32(w,st),w+=4,K.set(nt,w),w+=st,tt+=4+st}var at=void 0;if(Q<T-1)I=h[Q+1].dts-J.dts,at=h[Q+1].pts-J.pts;else{var ot=this.config,lt=Q>0?J.dts-h[Q-1].dts:C;if(at=Q>0?J.pts-h[Q-1].pts:C,ot.stretchShortVideoTrack&&null!==this.nextAudioPts){var ut=Math.floor(ot.maxBufferHole*a),ct=(r?_+r*a:this.nextAudioPts)-J.pts;ct>ut?((I=ct-lt)<0?I=lt:W=!0,c.b.log("[mp4-remuxer]: It is approximately "+ct/90+" ms to the next segment; using duration "+I/90+" ms for the last video frame.")):I=lt}else I=lt}var ht=Math.round(J.pts-J.dts);z=Math.min(z,I),$=Math.max($,I),Y=Math.min(Y,at),X=Math.max(X,at),v.push(new E(J.key,I,tt,ht))}if(v.length)if(g){if(g<70){var dt=v[0].flags;dt.dependsOn=2,dt.isNonSync=0}}else if(p&&X-Y<$-z&&C/$<.025&&0===v[0].cts){c.b.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var ft=n,gt=0,pt=v.length;gt<pt;gt++){var mt=ft+v[gt].duration,vt=ft+v[gt].cts;if(gt<pt-1){var yt=mt+v[gt+1].cts;v[gt].duration=yt-vt}else v[gt].duration=gt?v[gt-1].duration:C;v[gt].cts=0,ft=mt}}I=W||!I?C:I,this.nextAvcDts=S=s+I,this.videoSampleDuration=I,this.isVideoContiguous=!0;var Tt={data1:o.moof(t.sequenceNumber++,n,f({},t,{samples:v})),data2:K,startPTS:_/a,endPTS:(A+I)/a,startDTS:n/a,endDTS:S/a,type:"video",hasAudio:!1,hasVideo:!0,nb:v.length,dropped:t.dropped};return t.samples=[],t.dropped=0,Tt},e.remuxAudio=function(t,e,i,r,s){var a=t.inputTimeScale,h=a/(t.samplerate?t.samplerate:a),d="aac"===t.segmentCodec?1024:1152,g=d*h,p=this._initPTS,m="mp3"===t.segmentCodec&&this.typeSupported.mpeg,v=[],T=void 0!==s,b=t.samples,S=m?0:8,w=this.nextAudioPts||-1,I=e*a;if(this.isAudioContiguous=i=i||b.length&&w>0&&(r&&Math.abs(I-w)<9e3||Math.abs(y(b[0].pts-p,I)-w)<20*g),b.forEach((function(t){t.pts=y(t.pts-p,I)})),!i||w<0){if(!(b=b.filter((function(t){return t.pts>=0}))).length)return;w=0===s?0:r&&!T?Math.max(0,I):b[0].pts}if("aac"===t.segmentCodec)for(var _=this.config.maxAudioFramesDrift,A=0,k=w;A<b.length;A++){var D=b[A],L=D.pts,R=L-k,C=Math.abs(1e3*R/a);if(R<=-_*g&&T)0===A&&(c.b.warn("Audio frame @ "+(L/a).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*R/a)+" ms."),this.nextAudioPts=w=k=L);else if(R>=_*g&&C<1e4&&T){var O=Math.round(R/g);(k=L-O*g)<0&&(O--,k+=g),0===A&&(this.nextAudioPts=w=k),c.b.warn("[mp4-remuxer]: Injecting "+O+" audio frame @ "+(k/a).toFixed(3)+"s due to "+Math.round(1e3*R/a)+" ms gap.");for(var P=0;P<O;P++){var x=Math.max(k,0),N=n.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);N||(c.b.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),N=D.unit.subarray()),b.splice(A,0,{unit:N,pts:x}),k+=g,A++}}D.pts=k,k+=g}for(var M,F=null,U=null,B=0,V=b.length;V--;)B+=b[V].unit.byteLength;for(var j=0,G=b.length;j<G;j++){var K=b[j],H=K.unit,q=K.pts;if(null!==U)v[j-1].duration=Math.round((q-U)/h);else{if(i&&"aac"===t.segmentCodec&&(q=w),F=q,!(B>0))return;B+=S;try{M=new Uint8Array(B)}catch(t){return void this.observer.emit(l.a.ERROR,l.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:B,reason:"fail allocating audio mdat "+B})}m||(new DataView(M.buffer).setUint32(0,B),M.set(o.types.mdat,4))}M.set(H,S);var W=H.byteLength;S+=W,v.push(new E(!0,d,W,0)),U=q}var z=v.length;if(z){var Y=v[v.length-1];this.nextAudioPts=w=U+h*Y.duration;var $=m?new Uint8Array(0):o.moof(t.sequenceNumber++,F/h,f({},t,{samples:v}));t.samples=[];var X=F/a,Q=w/a,J={data1:$,data2:M,startPTS:X,endPTS:Q,startDTS:X,endDTS:Q,type:"audio",hasAudio:!0,hasVideo:!1,nb:z};return this.isAudioContiguous=!0,J}},e.remuxEmptyAudio=function(t,e,i,r){var s=t.inputTimeScale,a=s/(t.samplerate?t.samplerate:s),o=this.nextAudioPts,l=(null!==o?o:r.startDTS*s)+this._initDTS,u=r.endDTS*s+this._initDTS,h=1024*a,d=Math.ceil((u-l)/h),f=n.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(c.b.warn("[mp4-remuxer]: remux empty Audio"),f){for(var g=[],p=0;p<d;p++){var m=l+p*h;g.push({unit:f,pts:m,dts:m})}return t.samples=g,this.remuxAudio(t,e,i,!1)}c.b.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},t}();function y(t,e){var i;if(null===e)return t;for(i=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=i;return t}function T(t,e,i,r){var n=t.samples.length;if(n){for(var s=t.inputTimeScale,a=0;a<n;a++){var o=t.samples[a];o.pts=y(o.pts-i,e*s)/s,o.dts=y(o.dts-r,e*s)/s}var l=t.samples;return t.samples=[],{samples:l}}}function b(t,e,i){var r=t.samples.length;if(r){for(var n=t.inputTimeScale,s=0;s<r;s++){var a=t.samples[s];a.pts=y(a.pts-i,e*n)/n}t.samples.sort((function(t,e){return t.pts-e.pts}));var o=t.samples;return t.samples=[],{samples:o}}}var E=function(t,e,i,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=i,this.cts=r,this.flags=new S(t)},S=function(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}},function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var r=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},function(t,e,i){"use strict";var r=Object.prototype.hasOwnProperty,n="~";function s(){}function a(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function o(t,e,i,r,s){if("function"!=typeof i)throw new TypeError("The listener must be a function");var o=new a(i,r||t,s),l=n?n+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],o]:t._events[l].push(o):(t._events[l]=o,t._eventsCount++),t}function l(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function u(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(n=!1)),u.prototype.eventNames=function(){var t,e,i=[];if(0===this._eventsCount)return i;for(e in t=this._events)r.call(t,e)&&i.push(n?e.slice(1):e);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},u.prototype.listeners=function(t){var e=n?n+t:t,i=this._events[e];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,s=i.length,a=new Array(s);r<s;r++)a[r]=i[r].fn;return a},u.prototype.listenerCount=function(t){var e=n?n+t:t,i=this._events[e];return i?i.fn?1:i.length:0},u.prototype.emit=function(t,e,i,r,s,a){var o=n?n+t:t;if(!this._events[o])return!1;var l,u,c=this._events[o],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,i),!0;case 4:return c.fn.call(c.context,e,i,r),!0;case 5:return c.fn.call(c.context,e,i,r,s),!0;case 6:return c.fn.call(c.context,e,i,r,s,a),!0}for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var d,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(t,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,e);break;case 3:c[u].fn.call(c[u].context,e,i);break;case 4:c[u].fn.call(c[u].context,e,i,r);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(t,e,i){return o(this,t,e,i,!1)},u.prototype.once=function(t,e,i){return o(this,t,e,i,!0)},u.prototype.removeListener=function(t,e,i,r){var s=n?n+t:t;if(!this._events[s])return this;if(!e)return l(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||r&&!a.once||i&&a.context!==i||l(this,s);else{for(var o=0,u=[],c=a.length;o<c;o++)(a[o].fn!==e||r&&!a[o].once||i&&a[o].context!==i)&&u.push(a[o]);u.length?this._events[s]=1===u.length?u[0]:u:l(this,s)}return this},u.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&l(this,e)):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=n,u.EventEmitter=u,t.exports=u},function(t,e,i){"use strict";i.d(e,"a",(function(){return u}));var r=function(){function t(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}(),n=function(){function t(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}(),s=i(9),a=function(){function t(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var e=t.prototype;return e.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),i=new Uint32Array(4),r=0;r<4;r++)i[r]=e.getUint32(4*r);return i},e.initTable=function(){var t=this.sBox,e=this.invSBox,i=this.subMix,r=i[0],n=i[1],s=i[2],a=i[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],h=o[3],d=new Uint32Array(256),f=0,g=0,p=0;for(p=0;p<256;p++)d[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var m=g^g<<1^g<<2^g<<3^g<<4;m=m>>>8^255&m^99,t[f]=m,e[m]=f;var v=d[f],y=d[v],T=d[y],b=257*d[m]^16843008*m;r[f]=b<<24|b>>>8,n[f]=b<<16|b>>>16,s[f]=b<<8|b>>>24,a[f]=b,b=16843009*T^65537*y^257*v^16843008*f,l[m]=b<<24|b>>>8,u[m]=b<<16|b>>>16,c[m]=b<<8|b>>>24,h[m]=b,f?(f=v^d[d[d[T^v]]],g^=d[d[g]]):f=g=1}},e.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),i=!0,r=0;r<e.length&&i;)i=e[r]===this.key[r],r++;if(!i){this.key=e;var n=this.keySize=e.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var s,a,o,l,u=this.ksRows=4*(n+6+1),c=this.keySchedule=new Uint32Array(u),h=this.invKeySchedule=new Uint32Array(u),d=this.sBox,f=this.rcon,g=this.invSubMix,p=g[0],m=g[1],v=g[2],y=g[3];for(s=0;s<u;s++)s<n?o=c[s]=e[s]:(l=o,s%n==0?(l=d[(l=l<<8|l>>>24)>>>24]<<24|d[l>>>16&255]<<16|d[l>>>8&255]<<8|d[255&l],l^=f[s/n|0]<<24):n>6&&s%n==4&&(l=d[l>>>24]<<24|d[l>>>16&255]<<16|d[l>>>8&255]<<8|d[255&l]),c[s]=o=(c[s-n]^l)>>>0);for(a=0;a<u;a++)s=u-a,l=3&a?c[s]:c[s-4],h[a]=a<4||s<=4?l:p[d[l>>>24]]^m[d[l>>>16&255]]^v[d[l>>>8&255]]^y[d[255&l]],h[a]=h[a]>>>0}},e.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},e.decrypt=function(t,e,i){for(var r,n,s,a,o,l,u,c,h,d,f,g,p,m,v=this.keySize+6,y=this.invKeySchedule,T=this.invSBox,b=this.invSubMix,E=b[0],S=b[1],w=b[2],I=b[3],_=this.uint8ArrayToUint32Array_(i),A=_[0],k=_[1],D=_[2],L=_[3],R=new Int32Array(t),C=new Int32Array(R.length),O=this.networkToHostOrderSwap;e<R.length;){for(h=O(R[e]),d=O(R[e+1]),f=O(R[e+2]),g=O(R[e+3]),o=h^y[0],l=g^y[1],u=f^y[2],c=d^y[3],p=4,m=1;m<v;m++)r=E[o>>>24]^S[l>>16&255]^w[u>>8&255]^I[255&c]^y[p],n=E[l>>>24]^S[u>>16&255]^w[c>>8&255]^I[255&o]^y[p+1],s=E[u>>>24]^S[c>>16&255]^w[o>>8&255]^I[255&l]^y[p+2],a=E[c>>>24]^S[o>>16&255]^w[l>>8&255]^I[255&u]^y[p+3],o=r,l=n,u=s,c=a,p+=4;r=T[o>>>24]<<24^T[l>>16&255]<<16^T[u>>8&255]<<8^T[255&c]^y[p],n=T[l>>>24]<<24^T[u>>16&255]<<16^T[c>>8&255]<<8^T[255&o]^y[p+1],s=T[u>>>24]<<24^T[c>>16&255]<<16^T[o>>8&255]<<8^T[255&l]^y[p+2],a=T[c>>>24]<<24^T[o>>16&255]<<16^T[l>>8&255]<<8^T[255&u]^y[p+3],C[e]=O(r^A),C[e+1]=O(a^k),C[e+2]=O(s^D),C[e+3]=O(n^L),A=h,k=d,D=f,L=g,e+=4}return C.buffer},t}(),o=i(1),l=i(5),u=function(){function t(t,e,i){var r=(void 0===i?{}:i).removePKCS7Padding,n=void 0===r||r;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=t,this.config=e,this.removePKCS7Padding=n,n)try{var s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch(t){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var e=t.prototype;return e.destroy=function(){this.observer=null},e.isSync=function(){return this.config.enableSoftwareAES},e.flush=function(){var t=this.currentResult;if(t){var e,i,r,n=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?(r=(i=(e=n).byteLength)&&new DataView(e.buffer).getUint8(i-1))?Object(s.a)(e,0,i-r):e:n}this.reset()},e.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},e.decrypt=function(t,e,i,r){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(t),e,i);var n=this.flush();n&&r(n.buffer)}else this.webCryptoDecrypt(new Uint8Array(t),e,i).then(r)},e.softwareDecrypt=function(t,e,i){var r=this.currentIV,n=this.currentResult,o=this.remainderData;this.logOnce("JS AES decrypt"),o&&(t=Object(l.b)(o,t),this.remainderData=null);var u=this.getValidChunk(t);if(!u.length)return null;r&&(i=r);var c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new a),c.expandKey(e);var h=n;return this.currentResult=c.decrypt(u.buffer,0,i),this.currentIV=Object(s.a)(u,-16).buffer,h||null},e.webCryptoDecrypt=function(t,e,i){var s=this,a=this.subtle;return this.key===e&&this.fastAesKey||(this.key=e,this.fastAesKey=new n(a,e)),this.fastAesKey.expandKey().then((function(e){return a?new r(a,i).decrypt(t.buffer,e):Promise.reject(new Error("web crypto not initialized"))})).catch((function(r){return s.onWebCryptoError(r,t,e,i)}))},e.onWebCryptoError=function(t,e,i,r){return o.b.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",t),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(e,i,r)},e.getValidChunk=function(t){var e=t,i=t.length-t.length%16;return i!==t.length&&(e=Object(s.a)(t,0,i),this.remainderData=Object(s.a)(t,i)),e},e.logOnce=function(t){this.logEnabled&&(o.b.log("[decrypter.ts]: "+t),this.logEnabled=!1)},t}()},function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var r=i(12);function n(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var s=function(){function t(t,e){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=e?Object(r.buildAbsoluteURL)(t,e,{alwaysNormalize:!0}):t}var e,i;return t.fromURL=function(e,i){return new t(e,i)},t.fromURI=function(e){return new t(e)},e=t,(i=[{key:"uri",get:function(){return this._uri}}])&&n(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}()},function(t,e,i){function r(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.i=function(t){return t},i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/",i.oe=function(t){throw console.error(t),t};var r=i(i.s=ENTRY_MODULE);return r.default||r}function n(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function s(t,e,r){var s={};s[r]=[];var a=e.toString(),o=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!o)return s;for(var l,u=o[1],c=new RegExp("(\\\\n|\\W)"+n(u)+"\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)","g");l=c.exec(a);)"dll-reference"!==l[3]&&s[r].push(l[3]);for(c=new RegExp("\\("+n(u)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)',"g");l=c.exec(a);)t[l[2]]||(s[r].push(l[1]),t[l[2]]=i(l[1]).m),s[l[2]]=s[l[2]]||[],s[l[2]].push(l[4]);for(var h,d=Object.keys(s),f=0;f<d.length;f++)for(var g=0;g<s[d[f]].length;g++)h=s[d[f]][g],isNaN(1*h)||(s[d[f]][g]=1*s[d[f]][g]);return s}function a(t){return Object.keys(t).reduce((function(e,i){return e||t[i].length>0}),!1)}t.exports=function(t,e){e=e||{};var n={main:i.m},o=e.all?{main:Object.keys(n.main)}:function(t,e){for(var i={main:[e]},r={main:[]},n={main:{}};a(i);)for(var o=Object.keys(i),l=0;l<o.length;l++){var u=o[l],c=i[u].pop();if(n[u]=n[u]||{},!n[u][c]&&t[u][c]){n[u][c]=!0,r[u]=r[u]||[],r[u].push(c);for(var h=s(t,t[u][c],u),d=Object.keys(h),f=0;f<d.length;f++)i[d[f]]=i[d[f]]||[],i[d[f]]=i[d[f]].concat(h[d[f]])}}return r}(n,t),l="";Object.keys(o).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;o[t][e];)e++;o[t].push(e),n[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",l=l+"var "+t+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o[t].map((function(e){return JSON.stringify(e)+": "+n[t][e].toString()})).join(",")+"});\n"})),l=l+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o.main.map((function(t){return JSON.stringify(t)+": "+n.main[t].toString()})).join(",")+"}))(self);";var u=new window.Blob([l],{type:"text/javascript"});if(e.bare)return u;var c=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),h=new window.Worker(c);return h.objectURL=c,h}},function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return o}));var r=i(10),n=i(0),s=i(1),a=i(15);function o(t){var e=new a.EventEmitter,i=function(e,i){t.postMessage({event:e,data:i})};e.on(n.a.FRAG_DECRYPTED,i),e.on(n.a.ERROR,i),t.addEventListener("message",(function(n){var a=n.data;switch(a.cmd){case"init":var o=JSON.parse(a.config);t.transmuxer=new r.c(e,a.typeSupported,o,a.vendor,a.id),Object(s.a)(o.debug),function(){var t=function(t){s.b[t]=function(e){i("workerLog",{logType:t,message:e})}};for(var e in s.b)t(e)}(),i("init",null);break;case"configure":t.transmuxer.configure(a.config);break;case"demux":var u=t.transmuxer.push(a.data,a.decryptdata,a.chunkMeta,a.state);Object(r.d)(u)?u.then((function(e){l(t,e)})):l(t,u);break;case"flush":var h=a.chunkMeta,d=t.transmuxer.flush(h);Object(r.d)(d)?d.then((function(e){c(t,e,h)})):c(t,d,h)}}))}function l(t,e){if(!((i=e.remuxResult).audio||i.video||i.text||i.id3||i.initSegment))return!1;var i,r=[],n=e.remuxResult,s=n.audio,a=n.video;return s&&u(r,s),a&&u(r,a),t.postMessage({event:"transmuxComplete",data:e},r),!0}function u(t,e){e.data1&&t.push(e.data1.buffer),e.data2&&t.push(e.data2.buffer)}function c(t,e,i){e.reduce((function(e,i){return l(t,i)||e}),!1)||t.postMessage({event:"transmuxComplete",data:e[0]}),t.postMessage({event:"flush",data:i})}},function(t,e,i){"use strict";i.r(e),i.d(e,"default",(function(){return hr}));var r,n=i(12),s=i(3),a=i(0),o=i(2),l=i(1),u=i(5),c=/^(\d+)x(\d+)$/,h=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,d=function(){function t(e){for(var i in"string"==typeof e&&(e=t.parseAttrList(e)),e)e.hasOwnProperty(i)&&(this[i]=e[i])}var e=t.prototype;return e.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var i=new Uint8Array(e.length/2),r=0;r<e.length/2;r++)i[r]=parseInt(e.slice(2*r,2*r+2),16);return i}return null},e.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.decimalFloatingPoint=function(t){return parseFloat(this[t])},e.optionalFloat=function(t,e){var i=this[t];return i?parseFloat(i):e},e.enumeratedString=function(t){return this[t]},e.bool=function(t){return"YES"===this[t]},e.decimalResolution=function(t){var e=c.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},t.parseAttrList=function(t){var e,i={};for(h.lastIndex=0;null!==(e=h.exec(t));){var r=e[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),i[e[1]]=r}return i},t}();function f(){return(f=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}function g(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t.ID="ID",t.CLASS="CLASS",t.START_DATE="START-DATE",t.DURATION="DURATION",t.END_DATE="END-DATE",t.END_ON_NEXT="END-ON-NEXT",t.PLANNED_DURATION="PLANNED-DURATION",t.SCTE35_OUT="SCTE35-OUT",t.SCTE35_IN="SCTE35-IN"}(r||(r={}));var p=function(){function t(t,e){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,e){var i=e.attr;for(var n in i)if(Object.prototype.hasOwnProperty.call(t,n)&&t[n]!==i[n]){l.b.warn('DATERANGE tag attribute: "'+n+'" does not match for tags with ID: "'+t.ID+'"'),this._badValueForSameId=n;break}t=f(new d({}),i,t)}if(this.attr=t,this._startDate=new Date(t[r.START_DATE]),r.END_DATE in this.attr){var a=new Date(this.attr[r.END_DATE]);Object(s.a)(a.getTime())&&(this._endDate=a)}}var e,i;return e=t,(i=[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var t=this.duration;return null!==t?new Date(this._startDate.getTime()+1e3*t):null}},{key:"duration",get:function(){if(r.DURATION in this.attr){var t=this.attr.decimalFloatingPoint(r.DURATION);if(Object(s.a)(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return r.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(r.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(r.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(s.a)(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}])&&g(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}(),m=i(6);function v(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var y=function(){function t(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=t}var e,i;return t.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var e=this.lastPartSn-t.lastPartSn,i=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!i||!!e,this.advanced=this.endSN>t.endSN||e>0||0===e&&i>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay},e=t,(i=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(s.a)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return null!==(t=this.fragments)&&void 0!==t&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&v(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}(),T=i(17),b={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function E(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}var S=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,w=/#EXT-X-MEDIA:(.*)/g,I=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),_=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),A=/\.(mp4|m4s|m4v|m4a)$/i,k=function(){function t(){}return t.findGroup=function(t,e){for(var i=0;i<t.length;i++){var r=t[i];if(r.id===e)return r}},t.convertAVC1ToAVCOTI=function(t){var e=t.split(".");if(e.length>2){var i=e.shift()+".";return(i+=parseInt(e.shift()).toString(16))+("000"+parseInt(e.shift()).toString(16)).slice(-4)}return t},t.resolve=function(t,e){return n.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(e,i){var r,n=[],s={},a=!1;for(S.lastIndex=0;null!=(r=S.exec(e));)if(r[1]){var o=new d(r[1]),l={attrs:o,bitrate:o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),name:o.NAME,url:t.resolve(r[2],i)},u=o.decimalResolution("RESOLUTION");u&&(l.width=u.width,l.height=u.height),D((o.CODECS||"").split(/[ ,]+/).filter((function(t){return t})),l),l.videoCodec&&-1!==l.videoCodec.indexOf("avc1")&&(l.videoCodec=t.convertAVC1ToAVCOTI(l.videoCodec)),n.push(l)}else if(r[3]){var c=new d(r[3]);c["DATA-ID"]&&(a=!0,s[c["DATA-ID"]]=c)}return{levels:n,sessionData:a?s:null}},t.parseMasterPlaylistMedia=function(e,i,r,n){var s;void 0===n&&(n=[]);var a=[],o=0;for(w.lastIndex=0;null!==(s=w.exec(e));){var l=new d(s[1]);if(l.TYPE===r){var u={attrs:l,bitrate:0,id:o++,groupId:l["GROUP-ID"],instreamId:l["INSTREAM-ID"],name:l.NAME||l.LANGUAGE||"",type:r,default:l.bool("DEFAULT"),autoselect:l.bool("AUTOSELECT"),forced:l.bool("FORCED"),lang:l.LANGUAGE,url:l.URI?t.resolve(l.URI,i):""};if(n.length){var c=t.findGroup(n,u.groupId)||n[0];L(u,c,"audioCodec"),L(u,c,"textCodec")}a.push(u)}}return a},t.parseLevelPlaylist=function(t,e,i,r,a){var o,u,c,h=new y(e),f=h.fragments,g=null,v=0,b=0,E=0,S=0,w=null,k=new m.b(r,e),D=-1,L=!1;for(I.lastIndex=0,h.m3u8=t;null!==(o=I.exec(t));){L&&(L=!1,(k=new m.b(r,e)).start=E,k.sn=v,k.cc=S,k.level=i,g&&(k.initSegment=g,k.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null));var O=o[1];if(O){k.duration=parseFloat(O);var P=(" "+o[2]).slice(1);k.title=P||null,k.tagList.push(P?["INF",O,P]:["INF",O])}else if(o[3])Object(s.a)(k.duration)&&(k.start=E,c&&(k.levelkey=c),k.sn=v,k.level=i,k.cc=S,k.urlId=a,f.push(k),k.relurl=(" "+o[3]).slice(1),R(k,w),w=k,E+=k.duration,v++,b=0,L=!0);else if(o[4]){var x=(" "+o[4]).slice(1);w?k.setByteRange(x,w):k.setByteRange(x)}else if(o[5])k.rawProgramDateTime=(" "+o[5]).slice(1),k.tagList.push(["PROGRAM-DATE-TIME",k.rawProgramDateTime]),-1===D&&(D=f.length);else{if(!(o=o[0].match(_))){l.b.warn("No matches on slow regex match for level playlist!");continue}for(u=1;u<o.length&&void 0===o[u];u++);var N=(" "+o[u]).slice(1),M=(" "+o[u+1]).slice(1),F=o[u+2]?(" "+o[u+2]).slice(1):"";switch(N){case"PLAYLIST-TYPE":h.type=M.toUpperCase();break;case"MEDIA-SEQUENCE":v=h.startSN=parseInt(M);break;case"SKIP":var U=new d(M),B=U.decimalInteger("SKIPPED-SEGMENTS");if(Object(s.a)(B)){h.skippedSegments=B;for(var V=B;V--;)f.unshift(null);v+=B}var j=U.enumeratedString("RECENTLY-REMOVED-DATERANGES");j&&(h.recentlyRemovedDateranges=j.split("\t"));break;case"TARGETDURATION":h.targetduration=parseFloat(M);break;case"VERSION":h.version=parseInt(M);break;case"EXTM3U":break;case"ENDLIST":h.live=!1;break;case"#":(M||F)&&k.tagList.push(F?[M,F]:[M]);break;case"DISCONTINUITY":S++,k.tagList.push(["DIS"]);break;case"GAP":k.tagList.push([N]);break;case"BITRATE":k.tagList.push([N,M]);break;case"DATERANGE":var G=new d(M),K=new p(G,h.dateRanges[G.ID]);K.isValid||h.skippedSegments?h.dateRanges[K.id]=K:l.b.warn('Ignoring invalid DATERANGE tag: "'+M+'"'),k.tagList.push(["EXT-X-DATERANGE",M]);break;case"DISCONTINUITY-SEQUENCE":S=parseInt(M);break;case"KEY":var H,q=new d(M),W=q.enumeratedString("METHOD"),z=q.URI,Y=q.hexadecimalInteger("IV"),$=q.enumeratedString("KEYFORMATVERSIONS"),X=q.enumeratedString("KEYID"),Q=null!=(H=q.enumeratedString("KEYFORMAT"))?H:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(Q)>-1){l.b.warn("Keyformat "+Q+" is not supported from the manifest");continue}if("identity"!==Q)continue;W&&(c=T.a.fromURL(e,z),z&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(W)>=0&&(c.method=W,c.keyFormat=Q,X&&(c.keyID=X),$&&(c.keyFormatVersions=$),c.iv=Y));break;case"START":var J=new d(M).decimalFloatingPoint("TIME-OFFSET");Object(s.a)(J)&&(h.startTimeOffset=J);break;case"MAP":var Z=new d(M);if(k.duration){var tt=new m.b(r,e);C(tt,Z,i,c),g=tt,k.initSegment=g,g.rawProgramDateTime&&!k.rawProgramDateTime&&(k.rawProgramDateTime=g.rawProgramDateTime)}else C(k,Z,i,c),g=k,L=!0;break;case"SERVER-CONTROL":var et=new d(M);h.canBlockReload=et.bool("CAN-BLOCK-RELOAD"),h.canSkipUntil=et.optionalFloat("CAN-SKIP-UNTIL",0),h.canSkipDateRanges=h.canSkipUntil>0&&et.bool("CAN-SKIP-DATERANGES"),h.partHoldBack=et.optionalFloat("PART-HOLD-BACK",0),h.holdBack=et.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var it=new d(M);h.partTarget=it.decimalFloatingPoint("PART-TARGET");break;case"PART":var rt=h.partList;rt||(rt=h.partList=[]);var nt=b>0?rt[rt.length-1]:void 0,st=b++,at=new m.c(new d(M),k,e,st,nt);rt.push(at),k.duration+=at.duration;break;case"PRELOAD-HINT":var ot=new d(M);h.preloadHint=ot;break;case"RENDITION-REPORT":var lt=new d(M);h.renditionReports=h.renditionReports||[],h.renditionReports.push(lt);break;default:l.b.warn("line parsed but not handled: "+o)}}}w&&!w.relurl?(f.pop(),E-=w.duration,h.partList&&(h.fragmentHint=w)):h.partList&&(R(k,w),k.cc=S,h.fragmentHint=k);var ut=f.length,ct=f[0],ht=f[ut-1];if((E+=h.skippedSegments*h.targetduration)>0&&ut&&ht){h.averagetargetduration=E/ut;var dt=ht.sn;h.endSN="initSegment"!==dt?dt:0,ct&&(h.startCC=ct.cc,ct.initSegment||h.fragments.every((function(t){return t.relurl&&(e=t.relurl,A.test(null!=(i=null===(r=n.parseURL(e))||void 0===r?void 0:r.path)?i:""));var e,i,r}))&&(l.b.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(k=new m.b(r,e)).relurl=ht.relurl,k.level=i,k.sn="initSegment",ct.initSegment=k,h.needSidxRanges=!0))}else h.endSN=0,h.startCC=0;return h.fragmentHint&&(E+=h.fragmentHint.duration),h.totalduration=E,h.endCC=S,D>0&&function(t,e){for(var i=t[e],r=e;r--;){var n=t[r];if(!n)return;n.programDateTime=i.programDateTime-1e3*n.duration,i=n}}(f,D),h},t}();function D(t,e){["video","audio","text"].forEach((function(i){var r=t.filter((function(t){return function(t,e){var i=b[e];return!!i&&!0===i[t.slice(0,4)]}(t,i)}));if(r.length){var n=r.filter((function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}));e[i+"Codec"]=n.length>0?n[0]:r[0],t=t.filter((function(t){return-1===r.indexOf(t)}))}})),e.unknownCodecs=t}function L(t,e,i){var r=e[i];r&&(t[i]=r)}function R(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!=e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),Object(s.a)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}function C(t,e,i,r){t.relurl=e.URI,e.BYTERANGE&&t.setByteRange(e.BYTERANGE),t.level=i,t.sn="initSegment",r&&(t.levelkey=r),t.initSegment=null}var O=i(4);function P(t,e){var i=t.url;return void 0!==i&&0!==i.indexOf("data:")||(i=e.url),i}var x=function(){function t(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}var e=t.prototype;return e.startLoad=function(t){},e.stopLoad=function(){this.destroyInternalLoaders()},e.registerListeners=function(){var t=this.hls;t.on(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(a.a.LEVEL_LOADING,this.onLevelLoading,this),t.on(a.a.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(a.a.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.unregisterListeners=function(){var t=this.hls;t.off(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(a.a.LEVEL_LOADING,this.onLevelLoading,this),t.off(a.a.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(a.a.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.createInternalLoader=function(t){var e=this.hls.config,i=e.pLoader,r=e.loader,n=new(i||r)(e);return t.loader=n,this.loaders[t.type]=n,n},e.getInternalLoader=function(t){return this.loaders[t.type]},e.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},e.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},e.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},e.onManifestLoading=function(t,e){var i=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:O.a.MANIFEST,url:i,deliveryDirectives:null})},e.onLevelLoading=function(t,e){var i=e.id,r=e.level,n=e.url,s=e.deliveryDirectives;this.load({id:i,groupId:null,level:r,responseType:"text",type:O.a.LEVEL,url:n,deliveryDirectives:s})},e.onAudioTrackLoading=function(t,e){var i=e.id,r=e.groupId,n=e.url,s=e.deliveryDirectives;this.load({id:i,groupId:r,level:null,responseType:"text",type:O.a.AUDIO_TRACK,url:n,deliveryDirectives:s})},e.onSubtitleTrackLoading=function(t,e){var i=e.id,r=e.groupId,n=e.url,s=e.deliveryDirectives;this.load({id:i,groupId:r,level:null,responseType:"text",type:O.a.SUBTITLE_TRACK,url:n,deliveryDirectives:s})},e.load=function(t){var e,i,r,n,s,a,o=this.hls.config,u=this.getInternalLoader(t);if(u){var c=u.context;if(c&&c.url===t.url)return void l.b.trace("[playlist-loader]: playlist request ongoing");l.b.log("[playlist-loader]: aborting previous loader for type: "+t.type),u.abort()}switch(t.type){case O.a.MANIFEST:i=o.manifestLoadingMaxRetry,r=o.manifestLoadingTimeOut,n=o.manifestLoadingRetryDelay,s=o.manifestLoadingMaxRetryTimeout;break;case O.a.LEVEL:case O.a.AUDIO_TRACK:case O.a.SUBTITLE_TRACK:i=0,r=o.levelLoadingTimeOut;break;default:i=o.levelLoadingMaxRetry,r=o.levelLoadingTimeOut,n=o.levelLoadingRetryDelay,s=o.levelLoadingMaxRetryTimeout}if(u=this.createInternalLoader(t),null!==(e=t.deliveryDirectives)&&void 0!==e&&e.part&&(t.type===O.a.LEVEL&&null!==t.level?a=this.hls.levels[t.level].details:t.type===O.a.AUDIO_TRACK&&null!==t.id?a=this.hls.audioTracks[t.id].details:t.type===O.a.SUBTITLE_TRACK&&null!==t.id&&(a=this.hls.subtitleTracks[t.id].details),a)){var h=a.partTarget,d=a.targetduration;h&&d&&(r=Math.min(1e3*Math.max(3*h,.8*d),r))}var f={timeout:r,maxRetry:i,retryDelay:n,maxRetryDelay:s,highWaterMark:0},g={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};u.load(t,f,g)},e.loadsuccess=function(t,e,i,r){if(void 0===r&&(r=null),i.isSidxRequest)return this.handleSidxRequest(t,i),void this.handlePlaylistLoaded(t,e,i,r);this.resetInternalLoader(i.type);var n=t.data;0===n.indexOf("#EXTM3U")?(e.parsing.start=performance.now(),n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,e,i,r):this.handleMasterPlaylist(t,e,i,r)):this.handleManifestParsingError(t,i,"no EXTM3U delimiter",r)},e.loaderror=function(t,e,i){void 0===i&&(i=null),this.handleNetworkError(e,i,!1,t)},e.loadtimeout=function(t,e,i){void 0===i&&(i=null),this.handleNetworkError(e,i,!0)},e.handleMasterPlaylist=function(t,e,i,r){var n=this.hls,s=t.data,o=P(t,i),u=k.parseMasterPlaylist(s,o),c=u.levels,h=u.sessionData;if(c.length){var f=c.map((function(t){return{id:t.attrs.AUDIO,audioCodec:t.audioCodec}})),g=c.map((function(t){return{id:t.attrs.SUBTITLES,textCodec:t.textCodec}})),p=k.parseMasterPlaylistMedia(s,o,"AUDIO",f),m=k.parseMasterPlaylistMedia(s,o,"SUBTITLES",g),v=k.parseMasterPlaylistMedia(s,o,"CLOSED-CAPTIONS");p.length&&(p.some((function(t){return!t.url}))||!c[0].audioCodec||c[0].attrs.AUDIO||(l.b.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new d({}),bitrate:0,url:""}))),n.trigger(a.a.MANIFEST_LOADED,{levels:c,audioTracks:p,subtitles:m,captions:v,url:o,stats:e,networkDetails:r,sessionData:h})}else this.handleManifestParsingError(t,i,"no level found in manifest",r)},e.handleTrackOrLevelPlaylist=function(t,e,i,r){var n=this.hls,l=i.id,u=i.level,c=i.type,h=P(t,i),f=Object(s.a)(l)?l:0,g=Object(s.a)(u)?u:f,p=function(t){switch(t.type){case O.a.AUDIO_TRACK:return O.b.AUDIO;case O.a.SUBTITLE_TRACK:return O.b.SUBTITLE;default:return O.b.MAIN}}(i),m=k.parseLevelPlaylist(t.data,h,g,p,f);if(m.fragments.length){if(c===O.a.MANIFEST){var v={attrs:new d({}),bitrate:0,details:m,name:"",url:h};n.trigger(a.a.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:h,stats:e,networkDetails:r,sessionData:null})}if(e.parsing.end=performance.now(),m.needSidxRanges){var y,T=null===(y=m.fragments[0].initSegment)||void 0===y?void 0:y.url;this.load({url:T,isSidxRequest:!0,type:c,level:u,levelDetails:m,id:l,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else i.levelDetails=m,this.handlePlaylistLoaded(t,e,i,r)}else n.trigger(a.a.ERROR,{type:o.b.NETWORK_ERROR,details:o.a.LEVEL_EMPTY_ERROR,fatal:!1,url:h,reason:"no fragments found in level",level:"number"==typeof i.level?i.level:void 0})},e.handleSidxRequest=function(t,e){var i=new Uint8Array(t.data),r=Object(u.c)(i,["sidx"])[0];if(r){var n=Object(u.k)(r);if(n){var s=n.references,a=e.levelDetails;s.forEach((function(t,e){var r=t.info,n=a.fragments[e];if(0===n.byteRange.length&&n.setByteRange(String(1+r.end-r.start)+"@"+String(r.start)),n.initSegment){var s=Object(u.c)(i,["moov"])[0],o=s?s.length:null;n.initSegment.setByteRange(String(o)+"@0")}}))}}},e.handleManifestParsingError=function(t,e,i,r){this.hls.trigger(a.a.ERROR,{type:o.b.NETWORK_ERROR,details:o.a.MANIFEST_PARSING_ERROR,fatal:e.type===O.a.MANIFEST,url:t.url,reason:i,response:t,context:e,networkDetails:r})},e.handleNetworkError=function(t,e,i,r){void 0===i&&(i=!1),l.b.warn("[playlist-loader]: A network "+(i?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var n=o.a.UNKNOWN,s=!1,u=this.getInternalLoader(t);switch(t.type){case O.a.MANIFEST:n=i?o.a.MANIFEST_LOAD_TIMEOUT:o.a.MANIFEST_LOAD_ERROR,s=!0;break;case O.a.LEVEL:n=i?o.a.LEVEL_LOAD_TIMEOUT:o.a.LEVEL_LOAD_ERROR,s=!1;break;case O.a.AUDIO_TRACK:n=i?o.a.AUDIO_TRACK_LOAD_TIMEOUT:o.a.AUDIO_TRACK_LOAD_ERROR,s=!1;break;case O.a.SUBTITLE_TRACK:n=i?o.a.SUBTITLE_TRACK_LOAD_TIMEOUT:o.a.SUBTITLE_LOAD_ERROR,s=!1}u&&this.resetInternalLoader(t.type);var c={type:o.b.NETWORK_ERROR,details:n,fatal:s,url:t.url,loader:u,context:t,networkDetails:e};r&&(c.response=r),this.hls.trigger(a.a.ERROR,c)},e.handlePlaylistLoaded=function(t,e,i,r){var n=i.type,s=i.level,o=i.id,l=i.groupId,u=i.loader,c=i.levelDetails,h=i.deliveryDirectives;if(null!=c&&c.targetduration){if(u)switch(c.live&&(u.getCacheAge&&(c.ageHeader=u.getCacheAge()||0),u.getCacheAge&&!isNaN(c.ageHeader)||(c.ageHeader=0)),n){case O.a.MANIFEST:case O.a.LEVEL:this.hls.trigger(a.a.LEVEL_LOADED,{details:c,level:s||0,id:o||0,stats:e,networkDetails:r,deliveryDirectives:h});break;case O.a.AUDIO_TRACK:this.hls.trigger(a.a.AUDIO_TRACK_LOADED,{details:c,id:o||0,groupId:l||"",stats:e,networkDetails:r,deliveryDirectives:h});break;case O.a.SUBTITLE_TRACK:this.hls.trigger(a.a.SUBTITLE_TRACK_LOADED,{details:c,id:o||0,groupId:l||"",stats:e,networkDetails:r,deliveryDirectives:h})}}else this.handleManifestParsingError(t,i,"invalid target duration",r)},t}(),N=function(){function t(t){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=t,this.registerListeners()}var e=t.prototype;return e.startLoad=function(t){},e.stopLoad=function(){this.destroyInternalLoaders()},e.registerListeners=function(){this.hls.on(a.a.KEY_LOADING,this.onKeyLoading,this)},e.unregisterListeners=function(){this.hls.off(a.a.KEY_LOADING,this.onKeyLoading)},e.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={}},e.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},e.onKeyLoading=function(t,e){var i=e.frag,r=i.type,n=this.loaders[r];if(i.decryptdata){var s=i.decryptdata.uri;if(s!==this.decrypturl||null===this.decryptkey){var o=this.hls.config;if(n&&(l.b.warn("abort previous key loader for type:"+r),n.abort()),!s)return void l.b.warn("key uri is falsy");var u=o.loader,c=i.loader=this.loaders[r]=new u(o);this.decrypturl=s,this.decryptkey=null;var h={url:s,frag:i,responseType:"arraybuffer"},d={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout,highWaterMark:0},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};c.load(h,d,f)}else this.decryptkey&&(i.decryptdata.key=this.decryptkey,this.hls.trigger(a.a.KEY_LOADED,{frag:i}))}else l.b.warn("Missing decryption data on fragment in onKeyLoading")},e.loadsuccess=function(t,e,i){var r=i.frag;r.decryptdata?(this.decryptkey=r.decryptdata.key=new Uint8Array(t.data),r.loader=null,delete this.loaders[r.type],this.hls.trigger(a.a.KEY_LOADED,{frag:r})):l.b.error("after key load, decryptdata unset")},e.loaderror=function(t,e){var i=e.frag,r=i.loader;r&&r.abort(),delete this.loaders[i.type],this.hls.trigger(a.a.ERROR,{type:o.b.NETWORK_ERROR,details:o.a.KEY_LOAD_ERROR,fatal:!1,frag:i,response:t})},e.loadtimeout=function(t,e){var i=e.frag,r=i.loader;r&&r.abort(),delete this.loaders[i.type],this.hls.trigger(a.a.ERROR,{type:o.b.NETWORK_ERROR,details:o.a.KEY_LOAD_TIMEOUT,fatal:!1,frag:i})},t}();function M(t,e){var i;try{i=new Event("addtrack")}catch(t){(i=document.createEvent("Event")).initEvent("addtrack",!1,!1)}i.track=t,e.dispatchEvent(i)}function F(t,e){var i=t.mode;if("disabled"===i&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(i){l.b.debug("[texttrack-utils]: "+i);var r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,t.addCue(r)}"disabled"===i&&(t.mode=i)}function U(t){var e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues)for(var i=t.cues.length;i--;)t.removeCue(t.cues[i]);"disabled"===e&&(t.mode=e)}function B(t,e,i,r){var n=t.mode;if("disabled"===n&&(t.mode="hidden"),t.cues&&t.cues.length>0)for(var s=function(t,e,i){var r=[],n=function(t,e){if(e<t[0].startTime)return 0;var i=t.length-1;if(e>t[i].endTime)return-1;for(var r=0,n=i;r<=n;){var s=Math.floor((n+r)/2);if(e<t[s].startTime)n=s-1;else{if(!(e>t[s].startTime&&r<i))return s;r=s+1}}return t[r].startTime-e<e-t[n].startTime?r:n}(t,e);if(n>-1)for(var s=n,a=t.length;s<a;s++){var o=t[s];if(o.startTime>=e&&o.endTime<=i)r.push(o);else if(o.startTime>i)return r}return r}(t.cues,e,i),a=0;a<s.length;a++)r&&!r(s[a])||t.removeCue(s[a]);"disabled"===n&&(t.mode=n)}var V=i(7),j=i(8);function G(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function K(t,e){return t.getTime()/1e3-e}var H=function(){function t(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}var e=t.prototype;return e.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},e._registerListeners=function(){var t=this.hls;t.on(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(a.a.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(a.a.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(a.a.LEVEL_UPDATED,this.onLevelUpdated,this)},e._unregisterListeners=function(){var t=this.hls;t.off(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(a.a.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(a.a.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(a.a.LEVEL_UPDATED,this.onLevelUpdated,this)},e.onMediaAttached=function(t,e){this.media=e.media},e.onMediaDetaching=function(){this.id3Track&&(U(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},e.onManifestLoading=function(){this.dateRangeCuesAppended={}},e.createTrack=function(t){var e=this.getID3Track(t.textTracks);return e.mode="hidden",e},e.getID3Track=function(t){if(this.media){for(var e=0;e<t.length;e++){var i=t[e];if("metadata"===i.kind&&"id3"===i.label)return M(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},e.onFragParsingMetadata=function(t,e){if(this.media){var i=this.hls.config,r=i.enableEmsgMetadataCues,n=i.enableID3MetadataCues;if(r||n){var s=e.frag,a=e.samples,o=e.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var l=o.edge||s.end,u=G(),c=!1,h={},d=0;d<a.length;d++){var f=a[d].type;if((f!==j.a.emsg||r)&&n){var g=V.c(a[d].data);if(g){var p=a[d].pts,m=l;m-p<=0&&(m=p+.25);for(var v=0;v<g.length;v++){var y=g[v];if(!V.e(y)){var T=new u(p,m,"");T.value=y,f&&(T.type=f),this.id3Track.addCue(T),h[y.key]=null,c=!0}}}}}c&&this.updateId3CueEnds(h)}}},e.updateId3CueEnds=function(t){var e,i=null===(e=this.id3Track)||void 0===e?void 0:e.cues;if(i)for(var r=i.length;r--;){var n,s=i[r],a=null===(n=s.value)||void 0===n?void 0:n.key;if(a&&a in t){var o=t[a];o&&s.endTime!==o&&(s.endTime=o),t[a]=s.startTime}}},e.onBufferFlushing=function(t,e){var i=e.startOffset,r=e.endOffset,n=e.type,s=this.id3Track,a=this.hls;if(a){var o=a.config,l=o.enableEmsgMetadataCues,u=o.enableID3MetadataCues;s&&(l||u)&&B(s,i,r,"audio"===n?function(t){return t.type===j.a.audioId3&&u}:"video"===n?function(t){return t.type===j.a.emsg&&l}:function(t){return t.type===j.a.audioId3&&u||t.type===j.a.emsg&&l})}},e.onLevelUpdated=function(t,e){var i=this,n=e.details;if(this.media&&n.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var a=this.dateRangeCuesAppended,o=this.id3Track,l=n.dateRanges,u=Object.keys(l);if(o)for(var c=Object.keys(a).filter((function(t){return!u.includes(t)})),h=function(t){var e=c[t];Object.keys(a[e].cues).forEach((function(t){o.removeCue(a[e].cues[t])})),delete a[e]},d=c.length;d--;)h(d);var f=n.fragments[n.fragments.length-1];if(0!==u.length&&Object(s.a)(null==f?void 0:f.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var g=f.programDateTime/1e3-f.start,p=n.edge||f.end,m=G(),v=function(t){var e=u[t],n=l[e],s=a[e],o=(null==s?void 0:s.cues)||{},c=(null==s?void 0:s.durationKnown)||!1,h=K(n.startDate,g),d=p,f=n.endDate;if(f)d=K(f,g),c=!0;else if(n.endOnNext&&!c){var v=u.reduce((function(t,e){var i=l[e];return i.class===n.class&&i.id!==e&&i.startDate>n.startDate&&t.push(i),t}),[]).sort((function(t,e){return t.startDate.getTime()-e.startDate.getTime()}))[0];v&&(d=K(v.startDate,g),c=!0)}for(var y,T=Object.keys(n.attr),b=0;b<T.length;b++){var E=T[b];if(E!==r.ID&&E!==r.CLASS&&E!==r.START_DATE&&E!==r.DURATION&&E!==r.END_DATE&&E!==r.END_ON_NEXT){var S=o[E];if(S)c&&!s.durationKnown&&(S.endTime=d);else{var w=n.attr[E];S=new m(h,d,""),E!==r.SCTE35_OUT&&E!==r.SCTE35_IN||(y=w,w=Uint8Array.from(y.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer),S.value={key:E,data:w},S.type=j.a.dateRange,i.id3Track.addCue(S),o[E]=S}}}a[e]={cues:o,dateRange:n,durationKnown:c}},y=0;y<u.length;y++)v(y)}}},t}();function q(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var W,z=function(){function t(t){var e=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return e.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}var e,i,r=t.prototype;return r.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},r.registerListeners=function(){this.hls.on(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(a.a.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(a.a.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(a.a.ERROR,this.onError,this)},r.unregisterListeners=function(){this.hls.off(a.a.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(a.a.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(a.a.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(a.a.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(a.a.ERROR,this.onError)},r.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},r.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},r.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},r.onLevelUpdated=function(t,e){var i=e.details;this.levelDetails=i,i.advanced&&this.timeupdate(),!i.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},r.onError=function(t,e){e.details===o.a.BUFFER_STALLED_ERROR&&(this.stallCount++,l.b.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},r.timeupdate=function(){var t=this.media,e=this.levelDetails;if(t&&e){this.currentTime=t.currentTime;var i=this.computeLatency();if(null!==i){this._latency=i;var r=this.config,n=r.lowLatencyMode,s=r.maxLiveSyncPlaybackRate;if(n&&1!==s){var a=this.targetLatency;if(null!==a){var o=i-a,l=o<Math.min(this.maxLatency,a+e.targetduration);if(e.live&&l&&o>.05&&this.forwardBufferLength>1){var u=Math.min(2,Math.max(1,s)),c=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;t.playbackRate=Math.min(u,Math.max(1,c))}else 1!==t.playbackRate&&0!==t.playbackRate&&(t.playbackRate=1)}}}}},r.estimateLiveEdge=function(){var t=this.levelDetails;return null===t?null:t.edge+t.age},r.computeLatency=function(){var t=this.estimateLiveEdge();return null===t?null:t-this.currentTime},e=t,(i=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var t=this.config,e=this.levelDetails;return void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var t=this.levelDetails;if(null===t)return null;var e=t.holdBack,i=t.partHoldBack,r=t.targetduration,n=this.config,s=n.liveSyncDuration,a=n.liveSyncDurationCount,o=n.lowLatencyMode,l=this.hls.userConfig,u=o&&i||e;(l.liveSyncDuration||l.liveSyncDurationCount||0===u)&&(u=void 0!==s?s:a*r);var c=r;return u+Math.min(1*this.stallCount,c)}},{key:"liveSyncPosition",get:function(){var t=this.estimateLiveEdge(),e=this.targetLatency,i=this.levelDetails;if(null===t||null===e||null===i)return null;var r=i.edge,n=t-e-this.edgeStalled,s=r-i.totalduration,a=r-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(s,n),a)}},{key:"drift",get:function(){var t=this.levelDetails;return null===t?1:t.drift}},{key:"edgeStalled",get:function(){var t=this.levelDetails;if(null===t)return 0;var e=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.max(t.age-e,0)}},{key:"forwardBufferLength",get:function(){var t=this.media,e=this.levelDetails;if(!t||!e)return 0;var i=t.buffered.length;return(i?t.buffered.end(i-1):e.edge)-this.currentTime}}])&&q(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Y(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}!function(t){t.No="",t.Yes="YES",t.v2="v2"}(W||(W={}));var $=function(){function t(t,e,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=i}return t.prototype.addDirectives=function(t){var e=new self.URL(t);return void 0!==this.msn&&e.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.toString()},t}(),X=function(){function t(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter((function(t){return t})).join(",").replace(/\.[^.,]+/g,"")}var e,i;return e=t,(i=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){var e=t%this.url.length;this._urlId!==e&&(this.details=void 0,this._urlId=e)}}])&&Y(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Q(){return(Q=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}function J(t,e,i){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(i);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(i)}}function Z(t){var e={};t.forEach((function(t){var i=t.groupId||"";t.id=e[i]=e[i]||0,e[i]++}))}function tt(t,e){var i=e.startPTS;if(Object(s.a)(i)){var r,n=0;e.sn>t.sn?(n=i-t.start,r=t):(n=t.start-i,r=e),r.duration!==n&&(r.duration=n)}else e.sn>t.sn?t.cc===e.cc&&t.minEndPTS?e.start=t.start+(t.minEndPTS-t.start):e.start=t.start+t.duration:e.start=Math.max(t.start-e.duration,0)}function et(t,e,i,r,n,a){r-i<=0&&(l.b.warn("Fragment should have a positive duration",e),r=i+e.duration,a=n+e.duration);var o=i,u=r,c=e.startPTS,h=e.endPTS;if(Object(s.a)(c)){var d=Math.abs(c-i);Object(s.a)(e.deltaPTS)?e.deltaPTS=Math.max(d,e.deltaPTS):e.deltaPTS=d,o=Math.max(i,c),i=Math.min(i,c),n=Math.min(n,e.startDTS),u=Math.min(r,h),r=Math.max(r,h),a=Math.max(a,e.endDTS)}e.duration=r-i;var f=i-e.start;e.appendedPTS=r,e.start=e.startPTS=i,e.maxStartPTS=o,e.startDTS=n,e.endPTS=r,e.minEndPTS=u,e.endDTS=a;var g,p=e.sn;if(!t||p<t.startSN||p>t.endSN)return 0;var m=p-t.startSN,v=t.fragments;for(v[m]=e,g=m;g>0;g--)tt(v[g],v[g-1]);for(g=m;g<v.length-1;g++)tt(v[g],v[g+1]);return t.fragmentHint&&tt(v[v.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,f}function it(t,e){for(var i=null,r=t.fragments,n=r.length-1;n>=0;n--){var a=r[n].initSegment;if(a){i=a;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var o,u=0;if(function(t,e,i){for(var r=e.skippedSegments,n=Math.max(t.startSN,e.startSN)-e.startSN,s=(t.fragmentHint?1:0)+(r?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,a=e.startSN-t.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,u=n;u<=s;u++){var c=l[a+u],h=o[u];r&&!h&&u<r&&(h=e.fragments[u]=c),c&&h&&i(c,h)}}(t,e,(function(t,r){t.relurl&&(u=t.cc-r.cc),Object(s.a)(t.startPTS)&&Object(s.a)(t.endPTS)&&(r.start=r.startPTS=t.startPTS,r.startDTS=t.startDTS,r.appendedPTS=t.appendedPTS,r.maxStartPTS=t.maxStartPTS,r.endPTS=t.endPTS,r.endDTS=t.endDTS,r.minEndPTS=t.minEndPTS,r.duration=t.endPTS-t.startPTS,r.duration&&(o=r),e.PTSKnown=e.alignedSliding=!0),r.elementaryStreams=t.elementaryStreams,r.loader=t.loader,r.stats=t.stats,r.urlId=t.urlId,t.initSegment&&(r.initSegment=t.initSegment,i=t.initSegment)})),i&&(e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments).forEach((function(t){var e;t.initSegment&&t.initSegment.relurl!==(null===(e=i)||void 0===e?void 0:e.relurl)||(t.initSegment=i)})),e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some((function(t){return!t})),e.deltaUpdateFailed){l.b.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var c=e.skippedSegments;c--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=function(t,e,i){var r=Q({},t);return i&&i.forEach((function(t){delete r[t]})),Object.keys(e).forEach((function(t){var i=new p(e[t].attr,r[t]);i.isValid?r[t]=i:l.b.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(e[t].attr)+'"')})),r}(t.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));var h=e.fragments;if(u){l.b.warn("discontinuity sliding from playlist, take drift into account");for(var d=0;d<h.length;d++)h[d].cc+=u}e.skippedSegments&&(e.startCC=e.fragments[0].cc),function(t,e,i){if(t&&e)for(var r=0,n=0,s=t.length;n<=s;n++){var a=t[n],o=e[n+r];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?i(a,o):r--}}(t.partList,e.partList,(function(t,e){e.elementaryStreams=t.elementaryStreams,e.stats=t.stats})),o?et(e,o,o.startPTS,o.endPTS,o.startDTS,o.endDTS):rt(t,e),h.length&&(e.totalduration=e.edge-h[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;var f=e.advancedDateTime;if(e.advanced&&f){var g=e.edge;e.driftStart||(e.driftStartTime=f,e.driftStart=g),e.driftEndTime=f,e.driftEnd=g}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime}function rt(t,e){var i=e.startSN+e.skippedSegments-t.startSN,r=t.fragments;i<0||i>=r.length||nt(e,r[i].start)}function nt(t,e){if(e){for(var i=t.fragments,r=t.skippedSegments;r<i.length;r++)i[r].start+=e;t.fragmentHint&&(t.fragmentHint.start+=e)}}var st=function(){function t(t,e){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=l.b.log.bind(l.b,e+":"),this.warn=l.b.warn.bind(l.b,e+":"),this.hls=t}var e=t.prototype;return e.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},e.onError=function(t,e){e.fatal&&e.type===o.b.NETWORK_ERROR&&this.clearTimer()},e.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},e.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},e.stopLoad=function(){this.canLoad=!1,this.clearTimer()},e.switchParams=function(t,e){var i=null==e?void 0:e.renditionReports;if(i)for(var r=0;r<i.length;r++){var n=i[r],a=""+n.URI;if(a===t.slice(-a.length)){var o=parseInt(n["LAST-MSN"]),l=parseInt(n["LAST-PART"]);if(e&&this.hls.config.lowLatencyMode){var u=Math.min(e.age-e.partTarget,e.targetduration);void 0!==l&&u>e.partTarget&&(l+=1)}if(Object(s.a)(o))return new $(o,Object(s.a)(l)?l:void 0,W.No)}}},e.loadPlaylist=function(t){},e.shouldLoadTrack=function(t){return this.canLoad&&t&&!!t.url&&(!t.details||t.details.live)},e.playlistLoaded=function(t,e,i){var r=this,n=e.details,s=e.stats,a=s.loading.end?Math.max(0,self.performance.now()-s.loading.end):0;if(n.advancedDateTime=Date.now()-a,n.live||null!=i&&i.live){if(n.reloaded(i),i&&this.log("live playlist "+t+" "+(n.advanced?"REFRESHED "+n.lastPartSn+"-"+n.lastPartIndex:"MISSED")),i&&n.fragments.length>0&&it(i,n),!this.canLoad||!n.live)return;var o,l=void 0,u=void 0;if(n.canBlockReload&&n.endSN&&n.advanced){var c=this.hls.config.lowLatencyMode,h=n.lastPartSn,d=n.endSN,f=n.lastPartIndex,g=h===d;-1!==f?(l=g?d+1:h,u=g?c?0:f:f+1):l=d+1;var p=n.age,m=p+n.ageHeader,v=Math.min(m-n.partTarget,1.5*n.targetduration);if(v>0){if(i&&v>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+v+" with playlist age: "+n.age),v=0;else{var y=Math.floor(v/n.targetduration);l+=y,void 0!==u&&(u+=Math.round(v%n.targetduration/n.partTarget)),this.log("CDN Tune-in age: "+n.ageHeader+"s last advanced "+p.toFixed(2)+"s goal: "+v+" skip sn "+y+" to part "+u)}n.tuneInGoal=v}if(o=this.getDeliveryDirectives(n,e.deliveryDirectives,l,u),c||!g)return void this.loadPlaylist(o)}else o=this.getDeliveryDirectives(n,e.deliveryDirectives,l,u);var T=function(t,e){var i,r=1e3*t.levelTargetDuration,n=r/2,s=t.age,a=s>0&&s<3*r,o=e.loading.end-e.loading.start,l=t.availabilityDelay;if(!1===t.updated)if(a){var u=333*t.misses;i=Math.max(Math.min(n,2*o),u),t.availabilityDelay=(t.availabilityDelay||0)+i}else i=n;else a?(l=Math.min(l||r/2,s),t.availabilityDelay=l,i=l+r-s):i=r-o;return Math.round(i)}(n,s);void 0!==l&&n.canBlockReload&&(T-=n.partTarget||1),this.log("reload live playlist "+t+" in "+Math.round(T)+" ms"),this.timer=self.setTimeout((function(){return r.loadPlaylist(o)}),T)}else this.clearTimer()},e.getDeliveryDirectives=function(t,e,i,r){var n=function(t,e){var i=t.canSkipUntil,r=t.canSkipDateRanges,n=t.endSN;return i&&(void 0!==e?e-n:0)<i?r?W.v2:W.Yes:W.No}(t,i);return null!=e&&e.skip&&t.deltaUpdateFailed&&(i=e.msn,r=e.part,n=W.No),new $(i,r,n)},e.retryLoadingOrFail=function(t){var e,i=this,r=this.hls.config,n=this.retryCount<r.levelLoadingMaxRetry;if(n)if(this.retryCount++,t.details.indexOf("LoadTimeOut")>-1&&null!==(e=t.context)&&void 0!==e&&e.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+t.details+'"'),this.loadPlaylist();else{var s=Math.min(Math.pow(2,this.retryCount)*r.levelLoadingRetryDelay,r.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return i.loadPlaylist()}),s),this.warn("retry playlist loading #"+this.retryCount+" in "+s+' ms after "'+t.details+'"')}else this.warn('cannot recover from error "'+t.details+'"'),this.clearTimer(),t.fatal=!0;return n},t}();function at(){return(at=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}function ot(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function lt(t,e){return(lt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var ut,ct=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),ht=function(t){var e,i;function r(e){var i;return(i=t.call(this,e,"[level-controller]")||this)._levels=[],i._firstLevel=-1,i._startLevel=void 0,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.onParsedComplete=void 0,i._registerListeners(),i}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,lt(e,i);var n,s,l=r.prototype;return l._registerListeners=function(){var t=this.hls;t.on(a.a.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(a.a.LEVEL_LOADED,this.onLevelLoaded,this),t.on(a.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(a.a.FRAG_LOADED,this.onFragLoaded,this),t.on(a.a.ERROR,this.onError,this)},l._unregisterListeners=function(){var t=this.hls;t.off(a.a.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(a.a.LEVEL_LOADED,this.onLevelLoaded,this),t.off(a.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(a.a.FRAG_LOADED,this.onFragLoaded,this),t.off(a.a.ERROR,this.onError,this)},l.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,t.prototype.destroy.call(this)},l.startLoad=function(){this._levels.forEach((function(t){t.loadError=0})),t.prototype.startLoad.call(this)},l.onManifestLoaded=function(t,e){var i,r,n=[],s=[],l=[],u={},c=!1,h=!1,d=!1;if(e.levels.forEach((function(t){var e=t.attrs;c=c||!(!t.width||!t.height),h=h||!!t.videoCodec,d=d||!!t.audioCodec,ct&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0);var i=t.bitrate+"-"+t.attrs.RESOLUTION+"-"+t.attrs.CODECS;(r=u[i])?r.url.push(t.url):(r=new X(t),u[i]=r,n.push(r)),e&&(e.AUDIO&&J(r,"audio",e.AUDIO),e.SUBTITLES&&J(r,"text",e.SUBTITLES))})),(c||h)&&d&&(n=n.filter((function(t){var e=t.videoCodec,i=t.width,r=t.height;return!!e||!(!i||!r)}))),n=n.filter((function(t){var e=t.audioCodec,i=t.videoCodec;return(!e||E(e,"audio"))&&(!i||E(i,"video"))})),e.audioTracks&&Z(s=e.audioTracks.filter((function(t){return!t.audioCodec||E(t.audioCodec,"audio")}))),e.subtitles&&Z(l=e.subtitles),n.length>0){i=n[0].bitrate,n.sort((function(t,e){return t.bitrate-e.bitrate})),this._levels=n;for(var f=0;f<n.length;f++)if(n[f].bitrate===i){this._firstLevel=f,this.log("manifest loaded, "+n.length+" level(s) found, first bitrate: "+i);break}var g=d&&!h,p={levels:n,audioTracks:s,subtitleTracks:l,firstLevel:this._firstLevel,stats:e.stats,audio:d,video:h,altAudio:!g&&s.some((function(t){return!!t.url}))};this.hls.trigger(a.a.MANIFEST_PARSED,p),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(a.a.ERROR,{type:o.b.MEDIA_ERROR,details:o.a.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,reason:"no level with compatible codecs found in manifest"})},l.onError=function(e,i){var r;if(t.prototype.onError.call(this,e,i),!i.fatal){var n=i.context,s=this._levels[this.currentLevelIndex];if(n&&(n.type===O.a.AUDIO_TRACK&&s.audioGroupIds&&n.groupId===s.audioGroupIds[s.urlId]||n.type===O.a.SUBTITLE_TRACK&&s.textGroupIds&&n.groupId===s.textGroupIds[s.urlId]))this.redundantFailover(this.currentLevelIndex);else{var a,l=!1,u=!0;switch(i.details){case o.a.FRAG_LOAD_ERROR:case o.a.FRAG_LOAD_TIMEOUT:case o.a.KEY_LOAD_ERROR:case o.a.KEY_LOAD_TIMEOUT:if(i.frag){var c=i.frag.type===O.b.MAIN?i.frag.level:this.currentLevelIndex,h=this._levels[c];h?(h.fragmentError++,h.fragmentError>this.hls.config.fragLoadingMaxRetry&&(a=c)):a=c}break;case o.a.LEVEL_LOAD_ERROR:case o.a.LEVEL_LOAD_TIMEOUT:n&&(n.deliveryDirectives&&(u=!1),a=n.level),l=!0;break;case o.a.REMUX_ALLOC_ERROR:a=null!=(r=i.level)?r:this.currentLevelIndex,l=!0}void 0!==a&&this.recoverLevel(i,a,l,u)}}},l.recoverLevel=function(t,e,i,r){var n=t.details,s=this._levels[e];if(s.loadError++,i){if(!this.retryLoadingOrFail(t))return void(this.currentLevelIndex=-1);t.levelRetry=!0}if(r){var a=s.url.length;if(a>1&&s.loadError<a)t.levelRetry=!0,this.redundantFailover(e);else if(-1===this.manualLevelIndex){for(var o=-1,l=this._levels,u=l.length;u--;){var c=(u+this.currentLevelIndex)%l.length;if(c!==this.currentLevelIndex&&0===l[c].loadError){o=c;break}}o>-1&&this.currentLevelIndex!==o&&(this.warn(n+": switch to "+o),t.levelRetry=!0,this.hls.nextAutoLevel=o)}}},l.redundantFailover=function(t){var e=this._levels[t],i=e.url.length;if(i>1){var r=(e.urlId+1)%i;this.warn("Switching to redundant URL-id "+r),this._levels.forEach((function(t){t.urlId=r})),this.level=t}},l.onFragLoaded=function(t,e){var i=e.frag;if(void 0!==i&&i.type===O.b.MAIN){var r=this._levels[i.level];void 0!==r&&(r.fragmentError=0,r.loadError=0)}},l.onLevelLoaded=function(t,e){var i,r,n=e.level,s=e.details,a=this._levels[n];if(!a)return this.warn("Invalid level index "+n),void(null!==(r=e.deliveryDirectives)&&void 0!==r&&r.skip&&(s.deltaUpdateFailed=!0));n===this.currentLevelIndex?(0===a.fragmentError&&(a.loadError=0,this.retryCount=0),this.playlistLoaded(n,e,a.details)):null!==(i=e.deliveryDirectives)&&void 0!==i&&i.skip&&(s.deltaUpdateFailed=!0)},l.onAudioTrackSwitched=function(t,e){var i=this.hls.levels[this.currentLevelIndex];if(i&&i.audioGroupIds){for(var r=-1,n=this.hls.audioTracks[e.id].groupId,s=0;s<i.audioGroupIds.length;s++)if(i.audioGroupIds[s]===n){r=s;break}r!==i.urlId&&(i.urlId=r,this.startLoad())}},l.loadPlaylist=function(t){var e=this.currentLevelIndex,i=this._levels[e];if(this.canLoad&&i&&i.url.length>0){var r=i.urlId,n=i.url[r];if(t)try{n=t.addDirectives(n)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Attempt loading level index "+e+(t?" at sn "+t.msn+" part "+t.part:"")+" with URL-id "+r+" "+n),this.clearTimer(),this.hls.trigger(a.a.LEVEL_LOADING,{url:n,level:e,id:r,deliveryDirectives:t||null})}},l.removeLevel=function(t,e){var i=function(t,i){return i!==e},r=this._levels.filter((function(r,n){return n!==t||r.url.length>1&&void 0!==e&&(r.url=r.url.filter(i),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(i)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(i)),r.urlId=0,!0)})).map((function(t,e){var i=t.details;return null!=i&&i.fragments&&i.fragments.forEach((function(t){t.level=e})),t}));this._levels=r,this.hls.trigger(a.a.LEVELS_UPDATED,{levels:r})},n=r,(s=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e,i=this._levels;if(0!==i.length&&(this.currentLevelIndex!==t||null===(e=i[t])||void 0===e||!e.details)){if(t<0||t>=i.length){var r=t<0;if(this.hls.trigger(a.a.ERROR,{type:o.b.OTHER_ERROR,details:o.a.LEVEL_SWITCH_ERROR,level:t,fatal:r,reason:"invalid level idx"}),r)return;t=Math.min(t,i.length-1)}this.clearTimer();var n=this.currentLevelIndex,s=i[n],l=i[t];this.log("switching to level "+t+" from "+n),this.currentLevelIndex=t;var u=at({},l,{level:t,maxBitrate:l.maxBitrate,uri:l.uri,urlId:l.urlId});delete u._urlId,this.hls.trigger(a.a.LEVEL_SWITCHING,u);var c=l.details;if(!c||c.live){var h=this.switchParams(l.uri,null==s?void 0:s.details);this.loadPlaylist(h)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}])&&ot(n.prototype,s),Object.defineProperty(n,"prototype",{writable:!1}),r}(st);!function(t){t.NOT_LOADED="NOT_LOADED",t.APPENDING="APPENDING",t.PARTIAL="PARTIAL",t.OK="OK"}(ut||(ut={}));var dt=function(){function t(t){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=t,this._registerListeners()}var e=t.prototype;return e._registerListeners=function(){var t=this.hls;t.on(a.a.BUFFER_APPENDED,this.onBufferAppended,this),t.on(a.a.FRAG_BUFFERED,this.onFragBuffered,this),t.on(a.a.FRAG_LOADED,this.onFragLoaded,this)},e._unregisterListeners=function(){var t=this.hls;t.off(a.a.BUFFER_APPENDED,this.onBufferAppended,this),t.off(a.a.FRAG_BUFFERED,this.onFragBuffered,this),t.off(a.a.FRAG_LOADED,this.onFragLoaded,this)},e.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},e.getAppendedFrag=function(t,e){if(e===O.b.MAIN){var i=this.activeFragment,r=this.activeParts;if(!i)return null;if(r)for(var n=r.length;n--;){var s=r[n],a=s?s.end:i.appendedPTS;if(s.start<=t&&void 0!==a&&t<=a)return n>9&&(this.activeParts=r.slice(n-9)),s}else if(i.start<=t&&void 0!==i.appendedPTS&&t<=i.appendedPTS)return i}return this.getBufferedFrag(t,e)},e.getBufferedFrag=function(t,e){for(var i=this.fragments,r=Object.keys(i),n=r.length;n--;){var s=i[r[n]];if((null==s?void 0:s.body.type)===e&&s.buffered){var a=s.body;if(a.start<=t&&t<=a.end)return a}}return null},e.detectEvictedFragments=function(t,e,i){var r=this;Object.keys(this.fragments).forEach((function(n){var s=r.fragments[n];if(s)if(s.buffered){var a=s.range[t];a&&a.time.some((function(t){var i=!r.isTimeBuffered(t.startPTS,t.endPTS,e);return i&&r.removeFragment(s.body),i}))}else s.body.type===i&&r.removeFragment(s.body)}))},e.detectPartialFragments=function(t){var e=this,i=this.timeRanges,r=t.frag,n=t.part;if(i&&"initSegment"!==r.sn){var s=gt(r),a=this.fragments[s];a&&(Object.keys(i).forEach((function(t){var s=r.elementaryStreams[t];if(s){var o=i[t],l=null!==n||!0===s.partial;a.range[t]=e.getBufferedTimes(r,n,l,o)}})),a.loaded=null,Object.keys(a.range).length?a.buffered=!0:this.removeFragment(a.body))}},e.fragBuffered=function(t){var e=gt(t),i=this.fragments[e];i&&(i.loaded=null,i.buffered=!0)},e.getBufferedTimes=function(t,e,i,r){for(var n={time:[],partial:i},s=e?e.start:t.start,a=e?e.end:t.end,o=t.minEndPTS||a,l=t.maxStartPTS||s,u=0;u<r.length;u++){var c=r.start(u)-this.bufferPadding,h=r.end(u)+this.bufferPadding;if(l>=c&&o<=h){n.time.push({startPTS:Math.max(s,r.start(u)),endPTS:Math.min(a,r.end(u))});break}if(s<h&&a>c)n.partial=!0,n.time.push({startPTS:Math.max(s,r.start(u)),endPTS:Math.min(a,r.end(u))});else if(a<=c)break}return n},e.getPartialFragment=function(t){var e,i,r,n=null,s=0,a=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach((function(l){var u=o[l];u&&ft(u)&&(i=u.body.start-a,r=u.body.end+a,t>=i&&t<=r&&(e=Math.min(t-i,r-t),s<=e&&(n=u.body,s=e)))})),n},e.getState=function(t){var e=gt(t),i=this.fragments[e];return i?i.buffered?ft(i)?ut.PARTIAL:ut.OK:ut.APPENDING:ut.NOT_LOADED},e.isTimeBuffered=function(t,e,i){for(var r,n,s=0;s<i.length;s++){if(r=i.start(s)-this.bufferPadding,n=i.end(s)+this.bufferPadding,t>=r&&e<=n)return!0;if(e<=r)return!1}return!1},e.onFragLoaded=function(t,e){var i=e.frag,r=e.part;if("initSegment"!==i.sn&&!i.bitrateTest&&!r){var n=gt(i);this.fragments[n]={body:i,loaded:e,buffered:!1,range:Object.create(null)}}},e.onBufferAppended=function(t,e){var i=this,r=e.frag,n=e.part,s=e.timeRanges;if(r.type===O.b.MAIN)if(this.activeFragment=r,n){var a=this.activeParts;a||(this.activeParts=a=[]),a.push(n)}else this.activeParts=null;this.timeRanges=s,Object.keys(s).forEach((function(t){var e=s[t];if(i.detectEvictedFragments(t,e),!n)for(var a=0;a<e.length;a++)r.appendedPTS=Math.max(e.end(a),r.appendedPTS||0)}))},e.onFragBuffered=function(t,e){this.detectPartialFragments(e)},e.hasFragment=function(t){var e=gt(t);return!!this.fragments[e]},e.removeFragmentsInRange=function(t,e,i){var r=this;Object.keys(this.fragments).forEach((function(n){var s=r.fragments[n];if(s&&s.buffered){var a=s.body;a.type===i&&a.start<e&&a.end>t&&r.removeFragment(a)}}))},e.removeFragment=function(t){var e=gt(t);t.stats.loaded=0,t.clearElementaryStreamInfo(),delete this.fragments[e]},e.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},t}();function ft(t){var e,i;return t.buffered&&((null===(e=t.range.video)||void 0===e?void 0:e.partial)||(null===(i=t.range.audio)||void 0===i?void 0:i.partial))}function gt(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn}var pt=function(){function t(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var e=t.prototype;return e.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},e.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},e.onHandlerDestroyed=function(){},e.hasInterval=function(){return!!this._tickInterval},e.hasNextTick=function(){return!!this._tickTimer},e.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},e.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},e.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},e.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},e.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},e.doTick=function(){},t}(),mt={length:0,start:function(){return 0},end:function(){return 0}},vt=function(){function t(){}return t.isBuffered=function(e,i){try{if(e)for(var r=t.getBuffered(e),n=0;n<r.length;n++)if(i>=r.start(n)&&i<=r.end(n))return!0}catch(t){}return!1},t.bufferInfo=function(e,i,r){try{if(e){var n,s=t.getBuffered(e),a=[];for(n=0;n<s.length;n++)a.push({start:s.start(n),end:s.end(n)});return this.bufferedInfo(a,i,r)}}catch(t){}return{len:0,start:i,end:i,nextStart:void 0}},t.bufferedInfo=function(t,e,i){e=Math.max(0,e),t.sort((function(t,e){return t.start-e.start||e.end-t.end}));var r=[];if(i)for(var n=0;n<t.length;n++){var s=r.length;if(s){var a=r[s-1].end;t[n].start-a<i?t[n].end>a&&(r[s-1].end=t[n].end):r.push(t[n])}else r.push(t[n])}else r=t;for(var o,l=0,u=e,c=e,h=0;h<r.length;h++){var d=r[h].start,f=r[h].end;if(e+i>=d&&e<f)u=d,l=(c=f)-e;else if(e+i<d){o=d;break}}return{len:l,start:u||0,end:c||0,nextStart:o}},t.getBuffered=function(t){try{return t.buffered}catch(t){return l.b.log("failed to get media.buffered",t),mt}},t}(),yt=function(t,e,i,r,n,s){void 0===r&&(r=0),void 0===n&&(n=-1),void 0===s&&(s=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=e,this.id=i,this.size=r,this.part=n,this.partial=s};function Tt(t,e){if(t){var i=t.start+e;t.start=t.startPTS=i,t.endPTS=i+t.duration}}function bt(t,e){for(var i=e.fragments,r=0,n=i.length;r<n;r++)Tt(i[r],t);e.fragmentHint&&Tt(e.fragmentHint,t),e.alignedSliding=!0}function Et(t,e,i){e&&(function(t,e,i){if(function(t,e,i){return!(!e.details||!(i.endCC>i.startCC||t&&t.cc<i.startCC))}(t,i,e)){var r=function(t,e){var i=t.fragments,r=e.fragments;if(r.length&&i.length){var n=function(t,e){for(var i=null,r=0,n=t.length;r<n;r++){var s=t[r];if(s&&s.cc===e){i=s;break}}return i}(i,r[0].cc);if(n&&(!n||n.startPTS))return n;l.b.log("No frag in previous level to align on")}else l.b.log("No fragments to align")}(i.details,e);r&&Object(s.a)(r.start)&&(l.b.log("Adjusting PTS using last level due to CC increase within current level "+e.url),bt(r.start,e))}}(t,i,e),!i.alignedSliding&&e.details&&function(t,e){if(e.fragments.length&&t.hasProgramDateTime&&e.hasProgramDateTime){var i=e.fragments[0].programDateTime,r=t.fragments[0].programDateTime,n=(r-i)/1e3+e.fragments[0].start;n&&Object(s.a)(n)&&(l.b.log("Adjusting PTS using programDateTime delta "+(r-i)+"ms, sliding:"+n.toFixed(3)+" "+t.url+" "),bt(n,t))}}(i,e.details),i.alignedSliding||!e.details||i.skippedSegments||rt(e.details,i))}function St(t,e){var i=t.programDateTime;if(i){var r=(i-e)/1e3;t.start=t.startPTS=r,t.endPTS=r+t.duration}}function wt(t,e){if(e.fragments.length&&t.hasProgramDateTime&&e.hasProgramDateTime){var i=e.fragments[0].programDateTime-1e3*e.fragments[0].start;t.fragments.forEach((function(t){St(t,i)})),t.fragmentHint&&St(t.fragmentHint,i),t.alignedSliding=!0}}var It=function(t,e){for(var i=0,r=t.length-1,n=null,s=null;i<=r;){var a=e(s=t[n=(i+r)/2|0]);if(a>0)i=n+1;else{if(!(a<0))return s;r=n-1}}return null};function _t(t,e,i,r){void 0===i&&(i=0),void 0===r&&(r=0);var n=null;return t?n=e[t.sn-e[0].sn+1]||null:0===i&&0===e[0].start&&(n=e[0]),n&&0===At(i,r,n)?n:It(e,At.bind(null,i,r))||n}function At(t,e,i){void 0===t&&(t=0),void 0===e&&(e=0);var r=Math.min(e,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-r<=t?1:i.start-r>t&&i.start?-1:0}function kt(t,e,i){var r=1e3*Math.min(e,i.duration+(i.deltaPTS?i.deltaPTS:0));return(i.endProgramDateTime||0)-r>t}function Dt(t){var e="function"==typeof Map?new Map:void 0;return(Dt=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return Lt(t,arguments,Ot(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Ct(r,t)})(t)}function Lt(t,e,i){return(Lt=Rt()?Reflect.construct.bind():function(t,e,i){var r=[null];r.push.apply(r,e);var n=new(Function.bind.apply(t,r));return i&&Ct(n,i.prototype),n}).apply(null,arguments)}function Rt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Ct(t,e){return(Ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Ot(t){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Pt=Math.pow(2,17),xt=function(){function t(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var e=t.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(t,e){var i=this,r=t.url;if(!r)return Promise.reject(new Mt({type:o.b.NETWORK_ERROR,details:o.a.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(r?"part list":"url")));this.abort();var n=this.config,s=n.fLoader,a=n.loader;return new Promise((function(r,l){i.loader&&i.loader.destroy();var u=i.loader=t.loader=s?new s(n):new a(n),c=Nt(t),h={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:"initSegment"===t.sn?1/0:Pt};t.stats=u.stats,u.load(c,h,{onSuccess:function(e,n,s,a){i.resetLoader(t,u),r({frag:t,part:null,payload:e.data,networkDetails:a})},onError:function(e,r,n){i.resetLoader(t,u),l(new Mt({type:o.b.NETWORK_ERROR,details:o.a.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:e,networkDetails:n}))},onAbort:function(e,r,n){i.resetLoader(t,u),l(new Mt({type:o.b.NETWORK_ERROR,details:o.a.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:n}))},onTimeout:function(e,r,n){i.resetLoader(t,u),l(new Mt({type:o.b.NETWORK_ERROR,details:o.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:n}))},onProgress:function(i,r,n,s){e&&e({frag:t,part:null,payload:n,networkDetails:s})}})}))},e.loadPart=function(t,e,i){var r=this;this.abort();var n=this.config,s=n.fLoader,a=n.loader;return new Promise((function(l,u){r.loader&&r.loader.destroy();var c=r.loader=t.loader=s?new s(n):new a(n),h=Nt(t,e),d={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:Pt};e.stats=c.stats,c.load(h,d,{onSuccess:function(n,s,a,o){r.resetLoader(t,c),r.updateStatsFromPart(t,e);var u={frag:t,part:e,payload:n.data,networkDetails:o};i(u),l(u)},onError:function(i,n,s){r.resetLoader(t,c),u(new Mt({type:o.b.NETWORK_ERROR,details:o.a.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:i,networkDetails:s}))},onAbort:function(i,n,s){t.stats.aborted=e.stats.aborted,r.resetLoader(t,c),u(new Mt({type:o.b.NETWORK_ERROR,details:o.a.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,networkDetails:s}))},onTimeout:function(i,n,s){r.resetLoader(t,c),u(new Mt({type:o.b.NETWORK_ERROR,details:o.a.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,networkDetails:s}))}})}))},e.updateStatsFromPart=function(t,e){var i=t.stats,r=e.stats,n=r.total;if(i.loaded+=r.loaded,n){var s=Math.round(t.duration/e.duration),a=Math.min(Math.round(i.loaded/n),s),o=(s-a)*Math.round(i.loaded/a);i.total=i.loaded+o}else i.total=Math.max(i.loaded,i.total);var l=i.loading,u=r.loading;l.start?l.first+=u.first-u.start:(l.start=u.start,l.first=u.first),l.end=u.end},e.resetLoader=function(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},t}();function Nt(t,e){void 0===e&&(e=null);var i=e||t,r={frag:t,part:e,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},n=i.byteRangeStartOffset,a=i.byteRangeEndOffset;return Object(s.a)(n)&&Object(s.a)(a)&&(r.rangeStart=n,r.rangeEnd=a),r}var Mt=function(t){var e,i;function r(e){for(var i,r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];return(i=t.call.apply(t,[this].concat(n))||this).data=void 0,i.data=e,i}return i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,Ct(e,i),r}(Dt(Error)),Ft=i(16),Ut=function(t){for(var e="",i=t.length,r=0;r<i;r++)e+="["+t.start(r).toFixed(3)+","+t.end(r).toFixed(3)+"]";return e};function Bt(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Vt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function jt(t,e){return(jt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var Gt="STOPPED",Kt="IDLE",Ht="KEY_LOADING",qt="FRAG_LOADING",Wt="FRAG_LOADING_WAITING_RETRY",zt="WAITING_TRACK",Yt="PARSING",$t="PARSED",Xt="ENDED",Qt="ERROR",Jt="WAITING_INIT_PTS",Zt="WAITING_LEVEL",te=function(t){var e,i;function r(e,i,r){var n;return(n=t.call(this)||this).hls=void 0,n.fragPrevious=null,n.fragCurrent=null,n.fragmentTracker=void 0,n.transmuxer=null,n._state=Gt,n.media=null,n.mediaBuffer=null,n.config=void 0,n.bitrateTest=!1,n.lastCurrentTime=0,n.nextLoadPosition=0,n.startPosition=0,n.loadedmetadata=!1,n.fragLoadError=0,n.retryDate=0,n.levels=null,n.fragmentLoader=void 0,n.levelLastLoaded=null,n.startFragRequested=!1,n.decrypter=void 0,n.initPTS=[],n.onvseeking=null,n.onvended=null,n.logPrefix="",n.log=void 0,n.warn=void 0,n.logPrefix=r,n.log=l.b.log.bind(l.b,r+":"),n.warn=l.b.warn.bind(l.b,r+":"),n.hls=e,n.fragmentLoader=new xt(e.config),n.fragmentTracker=i,n.config=e.config,n.decrypter=new Ft.a(e,e.config),e.on(a.a.KEY_LOADED,n.onKeyLoaded,Vt(n)),e.on(a.a.LEVEL_SWITCHING,n.onLevelSwitching,Vt(n)),n}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,jt(e,i);var n,c,h=r.prototype;return h.doTick=function(){this.onTickEnd()},h.onTickEnd=function(){},h.startLoad=function(t){},h.stopLoad=function(){this.fragmentLoader.abort();var t=this.fragCurrent;t&&this.fragmentTracker.removeFragment(t),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Gt},h._streamEnded=function(t,e){var i=this.fragCurrent,r=this.fragmentTracker;if(!e.live&&i&&this.media&&i.sn>=e.endSN&&!t.nextStart){var n=e.partList;if(null!=n&&n.length){var s=n[n.length-1];return vt.isBuffered(this.media,s.start+s.duration/2)}var a=r.getState(i);return a===ut.PARTIAL||a===ut.OK}return!1},h.onMediaAttached=function(t,e){var i=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.state===Gt&&this.startLoad(r.startPosition)},h.onMediaDetaching=function(){var t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},h.onMediaSeeking=function(){var t=this.config,e=this.fragCurrent,i=this.media,r=this.mediaBuffer,n=this.state,a=i?i.currentTime:0,o=vt.bufferInfo(r||i,a,t.maxBufferHole);if(this.log("media seeking to "+(Object(s.a)(a)?a.toFixed(3):a)+", state: "+n),n===Xt)this.resetLoadingState();else if(e&&!o.len){var l=t.maxFragLookUpTolerance,u=e.start-l,c=a>e.start+e.duration+l;(a<u||c)&&(c&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.loader.abort()),this.resetLoadingState())}i&&(this.lastCurrentTime=a),this.loadedmetadata||o.len||(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()},h.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},h.onKeyLoaded=function(t,e){if(this.state===Ht&&e.frag===this.fragCurrent&&this.levels){this.state=Kt;var i=this.levels[e.frag.level].details;i&&this.loadFragment(e.frag,i,e.frag.start)}},h.onLevelSwitching=function(t,e){this.fragLoadError=0},h.onHandlerDestroying=function(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},h.onHandlerDestroyed=function(){this.state=Gt,this.hls.off(a.a.KEY_LOADED,this.onKeyLoaded,this),this.hls.off(a.a.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,t.prototype.onHandlerDestroyed.call(this)},h.loadKey=function(t,e){this.log("Loading key for "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level),this.state=Ht,this.fragCurrent=t,this.hls.trigger(a.a.KEY_LOADING,{frag:t})},h.loadFragment=function(t,e,i){this._loadFragForPlayback(t,e,i)},h._loadFragForPlayback=function(t,e,i){var r=this;this._doFragLoad(t,e,i,(function(e){if(r.fragContextChanged(t))return r.warn("Fragment "+t.sn+(e.part?" p: "+e.part.index:"")+" of level "+t.level+" was dropped during download."),void r.fragmentTracker.removeFragment(t);t.stats.chunkCount++,r._handleFragmentLoadProgress(e)})).then((function(e){if(e){r.fragLoadError=0;var i=r.state;r.fragContextChanged(t)?(i===qt||!r.fragCurrent&&i===Yt)&&(r.fragmentTracker.removeFragment(t),r.state=Kt):("payload"in e&&(r.log("Loaded fragment "+t.sn+" of level "+t.level),r.hls.trigger(a.a.FRAG_LOADED,e)),r._handleFragmentLoadComplete(e))}})).catch((function(e){r.state!==Gt&&r.state!==Qt&&(r.warn(e),r.resetFragmentLoading(t))}))},h.flushMainBuffer=function(t,e,i){if(void 0===i&&(i=null),t-e){var r={startOffset:t,endOffset:e,type:i};this.fragLoadError=0,this.hls.trigger(a.a.BUFFER_FLUSHING,r)}},h._loadInitSegment=function(t){var e=this;this._doFragLoad(t).then((function(i){if(!i||e.fragContextChanged(t)||!e.levels)throw new Error("init load aborted");return i})).then((function(i){var r=e.hls,n=i.payload,s=t.decryptdata;if(n&&n.byteLength>0&&s&&s.key&&s.iv&&"AES-128"===s.method){var o=self.performance.now();return e.decrypter.webCryptoDecrypt(new Uint8Array(n),s.key.buffer,s.iv.buffer).then((function(e){var n=self.performance.now();return r.trigger(a.a.FRAG_DECRYPTED,{frag:t,payload:e,stats:{tstart:o,tdecrypt:n}}),i.payload=e,i}))}return i})).then((function(i){var r=e.fragCurrent,n=e.hls,s=e.levels;if(!s)throw new Error("init load aborted, missing levels");s[t.level].details;var o=t.stats;e.state=Kt,e.fragLoadError=0,t.data=new Uint8Array(i.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),i.frag===r&&n.trigger(a.a.FRAG_BUFFERED,{stats:o,frag:r,part:null,id:t.type}),e.tick()})).catch((function(i){e.state!==Gt&&e.state!==Qt&&(e.warn(i),e.resetFragmentLoading(t))}))},h.fragContextChanged=function(t){var e=this.fragCurrent;return!t||!e||t.level!==e.level||t.sn!==e.sn||t.urlId!==e.urlId},h.fragBufferedComplete=function(t,e){var i=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+t.type+" sn: "+t.sn+(e?" part: "+e.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level+" "+(i?Ut(vt.getBuffered(i)):"(detached)")),this.state=Kt,i&&(!this.loadedmetadata&&i.buffered.length&&this.fragCurrent===this.fragPrevious&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},h.seekToStartPos=function(){},h._handleFragmentLoadComplete=function(t){var e=this.transmuxer;if(e){var i=t.frag,r=t.part,n=t.partsLoaded,s=!n||0===n.length||n.some((function(t){return!t})),a=new yt(i.level,i.sn,i.stats.chunkCount+1,0,r?r.index:-1,!s);e.flush(a)}},h._handleFragmentLoadProgress=function(t){},h._doFragLoad=function(t,e,i,r){var n=this;if(void 0===i&&(i=null),!this.levels)throw new Error("frag load aborted, missing levels");if(i=Math.max(t.start,i||0),this.config.lowLatencyMode&&e){var o=e.partList;if(o&&r){i>t.end&&e.fragmentHint&&(t=e.fragmentHint);var l=this.getNextPart(o,t,i);if(l>-1){var u=o[l];return this.log("Loading part sn: "+t.sn+" p: "+u.index+" cc: "+t.cc+" of playlist ["+e.startSN+"-"+e.endSN+"] parts [0-"+l+"-"+(o.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=u.start+u.duration,this.state=qt,this.hls.trigger(a.a.FRAG_LOADING,{frag:t,part:o[l],targetBufferTime:i}),this.doFragPartsLoad(t,o,l,r).catch((function(t){return n.handleFragLoadError(t)}))}if(!t.url||this.loadedEndOfParts(o,i))return Promise.resolve(null)}}return this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(e?"of ["+e.startSN+"-"+e.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(i.toFixed(3))),Object(s.a)(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=qt,this.hls.trigger(a.a.FRAG_LOADING,{frag:t,targetBufferTime:i}),this.fragmentLoader.load(t,r).catch((function(t){return n.handleFragLoadError(t)}))},h.doFragPartsLoad=function(t,e,i,r){var n=this;return new Promise((function(s,o){var l=[];!function i(u){var c=e[u];n.fragmentLoader.loadPart(t,c,r).then((function(r){l[c.index]=r;var o=r.part;n.hls.trigger(a.a.FRAG_LOADED,r);var h=e[u+1];if(!h||h.fragment!==t)return s({frag:t,part:o,partsLoaded:l});i(u+1)})).catch(o)}(i)}))},h.handleFragLoadError=function(t){var e=t.data;return e&&e.details===o.a.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(a.a.ERROR,e),null},h._handleTransmuxerFlush=function(t){var e=this.getCurrentContext(t);if(e&&this.state===Yt){var i=e.frag,r=e.part,n=e.level,s=self.performance.now();i.stats.parsing.end=s,r&&(r.stats.parsing.end=s),this.updateLevelTiming(i,r,n,t.partial)}else this.fragCurrent||(this.state=Kt)},h.getCurrentContext=function(t){var e=this.levels,i=t.level,r=t.sn,n=t.part;if(!e||!e[i])return this.warn("Levels object was unset while buffering fragment "+r+" of level "+i+". The current chunk will not be buffered."),null;var s=e[i],a=n>-1?function(t,e,i){if(!t||!t.details)return null;var r=t.details.partList;if(r)for(var n=r.length;n--;){var s=r[n];if(s.index===i&&s.fragment.sn===e)return s}return null}(s,r,n):null,o=a?a.fragment:function(t,e,i){if(!t||!t.details)return null;var r=t.details,n=r.fragments[e-r.startSN];return n||((n=r.fragmentHint)&&n.sn===e?n:e<r.startSN&&i&&i.sn===e?i:null)}(s,r,this.fragCurrent);return o?{frag:o,part:a,level:s}:null},h.bufferFragmentData=function(t,e,i,r){if(t&&this.state===Yt){var n=t.data1,s=t.data2,o=n;if(n&&s&&(o=Object(u.b)(n,s)),o&&o.length){var l={type:t.type,frag:e,part:i,chunkMeta:r,parent:e.type,data:o};this.hls.trigger(a.a.BUFFER_APPENDING,l),t.dropped&&t.independent&&!i&&this.flushBufferGap(e)}}},h.flushBufferGap=function(t){var e=this.media;if(e)if(vt.isBuffered(e,e.currentTime)){var i=e.currentTime,r=vt.bufferInfo(e,i,0),n=t.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*n),a=Math.max(Math.min(t.start-s,r.end-s),i+s);t.start-a>s&&this.flushMainBuffer(a,t.start)}else this.flushMainBuffer(0,t.start)},h.getFwdBufferInfo=function(t,e){var i=this.config,r=this.getLoadPosition();if(!Object(s.a)(r))return null;var n=vt.bufferInfo(t,r,i.maxBufferHole);if(0===n.len&&void 0!==n.nextStart){var a=this.fragmentTracker.getBufferedFrag(r,e);if(a&&n.nextStart<a.end)return vt.bufferInfo(t,r,Math.max(n.nextStart,i.maxBufferHole))}return n},h.getMaxBufferLength=function(t){var e,i=this.config;return e=t?Math.max(8*i.maxBufferSize/t,i.maxBufferLength):i.maxBufferLength,Math.min(e,i.maxMaxBufferLength)},h.reduceMaxBufferLength=function(t){var e=this.config,i=t||e.maxBufferLength;return e.maxMaxBufferLength>=i&&(e.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},h.getNextFragment=function(t,e){var i=e.fragments,r=i.length;if(!r)return null;var n,s=this.config,a=i[0].start;if(e.live){var o=s.initialLiveManifestSize;if(r<o)return this.warn("Not enough fragments to start playback (have: "+r+", need: "+o+")"),null;e.PTSKnown||this.startFragRequested||-1!==this.startPosition||(n=this.getInitialLiveFragment(e,i),this.startPosition=n?this.hls.liveSyncPosition||n.start:t)}else t<=a&&(n=i[0]);if(!n){var l=s.lowLatencyMode?e.partEnd:e.fragmentEnd;n=this.getFragmentAtPosition(t,l,e)}return this.mapToInitFragWhenRequired(n)},h.mapToInitFragWhenRequired=function(t){return null==t||!t.initSegment||null!=t&&t.initSegment.data||this.bitrateTest?t:t.initSegment},h.getNextPart=function(t,e,i){for(var r=-1,n=!1,s=!0,a=0,o=t.length;a<o;a++){var l=t[a];if(s=s&&!l.independent,r>-1&&i<l.start)break;var u=l.loaded;!u&&(n||l.independent||s)&&l.fragment===e&&(r=a),n=u}return r},h.loadedEndOfParts=function(t,e){var i=t[t.length-1];return i&&e>i.start&&i.loaded},h.getInitialLiveFragment=function(t,e){var i=this.fragPrevious,r=null;if(i){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),r=function(t,e,i){if(null===e||!Array.isArray(t)||!t.length||!Object(s.a)(e))return null;if(e<(t[0].programDateTime||0))return null;if(e>=(t[t.length-1].endProgramDateTime||0))return null;i=i||0;for(var r=0;r<t.length;++r){var n=t[r];if(kt(e,i,n))return n}return null}(e,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){var n=i.sn+1;if(n>=t.startSN&&n<=t.endSN){var a=e[n-t.startSN];i.cc===a.cc&&(r=a,this.log("Live playlist, switching playlist, load frag with next SN: "+r.sn))}r||(r=function(t,e){return It(t,(function(t){return t.cc<e?1:t.cc>e?-1:0}))}(e,i.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+r.sn)}}else{var o=this.hls.liveSyncPosition;null!==o&&(r=this.getFragmentAtPosition(o,this.bitrateTest?t.fragmentEnd:t.edge,t))}return r},h.getFragmentAtPosition=function(t,e,i){var r,n=this.config,s=this.fragPrevious,a=i.fragments,o=i.endSN,l=i.fragmentHint,u=n.maxFragLookUpTolerance,c=!!(n.lowLatencyMode&&i.partList&&l);if(c&&l&&!this.bitrateTest&&(a=a.concat(l),o=l.sn),r=t<e?_t(s,a,t,t>e-u?0:u):a[a.length-1]){var h=r.sn-i.startSN;if(s&&r.sn===s.sn&&!c&&s&&r.level===s.level){var d=a[h+1];r.sn<o&&this.fragmentTracker.getState(d)!==ut.OK?(this.log("SN "+r.sn+" just loaded, load next one: "+d.sn),r=d):r=null}}return r},h.synchronizeToLiveEdge=function(t){var e=this.config,i=this.media;if(i){var r=this.hls.liveSyncPosition,n=i.currentTime,s=t.fragments[0].start,a=t.edge,o=n>=s-e.maxFragLookUpTolerance&&n<=a;if(null!==r&&i.duration>r&&(n<r||!o)){var l=void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;(!o&&i.readyState<4||n<a-l)&&(this.loadedmetadata||(this.nextLoadPosition=r),i.readyState&&(this.warn("Playback: "+n.toFixed(3)+" is located too far from the end of live sliding playlist: "+a+", reset currentTime to : "+r.toFixed(3)),i.currentTime=r))}}},h.alignPlaylists=function(t,e){var i=this.levels,r=this.levelLastLoaded,n=this.fragPrevious,a=null!==r?i[r]:null,o=t.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;var l=t.fragments[0].start,u=!e,c=t.alignedSliding&&Object(s.a)(l);if(u||!c&&!l){Et(n,a,t);var h=t.fragments[0].start;return this.log("Live playlist sliding: "+h.toFixed(2)+" start-sn: "+(e?e.startSN:"na")+"->"+t.startSN+" prev-sn: "+(n?n.sn:"na")+" fragments: "+o),h}return l},h.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.partTarget&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},h.setStartPosition=function(t,e){var i=this.startPosition;if(i<e&&(i=-1),-1===i||-1===this.lastCurrentTime){var r=t.startTimeOffset;Object(s.a)(r)?(i=e+r,r<0&&(i+=t.totalduration),i=Math.min(Math.max(e,i),e+t.totalduration),this.log("Start time offset "+r+" found in playlist, adjust startPosition to "+i),this.startPosition=i):t.live?i=this.hls.liveSyncPosition||e:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i},h.getLoadPosition=function(){var t=this.media,e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e},h.handleFragLoadAborted=function(t,e){this.transmuxer&&"initSegment"!==t.sn&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(e?" part"+e.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},h.resetFragmentLoading=function(t){this.fragCurrent&&(this.fragContextChanged(t)||this.state===Wt)||(this.state=Kt)},h.onFragmentOrKeyLoadError=function(t,e){if(!e.fatal){var i=e.frag;if(i&&i.type===t){this.fragCurrent;var r=this.config;if(this.fragLoadError+1<=r.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var n=Math.min(Math.pow(2,this.fragLoadError)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout);this.warn("Fragment "+i.sn+" of "+t+" "+i.level+" failed to load, retrying in "+n+"ms"),this.retryDate=self.performance.now()+n,this.fragLoadError++,this.state=Wt}else e.levelRetry?(t===O.b.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=Kt):(l.b.error(e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.stopLoad(),this.state=Qt)}}},h.afterBufferFlushed=function(t,e,i){if(t){var r=vt.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,r,i),this.state===Xt&&this.resetLoadingState()}},h.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=Kt},h.resetStartWhenNotLoaded=function(t){if(!this.loadedmetadata){this.startFragRequested=!1;var e=this.levels?this.levels[t].details:null;null!=e&&e.live?(this.startPosition=-1,this.setStartPosition(e,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},h.updateLevelTiming=function(t,e,i,r){var n=this,s=i.details;Object.keys(t.elementaryStreams).reduce((function(e,o){var l=t.elementaryStreams[o];if(l){var u=l.endPTS-l.startPTS;if(u<=0)return n.warn("Could not parse fragment "+t.sn+" "+o+" duration reliably ("+u+")"),e||!1;var c=r?0:et(s,t,l.startPTS,l.endPTS,l.startDTS,l.endDTS);return n.hls.trigger(a.a.LEVEL_PTS_UPDATED,{details:s,level:i,drift:c,type:o,frag:t,start:l.startPTS,end:l.endPTS}),!0}return e}),!1)||(this.warn("Found no media in fragment "+t.sn+" of level "+i.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=$t,this.hls.trigger(a.a.FRAG_PARSED,{frag:t,part:e})},h.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},n=r,(c=[{key:"state",get:function(){return this._state},set:function(t){var e=this._state;e!==t&&(this._state=t,this.log(e+"->"+t))}}])&&Bt(n.prototype,c),Object.defineProperty(n,"prototype",{writable:!1}),r}(pt);function ee(){return self.MediaSource||self.WebKitMediaSource}function ie(){return self.SourceBuffer||self.WebKitSourceBuffer}var re=i(18),ne=i(10),se=i(15),ae=ee()||{isTypeSupported:function(){return!1}},oe=function(){function t(t,e,i,r){var n=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=t,this.id=e,this.onTransmuxComplete=i,this.onFlush=r;var s=t.config,u=function(e,i){(i=i||{}).frag=n.frag,i.id=n.id,t.trigger(e,i)};this.observer=new se.EventEmitter,this.observer.on(a.a.FRAG_DECRYPTED,u),this.observer.on(a.a.ERROR,u);var c={mp4:ae.isTypeSupported("video/mp4"),mpeg:ae.isTypeSupported("audio/mpeg"),mp3:ae.isTypeSupported('audio/mp4; codecs="mp3"')},h=navigator.vendor;if(s.enableWorker&&"undefined"!=typeof Worker){var d;l.b.log("demuxing in webworker");try{d=this.worker=re(19),this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(e){t.trigger(a.a.ERROR,{type:o.b.OTHER_ERROR,details:o.a.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(e.message+"  ("+e.filename+":"+e.lineno+")")})},d.postMessage({cmd:"init",typeSupported:c,vendor:h,id:e,config:JSON.stringify(s)})}catch(t){l.b.warn("Error in worker:",t),l.b.error("Error while initializing DemuxerWorker, fallback to inline"),d&&self.URL.revokeObjectURL(d.objectURL),this.transmuxer=new ne.c(this.observer,c,s,h,e),this.worker=null}}else this.transmuxer=new ne.c(this.observer,c,s,h,e)}var e=t.prototype;return e.destroy=function(){var t=this.worker;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null,this.onwmsg=void 0;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var i=this.observer;i&&i.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},e.push=function(t,e,i,r,n,s,a,o,u,c){var h,d,f=this;u.transmuxing.start=self.performance.now();var g=this.transmuxer,p=this.worker,m=s?s.start:n.start,v=n.decryptdata,y=this.frag,T=!(y&&n.cc===y.cc),b=!(y&&u.level===y.level),E=y?u.sn-y.sn:-1,S=this.part?u.part-this.part.index:-1,w=0===E&&u.id>1&&u.id===(null==y?void 0:y.stats.chunkCount),I=!b&&(1===E||0===E&&(1===S||w&&S<=0)),_=self.performance.now();(b||E||0===n.stats.parsing.start)&&(n.stats.parsing.start=_),!s||!S&&I||(s.stats.parsing.start=_);var A=!(y&&(null===(h=n.initSegment)||void 0===h?void 0:h.url)===(null===(d=y.initSegment)||void 0===d?void 0:d.url)),k=new ne.b(T,I,o,b,m,A);if(!I||T||A){l.b.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+u.sn+" p: "+u.part+" level: "+u.level+" id: "+u.id+"\n        discontinuity: "+T+"\n        trackSwitch: "+b+"\n        contiguous: "+I+"\n        accurateTimeOffset: "+o+"\n        timeOffset: "+m+"\n        initSegmentChange: "+A);var D=new ne.a(i,r,e,a,c);this.configureTransmuxer(D)}if(this.frag=n,this.part=s,p)p.postMessage({cmd:"demux",data:t,decryptdata:v,chunkMeta:u,state:k},t instanceof ArrayBuffer?[t]:[]);else if(g){var L=g.push(t,v,u,k);Object(ne.d)(L)?L.then((function(t){f.handleTransmuxComplete(t)})):this.handleTransmuxComplete(L)}},e.flush=function(t){var e=this;t.transmuxing.start=self.performance.now();var i=this.transmuxer,r=this.worker;if(r)r.postMessage({cmd:"flush",chunkMeta:t});else if(i){var n=i.flush(t);Object(ne.d)(n)?n.then((function(i){e.handleFlushResult(i,t)})):this.handleFlushResult(n,t)}},e.handleFlushResult=function(t,e){var i=this;t.forEach((function(t){i.handleTransmuxComplete(t)})),this.onFlush(e)},e.onWorkerMessage=function(t){var e=t.data,i=this.hls;switch(e.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;case"workerLog":l.b[e.data.logType]&&l.b[e.data.logType](e.data.message);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,i.trigger(e.event,e.data)}},e.configureTransmuxer=function(t){var e=this.worker,i=this.transmuxer;e?e.postMessage({cmd:"configure",config:t}):i&&i.configure(t)},e.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},t}(),le=function(){function t(t,e,i,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=i,this.hls=r}var e=t.prototype;return e.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},e.poll=function(t,e){var i=this.config,r=this.media,n=this.stalled;if(null!==r){var s=r.currentTime,a=r.seeking,o=this.seeking&&!a,u=!this.seeking&&a;if(this.seeking=a,s===t){if((u||o)&&(this.stalled=null),!(r.paused&&!a||r.ended||0===r.playbackRate)&&vt.getBuffered(r).length){var c=vt.bufferInfo(r,s,0),h=c.len>0,d=c.nextStart||0;if(h||d){if(a){var f=c.len>2,g=!d||e&&e.start<=s||d-s>2&&!this.fragmentTracker.getPartialFragment(s);if(f||g)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var p,m=Math.max(d,c.start||0)-s,v=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,y=(null==v||null===(p=v.details)||void 0===p?void 0:p.live)?2*v.details.targetduration:2;if(m>0&&m<=y)return void this._trySkipBufferHole(null)}var T=self.performance.now();if(null!==n){var b=T-n;if(a||!(b>=250)||(this._reportStall(c),this.media)){var E=vt.bufferInfo(r,s,i.maxBufferHole);this._tryFixBufferStall(E,b)}}else this.stalled=T}}}else if(this.moved=!0,null!==n){if(this.stallReported){var S=self.performance.now()-n;l.b.warn("playback not stuck anymore @"+s+", after "+Math.round(S)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},e._tryFixBufferStall=function(t,e){var i=this.config,r=this.fragmentTracker,n=this.media;if(null!==n){var s=n.currentTime,a=r.getPartialFragment(s);if(a&&(this._trySkipBufferHole(a)||!this.media))return;t.len>i.maxBufferHole&&e>1e3*i.highBufferWatchdogPeriod&&(l.b.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},e._reportStall=function(t){var e=this.hls,i=this.media;!this.stallReported&&i&&(this.stallReported=!0,l.b.warn("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(t)+")"),e.trigger(a.a.ERROR,{type:o.b.MEDIA_ERROR,details:o.a.BUFFER_STALLED_ERROR,fatal:!1,buffer:t.len}))},e._trySkipBufferHole=function(t){var e=this.config,i=this.hls,r=this.media;if(null===r)return 0;for(var n=r.currentTime,s=0,u=vt.getBuffered(r),c=0;c<u.length;c++){var h=u.start(c);if(n+e.maxBufferHole>=s&&n<h){var d=Math.max(h+.05,r.currentTime+.1);return l.b.warn("skipping hole, adjusting currentTime from "+n+" to "+d),this.moved=!0,this.stalled=null,r.currentTime=d,t&&i.trigger(a.a.ERROR,{type:o.b.MEDIA_ERROR,details:o.a.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+n+" to "+d,frag:t}),d}s=u.end(c)}return 0},e._tryNudgeBuffer=function(){var t=this.config,e=this.hls,i=this.media,r=this.nudgeRetry;if(null!==i){var n=i.currentTime;if(this.nudgeRetry++,r<t.nudgeMaxRetry){var s=n+(r+1)*t.nudgeOffset;l.b.warn("Nudging 'currentTime' from "+n+" to "+s),i.currentTime=s,e.trigger(a.a.ERROR,{type:o.b.MEDIA_ERROR,details:o.a.BUFFER_NUDGE_ON_STALL,fatal:!1})}else l.b.error("Playhead still not moving while enough data buffered @"+n+" after "+t.nudgeMaxRetry+" nudges"),e.trigger(a.a.ERROR,{type:o.b.MEDIA_ERROR,details:o.a.BUFFER_STALLED_ERROR,fatal:!0})}},t}();function ue(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function ce(t,e){return(ce=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var he=function(t){var e,i;function r(e,i){var r;return(r=t.call(this,e,i,"[stream-controller]")||this).audioCodecSwap=!1,r.gapController=null,r.level=-1,r._forceStartLoad=!1,r.altAudio=!1,r.audioOnly=!1,r.fragPlaying=null,r.onvplaying=null,r.onvseeked=null,r.fragLastKbps=0,r.couldBacktrack=!1,r.backtrackFragment=null,r.audioCodecSwitch=!1,r.videoBuffer=null,r._registerListeners(),r}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,ce(e,i);var n,l,u=r.prototype;return u._registerListeners=function(){var t=this.hls;t.on(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(a.a.MANIFEST_PARSED,this.onManifestParsed,this),t.on(a.a.LEVEL_LOADING,this.onLevelLoading,this),t.on(a.a.LEVEL_LOADED,this.onLevelLoaded,this),t.on(a.a.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(a.a.ERROR,this.onError,this),t.on(a.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(a.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(a.a.BUFFER_CREATED,this.onBufferCreated,this),t.on(a.a.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(a.a.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(a.a.FRAG_BUFFERED,this.onFragBuffered,this)},u._unregisterListeners=function(){var t=this.hls;t.off(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(a.a.MANIFEST_PARSED,this.onManifestParsed,this),t.off(a.a.LEVEL_LOADED,this.onLevelLoaded,this),t.off(a.a.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(a.a.ERROR,this.onError,this),t.off(a.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(a.a.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(a.a.BUFFER_CREATED,this.onBufferCreated,this),t.off(a.a.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(a.a.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(a.a.FRAG_BUFFERED,this.onFragBuffered,this)},u.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},u.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=i.startLevel;-1===r&&(i.config.testBandwidth&&this.levels.length>1?(r=0,this.bitrateTest=!0):r=i.nextAutoLevel),this.level=i.nextLoadLevel=r,this.loadedmetadata=!1}e>0&&-1===t&&(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=Kt,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=Gt},u.stopLoad=function(){this._forceStartLoad=!1,t.prototype.stopLoad.call(this)},u.doTick=function(){switch(this.state){case Kt:this.doTickIdle();break;case Zt:var t,e=this.levels,i=this.level,r=null==e||null===(t=e[i])||void 0===t?void 0:t.details;if(r&&(!r.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(r))break;this.state=Kt;break}break;case Wt:var n,s=self.performance.now(),a=this.retryDate;(!a||s>=a||null!==(n=this.media)&&void 0!==n&&n.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=Kt)}this.onTickEnd()},u.onTickEnd=function(){t.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},u.doTickIdle=function(){var t,e,i=this.hls,r=this.levelLastLoaded,n=this.levels,s=this.media,o=i.config,l=i.nextLoadLevel;if(null!==r&&(s||!this.startFragRequested&&o.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&n&&n[l]){var u=n[l];this.level=i.nextLoadLevel=l;var c=u.details;if(!c||this.state===Zt||c.live&&this.levelLastLoaded!==l)this.state=Zt;else{var h=this.getMainFwdBufferInfo();if(null!==h&&!(h.len>=this.getMaxBufferLength(u.maxBitrate))){if(this._streamEnded(h,c)){var d={};return this.altAudio&&(d.type="video"),this.hls.trigger(a.a.BUFFER_EOS,d),void(this.state=Xt)}this.backtrackFragment&&this.backtrackFragment.start>h.end&&(this.backtrackFragment=null);var f=this.backtrackFragment?this.backtrackFragment.start:h.end,g=this.getNextFragment(f,c);if(this.couldBacktrack&&!this.fragPrevious&&g&&"initSegment"!==g.sn&&this.fragmentTracker.getState(g)!==ut.OK){var p,v=(null!=(p=this.backtrackFragment)?p:g).sn-c.startSN,y=c.fragments[v-1];y&&g.cc===y.cc&&(g=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&h.len&&(this.backtrackFragment=null);if(g&&this.fragmentTracker.getState(g)===ut.OK&&this.nextLoadPosition>f){var T=this.audioOnly&&!this.altAudio?m.a.AUDIO:m.a.VIDEO;s&&this.afterBufferFlushed(s,T,O.b.MAIN),g=this.getNextFragment(this.nextLoadPosition,c)}g&&(!g.initSegment||g.initSegment.data||this.bitrateTest||(g=g.initSegment),"identity"!==(null===(t=g.decryptdata)||void 0===t?void 0:t.keyFormat)||null!==(e=g.decryptdata)&&void 0!==e&&e.key?this.loadFragment(g,c,f):this.loadKey(g,c))}}}},u.loadFragment=function(e,i,r){var n,s=this.fragmentTracker.getState(e);this.fragCurrent=e,s===ut.NOT_LOADED?"initSegment"===e.sn?this._loadInitSegment(e):this.bitrateTest?(this.log("Fragment "+e.sn+" of level "+e.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(e)):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,e,i,r)):s===ut.APPENDING?this.reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e):0===(null===(n=this.media)||void 0===n?void 0:n.buffered.length)&&this.fragmentTracker.removeAllFragments()},u.getAppendedFrag=function(t){var e=this.fragmentTracker.getAppendedFrag(t,O.b.MAIN);return e&&"fragment"in e?e.fragment:e},u.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,O.b.MAIN)},u.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},u.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},u.nextLevelSwitch=function(){var t=this.levels,e=this.media;if(null!=e&&e.readyState){var i,r=this.getAppendedFrag(e.currentTime);if(r&&r.start>1&&this.flushMainBuffer(0,r.start-1),!e.paused&&t){var n=t[this.hls.nextLoadLevel],s=this.fragLastKbps;i=s&&this.fragCurrent?this.fragCurrent.duration*n.maxBitrate/(1e3*s)+1:0}else i=0;var a=this.getBufferedFrag(e.currentTime+i);if(a){var o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();var l=o.maxStartPTS?o.maxStartPTS:o.start,u=o.duration,c=Math.max(a.end,l+Math.min(Math.max(u-this.config.maxFragLookUpTolerance,.5*u),.75*u));this.flushMainBuffer(c,Number.POSITIVE_INFINITY)}}}},u.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,null!=t&&t.loader&&t.loader.abort(),this.state){case Ht:case qt:case Wt:case Yt:case $t:this.state=Kt}this.nextLoadPosition=this.getLoadPosition()},u.flushMainBuffer=function(e,i){t.prototype.flushMainBuffer.call(this,e,i,this.altAudio?"video":null)},u.onMediaAttached=function(e,i){t.prototype.onMediaAttached.call(this,e,i);var r=i.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new le(this.config,r,this.fragmentTracker,this.hls)},u.onMediaDetaching=function(){var e=this.media;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),t.prototype.onMediaDetaching.call(this)},u.onMediaPlaying=function(){this.tick()},u.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:null;Object(s.a)(e)&&this.log("Media seeked to "+e.toFixed(3)),this.tick()},u.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(a.a.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},u.onManifestParsed=function(t,e){var i,r,n,s=!1,a=!1;e.levels.forEach((function(t){(i=t.audioCodec)&&(-1!==i.indexOf("mp4a.40.2")&&(s=!0),-1!==i.indexOf("mp4a.40.5")&&(a=!0))})),this.audioCodecSwitch=s&&a&&!("function"==typeof(null==(n=ie())||null===(r=n.prototype)||void 0===r?void 0:r.changeType)),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1},u.onLevelLoading=function(t,e){var i=this.levels;if(i&&this.state===Kt){var r=i[e.level];(!r.details||r.details.live&&this.levelLastLoaded!==e.level||this.waitForCdnTuneIn(r.details))&&(this.state=Zt)}},u.onLevelLoaded=function(t,e){var i,r=this.levels,n=e.level,s=e.details,o=s.totalduration;if(r){this.log("Level "+n+" loaded ["+s.startSN+","+s.endSN+"], cc ["+s.startCC+", "+s.endCC+"] duration:"+o);var l=this.fragCurrent;!l||this.state!==qt&&this.state!==Wt||l.level!==e.level&&l.loader&&(this.state=Kt,this.backtrackFragment=null,l.loader.abort());var u=r[n],c=0;if(s.live||null!==(i=u.details)&&void 0!==i&&i.live){if(s.fragments[0]||(s.deltaUpdateFailed=!0),s.deltaUpdateFailed)return;c=this.alignPlaylists(s,u.details)}if(u.details=s,this.levelLastLoaded=n,this.hls.trigger(a.a.LEVEL_UPDATED,{details:s,level:n}),this.state===Zt){if(this.waitForCdnTuneIn(s))return;this.state=Kt}this.startFragRequested?s.live&&this.synchronizeToLiveEdge(s):this.setStartPosition(s,c),this.tick()}else this.warn("Levels were reset while loading level "+n)},u._handleFragmentLoadProgress=function(t){var e,i=t.frag,r=t.part,n=t.payload,s=this.levels;if(s){var a=s[i.level],o=a.details;if(o){var l=a.videoCodec,u=o.PTSKnown||!o.live,c=null===(e=i.initSegment)||void 0===e?void 0:e.data,h=this._getAudioCodec(a),d=this.transmuxer=this.transmuxer||new oe(this.hls,O.b.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=r?r.index:-1,g=-1!==f,p=new yt(i.level,i.sn,i.stats.chunkCount,n.byteLength,f,g),m=this.initPTS[i.cc];d.push(n,c,h,l,i,r,o.totalduration,u,p,m)}else this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},u.onAudioTrackSwitching=function(t,e){var i=this.altAudio,r=!!e.url,n=e.id;if(!r){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var s=this.fragCurrent;null!=s&&s.loader&&(this.log("Switching to main audio track, cancel main fragment load"),s.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var o=this.hls;i&&o.trigger(a.a.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),o.trigger(a.a.AUDIO_TRACK_SWITCHED,{id:n})}},u.onAudioTrackSwitched=function(t,e){var i=e.id,r=!!this.hls.audioTracks[i].url;if(r){var n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=r,this.tick()},u.onBufferCreated=function(t,e){var i,r,n=e.tracks,s=!1;for(var a in n){var o=n[a];if("main"===o.id){if(r=a,i=o,"video"===a){var l=n[a];l&&(this.videoBuffer=l.buffer)}}else s=!0}s&&i?(this.log("Alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},u.onFragBuffered=function(t,e){var i=e.frag,r=e.part;if(!i||i.type===O.b.MAIN){if(this.fragContextChanged(i))return this.warn("Fragment "+i.sn+(r?" p: "+r.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===$t&&(this.state=Kt));var n=r?r.stats:i.stats;this.fragLastKbps=Math.round(8*n.total/(n.buffering.end-n.loading.first)),"initSegment"!==i.sn&&(this.fragPrevious=i),this.fragBufferedComplete(i,r)}},u.onError=function(t,e){switch(e.details){case o.a.FRAG_LOAD_ERROR:case o.a.FRAG_LOAD_TIMEOUT:case o.a.KEY_LOAD_ERROR:case o.a.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(O.b.MAIN,e);break;case o.a.LEVEL_LOAD_ERROR:case o.a.LEVEL_LOAD_TIMEOUT:this.state!==Qt&&(e.fatal?(this.warn(""+e.details),this.state=Qt):e.levelRetry||this.state!==Zt||(this.state=Kt));break;case o.a.BUFFER_FULL_ERROR:if("main"===e.parent&&(this.state===Yt||this.state===$t)){var i=!0,r=this.getFwdBufferInfo(this.media,O.b.MAIN);r&&r.len>.5&&(i=!this.reduceMaxBufferLength(r.len)),i&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},u.checkBuffer=function(){var t=this.media,e=this.gapController;if(t&&e&&t.readyState){if(this.loadedmetadata||!vt.getBuffered(t).length){var i=this.state!==Kt?this.fragCurrent:null;e.poll(this.lastCurrentTime,i)}this.lastCurrentTime=t.currentTime}},u.onFragLoadEmergencyAborted=function(){this.state=Kt,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},u.onBufferFlushed=function(t,e){var i=e.type;if(i!==m.a.AUDIO||this.audioOnly&&!this.altAudio){var r=(i===m.a.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(r,i,O.b.MAIN)}},u.onLevelsUpdated=function(t,e){this.levels=e.levels},u.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},u.seekToStartPos=function(){var t=this.media;if(t){var e=t.currentTime,i=this.startPosition;if(i>=0&&e<i){if(t.seeking)return void this.log("could not seek to "+i+", already seeking at "+e);var r=vt.getBuffered(t),n=(r.length?r.start(0):0)-i;n>0&&(n<this.config.maxBufferHole||n<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+n+" to match buffer start"),i+=n,this.startPosition=i),this.log("seek to target start position "+i+" from current time "+e),t.currentTime=i}}},u._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),e},u._loadBitrateTestFrag=function(t){var e=this;t.bitrateTest=!0,this._doFragLoad(t).then((function(i){var r=e.hls;if(i&&!r.nextLoadLevel&&!e.fragContextChanged(t)){e.fragLoadError=0,e.state=Kt,e.startFragRequested=!1,e.bitrateTest=!1;var n=t.stats;n.parsing.start=n.parsing.end=n.buffering.start=n.buffering.end=self.performance.now(),r.trigger(a.a.FRAG_LOADED,i),t.bitrateTest=!1}}))},u._handleTransmuxComplete=function(t){var e,i="main",r=this.hls,n=t.remuxResult,o=t.chunkMeta,l=this.getCurrentContext(o);if(!l)return this.warn("The loading context changed while buffering fragment "+o.sn+" of level "+o.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(o.level);var u=l.frag,c=l.part,h=l.level,d=n.video,f=n.text,g=n.id3,p=n.initSegment,v=h.details,y=this.altAudio?void 0:n.audio;if(!this.fragContextChanged(u)){if(this.state=Yt,p){p.tracks&&(this._bufferInitSegment(h,p.tracks,u,o),r.trigger(a.a.FRAG_PARSING_INIT_SEGMENT,{frag:u,id:i,tracks:p.tracks}));var T=p.initPTS,b=p.timescale;Object(s.a)(T)&&(this.initPTS[u.cc]=T,r.trigger(a.a.INIT_PTS_FOUND,{frag:u,id:i,initPTS:T,timescale:b}))}if(d&&!1!==n.independent){if(v){var E=d.startPTS,S=d.endPTS,w=d.startDTS,I=d.endDTS;if(c)c.elementaryStreams[d.type]={startPTS:E,endPTS:S,startDTS:w,endDTS:I};else if(d.firstKeyFrame&&d.independent&&(this.couldBacktrack=!0),d.dropped&&d.independent){var _=this.getMainFwdBufferInfo();if((_?_.end:this.getLoadPosition())+this.config.maxBufferHole<(d.firstKeyFramePTS?d.firstKeyFramePTS:E)-this.config.maxBufferHole)return void this.backtrack(u);u.setElementaryStreamInfo(d.type,u.start,S,u.start,I,!0)}u.setElementaryStreamInfo(d.type,E,S,w,I),this.backtrackFragment&&(this.backtrackFragment=u),this.bufferFragmentData(d,u,c,o)}}else if(!1===n.independent)return void this.backtrack(u);if(y){var A=y.startPTS,k=y.endPTS,D=y.startDTS,L=y.endDTS;c&&(c.elementaryStreams[m.a.AUDIO]={startPTS:A,endPTS:k,startDTS:D,endDTS:L}),u.setElementaryStreamInfo(m.a.AUDIO,A,k,D,L),this.bufferFragmentData(y,u,c,o)}if(v&&null!=g&&null!==(e=g.samples)&&void 0!==e&&e.length){var R={id:i,frag:u,details:v,samples:g.samples};r.trigger(a.a.FRAG_PARSING_METADATA,R)}if(v&&f){var C={id:i,frag:u,details:v,samples:f.samples};r.trigger(a.a.FRAG_PARSING_USERDATA,C)}}},u._bufferInitSegment=function(t,e,i,r){var n=this;if(this.state===Yt){this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&delete e.audio;var s=e.audio,o=e.video,l=e.audiovideo;if(s){var u=t.audioCodec,c=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(u&&(u=-1!==u.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==s.metadata.channelCount&&-1===c.indexOf("firefox")&&(u="mp4a.40.5")),-1!==c.indexOf("android")&&"audio/mpeg"!==s.container&&(u="mp4a.40.2",this.log("Android: force audio codec to "+u)),t.audioCodec&&t.audioCodec!==u&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+u+'"'),s.levelCodec=u,s.id="main",this.log("Init audio buffer, container:"+s.container+", codecs[selected/level/parsed]=["+(u||"")+"/"+(t.audioCodec||"")+"/"+s.codec+"]")}o&&(o.levelCodec=t.videoCodec,o.id="main",this.log("Init video buffer, container:"+o.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+o.codec+"]")),l&&this.log("Init audiovideo buffer, container:"+l.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+l.codec+"]"),this.hls.trigger(a.a.BUFFER_CODECS,e),Object.keys(e).forEach((function(t){var s=e[t].initSegment;null!=s&&s.byteLength&&n.hls.trigger(a.a.BUFFER_APPENDING,{type:t,data:s,frag:i,part:null,chunkMeta:r,parent:i.type})})),this.tick()}},u.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,O.b.MAIN)},u.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=Kt},u.checkFragmentChanged=function(){var t=this.media,e=null;if(t&&t.readyState>1&&!1===t.seeking){var i=t.currentTime;if(vt.isBuffered(t,i)?e=this.getAppendedFrag(i):vt.isBuffered(t,i+.1)&&(e=this.getAppendedFrag(i+.1)),e){this.backtrackFragment=null;var r=this.fragPlaying,n=e.level;r&&e.sn===r.sn&&r.level===n&&e.urlId===r.urlId||(this.hls.trigger(a.a.FRAG_CHANGED,{frag:e}),r&&r.level===n||this.hls.trigger(a.a.LEVEL_SWITCHED,{level:n}),this.fragPlaying=e)}}},n=r,(l=[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var e=t.currentTime,i=this.currentFrag;if(i&&Object(s.a)(e)&&Object(s.a)(i.programDateTime)){var r=i.programDateTime+1e3*(e-i.start);return new Date(r)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&ue(n.prototype,l),Object.defineProperty(n,"prototype",{writable:!1}),r}(te),de=function(){function t(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=i}var e=t.prototype;return e.sample=function(t,e){var i=Math.pow(this.alpha_,t);this.estimate_=e*(1-i)+i*this.estimate_,this.totalWeight_+=t},e.getTotalWeight=function(){return this.totalWeight_},e.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},t}(),fe=function(){function t(t,e,i){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new de(t),this.fast_=new de(e)}var e=t.prototype;return e.update=function(t,e){var i=this.slow_,r=this.fast_;this.slow_.halfLife!==t&&(this.slow_=new de(t,i.getEstimate(),i.getTotalWeight())),this.fast_.halfLife!==e&&(this.fast_=new de(e,r.getEstimate(),r.getTotalWeight()))},e.sample=function(t,e){var i=(t=Math.max(t,this.minDelayMs_))/1e3,r=8*e/i;this.fast_.sample(i,r),this.slow_.sample(i,r)},e.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},e.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.destroy=function(){},t}();function ge(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var pe=function(){function t(t){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;var e=t.config;this.bwEstimator=new fe(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate),this.registerListeners()}var e,i,r=t.prototype;return r.registerListeners=function(){var t=this.hls;t.on(a.a.FRAG_LOADING,this.onFragLoading,this),t.on(a.a.FRAG_LOADED,this.onFragLoaded,this),t.on(a.a.FRAG_BUFFERED,this.onFragBuffered,this),t.on(a.a.LEVEL_LOADED,this.onLevelLoaded,this),t.on(a.a.ERROR,this.onError,this)},r.unregisterListeners=function(){var t=this.hls;t.off(a.a.FRAG_LOADING,this.onFragLoading,this),t.off(a.a.FRAG_LOADED,this.onFragLoaded,this),t.off(a.a.FRAG_BUFFERED,this.onFragBuffered,this),t.off(a.a.LEVEL_LOADED,this.onLevelLoaded,this),t.off(a.a.ERROR,this.onError,this)},r.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},r.onFragLoading=function(t,e){var i,r=e.frag;r.type===O.b.MAIN&&(this.timer||(this.fragCurrent=r,this.partCurrent=null!=(i=e.part)?i:null,this.timer=self.setInterval(this.onCheck,100)))},r.onLevelLoaded=function(t,e){var i=this.hls.config;e.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)},r._abandonRulesCheck=function(){var t=this.fragCurrent,e=this.partCurrent,i=this.hls,r=i.autoLevelEnabled,n=i.config,o=i.media;if(t&&o){var u=e?e.stats:t.stats,c=e?e.duration:t.duration;if(u.aborted)return l.b.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(r&&!o.paused&&o.playbackRate&&o.readyState){var h=performance.now()-u.loading.start,d=Math.abs(o.playbackRate);if(!(h<=500*c/d)){var f=i.levels,g=i.minAutoLevel,p=f[t.level],m=u.total||Math.max(u.loaded,Math.round(c*p.maxBitrate/8)),v=Math.max(1,u.bwEstimate?u.bwEstimate/8:1e3*u.loaded/h),y=(m-u.loaded)/v,T=o.currentTime,b=(vt.bufferInfo(o,T,n.maxBufferHole).end-T)/d;if(!(b>=2*c/d||y<=b)){var E,S=Number.POSITIVE_INFINITY;for(E=t.level-1;E>g&&!((S=c*f[E].maxBitrate/(6.4*v))<b);E--);if(!(S>=y)){var w=this.bwEstimator.getEstimate();l.b.warn("Fragment "+t.sn+(e?" part "+e.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+E+"\n      Current BW estimate: "+(Object(s.a)(w)?(w/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+y.toFixed(3)+" s\n      Estimated load time for the next fragment: "+S.toFixed(3)+" s\n      Time to underbuffer: "+b.toFixed(3)+" s"),i.nextLoadLevel=E,this.bwEstimator.sample(h,u.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),i.trigger(a.a.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:u})}}}}}},r.onFragLoaded=function(t,e){var i=e.frag,r=e.part;if(i.type===O.b.MAIN&&Object(s.a)(i.sn)){var n=r?r.stats:i.stats,o=r?r.duration:i.duration;if(this.clearTimer(),this.lastLoadedFragLevel=i.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var l=this.hls.levels[i.level],u=(l.loaded?l.loaded.bytes:0)+n.loaded,c=(l.loaded?l.loaded.duration:0)+o;l.loaded={bytes:u,duration:c},l.realBitrate=Math.round(8*u/c)}if(i.bitrateTest){var h={stats:n,frag:i,part:r,id:i.type};this.onFragBuffered(a.a.FRAG_BUFFERED,h)}}},r.onFragBuffered=function(t,e){var i=e.frag,r=e.part,n=r?r.stats:i.stats;if(!n.aborted&&i.type===O.b.MAIN&&"initSegment"!==i.sn){var s=n.parsing.end-n.loading.start;this.bwEstimator.sample(s,n.loaded),n.bwEstimate=this.bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},r.onError=function(t,e){switch(e.details){case o.a.FRAG_LOAD_ERROR:case o.a.FRAG_LOAD_TIMEOUT:this.clearTimer()}},r.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},r.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,i=this.hls,r=i.maxAutoLevel,n=i.config,s=i.minAutoLevel,a=i.media,o=e?e.duration:t?t.duration:0,u=a?a.currentTime:0,c=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,h=this.bwEstimator?this.bwEstimator.getEstimate():n.abrEwmaDefaultEstimate,d=(vt.bufferInfo(a,u,n.maxBufferHole).end-u)/c,f=this.findBestLevel(h,s,r,d,n.abrBandWidthFactor,n.abrBandWidthUpFactor);if(f>=0)return f;l.b.trace((d?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var g=o?Math.min(o,n.maxStarvationDelay):n.maxStarvationDelay,p=n.abrBandWidthFactor,m=n.abrBandWidthUpFactor;if(!d){var v=this.bitrateTestDelay;v&&(g=(o?Math.min(o,n.maxLoadingDelay):n.maxLoadingDelay)-v,l.b.trace("bitrate test took "+Math.round(1e3*v)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*g)+" ms"),p=m=1)}return f=this.findBestLevel(h,s,r,d+g,p,m),Math.max(f,0)},r.findBestLevel=function(t,e,i,r,n,s){for(var a,o=this.fragCurrent,u=this.partCurrent,c=this.lastLoadedFragLevel,h=this.hls.levels,d=h[c],f=!(null==d||null===(a=d.details)||void 0===a||!a.live),g=null==d?void 0:d.codecSet,p=u?u.duration:o?o.duration:0,m=i;m>=e;m--){var v=h[m];if(v&&(!g||v.codecSet===g)){var y,T=v.details,b=(u?null==T?void 0:T.partTarget:null==T?void 0:T.averagetargetduration)||p;y=m<=c?n*t:s*t;var E=h[m].maxBitrate,S=E*b/y;if(l.b.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+m+"/"+Math.round(y)+"/"+E+"/"+b+"/"+r+"/"+S),y>E&&(!S||f&&!this.bitrateTestDelay||S<r))return m}}return-1},e=t,(i=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this.bwEstimator;if(-1!==t&&!e.canEstimate())return t;var i=this.getNextABRAutoLevel();return-1!==t&&this.hls.levels[i].loadError?t:(-1!==t&&(i=Math.min(t,i)),i)},set:function(t){this._nextAutoLevel=t}}])&&ge(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}(),me=function(){function t(){this.chunks=[],this.dataLength=0}var e=t.prototype;return e.push=function(t){this.chunks.push(t),this.dataLength+=t.length},e.flush=function(){var t,e=this.chunks,i=this.dataLength;return e.length?(t=1===e.length?e[0]:function(t,e){for(var i=new Uint8Array(e),r=0,n=0;n<t.length;n++){var s=t[n];i.set(s,r),r+=s.length}return i}(e,i),this.reset(),t):new Uint8Array(0)},e.reset=function(){this.chunks.length=0,this.dataLength=0},t}();function ve(){return(ve=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}function ye(t,e){return(ye=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var Te=function(t){var e,i;function r(e,i){var r;return(r=t.call(this,e,i,"[audio-stream-controller]")||this).videoBuffer=null,r.videoTrackCC=-1,r.waitingVideoCC=-1,r.audioSwitch=!1,r.trackId=-1,r.waitingData=null,r.mainDetails=null,r.bufferFlushed=!1,r.cachedTrackLoadedData=null,r._registerListeners(),r}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,ye(e,i);var n=r.prototype;return n.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},n._registerListeners=function(){var t=this.hls;t.on(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(a.a.LEVEL_LOADED,this.onLevelLoaded,this),t.on(a.a.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(a.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(a.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(a.a.ERROR,this.onError,this),t.on(a.a.BUFFER_RESET,this.onBufferReset,this),t.on(a.a.BUFFER_CREATED,this.onBufferCreated,this),t.on(a.a.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(a.a.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(a.a.FRAG_BUFFERED,this.onFragBuffered,this)},n._unregisterListeners=function(){var t=this.hls;t.off(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(a.a.LEVEL_LOADED,this.onLevelLoaded,this),t.off(a.a.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(a.a.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(a.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(a.a.ERROR,this.onError,this),t.off(a.a.BUFFER_RESET,this.onBufferReset,this),t.off(a.a.BUFFER_CREATED,this.onBufferCreated,this),t.off(a.a.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(a.a.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(a.a.FRAG_BUFFERED,this.onFragBuffered,this)},n.onInitPtsFound=function(t,e){var i=e.frag,r=e.id,n=e.initPTS;if("main"===r){var s=i.cc;this.initPTS[i.cc]=n,this.log("InitPTS for cc: "+s+" found from main: "+n),this.videoTrackCC=s,this.state===Jt&&this.tick()}},n.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=Gt);var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,e>0&&-1===t?(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e,this.state=Kt):(this.loadedmetadata=!1,this.state=zt),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},n.doTick=function(){switch(this.state){case Kt:this.doTickIdle();break;case zt:var e,i=this.levels,r=this.trackId,n=null==i||null===(e=i[r])||void 0===e?void 0:e.details;if(n){if(this.waitForCdnTuneIn(n))break;this.state=Jt}break;case Wt:var s,a=performance.now(),o=this.retryDate;(!o||a>=o||null!==(s=this.media)&&void 0!==s&&s.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=Kt);break;case Jt:var l=this.waitingData;if(l){var u=l.frag,c=l.part,h=l.cache,d=l.complete;if(void 0!==this.initPTS[u.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=qt;var f={frag:u,part:c,payload:h.flush(),networkDetails:null};this._handleFragmentLoadProgress(f),d&&t.prototype._handleFragmentLoadComplete.call(this,f)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+u.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var g=this.getLoadPosition(),p=vt.bufferInfo(this.mediaBuffer,g,this.config.maxBufferHole);At(p.end,this.config.maxFragLookUpTolerance,u)<0&&(this.log("Waiting fragment cc ("+u.cc+") @ "+u.start+" cancelled because another fragment at "+p.end+" is needed"),this.clearWaitingFragment())}}else this.state=Kt}this.onTickEnd()},n.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=Kt)},n.resetLoadingState=function(){this.clearWaitingFragment(),t.prototype.resetLoadingState.call(this)},n.onTickEnd=function(){var t=this.media;if(t&&t.readyState){var e=(this.mediaBuffer?this.mediaBuffer:t).buffered;!this.loadedmetadata&&e.length&&(this.loadedmetadata=!0),this.lastCurrentTime=t.currentTime}},n.doTickIdle=function(){var t,e,i=this.hls,r=this.levels,n=this.media,s=this.trackId,o=i.config;if(r&&r[s]&&(n||!this.startFragRequested&&o.startFragPrefetch)){var l=r[s].details;if(!l||l.live&&this.levelLastLoaded!==s||this.waitForCdnTuneIn(l))this.state=zt;else{var u=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&u&&(this.bufferFlushed=!1,this.afterBufferFlushed(u,m.a.AUDIO,O.b.AUDIO));var c=this.getFwdBufferInfo(u,O.b.AUDIO);if(null!==c){var h=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,O.b.MAIN),d=c.len,f=this.getMaxBufferLength(null==h?void 0:h.len),g=this.audioSwitch;if(!(d>=f)||g){if(!g&&this._streamEnded(c,l))return i.trigger(a.a.BUFFER_EOS,{type:"audio"}),void(this.state=Xt);var p=l.fragments[0].start,v=c.end;if(g&&n){var y=this.getLoadPosition();v=y,l.PTSKnown&&y<p&&(c.end>p||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),n.currentTime=p+.05)}if(!(h&&v>h.end+l.targetduration)&&(h&&h.len||!c.len)){var T=this.getNextFragment(v,l);T?"identity"!==(null===(t=T.decryptdata)||void 0===t?void 0:t.keyFormat)||null!==(e=T.decryptdata)&&void 0!==e&&e.key?this.loadFragment(T,l,v):this.loadKey(T,l):this.bufferFlushed=!0}}}}}},n.getMaxBufferLength=function(e){var i=t.prototype.getMaxBufferLength.call(this);return e?Math.max(i,e):i},n.onMediaDetaching=function(){this.videoBuffer=null,t.prototype.onMediaDetaching.call(this)},n.onAudioTracksUpdated=function(t,e){var i=e.audioTracks;this.resetTransmuxer(),this.levels=i.map((function(t){return new X(t)}))},n.onAudioTrackSwitching=function(t,e){var i=!!e.url;this.trackId=e.id;var r=this.fragCurrent;null!=r&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),i?this.setInterval(100):this.resetTransmuxer(),i?(this.audioSwitch=!0,this.state=Kt):this.state=Gt,this.tick()},n.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},n.onLevelLoaded=function(t,e){this.mainDetails=e.details,null!==this.cachedTrackLoadedData&&(this.hls.trigger(a.a.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},n.onAudioTrackLoaded=function(t,e){var i;if(null!=this.mainDetails){var r=this.levels,n=e.details,s=e.id;if(r){this.log("Track "+s+" loaded ["+n.startSN+","+n.endSN+"],duration:"+n.totalduration);var a=r[s],o=0;if(n.live||null!==(i=a.details)&&void 0!==i&&i.live){var l=this.mainDetails;if(n.fragments[0]||(n.deltaUpdateFailed=!0),n.deltaUpdateFailed||!l)return;!a.details&&n.hasProgramDateTime&&l.hasProgramDateTime?(wt(n,l),o=n.fragments[0].start):o=this.alignPlaylists(n,a.details)}a.details=n,this.levelLastLoaded=s,this.startFragRequested||!this.mainDetails&&n.live||this.setStartPosition(a.details,o),this.state!==zt||this.waitForCdnTuneIn(n)||(this.state=Kt),this.tick()}else this.warn("Audio tracks were reset while loading level "+s)}else this.cachedTrackLoadedData=e},n._handleFragmentLoadProgress=function(t){var e,i=t.frag,r=t.part,n=t.payload,s=this.config,a=this.trackId,o=this.levels;if(o){var l=o[a],u=l.details,c=s.defaultAudioCodec||l.audioCodec||"mp4a.40.2",h=this.transmuxer;h||(h=this.transmuxer=new oe(this.hls,O.b.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var d=this.initPTS[i.cc],f=null===(e=i.initSegment)||void 0===e?void 0:e.data;if(void 0!==d){var g=r?r.index:-1,p=-1!==g,m=new yt(i.level,i.sn,i.stats.chunkCount,n.byteLength,g,p);h.push(n,f,c,"",i,r,u.totalduration,!1,m,d)}else this.log("Unknown video PTS for cc "+i.cc+", waiting for video PTS before demuxing audio frag "+i.sn+" of ["+u.startSN+" ,"+u.endSN+"],track "+a),(this.waitingData=this.waitingData||{frag:i,part:r,cache:new me,complete:!1}).cache.push(new Uint8Array(n)),this.waitingVideoCC=this.videoTrackCC,this.state=Jt}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},n._handleFragmentLoadComplete=function(e){this.waitingData?this.waitingData.complete=!0:t.prototype._handleFragmentLoadComplete.call(this,e)},n.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},n.onBufferCreated=function(t,e){var i=e.tracks.audio;i&&(this.mediaBuffer=i.buffer||null),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer||null)},n.onFragBuffered=function(t,e){var i=e.frag,r=e.part;i.type===O.b.AUDIO&&(this.fragContextChanged(i)?this.warn("Fragment "+i.sn+(r?" p: "+r.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==i.sn&&(this.fragPrevious=i,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(a.a.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(i,r)))},n.onError=function(e,i){switch(i.details){case o.a.FRAG_LOAD_ERROR:case o.a.FRAG_LOAD_TIMEOUT:case o.a.KEY_LOAD_ERROR:case o.a.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(O.b.AUDIO,i);break;case o.a.AUDIO_TRACK_LOAD_ERROR:case o.a.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==Qt&&this.state!==Gt&&(this.state=i.fatal?Qt:Kt,this.warn(i.details+" while loading frag, switching to "+this.state+" state"));break;case o.a.BUFFER_FULL_ERROR:if("audio"===i.parent&&(this.state===Yt||this.state===$t)){var r=!0,n=this.getFwdBufferInfo(this.mediaBuffer,O.b.AUDIO);n&&n.len>.5&&(r=!this.reduceMaxBufferLength(n.len)),r&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},n.onBufferFlushed=function(t,e){e.type===m.a.AUDIO&&(this.bufferFlushed=!0)},n._handleTransmuxComplete=function(t){var e,i="audio",r=this.hls,n=t.remuxResult,s=t.chunkMeta,o=this.getCurrentContext(s);if(!o)return this.warn("The loading context changed while buffering fragment "+s.sn+" of level "+s.level+". This chunk will not be buffered."),void this.resetStartWhenNotLoaded(s.level);var l=o.frag,u=o.part,c=o.level.details,h=n.audio,d=n.text,f=n.id3,g=n.initSegment;if(!this.fragContextChanged(l)&&c){if(this.state=Yt,this.audioSwitch&&h&&this.completeAudioSwitch(),null!=g&&g.tracks&&(this._bufferInitSegment(g.tracks,l,s),r.trigger(a.a.FRAG_PARSING_INIT_SEGMENT,{frag:l,id:i,tracks:g.tracks})),h){var p=h.startPTS,v=h.endPTS,y=h.startDTS,T=h.endDTS;u&&(u.elementaryStreams[m.a.AUDIO]={startPTS:p,endPTS:v,startDTS:y,endDTS:T}),l.setElementaryStreamInfo(m.a.AUDIO,p,v,y,T),this.bufferFragmentData(h,l,u,s)}if(null!=f&&null!==(e=f.samples)&&void 0!==e&&e.length){var b=ve({id:i,frag:l,details:c},f);r.trigger(a.a.FRAG_PARSING_METADATA,b)}if(d){var E=ve({id:i,frag:l,details:c},d);r.trigger(a.a.FRAG_PARSING_USERDATA,E)}}},n._bufferInitSegment=function(t,e,i){if(this.state===Yt){t.video&&delete t.video;var r=t.audio;if(r){r.levelCodec=r.codec,r.id="audio",this.log("Init audio buffer, container:"+r.container+", codecs[parsed]=["+r.codec+"]"),this.hls.trigger(a.a.BUFFER_CODECS,t);var n=r.initSegment;if(null!=n&&n.byteLength){var s={type:"audio",frag:e,part:null,chunkMeta:i,parent:e.type,data:n};this.hls.trigger(a.a.BUFFER_APPENDING,s)}this.tick()}}},n.loadFragment=function(e,i,r){var n=this.fragmentTracker.getState(e);this.fragCurrent=e,(this.audioSwitch||n===ut.NOT_LOADED||n===ut.PARTIAL)&&("initSegment"===e.sn?this._loadInitSegment(e):i.live&&!Object(s.a)(this.initPTS[e.cc])?(this.log("Waiting for video PTS in continuity counter "+e.cc+" of live stream before loading audio fragment "+e.sn+" of level "+this.trackId),this.state=Jt):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,e,i,r)))},n.completeAudioSwitch=function(){var e=this.hls,i=this.media,r=this.trackId;i&&(this.log("Switching audio track : flushing all audio"),t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,e.trigger(a.a.AUDIO_TRACK_SWITCHED,{id:r})},r}(te);function be(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ee(t,e){return(Ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var Se=function(t){var e,i;function r(e){var i;return(i=t.call(this,e,"[audio-track-controller]")||this).tracks=[],i.groupId=null,i.tracksInGroup=[],i.trackId=-1,i.trackName="",i.selectDefaultTrack=!0,i.registerListeners(),i}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,Ee(e,i);var n,s,l=r.prototype;return l.registerListeners=function(){var t=this.hls;t.on(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(a.a.MANIFEST_PARSED,this.onManifestParsed,this),t.on(a.a.LEVEL_LOADING,this.onLevelLoading,this),t.on(a.a.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(a.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(a.a.ERROR,this.onError,this)},l.unregisterListeners=function(){var t=this.hls;t.off(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(a.a.MANIFEST_PARSED,this.onManifestParsed,this),t.off(a.a.LEVEL_LOADING,this.onLevelLoading,this),t.off(a.a.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(a.a.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(a.a.ERROR,this.onError,this)},l.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,t.prototype.destroy.call(this)},l.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},l.onManifestParsed=function(t,e){this.tracks=e.audioTracks||[]},l.onAudioTrackLoaded=function(t,e){var i=e.id,r=e.details,n=this.tracksInGroup[i];if(n){var s=n.details;n.details=e.details,this.log("audioTrack "+i+" loaded ["+r.startSN+"-"+r.endSN+"]"),i===this.trackId&&(this.retryCount=0,this.playlistLoaded(i,e,s))}else this.warn("Invalid audio track id "+i)},l.onLevelLoading=function(t,e){this.switchLevel(e.level)},l.onLevelSwitching=function(t,e){this.switchLevel(e.level)},l.switchLevel=function(t){var e=this.hls.levels[t];if(null!=e&&e.audioGroupIds){var i=e.audioGroupIds[e.urlId];if(this.groupId!==i){this.groupId=i;var r=this.tracks.filter((function(t){return!i||t.groupId===i}));this.selectDefaultTrack&&!r.some((function(t){return t.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=r;var n={audioTracks:r};this.log("Updating audio tracks, "+r.length+' track(s) found in "'+i+'" group-id'),this.hls.trigger(a.a.AUDIO_TRACKS_UPDATED,n),this.selectInitialTrack()}}},l.onError=function(e,i){t.prototype.onError.call(this,e,i),!i.fatal&&i.context&&i.context.type===O.a.AUDIO_TRACK&&i.context.id===this.trackId&&i.context.groupId===this.groupId&&this.retryLoadingOrFail(i)},l.setAudioTrack=function(t){var e=this.tracksInGroup;if(t<0||t>=e.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var i=e[this.trackId];this.log("Now switching to audio-track index "+t);var r=e[t],n=r.id,s=r.groupId,o=void 0===s?"":s,l=r.name,u=r.type,c=r.url;if(this.trackId=t,this.trackName=l,this.selectDefaultTrack=!1,this.hls.trigger(a.a.AUDIO_TRACK_SWITCHING,{id:n,groupId:o,name:l,type:u,url:c}),!r.details||r.details.live){var h=this.switchParams(r.url,null==i?void 0:i.details);this.loadPlaylist(h)}}},l.selectInitialTrack=function(){this.tracksInGroup;var t=this.trackName,e=this.findTrackId(t)||this.findTrackId();-1!==e?this.setAudioTrack(e):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(a.a.ERROR,{type:o.b.MEDIA_ERROR,details:o.a.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},l.findTrackId=function(t){for(var e=this.tracksInGroup,i=0;i<e.length;i++){var r=e[i];if((!this.selectDefaultTrack||r.default)&&(!t||t===r.name))return r.id}return-1},l.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var i=e.id,r=e.groupId,n=e.url;if(t)try{n=t.addDirectives(n)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("loading audio-track playlist for id: "+i),this.clearTimer(),this.hls.trigger(a.a.AUDIO_TRACK_LOADING,{url:n,id:i,groupId:r,deliveryDirectives:t||null})}},n=r,(s=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}])&&be(n.prototype,s),Object.defineProperty(n,"prototype",{writable:!1}),r}(st);function we(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ie(t,e){return(Ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var _e=function(t){var e,i;function r(e,i){var r;return(r=t.call(this,e,i,"[subtitle-stream-controller]")||this).levels=[],r.currentTrackId=-1,r.tracksBuffered=[],r.mainDetails=null,r._registerListeners(),r}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,Ie(e,i);var n,s,o=r.prototype;return o.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},o._registerListeners=function(){var t=this.hls;t.on(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(a.a.LEVEL_LOADED,this.onLevelLoaded,this),t.on(a.a.ERROR,this.onError,this),t.on(a.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(a.a.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(a.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(a.a.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(a.a.BUFFER_FLUSHING,this.onBufferFlushing,this)},o._unregisterListeners=function(){var t=this.hls;t.off(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(a.a.LEVEL_LOADED,this.onLevelLoaded,this),t.off(a.a.ERROR,this.onError,this),t.off(a.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(a.a.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(a.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(a.a.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(a.a.BUFFER_FLUSHING,this.onBufferFlushing,this)},o.startLoad=function(){this.stopLoad(),this.state=Kt,this.setInterval(500),this.tick()},o.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},o.onLevelLoaded=function(t,e){this.mainDetails=e.details},o.onSubtitleFragProcessed=function(t,e){var i=e.frag,r=e.success;if(this.fragPrevious=i,this.state=Kt,r){var n=this.tracksBuffered[this.currentTrackId];if(n){for(var s,a=i.start,o=0;o<n.length;o++)if(a>=n[o].start&&a<=n[o].end){s=n[o];break}var l=i.start+i.duration;s?s.end=l:(s={start:a,end:l},n.push(s)),this.fragmentTracker.fragBuffered(i)}}},o.onBufferFlushing=function(t,e){var i=e.startOffset,r=e.endOffset;if(0===i&&r!==Number.POSITIVE_INFINITY){var n=this.currentTrackId,s=this.levels;if(!s.length||!s[n]||!s[n].details)return;var a=r-s[n].details.targetduration;if(a<=0)return;e.endOffsetSubtitles=Math.max(0,a),this.tracksBuffered.forEach((function(t){for(var e=0;e<t.length;)if(t[e].end<=a)t.shift();else{if(!(t[e].start<a))break;t[e].start=a,e++}})),this.fragmentTracker.removeFragmentsInRange(i,a,O.b.SUBTITLE)}},o.onError=function(t,e){var i,r=e.frag;r&&r.type===O.b.SUBTITLE&&(null!==(i=this.fragCurrent)&&void 0!==i&&i.loader&&this.fragCurrent.loader.abort(),this.state=Kt)},o.onSubtitleTracksUpdated=function(t,e){var i=this,r=e.subtitleTracks;this.tracksBuffered=[],this.levels=r.map((function(t){return new X(t)})),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach((function(t){i.tracksBuffered[t.id]=[]})),this.mediaBuffer=null},o.onSubtitleTrackSwitch=function(t,e){if(this.currentTrackId=e.id,this.levels.length&&-1!==this.currentTrackId){var i=this.levels[this.currentTrackId];null!=i&&i.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,i&&this.setInterval(500)}else this.clearInterval()},o.onSubtitleTrackLoaded=function(t,e){var i,r=e.details,n=e.id,s=this.currentTrackId,a=this.levels;if(a.length){var o=a[s];if(!(n>=a.length||n!==s)&&o){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||null!==(i=o.details)&&void 0!==i&&i.live){var l=this.mainDetails;if(r.deltaUpdateFailed||!l)return;var u=l.fragments[0];o.details?0===this.alignPlaylists(r,o.details)&&u&&nt(r,u.start):r.hasProgramDateTime&&l.hasProgramDateTime?wt(r,l):u&&nt(r,u.start)}o.details=r,this.levelLastLoaded=n,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===Kt&&(_t(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),o.details=void 0))}}},o._handleFragmentLoadComplete=function(t){var e=t.frag,i=t.payload,r=e.decryptdata,n=this.hls;if(!this.fragContextChanged(e)&&i&&i.byteLength>0&&r&&r.key&&r.iv&&"AES-128"===r.method){var s=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(i),r.key.buffer,r.iv.buffer).then((function(t){var i=performance.now();n.trigger(a.a.FRAG_DECRYPTED,{frag:e,payload:t,stats:{tstart:s,tdecrypt:i}})}))}},o.doTick=function(){if(this.media){if(this.state===Kt){var t=this.currentTrackId,e=this.levels;if(!e.length||!e[t]||!e[t].details)return;var i=e[t].details,r=i.targetduration,n=this.config,s=this.media,a=vt.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],s.currentTime-r,n.maxBufferHole),o=a.end;if(a.len>this.getMaxBufferLength()+r)return;var l,u=i.fragments,c=u.length,h=i.edge,d=this.fragPrevious;if(o<h){var f=n.maxFragLookUpTolerance;!(l=_t(d,u,Math.max(u[0].start,o),f))&&d&&d.start<u[0].start&&(l=u[0])}else l=u[c-1];if(!(l=this.mapToInitFragWhenRequired(l)))return;l.encrypted?this.loadKey(l,i):this.fragmentTracker.getState(l)===ut.NOT_LOADED&&this.loadFragment(l,i,o)}}else this.state=Kt},o.loadFragment=function(e,i,r){this.fragCurrent=e,"initSegment"===e.sn?this._loadInitSegment(e):t.prototype.loadFragment.call(this,e,i,r)},n=r,(s=[{key:"mediaBufferTimeRanges",get:function(){return new Ae(this.tracksBuffered[this.currentTrackId]||[])}}])&&we(n.prototype,s),Object.defineProperty(n,"prototype",{writable:!1}),r}(te),Ae=function(t){this.buffered=void 0;var e=function(e,i,r){if((i>>>=0)>r-1)throw new DOMException("Failed to execute '"+e+"' on 'TimeRanges': The index provided ("+i+") is greater than the maximum bound ("+r+")");return t[i][e]};this.buffered={get length(){return t.length},end:function(i){return e("end",i,t.length)},start:function(i){return e("start",i,t.length)}}};function ke(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function De(t,e){return(De=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Le(t){for(var e=[],i=0;i<t.length;i++){var r=t[i];"subtitles"===r.kind&&r.label&&e.push(t[i])}return e}var Re,Ce=function(t){var e,i;function r(e){var i;return(i=t.call(this,e,"[subtitle-track-controller]")||this).media=null,i.tracks=[],i.groupId=null,i.tracksInGroup=[],i.trackId=-1,i.selectDefaultTrack=!0,i.queuedDefaultTrack=-1,i.trackChangeListener=function(){return i.onTextTracksChanged()},i.asyncPollTrackChange=function(){return i.pollTrackChange(0)},i.useTextTrackPolling=!1,i.subtitlePollingInterval=-1,i._subtitleDisplay=!0,i.registerListeners(),i}i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,De(e,i);var n,s,o=r.prototype;return o.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,t.prototype.destroy.call(this)},o.registerListeners=function(){var t=this.hls;t.on(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(a.a.MANIFEST_PARSED,this.onManifestParsed,this),t.on(a.a.LEVEL_LOADING,this.onLevelLoading,this),t.on(a.a.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(a.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(a.a.ERROR,this.onError,this)},o.unregisterListeners=function(){var t=this.hls;t.off(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(a.a.MANIFEST_PARSED,this.onManifestParsed,this),t.off(a.a.LEVEL_LOADING,this.onLevelLoading,this),t.off(a.a.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(a.a.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(a.a.ERROR,this.onError,this)},o.onMediaAttached=function(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},o.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},o.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),Le(this.media.textTracks).forEach((function(t){U(t)})),this.subtitleTrack=-1,this.media=null)},o.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},o.onManifestParsed=function(t,e){this.tracks=e.subtitleTracks},o.onSubtitleTrackLoaded=function(t,e){var i=e.id,r=e.details,n=this.trackId,s=this.tracksInGroup[n];if(s){var a=s.details;s.details=e.details,this.log("subtitle track "+i+" loaded ["+r.startSN+"-"+r.endSN+"]"),i===this.trackId&&(this.retryCount=0,this.playlistLoaded(i,e,a))}else this.warn("Invalid subtitle track id "+i)},o.onLevelLoading=function(t,e){this.switchLevel(e.level)},o.onLevelSwitching=function(t,e){this.switchLevel(e.level)},o.switchLevel=function(t){var e=this.hls.levels[t];if(null!=e&&e.textGroupIds){var i=e.textGroupIds[e.urlId];if(this.groupId!==i){var r=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,n=this.tracks.filter((function(t){return!i||t.groupId===i}));this.tracksInGroup=n;var s=this.findTrackId(null==r?void 0:r.name)||this.findTrackId();this.groupId=i;var o={subtitleTracks:n};this.log("Updating subtitle tracks, "+n.length+' track(s) found in "'+i+'" group-id'),this.hls.trigger(a.a.SUBTITLE_TRACKS_UPDATED,o),-1!==s&&this.setSubtitleTrack(s,r)}}},o.findTrackId=function(t){for(var e=this.tracksInGroup,i=0;i<e.length;i++){var r=e[i];if((!this.selectDefaultTrack||r.default)&&(!t||t===r.name))return r.id}return-1},o.onError=function(e,i){t.prototype.onError.call(this,e,i),!i.fatal&&i.context&&i.context.type===O.a.SUBTITLE_TRACK&&i.context.id===this.trackId&&i.context.groupId===this.groupId&&this.retryLoadingOrFail(i)},o.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var i=e.id,r=e.groupId,n=e.url;if(t)try{n=t.addDirectives(n)}catch(t){this.warn("Could not construct new URL with HLS Delivery Directives: "+t)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(a.a.SUBTITLE_TRACK_LOADING,{url:n,id:i,groupId:r,deliveryDirectives:t||null})}},o.toggleTrackModes=function(t){var e=this,i=this.media,r=this.trackId;if(i){var n=Le(i.textTracks),s=n.filter((function(t){return t.groupId===e.groupId}));if(-1===t)[].slice.call(n).forEach((function(t){t.mode="disabled"}));else{var a=s[r];a&&(a.mode="disabled")}var o=s[t];o&&(o.mode=this.subtitleDisplay?"showing":"hidden")}},o.setSubtitleTrack=function(t,e){var i,r=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(-1===t||null!==(i=r[t])&&void 0!==i&&i.details)||t<-1||t>=r.length)){this.clearTimer();var n=r[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,n){var s=n.id,o=n.groupId,l=void 0===o?"":o,u=n.name,c=n.type,h=n.url;this.hls.trigger(a.a.SUBTITLE_TRACK_SWITCH,{id:s,groupId:l,name:u,type:c,url:h});var d=this.switchParams(n.url,null==e?void 0:e.details);this.loadPlaylist(d)}else this.hls.trigger(a.a.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},o.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,e=Le(this.media.textTracks),i=0;i<e.length;i++)if("hidden"===e[i].mode)t=i;else if("showing"===e[i].mode){t=i;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},n=r,(s=[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,e)}}])&&ke(n.prototype,s),Object.defineProperty(n,"prototype",{writable:!1}),r}(st),Oe=function(){function t(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}var e=t.prototype;return e.append=function(t,e){var i=this.queues[e];i.push(t),1===i.length&&this.buffers[e]&&this.executeNext(e)},e.insertAbort=function(t,e){this.queues[e].unshift(t),this.executeNext(e)},e.appendBlocker=function(t){var e,i=new Promise((function(t){e=t})),r={execute:e,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(r,t),i},e.executeNext=function(t){var e=this.buffers,i=this.queues,r=e[t],n=i[t];if(n.length){var s=n[0];try{s.execute()}catch(e){l.b.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),s.onError(e),r&&r.updating||(n.shift(),this.executeNext(t))}}},e.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},e.current=function(t){return this.queues[t][0]},t}(),Pe=ee(),xe=/([ha]vc.)(?:\.[^.,]+)+/,Ne=function(){function t(t){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=e.hls,i=e.media,r=e.mediaSource;l.b.log("[buffer-controller]: Media source opened"),i&&(e.updateMediaElementDuration(),t.trigger(a.a.MEDIA_ATTACHED,{media:i})),r&&r.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){l.b.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){l.b.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var e=t.prototype;return e.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},e.destroy=function(){this.unregisterListeners(),this.details=null},e.registerListeners=function(){var t=this.hls;t.on(a.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(a.a.MANIFEST_PARSED,this.onManifestParsed,this),t.on(a.a.BUFFER_RESET,this.onBufferReset,this),t.on(a.a.BUFFER_APPENDING,this.onBufferAppending,this),t.on(a.a.BUFFER_CODECS,this.onBufferCodecs,this),t.on(a.a.BUFFER_EOS,this.onBufferEos,this),t.on(a.a.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(a.a.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(a.a.FRAG_PARSED,this.onFragParsed,this),t.on(a.a.FRAG_CHANGED,this.onFragChanged,this)},e.unregisterListeners=function(){var t=this.hls;t.off(a.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(a.a.MANIFEST_PARSED,this.onManifestParsed,this),t.off(a.a.BUFFER_RESET,this.onBufferReset,this),t.off(a.a.BUFFER_APPENDING,this.onBufferAppending,this),t.off(a.a.BUFFER_CODECS,this.onBufferCodecs,this),t.off(a.a.BUFFER_EOS,this.onBufferEos,this),t.off(a.a.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(a.a.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(a.a.FRAG_PARSED,this.onFragParsed,this),t.off(a.a.FRAG_CHANGED,this.onFragChanged,this)},e._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Oe(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},e.onManifestParsed=function(t,e){var i=2;(e.audio&&!e.video||!e.altAudio)&&(i=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,this.details=null,l.b.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},e.onMediaAttaching=function(t,e){var i=this.media=e.media;if(i&&Pe){var r=this.mediaSource=new Pe;r.addEventListener("sourceopen",this._onMediaSourceOpen),r.addEventListener("sourceended",this._onMediaSourceEnded),r.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(r),this._objectUrl=i.src}},e.onMediaDetaching=function(){var t=this.media,e=this.mediaSource,i=this._objectUrl;if(e){if(l.b.log("[buffer-controller]: media source detaching"),"open"===e.readyState)try{e.endOfStream()}catch(t){l.b.warn("[buffer-controller]: onMediaDetaching: "+t.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(i&&self.URL.revokeObjectURL(i),t.src===i?(t.removeAttribute("src"),t.load()):l.b.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(a.a.MEDIA_DETACHED,void 0)},e.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach((function(e){var i=t.sourceBuffer[e];try{i&&(t.removeBufferListeners(e),t.mediaSource&&t.mediaSource.removeSourceBuffer(i),t.sourceBuffer[e]=void 0)}catch(t){l.b.warn("[buffer-controller]: Failed to reset the "+e+" buffer",t)}})),this._initSourceBuffer()},e.onBufferCodecs=function(t,e){var i=this,r=this.getSourceBufferTypes().length;Object.keys(e).forEach((function(t){if(r){var n=i.tracks[t];if(n&&"function"==typeof n.buffer.changeType){var s=e[t],a=s.id,o=s.codec,u=s.levelCodec,c=s.container,h=s.metadata,d=(n.levelCodec||n.codec).replace(xe,"$1"),f=(u||o).replace(xe,"$1");if(d!==f){var g=c+";codecs="+(u||o);i.appendChangeType(t,g),l.b.log("[buffer-controller]: switching codec "+d+" to "+f),i.tracks[t]={buffer:n.buffer,codec:o,container:c,levelCodec:u,metadata:h,id:a}}}}else i.pendingTracks[t]=e[t]})),r||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},e.appendChangeType=function(t,e){var i=this,r=this.operationQueue,n={execute:function(){var n=i.sourceBuffer[t];n&&(l.b.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+e),n.changeType(e)),r.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(e){l.b.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",e)}};r.append(n,t)},e.onBufferAppending=function(t,e){var i=this,r=this.hls,n=this.operationQueue,s=this.tracks,u=e.data,c=e.type,h=e.frag,d=e.part,f=e.chunkMeta,g=f.buffering[c],p=self.performance.now();g.start=p;var m=h.stats.buffering,v=d?d.stats.buffering:null;0===m.start&&(m.start=p),v&&0===v.start&&(v.start=p);var y=s.audio,T="audio"===c&&1===f.id&&"audio/mpeg"===(null==y?void 0:y.container),b={execute:function(){if(g.executeStart=self.performance.now(),T){var t=i.sourceBuffer[c];if(t){var e=h.start-t.timestampOffset;Math.abs(e)>=.1&&(l.b.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+h.start+" (delta: "+e+") sn: "+h.sn+")"),t.timestampOffset=h.start)}}i.appendExecutor(u,c)},onStart:function(){},onComplete:function(){var t=self.performance.now();g.executeEnd=g.end=t,0===m.first&&(m.first=t),v&&0===v.first&&(v.first=t);var e=i.sourceBuffer,r={};for(var n in e)r[n]=vt.getBuffered(e[n]);i.appendError=0,i.hls.trigger(a.a.BUFFER_APPENDED,{type:c,frag:h,part:d,chunkMeta:f,parent:h.type,timeRanges:r})},onError:function(t){l.b.error("[buffer-controller]: Error encountered while trying to append to the "+c+" SourceBuffer",t);var e={type:o.b.MEDIA_ERROR,parent:h.type,details:o.a.BUFFER_APPEND_ERROR,err:t,fatal:!1};t.code===DOMException.QUOTA_EXCEEDED_ERR?e.details=o.a.BUFFER_FULL_ERROR:(i.appendError++,e.details=o.a.BUFFER_APPEND_ERROR,i.appendError>r.config.appendErrorMaxRetry&&(l.b.error("[buffer-controller]: Failed "+r.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),e.fatal=!0,r.stopLoad())),r.trigger(a.a.ERROR,e)}};n.append(b,c)},e.onBufferFlushing=function(t,e){var i=this,r=this.operationQueue,n=function(t){return{execute:i.removeExecutor.bind(i,t,e.startOffset,e.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(a.a.BUFFER_FLUSHED,{type:t})},onError:function(e){l.b.warn("[buffer-controller]: Failed to remove from "+t+" SourceBuffer",e)}}};e.type?r.append(n(e.type),e.type):this.getSourceBufferTypes().forEach((function(t){r.append(n(t),t)}))},e.onFragParsed=function(t,e){var i=this,r=e.frag,n=e.part,s=[],o=n?n.elementaryStreams:r.elementaryStreams;o[m.a.AUDIOVIDEO]?s.push("audiovideo"):(o[m.a.AUDIO]&&s.push("audio"),o[m.a.VIDEO]&&s.push("video")),0===s.length&&l.b.warn("Fragments must have at least one ElementaryStreamType set. type: "+r.type+" level: "+r.level+" sn: "+r.sn),this.blockBuffers((function(){var t=self.performance.now();r.stats.buffering.end=t,n&&(n.stats.buffering.end=t);var e=n?n.stats:r.stats;i.hls.trigger(a.a.FRAG_BUFFERED,{frag:r,part:n,stats:e,id:r.type})}),s)},e.onFragChanged=function(t,e){this.flushBackBuffer()},e.onBufferEos=function(t,e){var i=this;this.getSourceBufferTypes().reduce((function(t,r){var n=i.sourceBuffer[r];return e.type&&e.type!==r||n&&!n.ended&&(n.ended=!0,l.b.log("[buffer-controller]: "+r+" sourceBuffer now EOS")),t&&!(n&&!n.ended)}),!0)&&this.blockBuffers((function(){var t=i.mediaSource;t&&"open"===t.readyState&&t.endOfStream()}))},e.onLevelUpdated=function(t,e){var i=e.details;i.fragments.length&&(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},e.flushBackBuffer=function(){var t=this.hls,e=this.details,i=this.media,r=this.sourceBuffer;if(i&&null!==e){var n=this.getSourceBufferTypes();if(n.length){var o=e.live&&null!==t.config.liveBackBufferLength?t.config.liveBackBufferLength:t.config.backBufferLength;if(Object(s.a)(o)&&!(o<0)){var l=i.currentTime,u=e.levelTargetDuration,c=Math.max(o,u),h=Math.floor(l/u)*u-c;n.forEach((function(i){var n=r[i];if(n){var s=vt.getBuffered(n);s.length>0&&h>s.start(0)&&(t.trigger(a.a.BACK_BUFFER_REACHED,{bufferEnd:h}),e.live&&t.trigger(a.a.LIVE_BACK_BUFFER_REACHED,{bufferEnd:h}),t.trigger(a.a.BUFFER_FLUSHING,{startOffset:0,endOffset:h,type:i}))}}))}}}},e.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var t=this.details,e=this.hls,i=this.media,r=this.mediaSource,n=t.fragments[0].start+t.totalduration,a=i.duration,o=Object(s.a)(r.duration)?r.duration:0;t.live&&e.config.liveDurationInfinity?(l.b.log("[buffer-controller]: Media Source duration is set to Infinity"),r.duration=1/0,this.updateSeekableRange(t)):(n>o&&n>a||!Object(s.a)(a))&&(l.b.log("[buffer-controller]: Updating Media Source duration to "+n.toFixed(3)),r.duration=n)}},e.updateSeekableRange=function(t){var e=this.mediaSource,i=t.fragments;if(i.length&&t.live&&null!=e&&e.setLiveSeekableRange){var r=Math.max(0,i[0].start),n=Math.max(r,r+t.totalduration);e.setLiveSeekableRange(r,n)}},e.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,i=this.pendingTracks,r=Object.keys(i).length;if(r&&!t||2===r){this.createSourceBuffers(i),this.pendingTracks={};var n=this.getSourceBufferTypes();if(0===n.length)return void this.hls.trigger(a.a.ERROR,{type:o.b.MEDIA_ERROR,details:o.a.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});n.forEach((function(t){e.executeNext(t)}))}},e.createSourceBuffers=function(t){var e=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");var r=0;for(var n in t)if(!e[n]){var s=t[n];if(!s)throw Error("source buffer exists for track "+n+", however track does not");var u=s.levelCodec||s.codec,c=s.container+";codecs="+u;l.b.log("[buffer-controller]: creating sourceBuffer("+c+")");try{var h=e[n]=i.addSourceBuffer(c),d=n;this.addBufferListener(d,"updatestart",this._onSBUpdateStart),this.addBufferListener(d,"updateend",this._onSBUpdateEnd),this.addBufferListener(d,"error",this._onSBUpdateError),this.tracks[n]={buffer:h,codec:u,container:s.container,levelCodec:s.levelCodec,metadata:s.metadata,id:s.id},r++}catch(t){l.b.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(a.a.ERROR,{type:o.b.MEDIA_ERROR,details:o.a.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:c})}}r&&this.hls.trigger(a.a.BUFFER_CREATED,{tracks:this.tracks})},e._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},e._onSBUpdateEnd=function(t){var e=this.operationQueue;e.current(t).onComplete(),e.shiftAndExecuteNext(t)},e._onSBUpdateError=function(t,e){l.b.error("[buffer-controller]: "+t+" SourceBuffer error",e),this.hls.trigger(a.a.ERROR,{type:o.b.MEDIA_ERROR,details:o.a.BUFFER_APPENDING_ERROR,fatal:!1});var i=this.operationQueue.current(t);i&&i.onError(e)},e.removeExecutor=function(t,e,i){var r=this.media,n=this.mediaSource,a=this.operationQueue,o=this.sourceBuffer[t];if(!r||!n||!o)return l.b.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void a.shiftAndExecuteNext(t);var u=Object(s.a)(r.duration)?r.duration:1/0,c=Object(s.a)(n.duration)?n.duration:1/0,h=Math.max(0,e),d=Math.min(i,u,c);d>h?(l.b.log("[buffer-controller]: Removing ["+h+","+d+"] from the "+t+" SourceBuffer"),o.remove(h,d)):a.shiftAndExecuteNext(t)},e.appendExecutor=function(t,e){var i=this.operationQueue,r=this.sourceBuffer[e];if(!r)return l.b.warn("[buffer-controller]: Attempting to append to the "+e+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(e);r.ended=!1,r.appendBuffer(t)},e.blockBuffers=function(t,e){var i=this;if(void 0===e&&(e=this.getSourceBufferTypes()),!e.length)return l.b.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(t);var r=this.operationQueue,n=e.map((function(t){return r.appendBlocker(t)}));Promise.all(n).then((function(){t(),e.forEach((function(t){var e=i.sourceBuffer[t];e&&e.updating||r.shiftAndExecuteNext(t)}))}))},e.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},e.addBufferListener=function(t,e,i){var r=this.sourceBuffer[t];if(r){var n=i.bind(this,t);this.listeners[t].push({event:e,listener:n}),r.addEventListener(e,n)}},e.removeBufferListeners=function(t){var e=this.sourceBuffer[t];e&&this.listeners[t].forEach((function(t){e.removeEventListener(t.event,t.listener)}))},t}(),Me={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Fe=function(t){var e=t;return Me.hasOwnProperty(t)&&(e=Me[t]),String.fromCharCode(e)},Ue={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Be={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ve={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},je={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Ge=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(t){t[t.ERROR=0]="ERROR",t[t.TEXT=1]="TEXT",t[t.WARNING=2]="WARNING",t[t.INFO=2]="INFO",t[t.DEBUG=3]="DEBUG",t[t.DATA=3]="DATA"}(Re||(Re={}));var Ke=function(){function t(){this.time=null,this.verboseLevel=Re.ERROR}return t.prototype.log=function(t,e){this.verboseLevel>=t&&l.b.log(this.time+" ["+t+"] "+e)},t}(),He=function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].toString(16));return e},qe=function(){function t(t,e,i,r,n){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=i||!1,this.background=r||"black",this.flash=n||!1}var e=t.prototype;return e.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],i=0;i<e.length;i++){var r=e[i];t.hasOwnProperty(r)&&(this[r]=t[r])}},e.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},e.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},e.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),We=function(){function t(t,e,i,r,n,s){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new qe(e,i,r,n,s)}var e=t.prototype;return e.reset=function(){this.uchar=" ",this.penState.reset()},e.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},e.setPenState=function(t){this.penState.copy(t)},e.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},e.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},e.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),ze=function(){function t(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<100;e++)this.chars.push(new We);this.logger=t,this.pos=0,this.currPenState=new qe}var e=t.prototype;return e.equals=function(t){for(var e=!0,i=0;i<100;i++)if(!this.chars[i].equals(t.chars[i])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<100;e++)this.chars[e].copy(t.chars[e])},e.isEmpty=function(){for(var t=!0,e=0;e<100;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},e.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(Re.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>100&&(this.logger.log(Re.DEBUG,"Too large cursor position "+this.pos),this.pos=100)},e.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var i=this.pos+1;i<e+1;i++)this.chars[i].setPenState(this.currPenState);this.setCursor(e)},e.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.insertChar=function(t){t>=144&&this.backSpace();var e=Fe(t);this.pos>=100?this.logger.log(Re.ERROR,"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},e.clearFromPos=function(t){var e;for(e=t;e<100;e++)this.chars[e].reset()},e.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.getTextString=function(){for(var t=[],e=!0,i=0;i<100;i++){var r=this.chars[i].uchar;" "!==r&&(e=!1),t.push(r)}return e?"":t.join("")},e.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),Ye=function(){function t(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<15;e++)this.rows.push(new ze(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var e=t.prototype;return e.reset=function(){for(var t=0;t<15;t++)this.rows[t].clear();this.currRow=14},e.equals=function(t){for(var e=!0,i=0;i<15;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<15;e++)this.rows[e].copy(t.rows[e])},e.isEmpty=function(){for(var t=!0,e=0;e<15;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},e.backSpace=function(){this.rows[this.currRow].backSpace()},e.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.insertChar=function(t){this.rows[this.currRow].insertChar(t)},e.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},e.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},e.setCursor=function(t){this.logger.log(Re.INFO,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},e.setPAC=function(t){this.logger.log(Re.INFO,"pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var i=0;i<15;i++)this.rows[i].clear();var r=this.currRow+1-this.nrRollUpRows,n=this.lastOutputScreen;if(n){var s=n.rows[r].cueStartTime,a=this.logger.time;if(s&&null!==a&&s<a)for(var o=0;o<this.nrRollUpRows;o++)this.rows[e-this.nrRollUpRows+o+1].copy(n.rows[r+o])}}this.currRow=e;var l=this.rows[this.currRow];if(null!==t.indent){var u=t.indent,c=Math.max(u-1,0);l.setCursor(t.indent),t.color=l.chars[c].penState.foreground}var h={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(h)},e.setBkgData=function(t){this.logger.log(Re.INFO,"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},e.setRollUpRows=function(t){this.nrRollUpRows=t},e.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(Re.TEXT,this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(Re.INFO,"Rolling up")}else this.logger.log(Re.DEBUG,"roll_up but nrRollUpRows not set yet")},e.getDisplayText=function(t){t=t||!1;for(var e=[],i="",r=-1,n=0;n<15;n++){var s=this.rows[n].getTextString();s&&(r=n+1,t?e.push("Row "+r+": '"+s+"'"):e.push(s.trim()))}return e.length>0&&(i=t?"["+e.join(" | ")+"]":e.join("\n")),i},e.getTextAndFormat=function(){return this.rows},t}(),$e=function(){function t(t,e,i){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new Ye(i),this.nonDisplayedMemory=new Ye(i),this.lastOutputScreen=new Ye(i),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=i}var e=t.prototype;return e.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},e.getHandler=function(){return this.outputFilter},e.setHandler=function(t){this.outputFilter=t},e.setPAC=function(t){this.writeScreen.setPAC(t)},e.setBkgData=function(t){this.writeScreen.setBkgData(t)},e.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(Re.INFO,"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},e.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(Re.INFO,i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(Re.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.ccRCL=function(){this.logger.log(Re.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.ccBS=function(){this.logger.log(Re.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.ccAOF=function(){},e.ccAON=function(){},e.ccDER=function(){this.logger.log(Re.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.ccRU=function(t){this.logger.log(Re.INFO,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},e.ccFON=function(){this.logger.log(Re.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.ccRDC=function(){this.logger.log(Re.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.ccTR=function(){this.logger.log(Re.INFO,"TR"),this.setMode("MODE_TEXT")},e.ccRTD=function(){this.logger.log(Re.INFO,"RTD"),this.setMode("MODE_TEXT")},e.ccEDM=function(){this.logger.log(Re.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.ccCR=function(){this.logger.log(Re.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.ccENM=function(){this.logger.log(Re.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.ccEOC=function(){if(this.logger.log(Re.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(Re.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},e.ccTO=function(t){this.logger.log(Re.INFO,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},e.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var i=Math.floor(t/2)-16;e.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}this.logger.log(Re.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},e.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},e.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}();function Xe(t,e,i){i.a=t,i.b=e}function Qe(t,e,i){return i.a===t&&i.b===e}var Je=function(){function t(t,e,i){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new Ke;this.channels=[null,new $e(t,e,r),new $e(t+1,i,r)],this.cmdHistory={a:null,b:null},this.logger=r}var e=t.prototype;return e.getHandler=function(t){return this.channels[t].getHandler()},e.setHandler=function(t,e){this.channels[t].setHandler(e)},e.addData=function(t,e){var i,r,n,s=!1;this.logger.time=t;for(var a=0;a<e.length;a+=2)if(r=127&e[a],n=127&e[a+1],0!==r||0!==n){if(this.logger.log(Re.DATA,"["+He([e[a],e[a+1]])+"] -> ("+He([r,n])+")"),(i=this.parseCmd(r,n))||(i=this.parseMidrow(r,n)),i||(i=this.parsePAC(r,n)),i||(i=this.parseBackgroundAttributes(r,n)),!i&&(s=this.parseChars(r,n))){var o=this.currentChannel;o&&o>0?this.channels[o].insertChars(s):this.logger.log(Re.WARNING,"No channel found yet. TEXT-MODE?")}i||s||this.logger.log(Re.WARNING,"Couldn't parse cleaned data "+He([r,n])+" orig: "+He([e[a],e[a+1]]))}},e.parseCmd=function(t,e){var i=this.cmdHistory;if(!((20===t||28===t||21===t||29===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=33&&e<=35))return!1;if(Qe(t,e,i))return Xe(null,null,i),this.logger.log(Re.DEBUG,"Repeated command ("+He([t,e])+") is dropped"),!0;var r=20===t||21===t||23===t?1:2,n=this.channels[r];return 20===t||21===t||28===t||29===t?32===e?n.ccRCL():33===e?n.ccBS():34===e?n.ccAOF():35===e?n.ccAON():36===e?n.ccDER():37===e?n.ccRU(2):38===e?n.ccRU(3):39===e?n.ccRU(4):40===e?n.ccFON():41===e?n.ccRDC():42===e?n.ccTR():43===e?n.ccRTD():44===e?n.ccEDM():45===e?n.ccCR():46===e?n.ccENM():47===e&&n.ccEOC():n.ccTO(e-32),Xe(t,e,i),this.currentChannel=r,!0},e.parseMidrow=function(t,e){var i=0;if((17===t||25===t)&&e>=32&&e<=47){if((i=17===t?1:2)!==this.currentChannel)return this.logger.log(Re.ERROR,"Mismatch channel in midrow parsing"),!1;var r=this.channels[i];return!!r&&(r.ccMIDROW(e),this.logger.log(Re.DEBUG,"MIDROW ("+He([t,e])+")"),!0)}return!1},e.parsePAC=function(t,e){var i,r=this.cmdHistory;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127||(16===t||24===t)&&e>=64&&e<=95))return!1;if(Qe(t,e,r))return Xe(null,null,r),!0;var n=t<=23?1:2;i=e>=64&&e<=95?1===n?Ue[t]:Ve[t]:1===n?Be[t]:je[t];var s=this.channels[n];return!!s&&(s.setPAC(this.interpretPAC(i,e)),Xe(t,e,r),this.currentChannel=n,!0)},e.interpretPAC=function(t,e){var i,r={color:null,italics:!1,indent:null,underline:!1,row:t};return i=e>95?e-96:e-64,r.underline=1==(1&i),i<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((i-16)/2),r},e.parseChars=function(t,e){var i,r,n=null,s=null;if(t>=25?(i=2,s=t-8):(i=1,s=t),s>=17&&s<=19?(r=17===s?e+80:18===s?e+112:e+144,this.logger.log(Re.INFO,"Special char '"+Fe(r)+"' in channel "+i),n=[r]):t>=32&&t<=127&&(n=0===e?[t]:[t,e]),n){var a=He(n);this.logger.log(Re.DEBUG,"Char codes =  "+a.join(",")),Xe(t,e,this.cmdHistory)}return n},e.parseBackgroundAttributes=function(t,e){var i;if(!((16===t||24===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=45&&e<=47))return!1;var r={};16===t||24===t?(i=Math.floor((e-32)/2),r.background=Ge[i],e%2==1&&(r.background=r.background+"_semi")):45===e?r.background="transparent":(r.foreground="black",47===e&&(r.underline=!0));var n=t<=23?1:2;return this.channels[n].setBkgData(r),Xe(t,e,this.cmdHistory),!0},e.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var e=this.channels[t];e&&e.reset()}this.cmdHistory={a:null,b:null}},e.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++){var i=this.channels[e];i&&i.cueSplitAtTime(t)}},t}(),Ze=function(){function t(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}var e=t.prototype;return e.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},e.newCue=function(t,e,i){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=i,this.timelineController.createCaptionsTrack(this.trackName)},e.reset=function(){this.cueRanges=[],this.startTime=null},t}(),ti=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var t=["","lr","rl"],e=["start","middle","end","left","right"];function i(t,e){if("string"!=typeof e)return!1;if(!Array.isArray(t))return!1;var i=e.toLowerCase();return!!~t.indexOf(i)&&i}function r(t){return i(e,t)}function n(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];for(var n=1;n<arguments.length;n++){var s=arguments[n];for(var a in s)t[a]=s[a]}return t}function s(e,s,a){var o=this,l={enumerable:!0};o.hasBeenReset=!1;var u="",c=!1,h=e,d=s,f=a,g=null,p="",m=!0,v="auto",y="start",T=50,b="middle",E=50,S="middle";Object.defineProperty(o,"id",n({},l,{get:function(){return u},set:function(t){u=""+t}})),Object.defineProperty(o,"pauseOnExit",n({},l,{get:function(){return c},set:function(t){c=!!t}})),Object.defineProperty(o,"startTime",n({},l,{get:function(){return h},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");h=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",n({},l,{get:function(){return d},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",n({},l,{get:function(){return f},set:function(t){f=""+t,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",n({},l,{get:function(){return g},set:function(t){g=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",n({},l,{get:function(){return p},set:function(e){var r=function(e){return i(t,e)}(e);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");p=r,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",n({},l,{get:function(){return m},set:function(t){m=!!t,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",n({},l,{get:function(){return v},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",n({},l,{get:function(){return y},set:function(t){var e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",n({},l,{get:function(){return T},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");T=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",n({},l,{get:function(){return b},set:function(t){var e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",n({},l,{get:function(){return E},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");E=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",n({},l,{get:function(){return S},set:function(t){var e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");S=e,this.hasBeenReset=!0}})),o.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}(),ei=function(){function t(){}return t.prototype.decode=function(t,e){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))},t}();function ii(t){function e(t,e,i,r){return 3600*(0|t)+60*(0|e)+(0|i)+parseFloat(r||0)}var i=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return i?parseFloat(i[2])>59?e(i[2],i[3],0,i[4]):e(i[1],i[2],i[3],i[4]):null}var ri=function(){function t(){this.values=Object.create(null)}var e=t.prototype;return e.set=function(t,e){this.get(t)||""===e||(this.values[t]=e)},e.get=function(t,e,i){return i?this.has(t)?this.values[t]:e[i]:this.has(t)?this.values[t]:e},e.has=function(t){return t in this.values},e.alt=function(t,e,i){for(var r=0;r<i.length;++r)if(e===i[r]){this.set(t,e);break}},e.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},e.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var i=parseFloat(e);if(i>=0&&i<=100)return this.set(t,i),!0}return!1},t}();function ni(t,e,i,r){var n=r?t.split(r):[t];for(var s in n)if("string"==typeof n[s]){var a=n[s].split(i);2===a.length&&e(a[0],a[1])}}var si=new ti(0,0,""),ai="middle"===si.align?"middle":"center";function oi(t,e,i){var r=t;function n(){var e=ii(t);if(null===e)throw new Error("Malformed timestamp: "+r);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function s(){t=t.replace(/^\s+/,"")}if(s(),e.startTime=n(),s(),"--\x3e"!==t.slice(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);t=t.slice(3),s(),e.endTime=n(),s(),function(t,e){var r=new ri;ni(t,(function(t,e){var n;switch(t){case"region":for(var s=i.length-1;s>=0;s--)if(i[s].id===e){r.set(t,i[s].region);break}break;case"vertical":r.alt(t,e,["rl","lr"]);break;case"line":n=e.split(","),r.integer(t,n[0]),r.percent(t,n[0])&&r.set("snapToLines",!1),r.alt(t,n[0],["auto"]),2===n.length&&r.alt("lineAlign",n[1],["start",ai,"end"]);break;case"position":n=e.split(","),r.percent(t,n[0]),2===n.length&&r.alt("positionAlign",n[1],["start",ai,"end","line-left","line-right","auto"]);break;case"size":r.percent(t,e);break;case"align":r.alt(t,e,["start",ai,"end","left","right"])}}),/:/,/\s/),e.region=r.get("region",null),e.vertical=r.get("vertical","");var n=r.get("line","auto");"auto"===n&&-1===si.line&&(n=-1),e.line=n,e.lineAlign=r.get("lineAlign","start"),e.snapToLines=r.get("snapToLines",!0),e.size=r.get("size",100),e.align=r.get("align",ai);var s=r.get("position","auto");"auto"===s&&50===si.position&&(s="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=s}(t,e)}function li(t){return t.replace(/<br(?: \/)?>/gi,"\n")}var ui=function(){function t(){this.state="INITIAL",this.buffer="",this.decoder=new ei,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var e=t.prototype;return e.parse=function(t){var e=this;function i(){var t=e.buffer,i=0;for(t=li(t);i<t.length&&"\r"!==t[i]&&"\n"!==t[i];)++i;var r=t.slice(0,i);return"\r"===t[i]&&++i,"\n"===t[i]&&++i,e.buffer=t.slice(i),r}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{var r="";if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;var n=(r=i()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var s=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(s?s=!1:r=i(),e.state){case"HEADER":/:/.test(r)?ni(r,(function(t,e){}),/:/):r||(e.state="ID");continue;case"NOTE":r||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){e.state="NOTE";break}if(!r)continue;if(e.cue=new ti(0,0,""),e.state="CUE",-1===r.indexOf("--\x3e")){e.cue.id=r;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{oi(r,e.cue,e.regionList)}catch(t){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var a=-1!==r.indexOf("--\x3e");if(!r||a&&(s=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(null===e.cue)continue;e.cue.text&&(e.cue.text+="\n"),e.cue.text+=r;continue;case"BADCUE":r||(e.state="ID")}}}catch(t){"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this},e.flush=function(){try{if((this.cue||"HEADER"===this.state)&&(this.buffer+="\n\n",this.parse()),"INITIAL"===this.state||"BADWEBVTT"===this.state)throw new Error("Malformed WebVTT signature.")}catch(t){this.onparsingerror&&this.onparsingerror(t)}return this.onflush&&this.onflush(),this},t}(),ci=i(11),hi=i(13),di=/\r\n|\n\r|\n|\r/g,fi=function(t,e,i){return void 0===i&&(i=0),t.slice(i,i+e.length)===e},gi=function(t){for(var e=5381,i=t.length;i;)e=33*e^t.charCodeAt(--i);return(e>>>0).toString()};function pi(t,e,i){return gi(t.toString())+gi(e.toString())+gi(i)}function mi(t,e,i,r,n,a,o,l){var u,c=new ui,h=Object(V.f)(new Uint8Array(t)).trim().replace(di,"\n").split("\n"),d=[],f=Object(ci.a)(e,i),g="00:00.000",p=0,m=0,v=!0;c.oncue=function(t){var e=r[n],i=r.ccOffset,s=(p-f)/9e4;null!=e&&e.new&&(void 0!==m?i=r.ccOffset=e.start:function(t,e,i){var r=t[e],n=t[r.prevCC];if(!n||!n.new&&r.new)return t.ccOffset=t.presentationOffset=r.start,void(r.new=!1);for(;null!==(s=n)&&void 0!==s&&s.new;){var s;t.ccOffset+=r.start-n.start,r.new=!1,n=t[(r=n).prevCC]}t.presentationOffset=i}(r,n,s)),s&&(i=s-r.presentationOffset);var o=t.endTime-t.startTime,l=Object(hi.d)(9e4*(t.startTime+i-m),9e4*a)/9e4;t.startTime=Math.max(l,0),t.endTime=Math.max(l+o,0);var u=t.text.trim();t.text=decodeURIComponent(encodeURIComponent(u)),t.id||(t.id=pi(t.startTime,t.endTime,u)),t.endTime>0&&d.push(t)},c.onparsingerror=function(t){u=t},c.onflush=function(){u?l(u):o(d)},h.forEach((function(t){if(v){if(fi(t,"X-TIMESTAMP-MAP=")){v=!1,t.slice(16).split(",").forEach((function(t){fi(t,"LOCAL:")?g=t.slice(6):fi(t,"MPEGTS:")&&(p=parseInt(t.slice(7)))}));try{m=function(t){var e=parseInt(t.slice(-3)),i=parseInt(t.slice(-6,-4)),r=parseInt(t.slice(-9,-7)),n=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!(Object(s.a)(e)&&Object(s.a)(i)&&Object(s.a)(r)&&Object(s.a)(n)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return e+=1e3*i,(e+=6e4*r)+36e5*n}(g)/1e3}catch(t){u=t}return}""===t&&(v=!1)}c.parse(t+"\n")})),c.flush()}function vi(){return(vi=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}var yi=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,Ti=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,bi={left:"start",center:"center",right:"end",start:"start",end:"end"};function Ei(t,e,i,r,n){var s=Object(u.c)(new Uint8Array(t),["mdat"]);if(0!==s.length){var a=s.map((function(t){return Object(V.f)(t)})),o=Object(ci.c)(e,1,i);try{a.forEach((function(t){return r(function(t,e){var i=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!i)throw new Error("Invalid ttml");var r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(r).reduce((function(t,e){return t[e]=i.getAttribute("ttp:"+e)||r[e],t}),{}),s="preserve"!==i.getAttribute("xml:space"),a=wi(Si(i,"styling","style")),o=wi(Si(i,"layout","region")),l=Si(i,"body","[begin]");return[].map.call(l,(function(t){var i=function t(e,i){return[].slice.call(e.childNodes).reduce((function(e,r,n){var s;return"br"===r.nodeName&&n?e+"\n":null!==(s=r.childNodes)&&void 0!==s&&s.length?t(r,i):i?e+r.textContent.trim().replace(/\s+/g," "):e+r.textContent}),"")}(t,s);if(!i||!t.hasAttribute("begin"))return null;var r=Ai(t.getAttribute("begin"),n),l=Ai(t.getAttribute("dur"),n),u=Ai(t.getAttribute("end"),n);if(null===r)throw _i(t);if(null===u){if(null===l)throw _i(t);u=r+l}var c=new ti(r-e,u-e,i);c.id=pi(c.startTime,c.endTime,c.text);var h=o[t.getAttribute("region")],d=a[t.getAttribute("style")];c.position=10,c.size=80;var f=function(t,e,i){var r="http://www.w3.org/ns/ttml#styling",n=null,s=null!=t&&t.hasAttribute("style")?t.getAttribute("style"):null;return s&&i.hasOwnProperty(s)&&(n=i[s]),["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((function(i,s){var a=Ii(e,r,s)||Ii(t,r,s)||Ii(n,r,s);return a&&(i[s]=a),i}),{})}(h,d,a),g=f.textAlign;if(g){var p=bi[g];p&&(c.lineAlign=p),c.align=g}return vi(c,f),c})).filter((function(t){return null!==t}))}(t,o))}))}catch(t){n(t)}}else n(new Error("Could not parse IMSC1 mdat"))}function Si(t,e,i){var r=t.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(i)):[]}function wi(t){return t.reduce((function(t,e){var i=e.getAttribute("xml:id");return i&&(t[i]=e),t}),{})}function Ii(t,e,i){return t&&t.hasAttributeNS(e,i)?t.getAttributeNS(e,i):null}function _i(t){return new Error("Could not parse ttml timestamp "+t)}function Ai(t,e){if(!t)return null;var i=ii(t);return null===i&&(yi.test(t)?i=function(t,e){var i=yi.exec(t),r=(0|i[4])+(0|i[5])/e.subFrameRate;return 3600*(0|i[1])+60*(0|i[2])+(0|i[3])+r/e.frameRate}(t,e):Ti.test(t)&&(i=function(t,e){var i=Ti.exec(t),r=Number(i[1]);switch(i[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}(t,e))),i}var ki=function(){function t(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var e=new Ze(this,"textTrack1"),i=new Ze(this,"textTrack2"),r=new Ze(this,"textTrack3"),n=new Ze(this,"textTrack4");this.cea608Parser1=new Je(1,e,i),this.cea608Parser2=new Je(3,r,n)}t.on(a.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.on(a.a.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(a.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(a.a.FRAG_LOADING,this.onFragLoading,this),t.on(a.a.FRAG_LOADED,this.onFragLoaded,this),t.on(a.a.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(a.a.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(a.a.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(a.a.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(a.a.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=t.prototype;return e.destroy=function(){var t=this.hls;t.off(a.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(a.a.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(a.a.MANIFEST_LOADING,this.onManifestLoading,this),t.off(a.a.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(a.a.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(a.a.FRAG_LOADING,this.onFragLoading,this),t.off(a.a.FRAG_LOADED,this.onFragLoaded,this),t.off(a.a.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(a.a.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(a.a.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(a.a.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(a.a.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},e.addCues=function(t,e,i,r,n){for(var s,o,l,u,c=!1,h=n.length;h--;){var d=n[h],f=(s=d[0],o=d[1],l=e,u=i,Math.min(o,u)-Math.max(s,l));if(f>=0&&(d[0]=Math.min(d[0],e),d[1]=Math.max(d[1],i),c=!0,f/(i-e)>.5))return}if(c||n.push([e,i]),this.config.renderTextTracksNatively){var g=this.captionsTracks[t];this.Cues.newCue(g,e,i,r)}else{var p=this.Cues.newCue(null,e,i,r);this.hls.trigger(a.a.CUES_PARSED,{type:"captions",cues:p,track:t})}},e.onInitPtsFound=function(t,e){var i=this,r=e.frag,n=e.id,s=e.initPTS,o=e.timescale,l=this.unparsedVttFrags;"main"===n&&(this.initPTS[r.cc]=s,this.timescale[r.cc]=o),l.length&&(this.unparsedVttFrags=[],l.forEach((function(t){i.onFragLoaded(a.a.FRAG_LOADED,t)})))},e.getExistingTrack=function(t){var e=this.media;if(e)for(var i=0;i<e.textTracks.length;i++){var r=e.textTracks[i];if(r[t])return r}return null},e.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},e.createNativeTrack=function(t){if(!this.captionsTracks[t]){var e=this.captionsProperties,i=this.captionsTracks,r=this.media,n=e[t],s=n.label,a=n.languageCode,o=this.getExistingTrack(t);if(o)i[t]=o,U(i[t]),M(i[t],r);else{var l=this.createTextTrack("captions",s,a);l&&(l[t]=!0,i[t]=l)}}},e.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var e=this.captionsProperties[t];if(e){var i={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=i,this.hls.trigger(a.a.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[i]})}}},e.createTextTrack=function(t,e,i){var r=this.media;if(r)return r.addTextTrack(t,e,i)},e.onMediaAttaching=function(t,e){this.media=e.media,this._cleanTracks()},e.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach((function(e){U(t[e]),delete t[e]})),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var i=0;i<e.length;i++)U(e[i])}},e.onSubtitleTracksUpdated=function(t,e){var i=this;this.textTracks=[];var r=e.subtitleTracks||[],n=r.some((function(t){return"stpp.ttml.im1t"===t.textCodec}));if(this.config.enableWebVTT||n&&this.config.enableIMSC1){var s=this.tracks&&r&&this.tracks.length===r.length;if(this.tracks=r||[],this.config.renderTextTracksNatively){var o=this.media?this.media.textTracks:[];this.tracks.forEach((function(t,e){var r;if(e<o.length){for(var n=null,s=0;s<o.length;s++)if(Di(o[s],t)){n=o[s];break}n&&(r=n)}if(r)U(r);else{var a=i._captionsOrSubtitlesFromCharacteristics(t);(r=i.createTextTrack(a,t.name,t.lang))&&(r.mode="disabled")}r&&(r.groupId=t.groupId,i.textTracks.push(r))}))}else if(!s&&this.tracks&&this.tracks.length){var l=this.tracks.map((function(t){return{label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}}));this.hls.trigger(a.a.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}},e._captionsOrSubtitlesFromCharacteristics=function(t){var e;if(null!==(e=t.attrs)&&void 0!==e&&e.CHARACTERISTICS){var i=/transcribes-spoken-dialog/gi.test(t.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(t.attrs.CHARACTERISTICS);if(i&&r)return"captions"}return"subtitles"},e.onManifestLoaded=function(t,e){var i=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach((function(t){var e=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(e){var r="textTrack"+e[1],n=i.captionsProperties[r];n&&(n.label=t.name,t.lang&&(n.languageCode=t.lang),n.media=t)}}))},e.onFragLoading=function(t,e){var i=this.cea608Parser1,r=this.cea608Parser2,n=this.lastSn,s=this.lastPartIndex;if(this.enabled&&i&&r&&e.frag.type===O.b.MAIN){var a,o,l=e.frag.sn,u=null!=(a=null==e||null===(o=e.part)||void 0===o?void 0:o.index)?a:-1;l===n+1||l===n&&u===s+1||(i.reset(),r.reset()),this.lastSn=l,this.lastPartIndex=u}},e.onFragLoaded=function(t,e){var i=e.frag,r=e.payload,n=this.initPTS,o=this.unparsedVttFrags;if(i.type===O.b.SUBTITLE)if(r.byteLength){if(!Object(s.a)(n[i.cc]))return o.push(e),void(n.length&&this.hls.trigger(a.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")}));var l=i.decryptdata,u="stats"in e;if(null==l||null==l.key||"AES-128"!==l.method||u){var c=this.tracks[i.level],h=this.vttCCs;h[i.cc]||(h[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),c&&"stpp.ttml.im1t"===c.textCodec?this._parseIMSC1(i,r):this._parseVTTs(i,r,h)}}else this.hls.trigger(a.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(t,e){var i=this,r=this.hls;Ei(e,this.initPTS[t.cc],this.timescale[t.cc],(function(e){i._appendCues(e,t.level),r.trigger(a.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(e){l.b.log("Failed to parse IMSC1: "+e),r.trigger(a.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:e})}))},e._parseVTTs=function(t,e,i){var r,n=this,s=this.hls;mi(null!==(r=t.initSegment)&&void 0!==r&&r.data?Object(u.b)(t.initSegment.data,new Uint8Array(e)):e,this.initPTS[t.cc],this.timescale[t.cc],i,t.cc,t.start,(function(e){n._appendCues(e,t.level),s.trigger(a.a.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(i){n._fallbackToIMSC1(t,e),l.b.log("Failed to parse VTT cue: "+i),s.trigger(a.a.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:i})}))},e._fallbackToIMSC1=function(t,e){var i=this,r=this.tracks[t.level];r.textCodec||Ei(e,this.initPTS[t.cc],this.timescale[t.cc],(function(){r.textCodec="stpp.ttml.im1t",i._parseIMSC1(t,e)}),(function(){r.textCodec="wvtt"}))},e._appendCues=function(t,e){var i=this.hls;if(this.config.renderTextTracksNatively){var r=this.textTracks[e];if(!r||"disabled"===r.mode)return;t.forEach((function(t){return F(r,t)}))}else{var n=this.tracks[e];if(!n)return;var s=n.default?"default":"subtitles"+e;i.trigger(a.a.CUES_PARSED,{type:"subtitles",cues:t,track:s})}},e.onFragDecrypted=function(t,e){var i=e.frag;if(i.type===O.b.SUBTITLE){if(!Object(s.a)(this.initPTS[i.cc]))return void this.unparsedVttFrags.push(e);this.onFragLoaded(a.a.FRAG_LOADED,e)}},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(t,e){var i=this.cea608Parser1,r=this.cea608Parser2;if(this.enabled&&i&&r)for(var n=0;n<e.samples.length;n++){var s=e.samples[n].bytes;if(s){var a=this.extractCea608Data(s);i.addData(e.samples[n].pts,a[0]),r.addData(e.samples[n].pts,a[1])}}},e.onBufferFlushing=function(t,e){var i=e.startOffset,r=e.endOffset,n=e.endOffsetSubtitles,s=e.type,a=this.media;if(a&&!(a.currentTime<r)){if(!s||"video"===s){var o=this.captionsTracks;Object.keys(o).forEach((function(t){return B(o[t],i,r)}))}if(this.config.renderTextTracksNatively&&0===i&&void 0!==n){var l=this.textTracks;Object.keys(l).forEach((function(t){return B(l[t],i,n)}))}}},e.extractCea608Data=function(t){for(var e=[[],[]],i=31&t[0],r=2,n=0;n<i;n++){var s=t[r++],a=127&t[r++],o=127&t[r++];if((0!==a||0!==o)&&0!=(4&s)){var l=3&s;0!==l&&1!==l||(e[l].push(a),e[l].push(o))}}return e},t}();function Di(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}function Li(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ri,Ci=function(){function t(t){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var e,i,r=t.prototype;return r.setStreamController=function(t){this.streamController=t},r.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},r.registerListeners=function(){var t=this.hls;t.on(a.a.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(a.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(a.a.MANIFEST_PARSED,this.onManifestParsed,this),t.on(a.a.BUFFER_CODECS,this.onBufferCodecs,this),t.on(a.a.MEDIA_DETACHING,this.onMediaDetaching,this)},r.unregisterListener=function(){var t=this.hls;t.off(a.a.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(a.a.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(a.a.MANIFEST_PARSED,this.onManifestParsed,this),t.off(a.a.BUFFER_CODECS,this.onBufferCodecs,this),t.off(a.a.MEDIA_DETACHING,this.onMediaDetaching,this)},r.onFpsDropLevelCapping=function(e,i){t.isLevelAllowed(i.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(i.droppedLevel)},r.onMediaAttaching=function(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null},r.onManifestParsed=function(t,e){var i=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,i.config.capLevelToPlayerSize&&e.video&&this.startCapping()},r.onBufferCodecs=function(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},r.onMediaDetaching=function(){this.stopCapping()},r.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var t=this.hls.levels;if(t.length){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t.length-1),e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},r.getMaxLevel=function(e){var i=this,r=this.hls.levels;if(!r.length)return-1;var n=r.filter((function(r,n){return t.isLevelAllowed(n,i.restrictedLevels)&&n<=e}));return this.clientRect=null,t.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},r.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},r.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},r.getDimensions=function(){if(this.clientRect)return this.clientRect;var t=this.media,e={width:0,height:0};if(t){var i=t.getBoundingClientRect();e.width=i.width,e.height=i.height,e.width||e.height||(e.width=i.right-i.left||t.width||0,e.height=i.bottom-i.top||t.height||0)}return this.clientRect=e,e},t.isLevelAllowed=function(t,e){return void 0===e&&(e=[]),-1===e.indexOf(t)},t.getMaxLevelByMediaSize=function(t,e,i){if(!t||!t.length)return-1;for(var r,n,s=t.length-1,a=0;a<t.length;a+=1){var o=t[a];if((o.width>=e||o.height>=i)&&(r=o,!(n=t[a+1])||r.width!==n.width||r.height!==n.height)){s=a;break}}return s},e=t,(i=[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch(t){}return t}}])&&Li(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Oi=function(){function t(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}var e=t.prototype;return e.setStreamController=function(t){this.streamController=t},e.registerListeners=function(){this.hls.on(a.a.MEDIA_ATTACHING,this.onMediaAttaching,this)},e.unregisterListeners=function(){this.hls.off(a.a.MEDIA_ATTACHING,this.onMediaAttaching)},e.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},e.onMediaAttaching=function(t,e){var i=this.hls.config;if(i.capLevelOnFPSDrop){var r=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=r,r&&"function"==typeof r.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}},e.checkFPS=function(t,e,i){var r=performance.now();if(e){if(this.lastTime){var n=r-this.lastTime,s=i-this.lastDroppedFrames,o=e-this.lastDecodedFrames,u=1e3*s/n,c=this.hls;if(c.trigger(a.a.FPS_DROP,{currentDropped:s,currentDecoded:o,totalDroppedFrames:i}),u>0&&s>c.config.fpsDroppedMonitoringThreshold*o){var h=c.currentLevel;l.b.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=h)&&(h-=1,c.trigger(a.a.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:c.currentLevel}),c.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=i,this.lastDecodedFrames=e}},e.checkFPSInterval=function(){var t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},t}();!function(t){t.WIDEVINE="com.widevine.alpha",t.PLAYREADY="com.microsoft.playready"}(Ri||(Ri={}));var Pi="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null;function xi(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var Ni,Mi,Fi,Ui=function(){function t(t){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=t,this._config=t.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var e,i,r=t.prototype;return r.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},r._registerListeners=function(){this.hls.on(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(a.a.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(a.a.MANIFEST_PARSED,this.onManifestParsed,this)},r._unregisterListeners=function(){this.hls.off(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(a.a.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(a.a.MANIFEST_PARSED,this.onManifestParsed,this)},r.getLicenseServerUrl=function(t){switch(t){case Ri.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')},r._attemptKeySystemAccess=function(t,e,i){var r=this,n=function(t,e,i,r){if(t===Ri.WIDEVINE)return function(t,e,i){var r={audioCapabilities:[],videoCapabilities:[]};return t.forEach((function(t){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:i.audioRobustness||""})})),e.forEach((function(t){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:i.videoRobustness||""})})),[r]}(e,i,r);throw new Error("Unknown key-system: "+t)}(t,e,i,this._drmSystemOptions);l.b.log("Requesting encrypted media key-system access");var s=this.requestMediaKeySystemAccess(t,n);this.mediaKeysPromise=s.then((function(e){return r._onMediaKeySystemAccessObtained(t,e)})),s.catch((function(e){l.b.error('Failed to obtain key-system "'+t+'" access:',e)}))},r._onMediaKeySystemAccessObtained=function(t,e){var i=this;l.b.log('Access for key-system "'+t+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(r);var n=Promise.resolve().then((function(){return e.createMediaKeys()})).then((function(e){return r.mediaKeys=e,l.b.log('Media-keys created for key-system "'+t+'"'),i._onMediaKeysCreated(),e}));return n.catch((function(t){l.b.error("Failed to create media-keys:",t)})),n},r._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach((function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))}))},r._onNewMediaKeySession=function(t){var e=this;l.b.log("New key-system session "+t.sessionId),t.addEventListener("message",(function(i){e._onKeySessionMessage(t,i.message)}),!1)},r._onKeySessionMessage=function(t,e){l.b.log("Got EME message event, creating license request"),this._requestLicense(e,(function(e){l.b.log("Received license data (length: "+(e?e.byteLength:e)+"), updating key-session"),t.update(e).catch((function(t){l.b.warn("Updating key-session failed: "+t)}))}))},r.onMediaEncrypted=function(t){var e=this;if(l.b.log('Media is encrypted using "'+t.initDataType+'" init data type'),!this.mediaKeysPromise)return l.b.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(a.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_NO_KEYS,fatal:!0});var i=function(i){e._media&&(e._attemptSetMediaKeys(i),e._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};this.mediaKeysPromise.then(i).catch(i)},r._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return l.b.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(a.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_NO_KEYS,fatal:!0});l.b.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},r._generateRequestWithPreferredKeySession=function(t,e){var i=this,r=this._mediaKeysList[0];if(!r)return l.b.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(a.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(r.mediaKeysSessionInitialized)l.b.warn("Key-Session already initialized but requested again");else{var n=r.mediaKeysSession;if(!n)return l.b.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(a.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!e)return l.b.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(a.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});l.b.log('Generating key-session request for "'+t+'" init data type'),r.mediaKeysSessionInitialized=!0,n.generateRequest(t,e).then((function(){l.b.debug("Key-session generation succeeded")})).catch((function(t){l.b.error("Error generating key-session request:",t),i.hls.trigger(a.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},r._createLicenseXhr=function(t,e,i){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,t,e,i);var n=this._licenseXhrSetup;if(n)try{n.call(this.hls,r,t),n=void 0}catch(t){l.b.error(t)}try{r.readyState||r.open("POST",t,!0),n&&n.call(this.hls,r,t)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return r},r._onLicenseRequestReadyStageChange=function(t,e,i,r){if(4===t.readyState)if(200===t.status){this._requestLicenseFailureCount=0,l.b.log("License request succeeded");var n=t.response,s=this._licenseResponseCallback;if(s)try{n=s.call(this.hls,t,e)}catch(t){l.b.error(t)}r(n)}else{if(l.b.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(a.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var u=3-this._requestLicenseFailureCount+1;l.b.warn("Retrying license request, "+u+" attempts left"),this._requestLicense(i,r)}},r._generateLicenseRequestChallenge=function(t,e){if(t.mediaKeySystemDomain===Ri.WIDEVINE)return e;throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},r._requestLicense=function(t,e){l.b.log("Requesting content license for key-system");var i=this._mediaKeysList[0];if(!i)return l.b.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(a.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(i.mediaKeySystemDomain),n=this._createLicenseXhr(r,t,e);l.b.log("Sending license request to URL: "+r);var s=this._generateLicenseRequestChallenge(i,t);n.send(s)}catch(t){l.b.error("Failure requesting DRM license: "+t),this.hls.trigger(a.a.ERROR,{type:o.b.KEY_SYSTEM_ERROR,details:o.a.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},r.onMediaAttached=function(t,e){if(this._emeEnabled){var i=e.media;this._media=i,i.addEventListener("encrypted",this._onMediaEncrypted)}},r.onMediaDetached=function(){var t=this._media,e=this._mediaKeysList;t&&(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map((function(t){if(t.mediaKeysSession)return t.mediaKeysSession.close().catch((function(){}))}))).then((function(){return t.setMediaKeys(null)})).catch((function(){})))},r.onManifestParsed=function(t,e){if(this._emeEnabled){var i=e.levels.map((function(t){return t.audioCodec})).filter((function(t){return!!t})),r=e.levels.map((function(t){return t.videoCodec})).filter((function(t){return!!t}));this._attemptKeySystemAccess(Ri.WIDEVINE,i,r)}},e=t,(i=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&xi(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Bi(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Vi(t,e,i){return e&&Bi(t.prototype,e),i&&Bi(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function ji(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(i)return(i=i.call(t)).next.bind(i);if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return Gi(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Gi(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Gi(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function Ki(){return(Ki=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}!function(t){t.MANIFEST="m",t.AUDIO="a",t.VIDEO="v",t.MUXED="av",t.INIT="i",t.CAPTION="c",t.TIMED_TEXT="tt",t.KEY="k",t.OTHER="o"}(Ni||(Ni={})),function(t){t.DASH="d",t.HLS="h",t.SMOOTH="s",t.OTHER="o"}(Mi||(Mi={})),function(t){t.VOD="v",t.LIVE="l"}(Fi||(Fi={}));var Hi=function(){function t(e){var i=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){i.initialized&&(i.starved=!0),i.buffering=!0},this.onPlaying=function(){i.initialized||(i.initialized=!0),i.buffering=!1},this.applyPlaylistData=function(t){try{i.apply(t,{ot:Ni.MANIFEST,su:!i.initialized})}catch(t){l.b.warn("Could not generate manifest CMCD data.",t)}},this.applyFragmentData=function(t){try{var e=t.frag,r=i.hls.levels[e.level],n=i.getObjectType(e),s={d:1e3*e.duration,ot:n};n!==Ni.VIDEO&&n!==Ni.AUDIO&&n!=Ni.MUXED||(s.br=r.bitrate/1e3,s.tb=i.getTopBandwidth(n)/1e3,s.bl=i.getBufferLength(n)),i.apply(t,s)}catch(t){l.b.warn("Could not generate segment CMCD data.",t)}},this.hls=e;var r=this.config=e.config,n=r.cmcd;null!=n&&(r.pLoader=this.createPlaylistLoader(),r.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||t.uuid(),this.cid=n.contentId,this.useHeaders=!0===n.useHeaders,this.registerListeners())}var e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(a.a.MEDIA_DETACHED,this.onMediaDetached,this),t.on(a.a.BUFFER_CREATED,this.onBufferCreated,this)},e.unregisterListeners=function(){var t=this.hls;t.off(a.a.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(a.a.MEDIA_DETACHED,this.onMediaDetached,this),t.off(a.a.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},e.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},e.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},e.onMediaDetached=function(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},e.onBufferCreated=function(t,e){var i,r;this.audioBuffer=null===(i=e.tracks.audio)||void 0===i?void 0:i.buffer,this.videoBuffer=null===(r=e.tracks.video)||void 0===r?void 0:r.buffer},e.createData=function(){var t;return{v:1,sf:Mi.HLS,sid:this.sid,cid:this.cid,pr:null===(t=this.media)||void 0===t?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},e.apply=function(e,i){void 0===i&&(i={}),Ki(i,this.createData());var r=i.ot===Ni.INIT||i.ot===Ni.VIDEO||i.ot===Ni.MUXED;if(this.starved&&r&&(i.bs=!0,i.su=!0,this.starved=!1),null==i.su&&(i.su=this.buffering),this.useHeaders){var n=t.toHeaders(i);if(!Object.keys(n).length)return;e.headers||(e.headers={}),Ki(e.headers,n)}else{var s=t.toQuery(i);if(!s)return;e.url=t.appendQueryToUri(e.url,s)}},e.getObjectType=function(t){var e=t.type;return"subtitle"===e?Ni.TIMED_TEXT:"initSegment"===t.sn?Ni.INIT:"audio"===e?Ni.AUDIO:"main"===e?this.hls.audioTracks.length?Ni.VIDEO:Ni.MUXED:void 0},e.getTopBandwidth=function(t){var e,i=0,r=this.hls;if(t===Ni.AUDIO)e=r.audioTracks;else{var n=r.maxAutoLevel,s=n>-1?n+1:r.levels.length;e=r.levels.slice(0,s)}for(var a,o=ji(e);!(a=o()).done;){var l=a.value;l.bitrate>i&&(i=l.bitrate)}return i>0?i:NaN},e.getBufferLength=function(t){var e=this.hls.media,i=t===Ni.AUDIO?this.audioBuffer:this.videoBuffer;return i&&e?1e3*vt.bufferInfo(i,e.currentTime,this.config.maxBufferHole).len:NaN},e.createPlaylistLoader=function(){var t=this.config.pLoader,e=this.applyPlaylistData,i=t||this.config.loader;return function(){function t(t){this.loader=void 0,this.loader=new i(t)}var r=t.prototype;return r.destroy=function(){this.loader.destroy()},r.abort=function(){this.loader.abort()},r.load=function(t,i,r){e(t),this.loader.load(t,i,r)},Vi(t,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),t}()},e.createFragmentLoader=function(){var t=this.config.fLoader,e=this.applyFragmentData,i=t||this.config.loader;return function(){function t(t){this.loader=void 0,this.loader=new i(t)}var r=t.prototype;return r.destroy=function(){this.loader.destroy()},r.abort=function(){this.loader.abort()},r.load=function(t,i,r){e(t),this.loader.load(t,i,r)},Vi(t,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),t}()},t.uuid=function(){var t=URL.createObjectURL(new Blob),e=t.toString();return URL.revokeObjectURL(t),e.slice(e.lastIndexOf("/")+1)},t.serialize=function(t){for(var e,i=[],r=function(t){return!Number.isNaN(t)&&null!=t&&""!==t&&!1!==t},n=function(t){return Math.round(t)},s=function(t){return 100*n(t/100)},a={br:n,d:n,bl:s,dl:s,mtp:s,nor:function(t){return encodeURIComponent(t)},rtp:s,tb:n},o=ji(Object.keys(t||{}).sort());!(e=o()).done;){var l=e.value,u=t[l];if(r(u)&&!("v"===l&&1===u||"pr"==l&&1===u)){var c=a[l];c&&(u=c(u));var h,d=typeof u;h="ot"===l||"sf"===l||"st"===l?l+"="+u:"boolean"===d?l:"number"===d?l+"="+u:l+"="+JSON.stringify(u),i.push(h)}}return i.join(",")},t.toHeaders=function(e){for(var i={},r=["Object","Request","Session","Status"],n=[{},{},{},{}],s={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},a=0,o=Object.keys(e);a<o.length;a++){var l=o[a];n[null!=s[l]?s[l]:1][l]=e[l]}for(var u=0;u<n.length;u++){var c=t.serialize(n[u]);c&&(i["CMCD-"+r[u]]=c)}return i},t.toQuery=function(e){return"CMCD="+encodeURIComponent(t.serialize(e))},t.appendQueryToUri=function(t,e){if(!e)return t;var i=t.includes("?")?"&":"?";return""+t+i+e},t}(),qi=i(14),Wi=/^age:\s*[\d.]+\s*$/m,zi=function(){function t(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t?t.xhrSetup:null,this.stats=new qi.a,this.retryDelay=0}var e=t.prototype;return e.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},e.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))},e.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},e.load=function(t,e,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=i,this.retryDelay=e.retryDelay,this.loadInternal()},e.loadInternal=function(){var t=this.config,e=this.context;if(t){var i=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0;var n=this.xhrSetup;try{if(n)try{n(i,e.url)}catch(t){i.open("GET",e.url,!0),n(i,e.url)}i.readyState||i.open("GET",e.url,!0);var s=this.context.headers;if(s)for(var a in s)i.setRequestHeader(a,s[a])}catch(t){return void this.callbacks.onError({code:i.status,text:t.message},e,i)}e.rangeEnd&&i.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),i.onreadystatechange=this.readystatechange.bind(this),i.onprogress=this.loadprogress.bind(this),i.responseType=e.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),i.send()}},e.readystatechange=function(){var t=this.context,e=this.loader,i=this.stats;if(t&&e){var r=e.readyState,n=this.config;if(!i.aborted&&r>=2)if(self.clearTimeout(this.requestTimeout),0===i.loading.first&&(i.loading.first=Math.max(self.performance.now(),i.loading.start)),4===r){e.onreadystatechange=null,e.onprogress=null;var s=e.status;if(s>=200&&s<300){var a,o;if(i.loading.end=Math.max(self.performance.now(),i.loading.first),o="arraybuffer"===t.responseType?(a=e.response).byteLength:(a=e.responseText).length,i.loaded=i.total=o,!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(i,t,a,e),!this.callbacks)return;var c={url:e.responseURL,data:a};this.callbacks.onSuccess(c,i,t,e)}else i.retry>=n.maxRetry||s>=400&&s<499?(l.b.error(s+" while loading "+t.url),this.callbacks.onError({code:s,text:e.statusText},t,e)):(l.b.warn(s+" while loading "+t.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,n.maxRetryDelay),i.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout)}},e.loadtimeout=function(){l.b.warn("timeout while loading "+this.context.url);var t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))},e.loadprogress=function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)},e.getCacheAge=function(){var t=null;if(this.loader&&Wi.test(this.loader.getAllResponseHeaders())){var e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t},t}();function Yi(t){var e="function"==typeof Map?new Map:void 0;return(Yi=function(t){if(null===t||(i=t,-1===Function.toString.call(i).indexOf("[native code]")))return t;var i;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return $i(t,arguments,Ji(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Qi(r,t)})(t)}function $i(t,e,i){return($i=Xi()?Reflect.construct.bind():function(t,e,i){var r=[null];r.push.apply(r,e);var n=new(Function.bind.apply(t,r));return i&&Qi(n,i.prototype),n}).apply(null,arguments)}function Xi(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Qi(t,e){return(Qi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Ji(t){return(Ji=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Zi(){return(Zi=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}var tr=function(){function t(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||er,this.controller=new self.AbortController,this.stats=new qi.a}var e=t.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var t=this.response;t&&t.ok||(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(t,e,i){var r=this,n=this.stats;if(n.loading.start)throw new Error("Loader can only be used once.");n.loading.start=self.performance.now();var a=function(t,e){var i={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Zi({},t.headers))};return t.rangeEnd&&i.headers.set("Range","bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)),i}(t,this.controller.signal),o=i.onProgress,l="arraybuffer"===t.responseType,u=l?"byteLength":"length";this.context=t,this.config=e,this.callbacks=i,this.request=this.fetchSetup(t,a),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){r.abortInternal(),i.onTimeout(n,t,r.response)}),e.timeout),self.fetch(this.request).then((function(i){if(r.response=r.loader=i,!i.ok){var a=i.status,u=i.statusText;throw new ir(u||"fetch, bad network response",a,i)}return n.loading.first=Math.max(self.performance.now(),n.loading.start),n.total=parseInt(i.headers.get("Content-Length")||"0"),o&&Object(s.a)(e.highWaterMark)?r.loadProgressively(i,n,t,e.highWaterMark,o):l?i.arrayBuffer():i.text()})).then((function(a){var l=r.response;self.clearTimeout(r.requestTimeout),n.loading.end=Math.max(self.performance.now(),n.loading.first),n.loaded=n.total=a[u];var c={url:l.url,data:a};o&&!Object(s.a)(e.highWaterMark)&&o(n,t,a,l),i.onSuccess(c,n,t,l)})).catch((function(e){if(self.clearTimeout(r.requestTimeout),!n.aborted){var s=e&&e.code||0,a=e?e.message:null;i.onError({code:s,text:a},t,e?e.details:null)}}))},e.getCacheAge=function(){var t=null;if(this.response){var e=this.response.headers.get("age");t=e?parseFloat(e):null}return t},e.loadProgressively=function(t,e,i,r,n){void 0===r&&(r=0);var s=new me,a=t.body.getReader();return function o(){return a.read().then((function(a){if(a.done)return s.dataLength&&n(e,i,s.flush(),t),Promise.resolve(new ArrayBuffer(0));var l=a.value,u=l.length;return e.loaded+=u,u<r||s.dataLength?(s.push(l),s.dataLength>=r&&n(e,i,s.flush(),t)):n(e,i,l,t),o()})).catch((function(){return Promise.reject()}))}()},t}();function er(t,e){return new self.Request(t.url,e)}var ir=function(t){var e,i;function r(e,i,r){var n;return(n=t.call(this,e)||this).code=void 0,n.details=void 0,n.code=i,n.details=r,n}return i=t,(e=r).prototype=Object.create(i.prototype),e.prototype.constructor=e,Qi(e,i),r}(Yi(Error)),rr=tr,nr=/\s/;function sr(){return(sr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}).apply(this,arguments)}function ar(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,r)}return i}function or(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ar(Object(i),!0).forEach((function(e){lr(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ar(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function lr(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var ur=or(or({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:zi,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:pe,bufferController:Ne,capLevelController:Ci,fpsController:Oi,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Pi,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},{cueHandler:{newCue:function(t,e,i,r){for(var n,s,a,o,l,u=[],c=self.VTTCue||self.TextTrackCue,h=0;h<r.rows.length;h++)if(a=!0,o=0,l="",!(n=r.rows[h]).isEmpty()){for(var d=0;d<n.chars.length;d++)nr.test(n.chars[d].uchar)&&a?o++:(l+=n.chars[d].uchar,a=!1);n.cueStartTime=e,e===i&&(i+=1e-4),o>=16?o--:o++;var f=li(l.trim()),g=pi(e,i,f);t&&t.cues&&t.cues.getCueById(g)||((s=new c(e,i,f)).id=g,s.line=h+1,s.align="left",s.position=10+Math.min(80,10*Math.floor(8*o/32)),u.push(s))}return t&&u.length&&(u.sort((function(t,e){return"auto"===t.line||"auto"===e.line?0:t.line>8&&e.line>8?e.line-t.line:t.line-e.line})),u.forEach((function(e){return F(t,e)}))),u}},enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:_e,subtitleTrackController:Ce,timelineController:ki,audioStreamController:Te,audioTrackController:Se,emeController:Ui,cmcdController:Hi});function cr(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var hr=function(){function t(e){void 0===e&&(e={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new se.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var i=this.config=function(t,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return sr({},t,e)}(t.DefaultConfig,e);this.userConfig=e,Object(l.a)(i.debug),this._autoLevelCapping=-1,i.progressive&&function(t){var e=t.loader;e!==rr&&e!==zi?(l.b.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):function(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1}()&&(t.loader=rr,t.progressive=!0,t.enableSoftwareAES=!0,l.b.log("[config]: Progressive streaming enabled, using FetchLoader"))}(i);var r=i.abrController,n=i.bufferController,s=i.capLevelController,a=i.fpsController,o=this.abrController=new r(this),u=this.bufferController=new n(this),c=this.capLevelController=new s(this),h=new a(this),d=new x(this),f=new N(this),g=new H(this),p=this.levelController=new ht(this),m=new dt(this),v=this.streamController=new he(this,m);c.setStreamController(v),h.setStreamController(v);var y=[d,f,p,v];this.networkControllers=y;var T=[o,u,c,h,g,m];this.audioTrackController=this.createController(i.audioTrackController,null,y),this.createController(i.audioStreamController,m,y),this.subtitleTrackController=this.createController(i.subtitleTrackController,null,y),this.createController(i.subtitleStreamController,m,y),this.createController(i.timelineController,null,T),this.emeController=this.createController(i.emeController,null,T),this.cmcdController=this.createController(i.cmcdController,null,T),this.latencyController=this.createController(z,null,T),this.coreComponents=T}t.isSupported=function(){return function(){var t=ee();if(!t)return!1;var e=ie(),i=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!i&&!!r}()};var e,i,r,s=t.prototype;return s.createController=function(t,e,i){if(t){var r=e?new t(this,e):new t(this);return i&&i.push(r),r}return null},s.on=function(t,e,i){void 0===i&&(i=this),this._emitter.on(t,e,i)},s.once=function(t,e,i){void 0===i&&(i=this),this._emitter.once(t,e,i)},s.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},s.off=function(t,e,i,r){void 0===i&&(i=this),this._emitter.off(t,e,i,r)},s.listeners=function(t){return this._emitter.listeners(t)},s.emit=function(t,e,i){return this._emitter.emit(t,e,i)},s.trigger=function(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(e){l.b.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.trigger(a.a.ERROR,{type:o.b.OTHER_ERROR,details:o.a.INTERNAL_EXCEPTION,fatal:!1,event:t,error:e})}return!1},s.listenerCount=function(t){return this._emitter.listenerCount(t)},s.destroy=function(){l.b.log("destroy"),this.trigger(a.a.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(t){return t.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(t){return t.destroy()})),this.coreComponents.length=0},s.attachMedia=function(t){l.b.log("attachMedia"),this._media=t,this.trigger(a.a.MEDIA_ATTACHING,{media:t})},s.detachMedia=function(){l.b.log("detachMedia"),this.trigger(a.a.MEDIA_DETACHING,void 0),this._media=null},s.loadSource=function(t){this.stopLoad();var e=this.media,i=this.url,r=this.url=n.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});l.b.log("loadSource:"+r),e&&i&&i!==r&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(e)),this.trigger(a.a.MANIFEST_LOADING,{url:t})},s.startLoad=function(t){void 0===t&&(t=-1),l.b.log("startLoad("+t+")"),this.networkControllers.forEach((function(e){e.startLoad(t)}))},s.stopLoad=function(){l.b.log("stopLoad"),this.networkControllers.forEach((function(t){t.stopLoad()}))},s.swapAudioCodec=function(){l.b.log("swapAudioCodec"),this.streamController.swapAudioCodec()},s.recoverMediaError=function(){l.b.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},s.removeLevel=function(t,e){void 0===e&&(e=0),this.levelController.removeLevel(t,e)},e=t,r=[{key:"version",get:function(){return"1.2.2"}},{key:"Events",get:function(){return a.a}},{key:"ErrorTypes",get:function(){return o.b}},{key:"ErrorDetails",get:function(){return o.a}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:ur},set:function(e){t.defaultConfig=e}}],(i=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){l.b.log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){l.b.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){l.b.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){l.b.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){l.b.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){var e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(l.b.log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,e=this.config.minAutoBitrate;if(!t)return 0;for(var i=t.length,r=0;r<i;r++)if(t[r].maxBitrate>=e)return r;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,e=this.autoLevelCapping;return-1===e&&t&&t.length?t.length-1:e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&cr(e.prototype,i),r&&cr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();hr.defaultConfig=void 0}]).default)}},e={};function i(r){var n=e[r];if(void 0!==n)return n.exports;var s=e[r]={exports:{}};return t[r].call(s.exports,s,s.exports,i),s.exports}i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{"use strict";const t=function(t){const e=[];let i=0;for(let r=0;r<t.length;r++){let n=t.charCodeAt(r);n<128?e[i++]=n:n<2048?(e[i++]=n>>6|192,e[i++]=63&n|128):55296==(64512&n)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(n=65536+((1023&n)<<10)+(1023&t.charCodeAt(++r)),e[i++]=n>>18|240,e[i++]=n>>12&63|128,e[i++]=n>>6&63|128,e[i++]=63&n|128):(e[i++]=n>>12|224,e[i++]=n>>6&63|128,e[i++]=63&n|128)}return e},e={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const i=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const n=t[e],s=e+1<t.length,a=s?t[e+1]:0,o=e+2<t.length,l=o?t[e+2]:0,u=n>>2,c=(3&n)<<4|a>>4;let h=(15&a)<<2|l>>6,d=63&l;o||(d=64,s||(h=64)),r.push(i[u],i[c],i[h],i[d])}return r.join("")},encodeString(e,i){return this.HAS_NATIVE_SUPPORT&&!i?btoa(e):this.encodeByteArray(t(e),i)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let i=0,r=0;for(;i<t.length;){const n=t[i++];if(n<128)e[r++]=String.fromCharCode(n);else if(n>191&&n<224){const s=t[i++];e[r++]=String.fromCharCode((31&n)<<6|63&s)}else if(n>239&&n<365){const s=((7&n)<<18|(63&t[i++])<<12|(63&t[i++])<<6|63&t[i++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[i++],a=t[i++];e[r++]=String.fromCharCode((15&n)<<12|(63&s)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const i=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const n=i[t.charAt(e++)],s=e<t.length?i[t.charAt(e)]:0;++e;const a=e<t.length?i[t.charAt(e)]:64;++e;const o=e<t.length?i[t.charAt(e)]:64;if(++e,null==n||null==s||null==a||null==o)throw Error();const l=n<<2|s>>4;if(r.push(l),64!==a){const t=s<<4&240|a>>2;if(r.push(t),64!==o){const t=a<<6&192|o;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},r=function(i){const r=t(i);return e.encodeByteArray(r,!0)};class n{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,i))}}}function s(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function a(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())}function o(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function l(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function u(){const t=s();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}class c extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name="FirebaseError",Object.setPrototypeOf(this,c.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,h.prototype.create)}}class h{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){const i=e[0]||{},r=`${this.service}/${t}`,n=this.errors[t],s=n?function(t,e){return t.replace(d,((t,i)=>{const r=e[i];return null!=r?String(r):`<${i}?>`}))}(n,i):"Error",a=`${this.serviceName}: ${s} (${r}).`;return new c(r,a,i)}}const d=/\{\$([^}]+)}/g;function f(t,e){if(t===e)return!0;const i=Object.keys(t),r=Object.keys(e);for(const n of i){if(!r.includes(n))return!1;const i=t[n],s=e[n];if(g(i)&&g(s)){if(!f(i,s))return!1}else if(i!==s)return!1}for(const t of r)if(!i.includes(t))return!1;return!0}function g(t){return null!==t&&"object"==typeof t}function p(t){const e=[];for(const[i,r]of Object.entries(t))Array.isArray(r)?r.forEach((t=>{e.push(encodeURIComponent(i)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(i)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function m(t){const e={};return t.replace(/^\?/,"").split("&").forEach((t=>{if(t){const[i,r]=t.split("=");e[decodeURIComponent(i)]=decodeURIComponent(r)}})),e}function v(t){const e=t.indexOf("?");if(!e)return"";const i=t.indexOf("#",e);return t.substring(e,i>0?i:void 0)}class y{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((()=>{t(this)})).catch((t=>{this.error(t)}))}next(t){this.forEachObserver((e=>{e.next(t)}))}error(t){this.forEachObserver((e=>{e.error(t)})),this.close(t)}complete(){this.forEachObserver((t=>{t.complete()})),this.close()}subscribe(t,e,i){let r;if(void 0===t&&void 0===e&&void 0===i)throw new Error("Missing Observer.");r=function(t,e){if("object"!=typeof t||null===t)return!1;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(t)?t:{next:t,error:e,complete:i},void 0===r.next&&(r.next=T),void 0===r.error&&(r.error=T),void 0===r.complete&&(r.complete=T);const n=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(t){}})),this.observers.push(r),n}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function T(){}function b(t){return t&&t._delegate?t._delegate:t}class E{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const S="[DEFAULT]";class w{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new n;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:e});i&&t.resolve(i)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const i=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(i)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:i})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:S})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:i});e.resolve(t)}catch(t){}}}}clearInstance(t="[DEFAULT]"){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t="[DEFAULT]"){return this.instances.has(t)}getOptions(t="[DEFAULT]"){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:i,options:e});for(const[t,e]of this.instancesDeferred.entries())i===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var i;const r=this.normalizeInstanceIdentifier(e),n=null!==(i=this.onInitCallbacks.get(r))&&void 0!==i?i:new Set;n.add(t),this.onInitCallbacks.set(r,n);const s=this.instances.get(r);return s&&t(s,r),()=>{n.delete(t)}}invokeOnInitCallbacks(t,e){const i=this.onInitCallbacks.get(e);if(i)for(const r of i)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===S?void 0:r),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch(t){}var r;return i||null}normalizeInstanceIdentifier(t="[DEFAULT]"){return this.component?this.component.multipleInstances?t:S:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class I{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new w(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const _=[];var A,k;(k=A||(A={}))[k.DEBUG=0]="DEBUG",k[k.VERBOSE=1]="VERBOSE",k[k.INFO=2]="INFO",k[k.WARN=3]="WARN",k[k.ERROR=4]="ERROR",k[k.SILENT=5]="SILENT";const D={debug:A.DEBUG,verbose:A.VERBOSE,info:A.INFO,warn:A.WARN,error:A.ERROR,silent:A.SILENT},L=A.INFO,R={[A.DEBUG]:"log",[A.VERBOSE]:"log",[A.INFO]:"info",[A.WARN]:"warn",[A.ERROR]:"error"},C=(t,e,...i)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),n=R[e];if(!n)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[n](`[${r}]  ${t.name}:`,...i)};class O{constructor(t){this.name=t,this._logLevel=L,this._logHandler=C,this._userLogHandler=null,_.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in A))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?D[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,A.DEBUG,...t),this._logHandler(this,A.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,A.VERBOSE,...t),this._logHandler(this,A.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,A.INFO,...t),this._logHandler(this,A.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,A.WARN,...t),this._logHandler(this,A.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,A.ERROR,...t),this._logHandler(this,A.ERROR,...t)}}var P=i(676);class x{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const N="@firebase/app",M="0.7.18",F=new O("@firebase/app"),U={[N]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},B=new Map,V=new Map;function j(t,e){try{t.container.addComponent(e)}catch(i){F.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,i)}}function G(t){const e=t.name;if(V.has(e))return F.debug(`There were multiple attempts to register component ${e}.`),!1;V.set(e,t);for(const e of B.values())j(e,t);return!0}function K(t,e){const i=t.container.getProvider("heartbeat").getImmediate({optional:!0});return i&&i.triggerHeartbeat(),t.container.getProvider(e)}const H=new h("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}."});class q{constructor(t,e,i){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new E("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw H.create("app-deleted",{appName:this._name})}}const W="9.6.8";function z(t="[DEFAULT]"){const e=B.get(t);if(!e)throw H.create("no-app",{appName:t});return e}function Y(t,e,i){var r;let n=null!==(r=U[t])&&void 0!==r?r:t;i&&(n+=`-${i}`);const s=n.match(/\s|\//),a=e.match(/\s|\//);if(s||a){const t=[`Unable to register library "${n}" with version "${e}":`];return s&&t.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&a&&t.push("and"),a&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void F.warn(t.join(" "))}G(new E(`${n}-version`,(()=>({library:n,version:e})),"VERSION"))}const $="firebase-heartbeat-store";let X=null;function Q(){return X||(X=(0,P.openDb)("firebase-heartbeat-database",1,(t=>{0===t.oldVersion&&t.createObjectStore($)})).catch((t=>{throw H.create("storage-open",{originalErrorMessage:t.message})}))),X}async function J(t,e){try{const i=(await Q()).transaction($,"readwrite"),r=i.objectStore($);return await r.put(e,Z(t)),i.complete}catch(t){throw H.create("storage-set",{originalErrorMessage:t.message})}}function Z(t){return`${t.name}!${t.options.appId}`}class tt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new et(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=(new Date).toISOString().substring(0,10);if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),!this._heartbeatsCache.some((t=>t.date===e)))return this._heartbeatsCache.push({date:e,userAgent:t}),this._heartbeatsCache=this._heartbeatsCache.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache)return"";const{heartbeatsToSend:t,unsentEntries:e}=function(t,e=1024){const i=[];let r=t.slice();for(const n of t){const t=i.find((t=>t.userAgent===n.userAgent));if(t){if(t.dates.push(n.date),it(i)>e){t.dates.pop();break}}else if(i.push({userAgent:n.userAgent,dates:[n.date]}),it(i)>e){i.pop();break}r=r.slice(1)}return{heartbeatsToSend:i,unsentEntries:r}}(this._heartbeatsCache),i=r(JSON.stringify({version:2,heartbeats:t}));return e.length>0?(this._heartbeatsCache=e,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache=null,this._storage.deleteAll()),i}}class et{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return"object"==typeof indexedDB&&new Promise(((t,e)=>{try{let i=!0;const r="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(r);n.onsuccess=()=>{n.result.close(),i||self.indexedDB.deleteDatabase(r),t(!0)},n.onupgradeneeded=()=>{i=!1},n.onerror=()=>{var t;e((null===(t=n.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{return(await Q()).transaction($).objectStore($).get(Z(t))}catch(t){throw H.create("storage-get",{originalErrorMessage:t.message})}}(this.app);return(null==t?void 0:t.heartbeats)||[]}return[]}async overwrite(t){return await this._canUseIndexedDBPromise?J(this.app,{heartbeats:t}):void 0}async add(t){if(await this._canUseIndexedDBPromise){const e=await this.read();return J(this.app,{heartbeats:[...e,...t]})}}async delete(t){if(await this._canUseIndexedDBPromise){const e=await this.read();return J(this.app,{heartbeats:e.filter((e=>!t.includes(e)))})}}async deleteAll(){return await this._canUseIndexedDBPromise?async function(t){try{const e=(await Q()).transaction($,"readwrite");return await e.objectStore($).delete(Z(t)),e.complete}catch(t){throw H.create("storage-delete",{originalErrorMessage:t.message})}}(this.app):void 0}}function it(t){return r(JSON.stringify({version:2,heartbeats:t})).length}G(new E("platform-logger",(t=>new x(t)),"PRIVATE")),G(new E("heartbeat",(t=>new tt(t)),"PRIVATE")),Y(N,M,""),Y(N,M,"esm2017"),Y("fire-js",""),Y("firebase","9.6.8","app");var rt,nt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{},st={},at=at||{},ot=nt||self;function lt(){}function ut(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function ct(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var ht="closure_uid_"+(1e9*Math.random()>>>0),dt=0;function ft(t,e,i){return t.call.apply(t.bind,arguments)}function gt(t,e,i){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),t.apply(e,i)}}return function(){return t.apply(e,arguments)}}function pt(t,e,i){return(pt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ft:gt).apply(null,arguments)}function mt(t,e){var i=Array.prototype.slice.call(arguments,1);return function(){var e=i.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function vt(t,e){function i(){}i.prototype=e.prototype,t.Z=e.prototype,t.prototype=new i,t.prototype.constructor=t,t.Vb=function(t,i,r){for(var n=Array(arguments.length-2),s=2;s<arguments.length;s++)n[s-2]=arguments[s];return e.prototype[i].apply(t,n)}}function yt(){this.s=this.s,this.o=this.o}var Tt={};yt.prototype.s=!1,yt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,ht)&&t[ht]||(t[ht]=++dt)}(this);delete Tt[t]}},yt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const bt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let i=0;i<t.length;i++)if(i in t&&t[i]===e)return i;return-1},Et=Array.prototype.forEach?function(t,e,i){Array.prototype.forEach.call(t,e,i)}:function(t,e,i){const r=t.length,n="string"==typeof t?t.split(""):t;for(let s=0;s<r;s++)s in n&&e.call(i,n[s],s,t)};function St(t){return Array.prototype.concat.apply([],arguments)}function wt(t){const e=t.length;if(0<e){const i=Array(e);for(let r=0;r<e;r++)i[r]=t[r];return i}return[]}function It(t){return/^[\s\xa0]*$/.test(t)}var _t,At=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function kt(t,e){return-1!=t.indexOf(e)}function Dt(t,e){return t<e?-1:t>e?1:0}t:{var Lt=ot.navigator;if(Lt){var Rt=Lt.userAgent;if(Rt){_t=Rt;break t}}_t=""}function Ct(t,e,i){for(const r in t)e.call(i,t[r],r,t)}function Ot(t){const e={};for(const i in t)e[i]=t[i];return e}var Pt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function xt(t,e){let i,r;for(let e=1;e<arguments.length;e++){for(i in r=arguments[e],r)t[i]=r[i];for(let e=0;e<Pt.length;e++)i=Pt[e],Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}}function Nt(t){return Nt[" "](t),t}Nt[" "]=lt;var Mt,Ft,Ut=kt(_t,"Opera"),Bt=kt(_t,"Trident")||kt(_t,"MSIE"),Vt=kt(_t,"Edge"),jt=Vt||Bt,Gt=kt(_t,"Gecko")&&!(kt(_t.toLowerCase(),"webkit")&&!kt(_t,"Edge"))&&!(kt(_t,"Trident")||kt(_t,"MSIE"))&&!kt(_t,"Edge"),Kt=kt(_t.toLowerCase(),"webkit")&&!kt(_t,"Edge");function Ht(){var t=ot.document;return t?t.documentMode:void 0}t:{var qt="",Wt=(Ft=_t,Gt?/rv:([^\);]+)(\)|;)/.exec(Ft):Vt?/Edge\/([\d\.]+)/.exec(Ft):Bt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Ft):Kt?/WebKit\/(\S+)/.exec(Ft):Ut?/(?:Version)[ \/]?(\S+)/.exec(Ft):void 0);if(Wt&&(qt=Wt?Wt[1]:""),Bt){var zt=Ht();if(null!=zt&&zt>parseFloat(qt)){Mt=String(zt);break t}}Mt=qt}var Yt,$t={};function Xt(){return t=$t,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){let t=0;const e=At(String(Mt)).split("."),i=At("9").split("."),r=Math.max(e.length,i.length);for(let a=0;0==t&&a<r;a++){var n=e[a]||"",s=i[a]||"";do{if(n=/(\d*)(\D*)(.*)/.exec(n)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==n[0].length&&0==s[0].length)break;t=Dt(0==n[1].length?0:parseInt(n[1],10),0==s[1].length?0:parseInt(s[1],10))||Dt(0==n[2].length,0==s[2].length)||Dt(n[2],s[2]),n=n[3],s=s[3]}while(0==t)}return 0<=t}();var t}ot.document&&Bt?Yt=Ht()||parseInt(Mt,10)||void 0:Yt=void 0;var Qt=Yt,Jt=function(){if(!ot.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{ot.addEventListener("test",lt,e),ot.removeEventListener("test",lt,e)}catch(t){}return t}();function Zt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function te(t,e){if(Zt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var i=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Gt){t:{try{Nt(e.nodeName);var n=!0;break t}catch(t){}n=!1}n||(e=null)}}else"mouseover"==i?e=t.fromElement:"mouseout"==i&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:ee[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&te.Z.h.call(this)}}Zt.prototype.h=function(){this.defaultPrevented=!0},vt(te,Zt);var ee={2:"touch",3:"pen",4:"mouse"};te.prototype.h=function(){te.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ie="closure_listenable_"+(1e6*Math.random()|0),re=0;function ne(t,e,i,r,n){this.listener=t,this.proxy=null,this.src=e,this.type=i,this.capture=!!r,this.ia=n,this.key=++re,this.ca=this.fa=!1}function se(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function ae(t){this.src=t,this.g={},this.h=0}function oe(t,e){var i=e.type;if(i in t.g){var r,n=t.g[i],s=bt(n,e);(r=0<=s)&&Array.prototype.splice.call(n,s,1),r&&(se(e),0==t.g[i].length&&(delete t.g[i],t.h--))}}function le(t,e,i,r){for(var n=0;n<t.length;++n){var s=t[n];if(!s.ca&&s.listener==e&&s.capture==!!i&&s.ia==r)return n}return-1}ae.prototype.add=function(t,e,i,r,n){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var a=le(t,e,r,n);return-1<a?(e=t[a],i||(e.fa=!1)):((e=new ne(e,this.src,s,!!r,n)).fa=i,t.push(e)),e};var ue="closure_lm_"+(1e6*Math.random()|0),ce={};function he(t,e,i,r,n){if(r&&r.once)return fe(t,e,i,r,n);if(Array.isArray(e)){for(var s=0;s<e.length;s++)he(t,e[s],i,r,n);return null}return i=be(i),t&&t[ie]?t.N(e,i,ct(r)?!!r.capture:!!r,n):de(t,e,i,!1,r,n)}function de(t,e,i,r,n,s){if(!e)throw Error("Invalid event type");var a=ct(n)?!!n.capture:!!n,o=ye(t);if(o||(t[ue]=o=new ae(t)),(i=o.add(e,i,r,a,s)).proxy)return i;if(r=function(){var t=ve;return function e(i){return t.call(e.src,e.listener,i)}}(),i.proxy=r,r.src=t,r.listener=i,t.addEventListener)Jt||(n=a),void 0===n&&(n=!1),t.addEventListener(e.toString(),r,n);else if(t.attachEvent)t.attachEvent(me(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return i}function fe(t,e,i,r,n){if(Array.isArray(e)){for(var s=0;s<e.length;s++)fe(t,e[s],i,r,n);return null}return i=be(i),t&&t[ie]?t.O(e,i,ct(r)?!!r.capture:!!r,n):de(t,e,i,!0,r,n)}function ge(t,e,i,r,n){if(Array.isArray(e))for(var s=0;s<e.length;s++)ge(t,e[s],i,r,n);else r=ct(r)?!!r.capture:!!r,i=be(i),t&&t[ie]?(t=t.i,(e=String(e).toString())in t.g&&-1<(i=le(s=t.g[e],i,r,n))&&(se(s[i]),Array.prototype.splice.call(s,i,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=ye(t))&&(e=t.g[e.toString()],t=-1,e&&(t=le(e,i,r,n)),(i=-1<t?e[t]:null)&&pe(i))}function pe(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[ie])oe(e.i,t);else{var i=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(i,r,t.capture):e.detachEvent?e.detachEvent(me(i),r):e.addListener&&e.removeListener&&e.removeListener(r),(i=ye(e))?(oe(i,t),0==i.h&&(i.src=null,e[ue]=null)):se(t)}}}function me(t){return t in ce?ce[t]:ce[t]="on"+t}function ve(t,e){if(t.ca)t=!0;else{e=new te(e,this);var i=t.listener,r=t.ia||t.src;t.fa&&pe(t),t=i.call(r,e)}return t}function ye(t){return(t=t[ue])instanceof ae?t:null}var Te="__closure_events_fn_"+(1e9*Math.random()>>>0);function be(t){return"function"==typeof t?t:(t[Te]||(t[Te]=function(e){return t.handleEvent(e)}),t[Te])}function Ee(){yt.call(this),this.i=new ae(this),this.P=this,this.I=null}function Se(t,e){var i,r=t.I;if(r)for(i=[];r;r=r.I)i.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new Zt(e,t);else if(e instanceof Zt)e.target=e.target||t;else{var n=e;xt(e=new Zt(r,t),n)}if(n=!0,i)for(var s=i.length-1;0<=s;s--){var a=e.g=i[s];n=we(a,r,!0,e)&&n}if(n=we(a=e.g=t,r,!0,e)&&n,n=we(a,r,!1,e)&&n,i)for(s=0;s<i.length;s++)n=we(a=e.g=i[s],r,!1,e)&&n}function we(t,e,i,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var n=!0,s=0;s<e.length;++s){var a=e[s];if(a&&!a.ca&&a.capture==i){var o=a.listener,l=a.ia||a.src;a.fa&&oe(t.i,a),n=!1!==o.call(l,r)&&n}}return n&&!r.defaultPrevented}vt(Ee,yt),Ee.prototype[ie]=!0,Ee.prototype.removeEventListener=function(t,e,i,r){ge(this,t,e,i,r)},Ee.prototype.M=function(){if(Ee.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var i=e.g[t],r=0;r<i.length;r++)se(i[r]);delete e.g[t],e.h--}}this.I=null},Ee.prototype.N=function(t,e,i,r){return this.i.add(String(t),e,!1,i,r)},Ee.prototype.O=function(t,e,i,r){return this.i.add(String(t),e,!0,i,r)};var Ie=ot.JSON.stringify;function _e(){var t=Oe;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Ae,ke=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new De),(t=>t.reset()));class De{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Le(t){ot.setTimeout((()=>{throw t}),0)}function Re(t,e){Ae||function(){var t=ot.Promise.resolve(void 0);Ae=function(){t.then(Pe)}}(),Ce||(Ae(),Ce=!0),Oe.add(t,e)}var Ce=!1,Oe=new class{constructor(){this.h=this.g=null}add(t,e){const i=ke.get();i.set(t,e),this.h?this.h.next=i:this.g=i,this.h=i}};function Pe(){for(var t;t=_e();){try{t.h.call(t.g)}catch(t){Le(t)}var e=ke;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Ce=!1}function xe(t,e){Ee.call(this),this.h=t||1,this.g=e||ot,this.j=pt(this.kb,this),this.l=Date.now()}function Ne(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function Me(t,e,i){if("function"==typeof t)i&&(t=pt(t,i));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=pt(t.handleEvent,t)}return 2147483647<Number(e)?-1:ot.setTimeout(t,e||0)}function Fe(t){t.g=Me((()=>{t.g=null,t.i&&(t.i=!1,Fe(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}vt(xe,Ee),(rt=xe.prototype).da=!1,rt.S=null,rt.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Se(this,"tick"),this.da&&(Ne(this),this.start()))}},rt.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},rt.M=function(){xe.Z.M.call(this),Ne(this),delete this.g};class Ue extends yt{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Fe(this)}M(){super.M(),this.g&&(ot.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Be(t){yt.call(this),this.h=t,this.g={}}vt(Be,yt);var Ve=[];function je(t,e,i,r){Array.isArray(i)||(i&&(Ve[0]=i.toString()),i=Ve);for(var n=0;n<i.length;n++){var s=he(e,i[n],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function Ge(t){Ct(t.g,(function(t,e){this.g.hasOwnProperty(e)&&pe(t)}),t),t.g={}}function Ke(){this.g=!0}function He(t,e,i,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var i=JSON.parse(e);if(i)for(t=0;t<i.length;t++)if(Array.isArray(i[t])){var r=i[t];if(!(2>r.length)){var n=r[1];if(Array.isArray(n)&&!(1>n.length)){var s=n[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var a=1;a<n.length;a++)n[a]=""}}}return Ie(i)}catch(t){return e}}(t,i)+(r?" "+r:"")}))}Be.prototype.M=function(){Be.Z.M.call(this),Ge(this)},Be.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ke.prototype.Aa=function(){this.g=!1},Ke.prototype.info=function(){};var qe={},We=null;function ze(){return We=We||new Ee}function Ye(t){Zt.call(this,qe.Ma,t)}function $e(t){const e=ze();Se(e,new Ye(e,t))}function Xe(t,e){Zt.call(this,qe.STAT_EVENT,t),this.stat=e}function Qe(t){const e=ze();Se(e,new Xe(e,t))}function Je(t,e){Zt.call(this,qe.Na,t),this.size=e}function Ze(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return ot.setTimeout((function(){t()}),e)}qe.Ma="serverreachability",vt(Ye,Zt),qe.STAT_EVENT="statevent",vt(Xe,Zt),qe.Na="timingevent",vt(Je,Zt);var ti={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},ei={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function ii(){}function ri(t){return t.h||(t.h=t.i())}function ni(){}ii.prototype.h=null;var si,ai={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function oi(){Zt.call(this,"d")}function li(){Zt.call(this,"c")}function ui(){}function ci(t,e,i,r){this.l=t,this.j=e,this.m=i,this.X=r||1,this.V=new Be(this),this.P=di,t=jt?125:void 0,this.W=new xe(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new hi}function hi(){this.i=null,this.g="",this.h=!1}vt(oi,Zt),vt(li,Zt),vt(ui,ii),ui.prototype.g=function(){return new XMLHttpRequest},ui.prototype.i=function(){return{}},si=new ui;var di=45e3,fi={},gi={};function pi(t,e,i){t.K=1,t.v=Ui(Oi(e)),t.s=i,t.U=!0,mi(t,null)}function mi(t,e){t.F=Date.now(),bi(t),t.A=Oi(t.v);var i=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),Qi(i.h,"t",r),t.C=0,i=t.l.H,t.h=new hi,t.g=Qr(t.l,i?e:null,!t.s),0<t.O&&(t.L=new Ue(pt(t.Ia,t,t.g),t.O)),je(t.V,t.g,"readystatechange",t.gb),e=t.H?Ot(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),$e(1),function(t,e,i,r,n,s){t.info((function(){if(t.g)if(s)for(var a="",o=s.split("&"),l=0;l<o.length;l++){var u=o[l].split("=");if(1<u.length){var c=u[0];u=u[1];var h=c.split("_");a=2<=h.length&&"type"==h[1]?a+(c+"=")+u+"&":a+(c+"=redacted&")}}else a=null;else a=s;return"XMLHTTP REQ ("+r+") [attempt "+n+"]: "+e+"\n"+i+"\n"+a}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function vi(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function yi(t,e,i){let r,n=!0;for(;!t.I&&t.C<i.length;){if(r=Ti(t,i),r==gi){4==e&&(t.o=4,Qe(14),n=!1),He(t.j,t.m,null,"[Incomplete Response]");break}if(r==fi){t.o=4,Qe(15),He(t.j,t.m,i,"[Invalid Chunk]"),n=!1;break}He(t.j,t.m,r,null),_i(t,r)}vi(t)&&r!=gi&&r!=fi&&(t.h.g="",t.C=0),4!=e||0!=i.length||t.h.h||(t.o=1,Qe(16),n=!1),t.i=t.i&&n,n?0<i.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+i.length),Kr(e),e.L=!0,Qe(11))):(He(t.j,t.m,i,"[Invalid Chunked Response]"),Ii(t),wi(t))}function Ti(t,e){var i=t.C,r=e.indexOf("\n",i);return-1==r?gi:(i=Number(e.substring(i,r)),isNaN(i)?fi:(r+=1)+i>e.length?gi:(e=e.substr(r,i),t.C=r+i,e))}function bi(t){t.Y=Date.now()+t.P,Ei(t,t.P)}function Ei(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Ze(pt(t.eb,t),e)}function Si(t){t.B&&(ot.clearTimeout(t.B),t.B=null)}function wi(t){0==t.l.G||t.I||Wr(t.l,t)}function Ii(t){Si(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Ne(t.W),Ge(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function _i(t,e){try{var i=t.l;if(0!=i.G&&(i.g==t||rr(i.i,t)))if(i.I=t.N,!t.J&&rr(i.i,t)&&3==i.G){try{var r=i.Ca.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var n=r;if(0==n[0]){t:if(!i.u){if(i.g){if(!(i.g.F+3e3<t.F))break t;qr(i),xr(i)}Gr(i),Qe(18)}}else i.ta=n[1],0<i.ta-i.U&&37500>n[2]&&i.N&&0==i.A&&!i.v&&(i.v=Ze(pt(i.ab,i),6e3));if(1>=ir(i.i)&&i.ka){try{i.ka()}catch(t){}i.ka=void 0}}else Yr(i,11)}else if((t.J||i.g==t)&&qr(i),!It(e))for(n=i.Ca.g.parse(e),e=0;e<n.length;e++){let u=n[e];if(i.U=u[0],u=u[1],2==i.G)if("c"==u[0]){i.J=u[1],i.la=u[2];const e=u[3];null!=e&&(i.ma=e,i.h.info("VER="+i.ma));const n=u[4];null!=n&&(i.za=n,i.h.info("SVER="+i.za));const c=u[5];null!=c&&"number"==typeof c&&0<c&&(r=1.5*c,i.K=r,i.h.info("backChannelRequestTimeoutMs_="+r)),r=i;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.i;!s.g&&(kt(t,"spdy")||kt(t,"quic")||kt(t,"h2"))&&(s.j=s.l,s.g=new Set,s.h&&(nr(s,s.h),s.h=null))}if(r.D){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.sa=t,Fi(r.F,r.D,t))}}i.G=3,i.j&&i.j.xa(),i.$&&(i.O=Date.now()-t.F,i.h.info("Handshake RTT: "+i.O+"ms"));var a=t;if((r=i).oa=Xr(r,r.H?r.la:null,r.W),a.J){sr(r.i,a);var o=a,l=r.K;l&&o.setTimeout(l),o.B&&(Si(o),bi(o)),r.g=a}else jr(r);0<i.l.length&&Fr(i)}else"stop"!=u[0]&&"close"!=u[0]||Yr(i,7);else 3==i.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Yr(i,7):Pr(i):"noop"!=u[0]&&i.j&&i.j.wa(u),i.A=0)}$e(4)}catch(t){}}function Ai(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(ut(t)||"string"==typeof t)Et(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var i=t.T();else if(t.R&&"function"==typeof t.R)i=void 0;else if(ut(t)||"string"==typeof t){i=[];for(var r=t.length,n=0;n<r;n++)i.push(n)}else for(n in i=[],r=0,t)i[r++]=n;r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(ut(t)){for(var e=[],i=t.length,r=0;r<i;r++)e.push(t[r]);return e}for(r in e=[],i=0,t)e[i++]=t[r];return e}(t),n=r.length;for(var s=0;s<n;s++)e.call(void 0,r[s],i&&i[s],t)}}function ki(t,e){this.h={},this.g=[],this.i=0;var i=arguments.length;if(1<i){if(i%2)throw Error("Uneven number of arguments");for(var r=0;r<i;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ki)for(i=t.T(),r=0;r<i.length;r++)this.set(i[r],t.get(i[r]));else for(r in t)this.set(r,t[r])}function Di(t){if(t.i!=t.g.length){for(var e=0,i=0;e<t.g.length;){var r=t.g[e];Li(t.h,r)&&(t.g[i++]=r),e++}t.g.length=i}if(t.i!=t.g.length){var n={};for(i=e=0;e<t.g.length;)Li(n,r=t.g[e])||(t.g[i++]=r,n[r]=1),e++;t.g.length=i}}function Li(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(rt=ci.prototype).setTimeout=function(t){this.P=t},rt.gb=function(t){t=t.target;const e=this.L;e&&3==Dr(t)?e.l():this.Ia(t)},rt.Ia=function(t){try{if(t==this.g)t:{const c=Dr(this.g);var e=this.g.Da();const h=this.g.ba();if(!(3>c)&&(3!=c||jt||this.g&&(this.h.h||this.g.ga()||Lr(this.g)))){this.I||4!=c||7==e||$e(8==e||0>=h?3:2),Si(this);var i=this.g.ba();this.N=i;e:if(vi(this)){var r=Lr(this.g);t="";var n=r.length,s=4==Dr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ii(this),wi(this);var a="";break e}this.h.i=new ot.TextDecoder}for(e=0;e<n;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==n-1});r.splice(0,n),this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.ga();if(this.i=200==i,function(t,e,i,r,n,s,a){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+n+"]: "+e+"\n"+i+"\n"+s+" "+a}))}(this.j,this.u,this.A,this.m,this.X,c,i),this.i){if(this.$&&!this.J){e:{if(this.g){var o,l=this.g;if((o=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!It(o)){var u=o;break e}}u=null}if(!(i=u)){this.i=!1,this.o=3,Qe(12),Ii(this),wi(this);break t}He(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,_i(this,i)}this.U?(yi(this,c,a),jt&&this.i&&3==c&&(je(this.V,this.W,"tick",this.fb),this.W.start())):(He(this.j,this.m,a,null),_i(this,a)),4==c&&Ii(this),this.i&&!this.I&&(4==c?Wr(this.l,this):(this.i=!1,bi(this)))}else 400==i&&0<a.indexOf("Unknown SID")?(this.o=3,Qe(12)):(this.o=0,Qe(13)),Ii(this),wi(this)}}}catch(t){}},rt.fb=function(){if(this.g){var t=Dr(this.g),e=this.g.ga();this.C<e.length&&(Si(this),yi(this,t,e),this.i&&4!=t&&bi(this))}},rt.cancel=function(){this.I=!0,Ii(this)},rt.eb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&($e(3),Qe(17)),Ii(this),this.o=2,wi(this)):Ei(this,this.Y-t)},(rt=ki.prototype).R=function(){Di(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},rt.T=function(){return Di(this),this.g.concat()},rt.get=function(t,e){return Li(this.h,t)?this.h[t]:e},rt.set=function(t,e){Li(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},rt.forEach=function(t,e){for(var i=this.T(),r=0;r<i.length;r++){var n=i[r],s=this.get(n);t.call(e,s,n,this)}};var Ri=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ci(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Ci){this.g=void 0!==e?e:t.g,Pi(this,t.j),this.s=t.s,xi(this,t.i),Ni(this,t.m),this.l=t.l,e=t.h;var i=new zi;i.i=e.i,e.g&&(i.g=new ki(e.g),i.h=e.h),Mi(this,i),this.o=t.o}else t&&(i=String(t).match(Ri))?(this.g=!!e,Pi(this,i[1]||"",!0),this.s=Bi(i[2]||""),xi(this,i[3]||"",!0),Ni(this,i[4]),this.l=Bi(i[5]||"",!0),Mi(this,i[6]||"",!0),this.o=Bi(i[7]||"")):(this.g=!!e,this.h=new zi(null,this.g))}function Oi(t){return new Ci(t)}function Pi(t,e,i){t.j=i?Bi(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function xi(t,e,i){t.i=i?Bi(e,!0):e}function Ni(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Mi(t,e,i){e instanceof zi?(t.h=e,function(t,e){e&&!t.j&&(Yi(t),t.i=null,t.g.forEach((function(t,e){var i=e.toLowerCase();e!=i&&($i(this,e),Qi(this,i,t))}),t)),t.j=e}(t.h,t.g)):(i||(e=Vi(e,qi)),t.h=new zi(e,t.g))}function Fi(t,e,i){t.h.set(e,i)}function Ui(t){return Fi(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Bi(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Vi(t,e,i){return"string"==typeof t?(t=encodeURI(t).replace(e,ji),i&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ji(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ci.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Vi(e,Gi,!0),":");var i=this.i;return(i||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Vi(e,Gi,!0),"@"),t.push(encodeURIComponent(String(i)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(i=this.m)&&t.push(":",String(i))),(i=this.l)&&(this.i&&"/"!=i.charAt(0)&&t.push("/"),t.push(Vi(i,"/"==i.charAt(0)?Hi:Ki,!0))),(i=this.h.toString())&&t.push("?",i),(i=this.o)&&t.push("#",Vi(i,Wi)),t.join("")};var Gi=/[#\/\?@]/g,Ki=/[#\?:]/g,Hi=/[#\?]/g,qi=/[#\?@]/g,Wi=/#/g;function zi(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Yi(t){t.g||(t.g=new ki,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var i=0;i<t.length;i++){var r=t[i].indexOf("="),n=null;if(0<=r){var s=t[i].substring(0,r);n=t[i].substring(r+1)}else s=t[i];e(s,n?decodeURIComponent(n.replace(/\+/g," ")):"")}}}(t.i,(function(e,i){t.add(decodeURIComponent(e.replace(/\+/g," ")),i)})))}function $i(t,e){Yi(t),e=Ji(t,e),Li(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Li((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Di(t)))}function Xi(t,e){return Yi(t),e=Ji(t,e),Li(t.g.h,e)}function Qi(t,e,i){$i(t,e),0<i.length&&(t.i=null,t.g.set(Ji(t,e),wt(i)),t.h+=i.length)}function Ji(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Zi(t){this.l=t||tr,t=ot.PerformanceNavigationTiming?0<(t=ot.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(ot.g&&ot.g.Ea&&ot.g.Ea()&&ot.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(rt=zi.prototype).add=function(t,e){Yi(this),this.i=null,t=Ji(this,t);var i=this.g.get(t);return i||this.g.set(t,i=[]),i.push(e),this.h+=1,this},rt.forEach=function(t,e){Yi(this),this.g.forEach((function(i,r){Et(i,(function(i){t.call(e,i,r,this)}),this)}),this)},rt.T=function(){Yi(this);for(var t=this.g.R(),e=this.g.T(),i=[],r=0;r<e.length;r++)for(var n=t[r],s=0;s<n.length;s++)i.push(e[r]);return i},rt.R=function(t){Yi(this);var e=[];if("string"==typeof t)Xi(this,t)&&(e=St(e,this.g.get(Ji(this,t))));else{t=this.g.R();for(var i=0;i<t.length;i++)e=St(e,t[i])}return e},rt.set=function(t,e){return Yi(this),this.i=null,Xi(this,t=Ji(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},rt.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},rt.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),i=0;i<e.length;i++){var r=e[i],n=encodeURIComponent(String(r));r=this.R(r);for(var s=0;s<r.length;s++){var a=n;""!==r[s]&&(a+="="+encodeURIComponent(String(r[s]))),t.push(a)}}return this.i=t.join("&")};var tr=10;function er(t){return!!t.h||!!t.g&&t.g.size>=t.j}function ir(t){return t.h?1:t.g?t.g.size:0}function rr(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function nr(t,e){t.g?t.g.add(e):t.h=e}function sr(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ar(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const i of t.g.values())e=e.concat(i.D);return e}return wt(t.i)}function or(){}function lr(){this.g=new or}function ur(t,e,i){const r=i||"";try{Ai(t,(function(t,i){let n=t;ct(t)&&(n=Ie(t)),e.push(r+i+"="+encodeURIComponent(n))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function cr(t,e,i,r,n){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,n(r)}catch(t){}}function hr(t){this.l=t.$b||null,this.j=t.ib||!1}function dr(t,e){Ee.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=fr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Zi.prototype.cancel=function(){if(this.i=ar(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},or.prototype.stringify=function(t){return ot.JSON.stringify(t,void 0)},or.prototype.parse=function(t){return ot.JSON.parse(t,void 0)},vt(hr,ii),hr.prototype.g=function(){return new dr(this.l,this.j)},hr.prototype.i=function(t){return function(){return t}}({}),vt(dr,Ee);var fr=0;function gr(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function pr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,mr(t)}function mr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(rt=dr.prototype).open=function(t,e){if(this.readyState!=fr)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,mr(this)},rt.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||ot).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},rt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,pr(this)),this.readyState=fr},rt.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,mr(this)),this.g&&(this.readyState=3,mr(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==ot.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;gr(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},rt.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?pr(this):mr(this),3==this.readyState&&gr(this)}},rt.Ua=function(t){this.g&&(this.response=this.responseText=t,pr(this))},rt.Ta=function(t){this.g&&(this.response=t,pr(this))},rt.ha=function(){this.g&&pr(this)},rt.setRequestHeader=function(t,e){this.v.append(t,e)},rt.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},rt.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var i=e.next();!i.done;)i=i.value,t.push(i[0]+": "+i[1]),i=e.next();return t.join("\r\n")},Object.defineProperty(dr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var vr=ot.JSON.parse;function yr(t){Ee.call(this),this.headers=new ki,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Tr,this.K=this.L=!1}vt(yr,Ee);var Tr="",br=/^https?$/i,Er=["POST","PUT"];function Sr(t){return"content-type"==t.toLowerCase()}function wr(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Ir(t),Ar(t)}function Ir(t){t.D||(t.D=!0,Se(t,"complete"),Se(t,"error"))}function _r(t){if(t.h&&void 0!==at&&(!t.C[1]||4!=Dr(t)||2!=t.ba()))if(t.v&&4==Dr(t))Me(t.Fa,0,t);else if(Se(t,"readystatechange"),4==Dr(t)){t.h=!1;try{const o=t.ba();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var i;if(!(i=e)){var r;if(r=0===o){var n=String(t.H).match(Ri)[1]||null;if(!n&&ot.self&&ot.self.location){var s=ot.self.location.protocol;n=s.substr(0,s.length-1)}r=!br.test(n?n.toLowerCase():"")}i=r}if(i)Se(t,"complete"),Se(t,"success");else{t.m=6;try{var a=2<Dr(t)?t.g.statusText:""}catch(t){a=""}t.j=a+" ["+t.ba()+"]",Ir(t)}}finally{Ar(t)}}}function Ar(t,e){if(t.g){kr(t);const i=t.g,r=t.C[0]?lt:null;t.g=null,t.C=null,e||Se(t,"ready");try{i.onreadystatechange=r}catch(t){}}}function kr(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(ot.clearTimeout(t.A),t.A=null)}function Dr(t){return t.g?t.g.readyState:0}function Lr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Tr:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Rr(t,e,i){t:{for(r in i){var r=!1;break t}r=!0}r||(i=function(t){let e="";return Ct(t,(function(t,i){e+=i,e+=":",e+=t,e+="\r\n"})),e}(i),"string"==typeof t?null!=i&&encodeURIComponent(String(i)):Fi(t,e,i))}function Cr(t,e,i){return i&&i.internalChannelParams&&i.internalChannelParams[t]||e}function Or(t){this.za=0,this.l=[],this.h=new Ke,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Cr("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Cr("baseRetryDelayMs",5e3,t),this.$a=Cr("retryDelaySeedMs",1e4,t),this.Ya=Cr("forwardChannelMaxRetries",2,t),this.ra=Cr("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new Zi(t&&t.concurrentRequestLimit),this.Ca=new lr,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Pr(t){if(Nr(t),3==t.G){var e=t.V++,i=Oi(t.F);Fi(i,"SID",t.J),Fi(i,"RID",e),Fi(i,"TYPE","terminate"),Br(t,i),(e=new ci(t,t.h,e,void 0)).K=2,e.v=Ui(Oi(i)),i=!1,ot.navigator&&ot.navigator.sendBeacon&&(i=ot.navigator.sendBeacon(e.v.toString(),"")),!i&&ot.Image&&((new Image).src=e.v,i=!0),i||(e.g=Qr(e.l,null),e.g.ea(e.v)),e.F=Date.now(),bi(e)}$r(t)}function xr(t){t.g&&(Kr(t),t.g.cancel(),t.g=null)}function Nr(t){xr(t),t.u&&(ot.clearTimeout(t.u),t.u=null),qr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&ot.clearTimeout(t.m),t.m=null)}function Mr(t,e){t.l.push(new class{constructor(t,e){this.h=t,this.g=e}}(t.Za++,e)),3==t.G&&Fr(t)}function Fr(t){er(t.i)||t.m||(t.m=!0,Re(t.Ha,t),t.C=0)}function Ur(t,e){var i;i=e?e.m:t.V++;const r=Oi(t.F);Fi(r,"SID",t.J),Fi(r,"RID",i),Fi(r,"AID",t.U),Br(t,r),t.o&&t.s&&Rr(r,t.o,t.s),i=new ci(t,t.h,i,t.C+1),null===t.o&&(i.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Vr(t,i,1e3),i.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),nr(t.i,i),pi(i,r,e)}function Br(t,e){t.j&&Ai({},(function(t,i){Fi(e,i,t)}))}function Vr(t,e,i){i=Math.min(t.l.length,i);var r=t.j?pt(t.j.Oa,t.j,t):null;t:{var n=t.l;let e=-1;for(;;){const t=["count="+i];-1==e?0<i?(e=n[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let a=0;a<i;a++){let i=n[a].h;const o=n[a].g;if(i-=e,0>i)e=Math.max(0,n[a].h-100),s=!1;else try{ur(o,t,"req"+i+"_")}catch(t){r&&r(o)}}if(s){r=t.join("&");break t}}}return t=t.l.splice(0,i),e.D=t,r}function jr(t){t.g||t.u||(t.Y=1,Re(t.Ga,t),t.A=0)}function Gr(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=Ze(pt(t.Ga,t),zr(t,t.A)),t.A++,0))}function Kr(t){null!=t.B&&(ot.clearTimeout(t.B),t.B=null)}function Hr(t){t.g=new ci(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Oi(t.oa);Fi(e,"RID","rpc"),Fi(e,"SID",t.J),Fi(e,"CI",t.N?"0":"1"),Fi(e,"AID",t.U),Br(t,e),Fi(e,"TYPE","xmlhttp"),t.o&&t.s&&Rr(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var i=t.g;t=t.la,i.K=1,i.v=Ui(Oi(e)),i.s=null,i.U=!0,mi(i,t)}function qr(t){null!=t.v&&(ot.clearTimeout(t.v),t.v=null)}function Wr(t,e){var i=null;if(t.g==e){qr(t),Kr(t),t.g=null;var r=2}else{if(!rr(t.i,e))return;i=e.D,sr(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){i=e.s?e.s.length:0,e=Date.now()-e.F;var n=t.C;Se(r=ze(),new Je(r,i,e,n)),Fr(t)}else jr(t);else if(3==(n=e.o)||0==n&&0<t.I||!(1==r&&function(t,e){return!(ir(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Ze(pt(t.Ha,t,e),zr(t,t.C)),t.C++,0)))}(t,e)||2==r&&Gr(t)))switch(i&&0<i.length&&(e=t.i,e.i=e.i.concat(i)),n){case 1:Yr(t,5);break;case 4:Yr(t,10);break;case 3:Yr(t,6);break;default:Yr(t,2)}}function zr(t,e){let i=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(i*=2),i*e}function Yr(t,e){if(t.h.info("Error code "+e),2==e){var i=null;t.j&&(i=null);var r=pt(t.jb,t);i||(i=new Ci("//www.google.com/images/cleardot.gif"),ot.location&&"http"==ot.location.protocol||Pi(i,"https"),Ui(i)),function(t,e){const i=new Ke;if(ot.Image){const r=new Image;r.onload=mt(cr,i,r,"TestLoadImage: loaded",!0,e),r.onerror=mt(cr,i,r,"TestLoadImage: error",!1,e),r.onabort=mt(cr,i,r,"TestLoadImage: abort",!1,e),r.ontimeout=mt(cr,i,r,"TestLoadImage: timeout",!1,e),ot.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(i.toString(),r)}else Qe(2);t.G=0,t.j&&t.j.va(e),$r(t),Nr(t)}function $r(t){t.G=0,t.I=-1,t.j&&(0==ar(t.i).length&&0==t.l.length||(t.i.i.length=0,wt(t.l),t.l.length=0),t.j.ua())}function Xr(t,e,i){let r=function(t){return t instanceof Ci?Oi(t):new Ci(t,void 0)}(i);if(""!=r.i)e&&xi(r,e+"."+r.i),Ni(r,r.m);else{const t=ot.location;r=function(t,e,i,r){var n=new Ci(null,void 0);return t&&Pi(n,t),e&&xi(n,e),i&&Ni(n,i),r&&(n.l=r),n}(t.protocol,e?e+"."+t.hostname:t.hostname,+t.port,i)}return t.aa&&Ct(t.aa,(function(t,e){Fi(r,e,t)})),e=t.D,i=t.sa,e&&i&&Fi(r,e,i),Fi(r,"VER",t.ma),Br(t,r),r}function Qr(t,e,i){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=i&&t.Ba&&!t.qa?new yr(new hr({ib:!0})):new yr(t.qa)).L=t.H,e}function Jr(){}function Zr(){if(Bt&&!(10<=Number(Qt)))throw Error("Environmental error: no available transport.")}function tn(t,e){Ee.call(this),this.g=new Or(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!It(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!It(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new nn(this)}function en(t){oi.call(this);var e=t.__sm__;if(e){t:{for(const i in e){t=i;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function rn(){li.call(this),this.status=1}function nn(t){this.g=t}(rt=yr.prototype).ea=function(t,e,i,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():si.g(),this.C=this.u?ri(this.u):ri(si),this.g.onreadystatechange=pt(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void wr(this,t)}t=i||"";const n=new ki(this.headers);r&&Ai(r,(function(t,e){n.set(e,t)})),r=function(t){t:{var e=Sr;const i=t.length,r="string"==typeof t?t.split(""):t;for(let n=0;n<i;n++)if(n in r&&e.call(void 0,r[n],n,t)){e=n;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(n.T()),i=ot.FormData&&t instanceof ot.FormData,!(0<=bt(Er,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),n.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{kr(this),0<this.B&&((this.K=function(t){return Bt&&Xt()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=pt(this.pa,this)):this.A=Me(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){wr(this,t)}},rt.pa=function(){void 0!==at&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Se(this,"timeout"),this.abort(8))},rt.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Se(this,"complete"),Se(this,"abort"),Ar(this))},rt.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ar(this,!0)),yr.Z.M.call(this)},rt.Fa=function(){this.s||(this.F||this.v||this.l?_r(this):this.cb())},rt.cb=function(){_r(this)},rt.ba=function(){try{return 2<Dr(this)?this.g.status:-1}catch(t){return-1}},rt.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},rt.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),vr(e)}},rt.Da=function(){return this.m},rt.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(rt=Or.prototype).ma=8,rt.G=1,rt.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},rt.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const n=new ci(this,this.h,t,void 0);let s=this.s;if(this.P&&(s?(s=Ot(s),xt(s,this.P)):s=this.P),null===this.o&&(n.H=s),this.ja)t:{for(var e=0,i=0;i<this.l.length;i++){var r=this.l[i];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=i;break t}if(4096===e||i===this.l.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Vr(this,n,e),Fi(i=Oi(this.F),"RID",t),Fi(i,"CVER",22),this.D&&Fi(i,"X-HTTP-Session-Id",this.D),Br(this,i),this.o&&s&&Rr(i,this.o,s),nr(this.i,n),this.Ra&&Fi(i,"TYPE","init"),this.ja?(Fi(i,"$req",e),Fi(i,"SID","null"),n.$=!0,pi(n,i,null)):pi(n,i,e),this.G=2}}else 3==this.G&&(t?Ur(this,t):0==this.l.length||er(this.i)||Ur(this))},rt.Ga=function(){if(this.u=null,Hr(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Ze(pt(this.bb,this),t)}},rt.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,Qe(10),xr(this),Hr(this))},rt.ab=function(){null!=this.v&&(this.v=null,xr(this),Gr(this),Qe(19))},rt.jb=function(t){t?(this.h.info("Successfully pinged google.com"),Qe(2)):(this.h.info("Failed to ping google.com"),Qe(1))},(rt=Jr.prototype).xa=function(){},rt.wa=function(){},rt.va=function(){},rt.ua=function(){},rt.Oa=function(){},Zr.prototype.g=function(t,e){return new tn(t,e)},vt(tn,Ee),tn.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,i=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Re(pt(t.hb,t,e))),Qe(0),t.W=e,t.aa=i||{},t.N=t.X,t.F=Xr(t,null,t.W),Fr(t)},tn.prototype.close=function(){Pr(this.g)},tn.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Mr(this.g,e)}else this.v?((e={}).__data__=Ie(t),Mr(this.g,e)):Mr(this.g,t)},tn.prototype.M=function(){this.g.j=null,delete this.j,Pr(this.g),delete this.g,tn.Z.M.call(this)},vt(en,oi),vt(rn,li),vt(nn,Jr),nn.prototype.xa=function(){Se(this.g,"a")},nn.prototype.wa=function(t){Se(this.g,new en(t))},nn.prototype.va=function(t){Se(this.g,new rn(t))},nn.prototype.ua=function(){Se(this.g,"b")},Zr.prototype.createWebChannel=Zr.prototype.g,tn.prototype.send=tn.prototype.u,tn.prototype.open=tn.prototype.m,tn.prototype.close=tn.prototype.close,ti.NO_ERROR=0,ti.TIMEOUT=8,ti.HTTP_ERROR=6,ei.COMPLETE="complete",ni.EventType=ai,ai.OPEN="a",ai.CLOSE="b",ai.ERROR="c",ai.MESSAGE="d",Ee.prototype.listen=Ee.prototype.N,yr.prototype.listenOnce=yr.prototype.O,yr.prototype.getLastError=yr.prototype.La,yr.prototype.getLastErrorCode=yr.prototype.Da,yr.prototype.getStatus=yr.prototype.ba,yr.prototype.getResponseJson=yr.prototype.Qa,yr.prototype.getResponseText=yr.prototype.ga,yr.prototype.send=yr.prototype.ea;var sn=st.createWebChannelTransport=function(){return new Zr},an=st.getStatEventTarget=function(){return ze()},on=st.ErrorCode=ti,ln=st.EventType=ei,un=st.Event=qe,cn=st.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},hn=st.FetchXmlHttpFactory=hr,dn=st.WebChannel=ni,fn=st.XhrIo=yr;const gn="@firebase/firestore";class pn{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}pn.UNAUTHENTICATED=new pn(null),pn.GOOGLE_CREDENTIALS=new pn("google-credentials-uid"),pn.FIRST_PARTY=new pn("first-party-uid"),pn.MOCK_USER=new pn("mock-user");let mn="9.6.7";const vn=new O("@firebase/firestore");function yn(){return vn.logLevel}function Tn(t,...e){if(vn.logLevel<=A.DEBUG){const i=e.map(Sn);vn.debug(`Firestore (${mn}): ${t}`,...i)}}function bn(t,...e){if(vn.logLevel<=A.ERROR){const i=e.map(Sn);vn.error(`Firestore (${mn}): ${t}`,...i)}}function En(t,...e){if(vn.logLevel<=A.WARN){const i=e.map(Sn);vn.warn(`Firestore (${mn}): ${t}`,...i)}}function Sn(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function wn(t="Unexpected state"){const e=`FIRESTORE (${mn}) INTERNAL ASSERTION FAILED: `+t;throw bn(e),new Error(e)}function In(t,e){t||wn()}function _n(t,e){return t}const An={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class kn extends c{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Dn{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Ln{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Rn{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(pn.UNAUTHENTICATED)))}shutdown(){}}class Cn{constructor(t){this.t=t,this.currentUser=pn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let i=this.i;const r=t=>this.i!==i?(i=this.i,e(t)):Promise.resolve();let n=new Dn;this.o=()=>{this.i++,this.currentUser=this.u(),n.resolve(),n=new Dn,t.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const e=n;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},a=t=>{Tn("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>a(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?a(t):(Tn("FirebaseAuthCredentialsProvider","Auth not yet detected"),n.resolve(),n=new Dn)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Tn("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(In("string"==typeof e.accessToken),new Ln(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return In(null===t||"string"==typeof t),new pn(t)}}class On{constructor(t,e,i){this.type="FirstParty",this.user=pn.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",e);const r=t.auth.getAuthHeaderValueForFirstParty([]);r&&this.headers.set("Authorization",r),i&&this.headers.set("X-Goog-Iam-Authorization-Token",i)}}class Pn{constructor(t,e,i){this.h=t,this.l=e,this.m=i}getToken(){return Promise.resolve(new On(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(pn.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class xn{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Nn{constructor(t){this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(t,e){const i=t=>{null!=t.error&&Tn("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const i=t.token!==this.p;return this.p=t.token,Tn("FirebaseAppCheckTokenProvider",`Received ${i?"new":"existing"} token.`),i?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>i(e)))};const r=t=>{Tn("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.g.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.g.getImmediate({optional:!0});t?r(t):Tn("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(In("string"==typeof t.token),this.p=t.token,new xn(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class Mn{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.I(t),this.T=t=>e.writeSequenceNumber(t))}I(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.T&&this.T(t),t}}function Fn(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),i=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(i);else for(let e=0;e<t;e++)i[e]=Math.floor(256*Math.random());return i}Mn.A=-1;class Un{static R(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let i="";for(;i.length<20;){const r=Fn(40);for(let n=0;n<r.length;++n)i.length<20&&r[n]<e&&(i+=t.charAt(r[n]%t.length))}return i}}function Bn(t,e){return t<e?-1:t>e?1:0}function Vn(t,e,i){return t.length===e.length&&t.every(((t,r)=>i(t,e[r])))}class jn{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new kn(An.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new kn(An.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new kn(An.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new kn(An.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return jn.fromMillis(Date.now())}static fromDate(t){return jn.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),i=Math.floor(1e6*(t-1e3*e));return new jn(e,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Bn(this.nanoseconds,t.nanoseconds):Bn(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Gn{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Gn(t)}static min(){return new Gn(new jn(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Kn(t){let e=0;for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&e++;return e}function Hn(t,e){for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&e(i,t[i])}function qn(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Wn{constructor(t,e,i){void 0===e?e=0:e>t.length&&wn(),void 0===i?i=t.length-e:i>t.length-e&&wn(),this.segments=t,this.offset=e,this.len=i}get length(){return this.len}isEqual(t){return 0===Wn.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Wn?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,i=this.limit();e<i;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const i=Math.min(t.length,e.length);for(let r=0;r<i;r++){const i=t.get(r),n=e.get(r);if(i<n)return-1;if(i>n)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class zn extends Wn{construct(t,e,i){return new zn(t,e,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const i of t){if(i.indexOf("//")>=0)throw new kn(An.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);e.push(...i.split("/").filter((t=>t.length>0)))}return new zn(e)}static emptyPath(){return new zn([])}}const Yn=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class $n extends Wn{construct(t,e,i){return new $n(t,e,i)}static isValidIdentifier(t){return Yn.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),$n.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new $n(["__name__"])}static fromServerFormat(t){const e=[];let i="",r=0;const n=()=>{if(0===i.length)throw new kn(An.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(i),i=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new kn(An.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new kn(An.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);i+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(i+=e,r++):(n(),r++)}if(n(),s)throw new kn(An.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new $n(e)}static emptyPath(){return new $n([])}}class Xn{constructor(t){this.fields=t,t.sort($n.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Vn(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Qn{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new Qn(e)}static fromUint8Array(t){const e=function(t){let e="";for(let i=0;i<t.length;++i)e+=String.fromCharCode(t[i]);return e}(t);return new Qn(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Bn(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Qn.EMPTY_BYTE_STRING=new Qn("");const Jn=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Zn(t){if(In(!!t),"string"==typeof t){let e=0;const i=Jn.exec(t);if(In(!!i),i[1]){let t=i[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ts(t.seconds),nanos:ts(t.nanos)}}function ts(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function es(t){return"string"==typeof t?Qn.fromBase64String(t):Qn.fromUint8Array(t)}function is(t){var e,i;return"server_timestamp"===(null===(i=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===i?void 0:i.stringValue)}function rs(t){const e=t.mapValue.fields.__previous_value__;return is(e)?rs(e):e}function ns(t){const e=Zn(t.mapValue.fields.__local_write_time__.timestampValue);return new jn(e.seconds,e.nanos)}class ss{constructor(t,e,i,r,n,s,a,o){this.databaseId=t,this.appId=e,this.persistenceKey=i,this.host=r,this.ssl=n,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.useFetchStreams=o}}class as{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new as("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof as&&t.projectId===this.projectId&&t.database===this.database}}function os(t){return null==t}function ls(t){return 0===t&&1/t==-1/0}class us{constructor(t){this.path=t}static fromPath(t){return new us(zn.fromString(t))}static fromName(t){return new us(zn.fromString(t).popFirst(5))}static empty(){return new us(zn.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===zn.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return zn.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new us(new zn(t.slice()))}}const cs={mapValue:{fields:{__type__:{stringValue:"__max___"}}}};function hs(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?is(t)?4:10:wn()}function ds(t,e){if(t===e)return!0;const i=hs(t);if(i!==hs(e))return!1;switch(i){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ns(t).isEqual(ns(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const i=Zn(t.timestampValue),r=Zn(e.timestampValue);return i.seconds===r.seconds&&i.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return es(t.bytesValue).isEqual(es(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return ts(t.geoPointValue.latitude)===ts(e.geoPointValue.latitude)&&ts(t.geoPointValue.longitude)===ts(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return ts(t.integerValue)===ts(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const i=ts(t.doubleValue),r=ts(e.doubleValue);return i===r?ls(i)===ls(r):isNaN(i)&&isNaN(r)}return!1}(t,e);case 9:return Vn(t.arrayValue.values||[],e.arrayValue.values||[],ds);case 10:return function(t,e){const i=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Kn(i)!==Kn(r))return!1;for(const t in i)if(i.hasOwnProperty(t)&&(void 0===r[t]||!ds(i[t],r[t])))return!1;return!0}(t,e);default:return wn()}}function fs(t,e){return void 0!==(t.values||[]).find((t=>ds(t,e)))}function gs(t,e){if(t===e)return 0;const i=hs(t),r=hs(e);if(i!==r)return Bn(i,r);switch(i){case 0:return 0;case 1:return Bn(t.booleanValue,e.booleanValue);case 2:return function(t,e){const i=ts(t.integerValue||t.doubleValue),r=ts(e.integerValue||e.doubleValue);return i<r?-1:i>r?1:i===r?0:isNaN(i)?isNaN(r)?0:-1:1}(t,e);case 3:return ps(t.timestampValue,e.timestampValue);case 4:return ps(ns(t),ns(e));case 5:return Bn(t.stringValue,e.stringValue);case 6:return function(t,e){const i=es(t),r=es(e);return i.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const i=t.split("/"),r=e.split("/");for(let t=0;t<i.length&&t<r.length;t++){const e=Bn(i[t],r[t]);if(0!==e)return e}return Bn(i.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const i=Bn(ts(t.latitude),ts(e.latitude));return 0!==i?i:Bn(ts(t.longitude),ts(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const i=t.values||[],r=e.values||[];for(let t=0;t<i.length&&t<r.length;++t){const e=gs(i[t],r[t]);if(e)return e}return Bn(i.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const i=t.fields||{},r=Object.keys(i),n=e.fields||{},s=Object.keys(n);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=Bn(r[t],s[t]);if(0!==e)return e;const a=gs(i[r[t]],n[s[t]]);if(0!==a)return a}return Bn(r.length,s.length)}(t.mapValue,e.mapValue);default:throw wn()}}function ps(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Bn(t,e);const i=Zn(t),r=Zn(e),n=Bn(i.seconds,r.seconds);return 0!==n?n:Bn(i.nanos,r.nanos)}function ms(t){return vs(t)}function vs(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Zn(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?es(t.bytesValue).toBase64():"referenceValue"in t?(i=t.referenceValue,us.fromName(i).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",i=!0;for(const r of t.values||[])i?i=!1:e+=",",e+=vs(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let i="{",r=!0;for(const n of e)r?r=!1:i+=",",i+=`${n}:${vs(t.fields[n])}`;return i+"}"}(t.mapValue):wn();var e,i}function ys(t){return!!t&&"integerValue"in t}function Ts(t){return!!t&&"arrayValue"in t}function bs(t){return!!t&&"nullValue"in t}function Es(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ss(t){return!!t&&"mapValue"in t}function ws(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Hn(t.mapValue.fields,((t,i)=>e.mapValue.fields[t]=ws(i))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let i=0;i<(t.arrayValue.values||[]).length;++i)e.arrayValue.values[i]=ws(t.arrayValue.values[i]);return e}return Object.assign({},t)}class Is{constructor(t){this.value=t}static empty(){return new Is({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let i=0;i<t.length-1;++i)if(e=(e.mapValue.fields||{})[t.get(i)],!Ss(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ws(e)}setAll(t){let e=$n.emptyPath(),i={},r=[];t.forEach(((t,n)=>{if(!e.isImmediateParentOf(n)){const t=this.getFieldsMap(e);this.applyChanges(t,i,r),i={},r=[],e=n.popLast()}t?i[n.lastSegment()]=ws(t):r.push(n.lastSegment())}));const n=this.getFieldsMap(e);this.applyChanges(n,i,r)}delete(t){const e=this.field(t.popLast());Ss(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ds(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let i=0;i<t.length;++i){let r=e.mapValue.fields[t.get(i)];Ss(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(i)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,i){Hn(e,((e,i)=>t[e]=i));for(const e of i)delete t[e]}clone(){return new Is(ws(this.value))}}function _s(t){const e=[];return Hn(t.fields,((t,i)=>{const r=new $n([t]);if(Ss(i)){const t=_s(i.mapValue).fields;if(0===t.length)e.push(r);else for(const i of t)e.push(r.child(i))}else e.push(r)})),new Xn(e)}class As{constructor(t,e,i,r,n,s){this.key=t,this.documentType=e,this.version=i,this.readTime=r,this.data=n,this.documentState=s}static newInvalidDocument(t){return new As(t,0,Gn.min(),Gn.min(),Is.empty(),0)}static newFoundDocument(t,e,i){return new As(t,1,e,Gn.min(),i,0)}static newNoDocument(t,e){return new As(t,2,e,Gn.min(),Is.empty(),0)}static newUnknownDocument(t,e){return new As(t,3,e,Gn.min(),Is.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Is.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Is.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof As&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new As(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ks{constructor(t,e=null,i=[],r=[],n=null,s=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=i,this.filters=r,this.limit=n,this.startAt=s,this.endAt=a,this.P=null}}function Ds(t,e=null,i=[],r=[],n=null,s=null,a=null){return new ks(t,e,i,r,n,s,a)}function Ls(t){const e=_n(t);if(null===e.P){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>{return(e=t).field.canonicalString()+e.op.toString()+ms(e.value);var e})).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),os(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>ms(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>ms(t))).join(",")),e.P=t}return e.P}function Rs(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let i=0;i<t.orderBy.length;i++)if(!Ks(t.orderBy[i],e.orderBy[i]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(i=t.filters[n],r=e.filters[n],i.op!==r.op||!i.field.isEqual(r.field)||!ds(i.value,r.value))return!1;var i,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!qs(t.startAt,e.startAt)&&qs(t.endAt,e.endAt)}function Cs(t){return us.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Os extends class{}{constructor(t,e,i){super(),this.field=t,this.op=e,this.value=i}static create(t,e,i){return t.isKeyField()?"in"===e||"not-in"===e?this.v(t,e,i):new Ps(t,e,i):"array-contains"===e?new Fs(t,i):"in"===e?new Us(t,i):"not-in"===e?new Bs(t,i):"array-contains-any"===e?new Vs(t,i):new Os(t,e,i)}static v(t,e,i){return"in"===e?new xs(t,i):new Ns(t,i)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.V(gs(e,this.value)):null!==e&&hs(this.value)===hs(e)&&this.V(gs(e,this.value))}V(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return wn()}}S(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Ps extends Os{constructor(t,e,i){super(t,e,i),this.key=us.fromName(i.referenceValue)}matches(t){const e=us.comparator(t.key,this.key);return this.V(e)}}class xs extends Os{constructor(t,e){super(t,"in",e),this.keys=Ms(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Ns extends Os{constructor(t,e){super(t,"not-in",e),this.keys=Ms(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Ms(t,e){var i;return((null===(i=e.arrayValue)||void 0===i?void 0:i.values)||[]).map((t=>us.fromName(t.referenceValue)))}class Fs extends Os{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Ts(e)&&fs(e.arrayValue,this.value)}}class Us extends Os{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&fs(this.value.arrayValue,e)}}class Bs extends Os{constructor(t,e){super(t,"not-in",e)}matches(t){if(fs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!fs(this.value.arrayValue,e)}}class Vs extends Os{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Ts(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>fs(this.value.arrayValue,t)))}}class js{constructor(t,e){this.position=t,this.inclusive=e}}class Gs{constructor(t,e="asc"){this.field=t,this.dir=e}}function Ks(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function Hs(t,e,i){let r=0;for(let n=0;n<t.position.length;n++){const s=e[n],a=t.position[n];if(r=s.field.isKeyField()?us.comparator(us.fromName(a.referenceValue),i.key):gs(a,i.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function qs(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let i=0;i<t.position.length;i++)if(!ds(t.position[i],e.position[i]))return!1;return!0}class Ws{constructor(t,e=null,i=[],r=[],n=null,s="F",a=null,o=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=i,this.filters=r,this.limit=n,this.limitType=s,this.startAt=a,this.endAt=o,this.D=null,this.C=null,this.startAt,this.endAt}}function zs(t){return new Ws(t)}function Ys(t){return!os(t.limit)&&"F"===t.limitType}function $s(t){return!os(t.limit)&&"L"===t.limitType}function Xs(t){const e=_n(t);if(null===e.D){e.D=[];const t=function(t){for(const e of t.filters)if(e.S())return e.field;return null}(e),i=function(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}(e);if(null!==t&&null===i)t.isKeyField()||e.D.push(new Gs(t)),e.D.push(new Gs($n.keyField(),"asc"));else{let t=!1;for(const i of e.explicitOrderBy)e.D.push(i),i.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.D.push(new Gs($n.keyField(),t))}}}return e.D}function Qs(t){const e=_n(t);if(!e.C)if("F"===e.limitType)e.C=Ds(e.path,e.collectionGroup,Xs(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const i of Xs(e)){const e="desc"===i.dir?"asc":"desc";t.push(new Gs(i.field,e))}const i=e.endAt?new js(e.endAt.position,!e.endAt.inclusive):null,r=e.startAt?new js(e.startAt.position,!e.startAt.inclusive):null;e.C=Ds(e.path,e.collectionGroup,t,e.filters,e.limit,i,r)}return e.C}function Js(t,e){return Rs(Qs(t),Qs(e))&&t.limitType===e.limitType}function Zs(t){return`${Ls(Qs(t))}|lt:${t.limitType}`}function ta(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${ms(e.value)}`;var e})).join(", ")}]`),os(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>ms(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>ms(t))).join(",")),`Target(${e})`}(Qs(t))}; limitType=${t.limitType})`}function ea(t,e){return e.isFoundDocument()&&function(t,e){const i=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(i):us.isDocumentKey(t.path)?t.path.isEqual(i):t.path.isImmediateParentOf(i)}(t,e)&&function(t,e){for(const i of t.explicitOrderBy)if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1;return!0}(t,e)&&function(t,e){for(const i of t.filters)if(!i.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,i){const r=Hs(t,e,i);return t.inclusive?r<=0:r<0}(t.startAt,Xs(t),e)||t.endAt&&!function(t,e,i){const r=Hs(t,e,i);return t.inclusive?r>=0:r>0}(t.endAt,Xs(t),e))}(t,e)}function ia(t){return(e,i)=>{let r=!1;for(const n of Xs(t)){const t=ra(n,e,i);if(0!==t)return t;r=r||n.field.isKeyField()}return 0}}function ra(t,e,i){const r=t.field.isKeyField()?us.comparator(e.key,i.key):function(t,e,i){const r=e.data.field(t),n=i.data.field(t);return null!==r&&null!==n?gs(r,n):wn()}(t.field,e,i);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return wn()}}function na(t,e){if(t.N){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ls(e)?"-0":e}}function sa(t){return{integerValue:""+t}}function aa(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!ls(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?sa(e):na(t,e)}class oa{constructor(){this._=void 0}}function la(t,e,i){return t instanceof ha?function(t,e){const i={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(i.fields.__previous_value__=e),{mapValue:i}}(i,e):t instanceof da?fa(t,e):t instanceof ga?pa(t,e):function(t,e){const i=ca(t,e),r=va(i)+va(t.k);return ys(i)&&ys(t.k)?sa(r):na(t.O,r)}(t,e)}function ua(t,e,i){return t instanceof da?fa(t,e):t instanceof ga?pa(t,e):i}function ca(t,e){return t instanceof ma?ys(i=e)||function(t){return!!t&&"doubleValue"in t}(i)?e:{integerValue:0}:null;var i}class ha extends oa{}class da extends oa{constructor(t){super(),this.elements=t}}function fa(t,e){const i=ya(e);for(const e of t.elements)i.some((t=>ds(t,e)))||i.push(e);return{arrayValue:{values:i}}}class ga extends oa{constructor(t){super(),this.elements=t}}function pa(t,e){let i=ya(e);for(const e of t.elements)i=i.filter((t=>!ds(t,e)));return{arrayValue:{values:i}}}class ma extends oa{constructor(t,e){super(),this.O=t,this.k=e}}function va(t){return ts(t.integerValue||t.doubleValue)}function ya(t){return Ts(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Ta{constructor(t,e){this.version=t,this.transformResults=e}}class ba{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new ba}static exists(t){return new ba(void 0,t)}static updateTime(t){return new ba(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ea(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Sa{}function wa(t,e,i){t instanceof Da?function(t,e,i){const r=t.value.clone(),n=Ca(t.fieldTransforms,e,i.transformResults);r.setAll(n),e.convertToFoundDocument(i.version,r).setHasCommittedMutations()}(t,e,i):t instanceof La?function(t,e,i){if(!Ea(t.precondition,e))return void e.convertToUnknownDocument(i.version);const r=Ca(t.fieldTransforms,e,i.transformResults),n=e.data;n.setAll(Ra(t)),n.setAll(r),e.convertToFoundDocument(i.version,n).setHasCommittedMutations()}(t,e,i):function(t,e,i){e.convertToNoDocument(i.version).setHasCommittedMutations()}(0,e,i)}function Ia(t,e,i){t instanceof Da?function(t,e,i){if(!Ea(t.precondition,e))return;const r=t.value.clone(),n=Oa(t.fieldTransforms,i,e);r.setAll(n),e.convertToFoundDocument(ka(e),r).setHasLocalMutations()}(t,e,i):t instanceof La?function(t,e,i){if(!Ea(t.precondition,e))return;const r=Oa(t.fieldTransforms,i,e),n=e.data;n.setAll(Ra(t)),n.setAll(r),e.convertToFoundDocument(ka(e),n).setHasLocalMutations()}(t,e,i):function(t,e){Ea(t.precondition,e)&&e.convertToNoDocument(Gn.min())}(t,e)}function _a(t,e){let i=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),n=ca(r.transform,t||null);null!=n&&(null==i&&(i=Is.empty()),i.set(r.field,n))}return i||null}function Aa(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Vn(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof da&&e instanceof da||t instanceof ga&&e instanceof ga?Vn(t.elements,e.elements,ds):t instanceof ma&&e instanceof ma?ds(t.k,e.k):t instanceof ha&&e instanceof ha}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function ka(t){return t.isFoundDocument()?t.version:Gn.min()}class Da extends Sa{constructor(t,e,i,r=[]){super(),this.key=t,this.value=e,this.precondition=i,this.fieldTransforms=r,this.type=0}}class La extends Sa{constructor(t,e,i,r,n=[]){super(),this.key=t,this.data=e,this.fieldMask=i,this.precondition=r,this.fieldTransforms=n,this.type=1}}function Ra(t){const e=new Map;return t.fieldMask.fields.forEach((i=>{if(!i.isEmpty()){const r=t.data.field(i);e.set(i,r)}})),e}function Ca(t,e,i){const r=new Map;In(t.length===i.length);for(let n=0;n<i.length;n++){const s=t[n],a=s.transform,o=e.data.field(s.field);r.set(s.field,ua(a,o,i[n]))}return r}function Oa(t,e,i){const r=new Map;for(const n of t){const t=n.transform,s=i.data.field(n.field);r.set(n.field,la(t,s,e))}return r}class Pa extends Sa{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class xa extends Sa{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}class Na{constructor(t){this.count=t}}var Ma,Fa;function Ua(t){if(void 0===t)return bn("GRPC error has no .code"),An.UNKNOWN;switch(t){case Ma.OK:return An.OK;case Ma.CANCELLED:return An.CANCELLED;case Ma.UNKNOWN:return An.UNKNOWN;case Ma.DEADLINE_EXCEEDED:return An.DEADLINE_EXCEEDED;case Ma.RESOURCE_EXHAUSTED:return An.RESOURCE_EXHAUSTED;case Ma.INTERNAL:return An.INTERNAL;case Ma.UNAVAILABLE:return An.UNAVAILABLE;case Ma.UNAUTHENTICATED:return An.UNAUTHENTICATED;case Ma.INVALID_ARGUMENT:return An.INVALID_ARGUMENT;case Ma.NOT_FOUND:return An.NOT_FOUND;case Ma.ALREADY_EXISTS:return An.ALREADY_EXISTS;case Ma.PERMISSION_DENIED:return An.PERMISSION_DENIED;case Ma.FAILED_PRECONDITION:return An.FAILED_PRECONDITION;case Ma.ABORTED:return An.ABORTED;case Ma.OUT_OF_RANGE:return An.OUT_OF_RANGE;case Ma.UNIMPLEMENTED:return An.UNIMPLEMENTED;case Ma.DATA_LOSS:return An.DATA_LOSS;default:return wn()}}(Fa=Ma||(Ma={}))[Fa.OK=0]="OK",Fa[Fa.CANCELLED=1]="CANCELLED",Fa[Fa.UNKNOWN=2]="UNKNOWN",Fa[Fa.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Fa[Fa.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Fa[Fa.NOT_FOUND=5]="NOT_FOUND",Fa[Fa.ALREADY_EXISTS=6]="ALREADY_EXISTS",Fa[Fa.PERMISSION_DENIED=7]="PERMISSION_DENIED",Fa[Fa.UNAUTHENTICATED=16]="UNAUTHENTICATED",Fa[Fa.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Fa[Fa.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Fa[Fa.ABORTED=10]="ABORTED",Fa[Fa.OUT_OF_RANGE=11]="OUT_OF_RANGE",Fa[Fa.UNIMPLEMENTED=12]="UNIMPLEMENTED",Fa[Fa.INTERNAL=13]="INTERNAL",Fa[Fa.UNAVAILABLE=14]="UNAVAILABLE",Fa[Fa.DATA_LOSS=15]="DATA_LOSS";class Ba{constructor(t,e){this.comparator=t,this.root=e||ja.EMPTY}insert(t,e){return new Ba(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ja.BLACK,null,null))}remove(t){return new Ba(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ja.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const i=this.comparator(t,e.key);if(0===i)return e.value;i<0?e=e.left:i>0&&(e=e.right)}return null}indexOf(t){let e=0,i=this.root;for(;!i.isEmpty();){const r=this.comparator(t,i.key);if(0===r)return e+i.left.size;r<0?i=i.left:(e+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,i)=>(t(e,i),!1)))}toString(){const t=[];return this.inorderTraversal(((e,i)=>(t.push(`${e}:${i}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Va(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Va(this.root,t,this.comparator,!1)}getReverseIterator(){return new Va(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Va(this.root,t,this.comparator,!0)}}class Va{constructor(t,e,i,r){this.isReverse=r,this.nodeStack=[];let n=1;for(;!t.isEmpty();)if(n=e?i(t.key,e):1,r&&(n*=-1),n<0)t=this.isReverse?t.left:t.right;else{if(0===n){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class ja{constructor(t,e,i,r,n){this.key=t,this.value=e,this.color=null!=i?i:ja.RED,this.left=null!=r?r:ja.EMPTY,this.right=null!=n?n:ja.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,i,r,n){return new ja(null!=t?t:this.key,null!=e?e:this.value,null!=i?i:this.color,null!=r?r:this.left,null!=n?n:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,i){let r=this;const n=i(t,r.key);return r=n<0?r.copy(null,null,null,r.left.insert(t,e,i),null):0===n?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ja.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let i,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return ja.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,ja.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,ja.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw wn();if(this.right.isRed())throw wn();const t=this.left.check();if(t!==this.right.check())throw wn();return t+(this.isRed()?0:1)}}ja.EMPTY=null,ja.RED=!0,ja.BLACK=!1,ja.EMPTY=new class{constructor(){this.size=0}get key(){throw wn()}get value(){throw wn()}get color(){throw wn()}get left(){throw wn()}get right(){throw wn()}copy(t,e,i,r,n){return this}insert(t,e,i){return new ja(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ga{constructor(t){this.comparator=t,this.data=new Ba(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,i)=>(t(e),!1)))}forEachInRange(t,e){const i=this.data.getIteratorFrom(t[0]);for(;i.hasNext();){const r=i.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let i;for(i=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();i.hasNext();)if(!t(i.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ka(this.data.getIterator())}getIteratorFrom(t){return new Ka(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Ga))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),i=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=i.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Ga(this.comparator);return e.data=t,e}}class Ka{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}const Ha=new Ba(us.comparator);function qa(){return Ha}const Wa=new Ba(us.comparator);function za(){return Wa}const Ya=new Ba(us.comparator),$a=new Ga(us.comparator);function Xa(...t){let e=$a;for(const i of t)e=e.add(i);return e}const Qa=new Ga(Bn);function Ja(){return Qa}class Za{constructor(t,e,i,r,n){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=n}static createSynthesizedRemoteEventForCurrentChange(t,e){const i=new Map;return i.set(t,to.createSynthesizedTargetChangeForCurrentChange(t,e)),new Za(Gn.min(),i,Ja(),qa(),Xa())}}class to{constructor(t,e,i,r,n){this.resumeToken=t,this.current=e,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=n}static createSynthesizedTargetChangeForCurrentChange(t,e){return new to(Qn.EMPTY_BYTE_STRING,e,Xa(),Xa(),Xa())}}class eo{constructor(t,e,i,r){this.M=t,this.removedTargetIds=e,this.key=i,this.$=r}}class io{constructor(t,e){this.targetId=t,this.F=e}}class ro{constructor(t,e,i=Qn.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=i,this.cause=r}}class no{constructor(){this.B=0,this.L=oo(),this.U=Qn.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return 0!==this.B}get j(){return this.K}W(t){t.approximateByteSize()>0&&(this.K=!0,this.U=t)}H(){let t=Xa(),e=Xa(),i=Xa();return this.L.forEach(((r,n)=>{switch(n){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:i=i.add(r);break;default:wn()}})),new to(this.U,this.q,t,e,i)}J(){this.K=!1,this.L=oo()}Y(t,e){this.K=!0,this.L=this.L.insert(t,e)}X(t){this.K=!0,this.L=this.L.remove(t)}Z(){this.B+=1}tt(){this.B-=1}et(){this.K=!0,this.q=!0}}class so{constructor(t){this.nt=t,this.st=new Map,this.it=qa(),this.rt=ao(),this.ot=new Ga(Bn)}ct(t){for(const e of t.M)t.$&&t.$.isFoundDocument()?this.ut(e,t.$):this.at(e,t.key,t.$);for(const e of t.removedTargetIds)this.at(e,t.key,t.$)}ht(t){this.forEachTarget(t,(e=>{const i=this.lt(e);switch(t.state){case 0:this.ft(e)&&i.W(t.resumeToken);break;case 1:i.tt(),i.G||i.J(),i.W(t.resumeToken);break;case 2:i.tt(),i.G||this.removeTarget(e);break;case 3:this.ft(e)&&(i.et(),i.W(t.resumeToken));break;case 4:this.ft(e)&&(this.dt(e),i.W(t.resumeToken));break;default:wn()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.st.forEach(((t,i)=>{this.ft(i)&&e(i)}))}_t(t){const e=t.targetId,i=t.F.count,r=this.wt(e);if(r){const t=r.target;if(Cs(t))if(0===i){const i=new us(t.path);this.at(e,i,As.newNoDocument(i,Gn.min()))}else In(1===i);else this.gt(e)!==i&&(this.dt(e),this.ot=this.ot.add(e))}}yt(t){const e=new Map;this.st.forEach(((i,r)=>{const n=this.wt(r);if(n){if(i.current&&Cs(n.target)){const e=new us(n.target.path);null!==this.it.get(e)||this.It(r,e)||this.at(r,e,As.newNoDocument(e,t))}i.j&&(e.set(r,i.H()),i.J())}}));let i=Xa();this.rt.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.wt(t);return!e||2===e.purpose||(r=!1,!1)})),r&&(i=i.add(t))})),this.it.forEach(((e,i)=>i.setReadTime(t)));const r=new Za(t,e,this.ot,this.it,i);return this.it=qa(),this.rt=ao(),this.ot=new Ga(Bn),r}ut(t,e){if(!this.ft(t))return;const i=this.It(t,e.key)?2:0;this.lt(t).Y(e.key,i),this.it=this.it.insert(e.key,e),this.rt=this.rt.insert(e.key,this.Et(e.key).add(t))}at(t,e,i){if(!this.ft(t))return;const r=this.lt(t);this.It(t,e)?r.Y(e,1):r.X(e),this.rt=this.rt.insert(e,this.Et(e).delete(t)),i&&(this.it=this.it.insert(e,i))}removeTarget(t){this.st.delete(t)}gt(t){const e=this.lt(t).H();return this.nt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Z(t){this.lt(t).Z()}lt(t){let e=this.st.get(t);return e||(e=new no,this.st.set(t,e)),e}Et(t){let e=this.rt.get(t);return e||(e=new Ga(Bn),this.rt=this.rt.insert(t,e)),e}ft(t){const e=null!==this.wt(t);return e||Tn("WatchChangeAggregator","Detected inactive target",t),e}wt(t){const e=this.st.get(t);return e&&e.G?null:this.nt.Tt(t)}dt(t){this.st.set(t,new no),this.nt.getRemoteKeysForTarget(t).forEach((e=>{this.at(t,e,null)}))}It(t,e){return this.nt.getRemoteKeysForTarget(t).has(e)}}function ao(){return new Ba(us.comparator)}function oo(){return new Ba(us.comparator)}const lo={asc:"ASCENDING",desc:"DESCENDING"},uo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class co{constructor(t,e){this.databaseId=t,this.N=e}}function ho(t,e){return t.N?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function fo(t,e){return t.N?e.toBase64():e.toUint8Array()}function go(t,e){return ho(t,e.toTimestamp())}function po(t){return In(!!t),Gn.fromTimestamp(function(t){const e=Zn(t);return new jn(e.seconds,e.nanos)}(t))}function mo(t,e){return function(t){return new zn(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function vo(t){const e=zn.fromString(t);return In(No(e)),e}function yo(t,e){return mo(t.databaseId,e.path)}function To(t,e){const i=vo(e);if(i.get(1)!==t.databaseId.projectId)throw new kn(An.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+i.get(1)+" vs "+t.databaseId.projectId);if(i.get(3)!==t.databaseId.database)throw new kn(An.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+i.get(3)+" vs "+t.databaseId.database);return new us(So(i))}function bo(t,e){return mo(t.databaseId,e)}function Eo(t){return new zn(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function So(t){return In(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function wo(t,e,i){return{name:yo(t,e),fields:i.value.mapValue.fields}}function Io(t,e){return{documents:[bo(t,e.path)]}}function _o(t,e){const i={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(i.parent=bo(t,r),i.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i.parent=bo(t,r.popLast()),i.structuredQuery.from=[{collectionId:r.lastSegment()}]);const n=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(Es(t.value))return{unaryFilter:{field:Ro(t.field),op:"IS_NAN"}};if(bs(t.value))return{unaryFilter:{field:Ro(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Es(t.value))return{unaryFilter:{field:Ro(t.field),op:"IS_NOT_NAN"}};if(bs(t.value))return{unaryFilter:{field:Ro(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ro(t.field),op:Lo(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);n&&(i.structuredQuery.where=n);const s=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Ro(t.field),direction:Do(t.dir)}}(t)))}(e.orderBy);s&&(i.structuredQuery.orderBy=s);const a=function(t,e){return t.N||os(e)?e:{value:e}}(t,e.limit);var o;return null!==a&&(i.structuredQuery.limit=a),e.startAt&&(i.structuredQuery.startAt={before:(o=e.startAt).inclusive,values:o.position}),e.endAt&&(i.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),i}function Ao(t){let e=function(t){const e=vo(t);return 4===e.length?zn.emptyPath():So(e)}(t.parent);const i=t.structuredQuery,r=i.from?i.from.length:0;let n=null;if(r>0){In(1===r);const t=i.from[0];t.allDescendants?n=t.collectionId:e=e.child(t.collectionId)}let s=[];i.where&&(s=ko(i.where));let a=[];i.orderBy&&(a=i.orderBy.map((t=>function(t){return new Gs(Co(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let o=null;i.limit&&(o=function(t){let e;return e="object"==typeof t?t.value:t,os(e)?null:e}(i.limit));let l=null;i.startAt&&(l=function(t){const e=!!t.before,i=t.values||[];return new js(i,e)}(i.startAt));let u=null;return i.endAt&&(u=function(t){const e=!t.before,i=t.values||[];return new js(i,e)}(i.endAt)),function(t,e,i,r,n,s,a,o){return new Ws(t,e,i,r,n,s,a,o)}(e,n,a,s,o,"F",l,u)}function ko(t){return t?void 0!==t.unaryFilter?[Po(t)]:void 0!==t.fieldFilter?[Oo(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>ko(t))).reduce(((t,e)=>t.concat(e))):wn():[]}function Do(t){return lo[t]}function Lo(t){return uo[t]}function Ro(t){return{fieldPath:t.canonicalString()}}function Co(t){return $n.fromServerFormat(t.fieldPath)}function Oo(t){return Os.create(Co(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return wn()}}(t.fieldFilter.op),t.fieldFilter.value)}function Po(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Co(t.unaryFilter.field);return Os.create(e,"==",{doubleValue:NaN});case"IS_NULL":const i=Co(t.unaryFilter.field);return Os.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Co(t.unaryFilter.field);return Os.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const n=Co(t.unaryFilter.field);return Os.create(n,"!=",{nullValue:"NULL_VALUE"});default:return wn()}}function xo(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function No(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Mo(t){let e="";for(let i=0;i<t.length;i++)e.length>0&&(e=Uo(e)),e=Fo(t.get(i),e);return Uo(e)}function Fo(t,e){let i=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":i+="";break;case"":i+="";break;default:i+=r}}return i}function Uo(t){return t+""}class Bo{constructor(t,e,i){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=i}}Bo.store="owner",Bo.key="owner";class Vo{constructor(t,e,i){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=i}}Vo.store="mutationQueues",Vo.keyPath="userId";class jo{constructor(t,e,i,r,n){this.userId=t,this.batchId=e,this.localWriteTimeMs=i,this.baseMutations=r,this.mutations=n}}jo.store="mutations",jo.keyPath="batchId",jo.userMutationsIndex="userMutationsIndex",jo.userMutationsKeyPath=["userId","batchId"];class Go{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,Mo(e)]}static key(t,e,i){return[t,Mo(e),i]}}Go.store="documentMutations",Go.PLACEHOLDER=new Go;class Ko{constructor(t,e,i,r,n,s){this.unknownDocument=t,this.noDocument=e,this.document=i,this.hasCommittedMutations=r,this.readTime=n,this.parentPath=s}}Ko.store="remoteDocuments",Ko.readTimeIndex="readTimeIndex",Ko.readTimeIndexPath="readTime",Ko.collectionReadTimeIndex="collectionReadTimeIndex",Ko.collectionReadTimeIndexPath=["parentPath","readTime"];class Ho{constructor(t){this.byteSize=t}}Ho.store="remoteDocumentGlobal",Ho.key="remoteDocumentGlobalKey";class qo{constructor(t,e,i,r,n,s,a){this.targetId=t,this.canonicalId=e,this.readTime=i,this.resumeToken=r,this.lastListenSequenceNumber=n,this.lastLimboFreeSnapshotVersion=s,this.query=a}}qo.store="targets",qo.keyPath="targetId",qo.queryTargetsIndexName="queryTargetsIndex",qo.queryTargetsKeyPath=["canonicalId","targetId"];class Wo{constructor(t,e,i){this.targetId=t,this.path=e,this.sequenceNumber=i}}Wo.store="targetDocuments",Wo.keyPath=["targetId","path"],Wo.documentTargetsIndex="documentTargetsIndex",Wo.documentTargetsKeyPath=["path","targetId"];class zo{constructor(t,e,i,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=i,this.targetCount=r}}zo.key="targetGlobalKey",zo.store="targetGlobal";class Yo{constructor(t,e){this.collectionId=t,this.parent=e}}Yo.store="collectionParents",Yo.keyPath=["collectionId","parent"];class $o{constructor(t,e,i,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=i,this.inForeground=r}}$o.store="clientMetadata",$o.keyPath="clientId";class Xo{constructor(t,e,i){this.bundleId=t,this.createTime=e,this.version=i}}Xo.store="bundles",Xo.keyPath="bundleId";class Qo{constructor(t,e,i){this.name=t,this.readTime=e,this.bundledQuery=i}}Qo.store="namedQueries",Qo.keyPath="name";class Jo{constructor(t,e,i){this.indexId=t,this.collectionGroup=e,this.fields=i}}Jo.store="indexConfiguration",Jo.keyPath="indexId",Jo.collectionGroupIndex="collectionGroupIndex",Jo.collectionGroupIndexPath="collectionGroup";class Zo{constructor(t,e,i,r,n,s){this.indexId=t,this.uid=e,this.sequenceNumber=i,this.readTime=r,this.documentKey=n,this.largestBatchId=s}}Zo.store="indexState",Zo.keyPath=["indexId","uid"],Zo.sequenceNumberIndex="sequenceNumberIndex",Zo.sequenceNumberIndexPath=["uid","sequenceNumber"];class tl{constructor(t,e,i,r,n){this.indexId=t,this.uid=e,this.arrayValue=i,this.directionalValue=r,this.documentKey=n}}tl.store="indexEntries",tl.keyPath=["indexId","uid","arrayValue","directionalValue","documentKey"],tl.documentKeyIndex="documentKeyIndex",tl.documentKeyIndexPath=["indexId","uid","documentKey"];class el{constructor(t,e,i,r,n,s){this.userId=t,this.collectionPath=e,this.documentId=i,this.collectionGroup=r,this.largestBatchId=n,this.overlayMutation=s}}el.store="documentOverlays",el.keyPath=["userId","collectionPath","documentId"],el.collectionPathOverlayIndex="collectionPathOverlayIndex",el.collectionPathOverlayIndexPath=["userId","collectionPath","largestBatchId"],el.collectionGroupOverlayIndex="collectionGroupOverlayIndex",el.collectionGroupOverlayIndexPath=["userId","collectionGroup","largestBatchId"];Vo.store,jo.store,Go.store,Ko.store,qo.store,Bo.store,zo.store,Wo.store,$o.store,Ho.store,Yo.store,Xo.store,Qo.store,el.store;const il=(Jo.store,Zo.store,tl.store,"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.");class rl{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&wn(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new rl(((i,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(i,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(i,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof rl?e:rl.resolve(e)}catch(t){return rl.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):rl.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):rl.reject(e)}static resolve(t){return new rl(((e,i)=>{e(t)}))}static reject(t){return new rl(((e,i)=>{i(t)}))}static waitFor(t){return new rl(((e,i)=>{let r=0,n=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++n,s&&n===r&&e()}),(t=>i(t)))})),s=!0,n===r&&e()}))}static or(t){let e=rl.resolve(!1);for(const i of t)e=e.next((t=>t?rl.resolve(t):i()));return e}static forEach(t,e){const i=[];return t.forEach(((t,r)=>{i.push(e.call(this,t,r))})),this.waitFor(i)}}function nl(t){return"IndexedDbTransactionError"===t.name}class sl{constructor(t,e,i,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(t,e){const i=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&wa(r,t,i[e])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&Ia(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&Ia(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach((e=>{const i=t.get(e.key),r=i;this.applyToLocalView(r),i.isValidDocument()||r.convertToNoDocument(Gn.min())}))}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Xa())}isEqual(t){return this.batchId===t.batchId&&Vn(this.mutations,t.mutations,((t,e)=>Aa(t,e)))&&Vn(this.baseMutations,t.baseMutations,((t,e)=>Aa(t,e)))}}class al{constructor(t,e,i,r){this.batch=t,this.commitVersion=e,this.mutationResults=i,this.docVersions=r}static from(t,e,i){In(t.mutations.length===i.length);let r=Ya;const n=t.mutations;for(let t=0;t<n.length;t++)r=r.insert(n[t].key,i[t].version);return new al(t,e,i,r)}}class ol{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class ll{constructor(t,e,i,r,n=Gn.min(),s=Gn.min(),a=Qn.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=n,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a}withSequenceNumber(t){return new ll(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new ll(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new ll(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class ul{constructor(t){this.Ht=t}}function cl(t){const e=Ao({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?function(t,e,i){return new Ws(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,i,t.startAt,t.endAt)}(e,e.limit,"L"):e}class hl{constructor(){}Xt(t,e){this.Zt(t,e),e.te()}Zt(t,e){if("nullValue"in t)this.ee(e,5);else if("booleanValue"in t)this.ee(e,10),e.ne(t.booleanValue?1:0);else if("integerValue"in t)this.ee(e,15),e.ne(ts(t.integerValue));else if("doubleValue"in t){const i=ts(t.doubleValue);isNaN(i)?this.ee(e,13):(this.ee(e,15),ls(i)?e.ne(0):e.ne(i))}else if("timestampValue"in t){const i=t.timestampValue;this.ee(e,20),"string"==typeof i?e.se(i):(e.se(`${i.seconds||""}`),e.ne(i.nanos||0))}else if("stringValue"in t)this.ie(t.stringValue,e),this.re(e);else if("bytesValue"in t)this.ee(e,30),e.oe(es(t.bytesValue)),this.re(e);else if("referenceValue"in t)this.ce(t.referenceValue,e);else if("geoPointValue"in t){const i=t.geoPointValue;this.ee(e,45),e.ne(i.latitude||0),e.ne(i.longitude||0)}else"mapValue"in t?ds(t,cs)?this.ee(e,Number.MAX_SAFE_INTEGER):(this.ue(t.mapValue,e),this.re(e)):"arrayValue"in t?(this.ae(t.arrayValue,e),this.re(e)):wn()}ie(t,e){this.ee(e,25),this.he(t,e)}he(t,e){e.se(t)}ue(t,e){const i=t.fields||{};this.ee(e,55);for(const t of Object.keys(i))this.ie(t,e),this.Zt(i[t],e)}ae(t,e){const i=t.values||[];this.ee(e,50);for(const t of i)this.Zt(t,e)}ce(t,e){this.ee(e,37),us.fromName(t).path.forEach((t=>{this.ee(e,60),this.he(t,e)}))}ee(t,e){t.ne(e)}re(t){t.ne(2)}}hl.le=new hl;class dl{constructor(){this.xe=new fl}addToCollectionParentIndex(t,e){return this.xe.add(e),rl.resolve()}getCollectionParents(t,e){return rl.resolve(this.xe.getEntries(e))}addFieldIndex(t,e){return rl.resolve()}deleteFieldIndex(t,e){return rl.resolve()}getDocumentsMatchingTarget(t,e,i){return rl.resolve(Xa())}getFieldIndex(t,e){return rl.resolve(null)}getFieldIndexes(t,e){return rl.resolve([])}getNextCollectionGroupToUpdate(t){return rl.resolve(null)}updateCollectionGroup(t,e,i){return rl.resolve()}updateIndexEntries(t,e){return rl.resolve()}}class fl{constructor(){this.index={}}add(t){const e=t.lastSegment(),i=t.popLast(),r=this.index[e]||new Ga(zn.comparator),n=!r.has(i);return this.index[e]=r.add(i),n}has(t){const e=t.lastSegment(),i=t.popLast(),r=this.index[e];return r&&r.has(i)}getEntries(t){return(this.index[t]||new Ga(zn.comparator)).toArray()}}class gl{constructor(t,e,i){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=i}static withCacheSize(t){return new gl(t,gl.DEFAULT_COLLECTION_PERCENTILE,gl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}gl.DEFAULT_COLLECTION_PERCENTILE=10,gl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,gl.DEFAULT=new gl(41943040,gl.DEFAULT_COLLECTION_PERCENTILE,gl.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),gl.DISABLED=new gl(-1,0,0);class pl{constructor(t){this.ze=t}next(){return this.ze+=2,this.ze}static He(){return new pl(0)}static Je(){return new pl(-1)}}async function ml(t){if(t.code!==An.FAILED_PRECONDITION||t.message!==il)throw t;Tn("LocalStore","Unexpectedly lost primary lease")}class vl{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}get(t){const e=this.mapKeyFn(t),i=this.inner[e];if(void 0!==i)for(const[e,r]of i)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const i=this.mapKeyFn(t),r=this.inner[i];if(void 0!==r){for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[i]=[[t,e]]}delete(t){const e=this.mapKeyFn(t),i=this.inner[e];if(void 0===i)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],t))return 1===i.length?delete this.inner[e]:i.splice(r,1),!0;return!1}forEach(t){Hn(this.inner,((e,i)=>{for(const[e,r]of i)t(e,r)}))}isEmpty(){return qn(this.inner)}}class yl{constructor(t,e,i){this.qn=t,this.gs=e,this.indexManager=i}ys(t,e){return this.gs.getAllMutationBatchesAffectingDocumentKey(t,e).next((i=>this.ps(t,e,i)))}ps(t,e,i){return this.qn.getEntry(t,e).next((t=>{for(const e of i)e.applyToLocalView(t);return t}))}Is(t,e){t.forEach(((t,i)=>{for(const t of e)t.applyToLocalView(i)}))}Es(t,e){return this.qn.getEntries(t,e).next((e=>this.Ts(t,e).next((()=>e))))}Ts(t,e){return this.gs.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>this.Is(e,t)))}As(t,e,i){return function(t){return us.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Rs(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.Ps(t,e,i):this.bs(t,e,i)}Rs(t,e){return this.ys(t,new us(e)).next((t=>{let e=za();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}Ps(t,e,i){const r=e.collectionGroup;let n=za();return this.indexManager.getCollectionParents(t,r).next((s=>rl.forEach(s,(s=>{const a=function(t,e){return new Ws(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(r));return this.bs(t,a,i).next((t=>{t.forEach(((t,e)=>{n=n.insert(t,e)}))}))})).next((()=>n))))}bs(t,e,i){let r;return this.qn.getAll(t,e.path,i).next((i=>(r=i,this.gs.getAllMutationBatchesAffectingQuery(t,e)))).next((t=>{for(const e of t)for(const t of e.mutations){const i=t.key;let n=r.get(i);null==n&&(n=As.newInvalidDocument(i),r=r.insert(i,n)),Ia(t,n,e.localWriteTime),n.isFoundDocument()||(r=r.remove(i))}})).next((()=>(r.forEach(((t,i)=>{ea(e,i)||(r=r.remove(t))})),r)))}}class Tl{constructor(t,e,i,r){this.targetId=t,this.fromCache=e,this.vs=i,this.Vs=r}static Ss(t,e){let i=Xa(),r=Xa();for(const t of e.docChanges)switch(t.type){case 0:i=i.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Tl(t,e.fromCache,i,r)}}class bl{Ds(t){this.Cs=t}As(t,e,i,r){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||i.isEqual(Gn.min())?this.Ns(t,e):this.Cs.Es(t,r).next((n=>{const s=this.xs(e,n);return(Ys(e)||$s(e))&&this.ks(e.limitType,s,r,i)?this.Ns(t,e):(yn()<=A.DEBUG&&Tn("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ta(e)),this.Cs.As(t,e,i).next((t=>(s.forEach((e=>{t=t.insert(e.key,e)})),t))))}))}xs(t,e){let i=new Ga(ia(t));return e.forEach(((e,r)=>{ea(t,r)&&(i=i.add(r))})),i}ks(t,e,i,r){if(i.size!==e.size)return!0;const n="F"===t?e.last():e.first();return!!n&&(n.hasPendingWrites||n.version.compareTo(r)>0)}Ns(t,e){return yn()<=A.DEBUG&&Tn("QueryEngine","Using full collection scan to execute query:",ta(e)),this.Cs.As(t,e,Gn.min())}}class El{constructor(t,e,i,r){this.persistence=t,this.Os=e,this.O=r,this.Ms=new Ba(Bn),this.$s=new vl((t=>Ls(t)),Rs),this.Fs=Gn.min(),this.Bs=t.getRemoteDocumentCache(),this.Un=t.getTargetCache(),this.Kn=t.getBundleCache(),this.Ls(i)}Ls(t){this.indexManager=this.persistence.getIndexManager(t),this.gs=this.persistence.getMutationQueue(t,this.indexManager),this.Us=new yl(this.Bs,this.gs,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Os.Ds(this.Us)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}async function Sl(t,e){const i=_n(t);return await i.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return i.gs.getAllMutationBatches(t).next((n=>(r=n,i.Ls(e),i.gs.getAllMutationBatches(t)))).next((e=>{const n=[],s=[];let a=Xa();for(const t of r){n.push(t.batchId);for(const e of t.mutations)a=a.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)a=a.add(e.key)}return i.Us.Es(t,a).next((t=>({qs:t,removedBatchIds:n,addedBatchIds:s})))}))}))}function wl(t){const e=_n(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Un.getLastRemoteSnapshotVersion(t)))}function Il(t,e){const i=_n(t);return i.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),i.gs.getNextMutationBatchAfterBatchId(t,e))))}async function _l(t,e,i){const r=_n(t),n=r.Ms.get(e),s=i?"readwrite":"readwrite-primary";try{i||await r.persistence.runTransaction("Release target",s,(t=>r.persistence.referenceDelegate.removeTarget(t,n)))}catch(t){if(!nl(t))throw t;Tn("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.Ms=r.Ms.remove(e),r.$s.delete(n.target)}function Al(t,e,i){const r=_n(t);let n=Gn.min(),s=Xa();return r.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,i){const r=_n(t),n=r.$s.get(i);return void 0!==n?rl.resolve(r.Ms.get(n)):r.Un.getTargetData(e,i)}(r,t,Qs(e)).next((e=>{if(e)return n=e.lastLimboFreeSnapshotVersion,r.Un.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>r.Os.As(t,e,i?n:Gn.min(),i?s:Xa()))).next((t=>({documents:t,Ks:s})))))}class kl{constructor(t){this.O=t,this.Ws=new Map,this.zs=new Map}getBundleMetadata(t,e){return rl.resolve(this.Ws.get(e))}saveBundleMetadata(t,e){var i;return this.Ws.set(e.id,{id:(i=e).id,version:i.version,createTime:po(i.createTime)}),rl.resolve()}getNamedQuery(t,e){return rl.resolve(this.zs.get(e))}saveNamedQuery(t,e){return this.zs.set(e.name,function(t){return{name:t.name,query:cl(t.bundledQuery),readTime:po(t.readTime)}}(e)),rl.resolve()}}class Dl{constructor(){this.overlays=new Ba(us.comparator),this.Hs=new Map}getOverlay(t,e){return rl.resolve(this.overlays.get(e))}saveOverlays(t,e,i){return i.forEach((i=>{this.Yt(t,e,i)})),rl.resolve()}removeOverlaysForBatchId(t,e,i){const r=this.Hs.get(i);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.Hs.delete(i)),rl.resolve()}getOverlaysForCollection(t,e,i){const r=new Map,n=e.length+1,s=new us(e.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){const t=a.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===n&&t.largestBatchId>i&&r.set(t.getKey(),t)}return rl.resolve(r)}getOverlaysForCollectionGroup(t,e,i,r){let n=new Ba(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>i){let e=n.get(t.largestBatchId);null===e&&(e=new Map,n=n.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const a=new Map,o=n.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach(((t,e)=>a.set(e,t))),!(a.size>=r)););return rl.resolve(a)}Yt(t,e,i){if(null===i)return;const r=this.overlays.get(i.key);null!==r&&this.Hs.get(r.largestBatchId).delete(i.key),this.overlays=this.overlays.insert(i.key,new ol(e,i));let n=this.Hs.get(e);void 0===n&&(n=new Set,this.Hs.set(e,n)),n.add(i.key)}}class Ll{constructor(){this.Js=new Ga(Rl.Ys),this.Xs=new Ga(Rl.Zs)}isEmpty(){return this.Js.isEmpty()}addReference(t,e){const i=new Rl(t,e);this.Js=this.Js.add(i),this.Xs=this.Xs.add(i)}ti(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.ei(new Rl(t,e))}ni(t,e){t.forEach((t=>this.removeReference(t,e)))}si(t){const e=new us(new zn([])),i=new Rl(e,t),r=new Rl(e,t+1),n=[];return this.Xs.forEachInRange([i,r],(t=>{this.ei(t),n.push(t.key)})),n}ii(){this.Js.forEach((t=>this.ei(t)))}ei(t){this.Js=this.Js.delete(t),this.Xs=this.Xs.delete(t)}ri(t){const e=new us(new zn([])),i=new Rl(e,t),r=new Rl(e,t+1);let n=Xa();return this.Xs.forEachInRange([i,r],(t=>{n=n.add(t.key)})),n}containsKey(t){const e=new Rl(t,0),i=this.Js.firstAfterOrEqual(e);return null!==i&&t.isEqual(i.key)}}class Rl{constructor(t,e){this.key=t,this.oi=e}static Ys(t,e){return us.comparator(t.key,e.key)||Bn(t.oi,e.oi)}static Zs(t,e){return Bn(t.oi,e.oi)||us.comparator(t.key,e.key)}}class Cl{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.gs=[],this.ci=1,this.ui=new Ga(Rl.Ys)}checkEmpty(t){return rl.resolve(0===this.gs.length)}addMutationBatch(t,e,i,r){const n=this.ci;this.ci++,this.gs.length>0&&this.gs[this.gs.length-1];const s=new sl(n,e,i,r);this.gs.push(s);for(const e of r)this.ui=this.ui.add(new Rl(e.key,n)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return rl.resolve(s)}lookupMutationBatch(t,e){return rl.resolve(this.ai(e))}getNextMutationBatchAfterBatchId(t,e){const i=e+1,r=this.hi(i),n=r<0?0:r;return rl.resolve(this.gs.length>n?this.gs[n]:null)}getHighestUnacknowledgedBatchId(){return rl.resolve(0===this.gs.length?-1:this.ci-1)}getAllMutationBatches(t){return rl.resolve(this.gs.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const i=new Rl(e,0),r=new Rl(e,Number.POSITIVE_INFINITY),n=[];return this.ui.forEachInRange([i,r],(t=>{const e=this.ai(t.oi);n.push(e)})),rl.resolve(n)}getAllMutationBatchesAffectingDocumentKeys(t,e){let i=new Ga(Bn);return e.forEach((t=>{const e=new Rl(t,0),r=new Rl(t,Number.POSITIVE_INFINITY);this.ui.forEachInRange([e,r],(t=>{i=i.add(t.oi)}))})),rl.resolve(this.li(i))}getAllMutationBatchesAffectingQuery(t,e){const i=e.path,r=i.length+1;let n=i;us.isDocumentKey(n)||(n=n.child(""));const s=new Rl(new us(n),0);let a=new Ga(Bn);return this.ui.forEachWhile((t=>{const e=t.key.path;return!!i.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.oi)),!0)}),s),rl.resolve(this.li(a))}li(t){const e=[];return t.forEach((t=>{const i=this.ai(t);null!==i&&e.push(i)})),e}removeMutationBatch(t,e){In(0===this.fi(e.batchId,"removed")),this.gs.shift();let i=this.ui;return rl.forEach(e.mutations,(r=>{const n=new Rl(r.key,e.batchId);return i=i.delete(n),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.ui=i}))}Qe(t){}containsKey(t,e){const i=new Rl(e,0),r=this.ui.firstAfterOrEqual(i);return rl.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.gs.length,rl.resolve()}fi(t,e){return this.hi(t)}hi(t){return 0===this.gs.length?0:t-this.gs[0].batchId}ai(t){const e=this.hi(t);return e<0||e>=this.gs.length?null:this.gs[e]}}class Ol{constructor(t){this.di=t,this.docs=new Ba(us.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const i=e.key,r=this.docs.get(i),n=r?r.size:0,s=this.di(e);return this.docs=this.docs.insert(i,{document:e.mutableCopy(),size:s}),this.size+=s-n,this.indexManager.addToCollectionParentIndex(t,i.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const i=this.docs.get(e);return rl.resolve(i?i.document.mutableCopy():As.newInvalidDocument(e))}getEntries(t,e){let i=qa();return e.forEach((t=>{const e=this.docs.get(t);i=i.insert(t,e?e.document.mutableCopy():As.newInvalidDocument(t))})),rl.resolve(i)}getAll(t,e,i){let r=qa();const n=new us(e.child("")),s=this.docs.getIteratorFrom(n);for(;s.hasNext();){const{key:t,value:{document:n}}=s.getNext();if(!e.isPrefixOf(t.path))break;t.path.length>e.length+1||n.readTime.compareTo(i)<=0||(r=r.insert(n.key,n.mutableCopy()))}return rl.resolve(r)}_i(t,e){return rl.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Pl(this)}getSize(t){return rl.resolve(this.size)}}class Pl extends class{constructor(){this.changes=new vl((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,As.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const i=this.changes.get(e);return void 0!==i?rl.resolve(i):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}{constructor(t){super(),this.Tn=t}applyChanges(t){const e=[];return this.changes.forEach(((i,r)=>{r.isValidDocument()?e.push(this.Tn.addEntry(t,r)):this.Tn.removeEntry(i)})),rl.waitFor(e)}getFromCache(t,e){return this.Tn.getEntry(t,e)}getAllFromCache(t,e){return this.Tn.getEntries(t,e)}}class xl{constructor(t){this.persistence=t,this.wi=new vl((t=>Ls(t)),Rs),this.lastRemoteSnapshotVersion=Gn.min(),this.highestTargetId=0,this.mi=0,this.gi=new Ll,this.targetCount=0,this.yi=pl.He()}forEachTarget(t,e){return this.wi.forEach(((t,i)=>e(i))),rl.resolve()}getLastRemoteSnapshotVersion(t){return rl.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return rl.resolve(this.mi)}allocateTargetId(t){return this.highestTargetId=this.yi.next(),rl.resolve(this.highestTargetId)}setTargetsMetadata(t,e,i){return i&&(this.lastRemoteSnapshotVersion=i),e>this.mi&&(this.mi=e),rl.resolve()}Ze(t){this.wi.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.yi=new pl(e),this.highestTargetId=e),t.sequenceNumber>this.mi&&(this.mi=t.sequenceNumber)}addTargetData(t,e){return this.Ze(e),this.targetCount+=1,rl.resolve()}updateTargetData(t,e){return this.Ze(e),rl.resolve()}removeTargetData(t,e){return this.wi.delete(e.target),this.gi.si(e.targetId),this.targetCount-=1,rl.resolve()}removeTargets(t,e,i){let r=0;const n=[];return this.wi.forEach(((s,a)=>{a.sequenceNumber<=e&&null===i.get(a.targetId)&&(this.wi.delete(s),n.push(this.removeMatchingKeysForTargetId(t,a.targetId)),r++)})),rl.waitFor(n).next((()=>r))}getTargetCount(t){return rl.resolve(this.targetCount)}getTargetData(t,e){const i=this.wi.get(e)||null;return rl.resolve(i)}addMatchingKeys(t,e,i){return this.gi.ti(e,i),rl.resolve()}removeMatchingKeys(t,e,i){this.gi.ni(e,i);const r=this.persistence.referenceDelegate,n=[];return r&&e.forEach((e=>{n.push(r.markPotentiallyOrphaned(t,e))})),rl.waitFor(n)}removeMatchingKeysForTargetId(t,e){return this.gi.si(e),rl.resolve()}getMatchingKeysForTargetId(t,e){const i=this.gi.ri(e);return rl.resolve(i)}containsKey(t,e){return rl.resolve(this.gi.containsKey(e))}}class Nl{constructor(t,e){this.pi={},this.overlays={},this.Nn=new Mn(0),this.xn=!1,this.xn=!0,this.referenceDelegate=t(this),this.Un=new xl(this),this.indexManager=new dl,this.qn=function(t){return new Ol(t)}((t=>this.referenceDelegate.Ii(t))),this.O=new ul(e),this.Kn=new kl(this.O)}start(){return Promise.resolve()}shutdown(){return this.xn=!1,Promise.resolve()}get started(){return this.xn}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Dl,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let i=this.pi[t.toKey()];return i||(i=new Cl(e,this.referenceDelegate),this.pi[t.toKey()]=i),i}getTargetCache(){return this.Un}getRemoteDocumentCache(){return this.qn}getBundleCache(){return this.Kn}runTransaction(t,e,i){Tn("MemoryPersistence","Starting transaction:",t);const r=new Ml(this.Nn.next());return this.referenceDelegate.Ei(),i(r).next((t=>this.referenceDelegate.Ti(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Ai(t,e){return rl.or(Object.values(this.pi).map((i=>()=>i.containsKey(t,e))))}}class Ml extends class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}{constructor(t){super(),this.currentSequenceNumber=t}}class Fl{constructor(t){this.persistence=t,this.Ri=new Ll,this.Pi=null}static bi(t){return new Fl(t)}get vi(){if(this.Pi)return this.Pi;throw wn()}addReference(t,e,i){return this.Ri.addReference(i,e),this.vi.delete(i.toString()),rl.resolve()}removeReference(t,e,i){return this.Ri.removeReference(i,e),this.vi.add(i.toString()),rl.resolve()}markPotentiallyOrphaned(t,e){return this.vi.add(e.toString()),rl.resolve()}removeTarget(t,e){this.Ri.si(e.targetId).forEach((t=>this.vi.add(t.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.vi.add(t.toString())))})).next((()=>i.removeTargetData(t,e)))}Ei(){this.Pi=new Set}Ti(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return rl.forEach(this.vi,(i=>{const r=us.fromPath(i);return this.Vi(t,r).next((t=>{t||e.removeEntry(r,Gn.min())}))})).next((()=>(this.Pi=null,e.apply(t))))}updateLimboDocument(t,e){return this.Vi(t,e).next((t=>{t?this.vi.delete(e.toString()):this.vi.add(e.toString())}))}Ii(t){return 0}Vi(t,e){return rl.or([()=>rl.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class Ul{constructor(){this.activeTargetIds=Ja()}Ci(t){this.activeTargetIds=this.activeTargetIds.add(t)}Ni(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Di(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Bl{constructor(){this._r=new Ul,this.wr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,i){}addLocalQueryTarget(t){return this._r.Ci(t),this.wr[t]||"not-current"}updateQueryState(t,e,i){this.wr[t]=e}removeLocalQueryTarget(t){this._r.Ni(t)}isLocalQueryTarget(t){return this._r.activeTargetIds.has(t)}clearQueryState(t){delete this.wr[t]}getAllActiveQueryTargets(){return this._r.activeTargetIds}isActiveQueryTarget(t){return this._r.activeTargetIds.has(t)}start(){return this._r=new Ul,Promise.resolve()}handleUserChange(t,e,i){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(){}}class Vl{mr(t){}shutdown(){}}class jl{constructor(){this.gr=()=>this.yr(),this.pr=()=>this.Ir(),this.Er=[],this.Tr()}mr(t){this.Er.push(t)}shutdown(){window.removeEventListener("online",this.gr),window.removeEventListener("offline",this.pr)}Tr(){window.addEventListener("online",this.gr),window.addEventListener("offline",this.pr)}yr(){Tn("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Er)t(0)}Ir(){Tn("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Er)t(1)}static Vt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const Gl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Kl{constructor(t){this.Ar=t.Ar,this.Rr=t.Rr}Pr(t){this.br=t}vr(t){this.Vr=t}onMessage(t){this.Sr=t}close(){this.Rr()}send(t){this.Ar(t)}Dr(){this.br()}Cr(t){this.Vr(t)}Nr(t){this.Sr(t)}}class Hl extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.kr=e+"://"+t.host,this.Or="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Mr(t,e,i,r,n){const s=this.$r(t,e);Tn("RestConnection","Sending: ",s,i);const a={};return this.Fr(a,r,n),this.Br(t,s,a,i).then((t=>(Tn("RestConnection","Received: ",t),t)),(e=>{throw En("RestConnection",`${t} failed with error: `,e,"url: ",s,"request:",i),e}))}Lr(t,e,i,r,n){return this.Mr(t,e,i,r,n)}Fr(t,e,i){t["X-Goog-Api-Client"]="gl-js/ fire/"+mn,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,i)=>t[i]=e)),i&&i.headers.forEach(((e,i)=>t[i]=e))}$r(t,e){const i=Gl[t];return`${this.kr}/v1/${e}:${i}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}Br(t,e,i,r){return new Promise(((n,s)=>{const a=new fn;a.listenOnce(ln.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case on.NO_ERROR:const e=a.getResponseJson();Tn("Connection","XHR received:",JSON.stringify(e)),n(e);break;case on.TIMEOUT:Tn("Connection",'RPC "'+t+'" timed out'),s(new kn(An.DEADLINE_EXCEEDED,"Request time out"));break;case on.HTTP_ERROR:const i=a.getStatus();if(Tn("Connection",'RPC "'+t+'" failed with status:',i,"response text:",a.getResponseText()),i>0){const t=a.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(An).indexOf(e)>=0?e:An.UNKNOWN}(t.status);s(new kn(e,t.message))}else s(new kn(An.UNKNOWN,"Server responded with status "+a.getStatus()))}else s(new kn(An.UNAVAILABLE,"Connection failed."));break;default:wn()}}finally{Tn("Connection",'RPC "'+t+'" completed.')}}));const o=JSON.stringify(r);a.send(e,"POST",o,i,15)}))}Ur(t,e,i){const r=[this.kr,"/","google.firestore.v1.Firestore","/",t,"/channel"],n=sn(),c=an(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(h.xmlHttpFactory=new hn({})),this.Fr(h.initMessageHeaders,e,i),a()||l()||s().indexOf("Electron/")>=0||u()||s().indexOf("MSAppHost/")>=0||o()||(h.httpHeadersOverwriteParam="$httpHeaders");const d=r.join("");Tn("Connection","Creating WebChannel: "+d,h);const f=n.createWebChannel(d,h);let g=!1,p=!1;const m=new Kl({Ar:t=>{p?Tn("Connection","Not sending because WebChannel is closed:",t):(g||(Tn("Connection","Opening WebChannel transport."),f.open(),g=!0),Tn("Connection","WebChannel sending:",t),f.send(t))},Rr:()=>f.close()}),v=(t,e,i)=>{t.listen(e,(t=>{try{i(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return v(f,dn.EventType.OPEN,(()=>{p||Tn("Connection","WebChannel transport opened.")})),v(f,dn.EventType.CLOSE,(()=>{p||(p=!0,Tn("Connection","WebChannel transport closed"),m.Cr())})),v(f,dn.EventType.ERROR,(t=>{p||(p=!0,En("Connection","WebChannel transport errored:",t),m.Cr(new kn(An.UNAVAILABLE,"The operation could not be completed")))})),v(f,dn.EventType.MESSAGE,(t=>{var e;if(!p){const i=t.data[0];In(!!i);const r=i,n=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(n){Tn("Connection","WebChannel received error:",n);const t=n.status;let e=function(t){const e=Ma[t];if(void 0!==e)return Ua(e)}(t),i=n.message;void 0===e&&(e=An.INTERNAL,i="Unknown error status: "+t+" with message "+n.message),p=!0,m.Cr(new kn(e,i)),f.close()}else Tn("Connection","WebChannel received:",i),m.Nr(i)}})),v(c,un.STAT_EVENT,(t=>{t.stat===cn.PROXY?Tn("Connection","Detected buffering proxy"):t.stat===cn.NOPROXY&&Tn("Connection","Detected no buffering proxy")})),setTimeout((()=>{m.Dr()}),0),m}}function ql(){return"undefined"!=typeof document?document:null}function Wl(t){return new co(t,!0)}class zl{constructor(t,e,i=1e3,r=1.5,n=6e4){this.Sn=t,this.timerId=e,this.qr=i,this.Kr=r,this.Gr=n,this.jr=0,this.Qr=null,this.Wr=Date.now(),this.reset()}reset(){this.jr=0}zr(){this.jr=this.Gr}Hr(t){this.cancel();const e=Math.floor(this.jr+this.Jr()),i=Math.max(0,Date.now()-this.Wr),r=Math.max(0,e-i);r>0&&Tn("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.jr} ms, delay with jitter: ${e} ms, last attempt: ${i} ms ago)`),this.Qr=this.Sn.enqueueAfterDelay(this.timerId,r,(()=>(this.Wr=Date.now(),t()))),this.jr*=this.Kr,this.jr<this.qr&&(this.jr=this.qr),this.jr>this.Gr&&(this.jr=this.Gr)}Yr(){null!==this.Qr&&(this.Qr.skipDelay(),this.Qr=null)}cancel(){null!==this.Qr&&(this.Qr.cancel(),this.Qr=null)}Jr(){return(Math.random()-.5)*this.jr}}class Yl{constructor(t,e,i,r,n,s,a,o){this.Sn=t,this.Xr=i,this.Zr=r,this.eo=n,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.no=0,this.so=null,this.io=null,this.stream=null,this.ro=new zl(t,e)}oo(){return 1===this.state||5===this.state||this.co()}co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.uo()}async stop(){this.oo()&&await this.close(0)}ao(){this.state=0,this.ro.reset()}ho(){this.co()&&null===this.so&&(this.so=this.Sn.enqueueAfterDelay(this.Xr,6e4,(()=>this.lo())))}fo(t){this._o(),this.stream.send(t)}async lo(){if(this.co())return this.close(0)}_o(){this.so&&(this.so.cancel(),this.so=null)}wo(){this.io&&(this.io.cancel(),this.io=null)}async close(t,e){this._o(),this.wo(),this.ro.cancel(),this.no++,4!==t?this.ro.reset():e&&e.code===An.RESOURCE_EXHAUSTED?(bn(e.toString()),bn("Using maximum backoff delay to prevent overloading the backend."),this.ro.zr()):e&&e.code===An.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.mo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.vr(e)}mo(){}auth(){this.state=1;const t=this.yo(this.no),e=this.no;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,i])=>{this.no===e&&this.po(t,i)}),(e=>{t((()=>{const t=new kn(An.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Io(t)}))}))}po(t,e){const i=this.yo(this.no);this.stream=this.Eo(t,e),this.stream.Pr((()=>{i((()=>(this.state=2,this.io=this.Sn.enqueueAfterDelay(this.Zr,1e4,(()=>(this.co()&&(this.state=3),Promise.resolve()))),this.listener.Pr())))})),this.stream.vr((t=>{i((()=>this.Io(t)))})),this.stream.onMessage((t=>{i((()=>this.onMessage(t)))}))}uo(){this.state=5,this.ro.Hr((async()=>{this.state=0,this.start()}))}Io(t){return Tn("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}yo(t){return e=>{this.Sn.enqueueAndForget((()=>this.no===t?e():(Tn("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class $l extends Yl{constructor(t,e,i,r,n,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,i,r,s),this.O=n}Eo(t,e){return this.eo.Ur("Listen",t,e)}onMessage(t){this.ro.reset();const e=function(t,e){let i;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:wn()}(e.targetChange.targetChangeType||"NO_CHANGE"),n=e.targetChange.targetIds||[],s=function(t,e){return t.N?(In(void 0===e||"string"==typeof e),Qn.fromBase64String(e||"")):(In(void 0===e||e instanceof Uint8Array),Qn.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,o=a&&function(t){const e=void 0===t.code?An.UNKNOWN:Ua(t.code);return new kn(e,t.message||"")}(a);i=new ro(r,n,s,o||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const n=To(t,r.document.name),s=po(r.document.updateTime),a=new Is({mapValue:{fields:r.document.fields}}),o=As.newFoundDocument(n,s,a),l=r.targetIds||[],u=r.removedTargetIds||[];i=new eo(l,u,o.key,o)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const n=To(t,r.document),s=r.readTime?po(r.readTime):Gn.min(),a=As.newNoDocument(n,s),o=r.removedTargetIds||[];i=new eo([],o,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const n=To(t,r.document),s=r.removedTargetIds||[];i=new eo([],s,n,null)}else{if(!("filter"in e))return wn();{e.filter;const t=e.filter;t.targetId;const r=t.count||0,n=new Na(r),s=t.targetId;i=new io(s,n)}}return i}(this.O,t),i=function(t){if(!("targetChange"in t))return Gn.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Gn.min():e.readTime?po(e.readTime):Gn.min()}(t);return this.listener.To(e,i)}Ao(t){const e={};e.database=Eo(this.O),e.addTarget=function(t,e){let i;const r=e.target;return i=Cs(r)?{documents:Io(t,r)}:{query:_o(t,r)},i.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?i.resumeToken=fo(t,e.resumeToken):e.snapshotVersion.compareTo(Gn.min())>0&&(i.readTime=ho(t,e.snapshotVersion.toTimestamp())),i}(this.O,t);const i=function(t,e){const i=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return wn()}}(0,e.purpose);return null==i?null:{"goog-listen-tags":i}}(this.O,t);i&&(e.labels=i),this.fo(e)}Ro(t){const e={};e.database=Eo(this.O),e.removeTarget=t,this.fo(e)}}class Xl extends Yl{constructor(t,e,i,r,n,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,i,r,s),this.O=n,this.Po=!1}get bo(){return this.Po}start(){this.Po=!1,this.lastStreamToken=void 0,super.start()}mo(){this.Po&&this.vo([])}Eo(t,e){return this.eo.Ur("Write",t,e)}onMessage(t){if(In(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Po){this.ro.reset();const e=function(t,e){return t&&t.length>0?(In(void 0!==e),t.map((t=>function(t,e){let i=t.updateTime?po(t.updateTime):po(e);return i.isEqual(Gn.min())&&(i=po(e)),new Ta(i,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),i=po(t.commitTime);return this.listener.Vo(i,e)}return In(!t.writeResults||0===t.writeResults.length),this.Po=!0,this.listener.So()}Do(){const t={};t.database=Eo(this.O),this.fo(t)}vo(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let i;if(e instanceof Da)i={update:wo(t,e.key,e.value)};else if(e instanceof Pa)i={delete:yo(t,e.key)};else if(e instanceof La)i={update:wo(t,e.key,e.data),updateMask:xo(e.fieldMask)};else{if(!(e instanceof xa))return wn();i={verify:yo(t,e.key)}}return e.fieldTransforms.length>0&&(i.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const i=e.transform;if(i instanceof ha)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(i instanceof da)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:i.elements}};if(i instanceof ga)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:i.elements}};if(i instanceof ma)return{fieldPath:e.field.canonicalString(),increment:i.k};throw wn()}(0,t)))),e.precondition.isNone||(i.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:go(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:wn()}(t,e.precondition)),i}(this.O,t)))};this.fo(e)}}class Ql extends class{}{constructor(t,e,i,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.eo=i,this.O=r,this.Co=!1}No(){if(this.Co)throw new kn(An.FAILED_PRECONDITION,"The client has already been terminated.")}Mr(t,e,i){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,n])=>this.eo.Mr(t,e,i,r,n))).catch((t=>{throw"FirebaseError"===t.name?(t.code===An.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new kn(An.UNKNOWN,t.toString())}))}Lr(t,e,i){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,n])=>this.eo.Lr(t,e,i,r,n))).catch((t=>{throw"FirebaseError"===t.name?(t.code===An.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new kn(An.UNKNOWN,t.toString())}))}terminate(){this.Co=!0}}class Jl{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.xo=0,this.ko=null,this.Oo=!0}Mo(){0===this.xo&&(this.$o("Unknown"),this.ko=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.ko=null,this.Fo("Backend didn't respond within 10 seconds."),this.$o("Offline"),Promise.resolve()))))}Bo(t){"Online"===this.state?this.$o("Unknown"):(this.xo++,this.xo>=1&&(this.Lo(),this.Fo(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.$o("Offline")))}set(t){this.Lo(),this.xo=0,"Online"===t&&(this.Oo=!1),this.$o(t)}$o(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}Fo(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Oo?(bn(e),this.Oo=!1):Tn("OnlineStateTracker",e)}Lo(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}}class Zl{constructor(t,e,i,r,n){this.localStore=t,this.datastore=e,this.asyncQueue=i,this.remoteSyncer={},this.Uo=[],this.qo=new Map,this.Ko=new Set,this.Go=[],this.jo=n,this.jo.mr((t=>{i.enqueueAndForget((async()=>{lu(this)&&(Tn("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=_n(t);e.Ko.add(4),await eu(e),e.Qo.set("Unknown"),e.Ko.delete(4),await tu(e)}(this))}))})),this.Qo=new Jl(i,r)}}async function tu(t){if(lu(t))for(const e of t.Go)await e(!0)}async function eu(t){for(const e of t.Go)await e(!1)}function iu(t,e){const i=_n(t);i.qo.has(e.targetId)||(i.qo.set(e.targetId,e),ou(i)?au(i):_u(i).co()&&nu(i,e))}function ru(t,e){const i=_n(t),r=_u(i);i.qo.delete(e),r.co()&&su(i,e),0===i.qo.size&&(r.co()?r.ho():lu(i)&&i.Qo.set("Unknown"))}function nu(t,e){t.Wo.Z(e.targetId),_u(t).Ao(e)}function su(t,e){t.Wo.Z(e),_u(t).Ro(e)}function au(t){t.Wo=new so({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Tt:e=>t.qo.get(e)||null}),_u(t).start(),t.Qo.Mo()}function ou(t){return lu(t)&&!_u(t).oo()&&t.qo.size>0}function lu(t){return 0===_n(t).Ko.size}function uu(t){t.Wo=void 0}async function cu(t){t.qo.forEach(((e,i)=>{nu(t,e)}))}async function hu(t,e){uu(t),ou(t)?(t.Qo.Bo(e),au(t)):t.Qo.set("Unknown")}async function du(t,e,i){if(t.Qo.set("Online"),e instanceof ro&&2===e.state&&e.cause)try{await async function(t,e){const i=e.cause;for(const r of e.targetIds)t.qo.has(r)&&(await t.remoteSyncer.rejectListen(r,i),t.qo.delete(r),t.Wo.removeTarget(r))}(t,e)}catch(i){Tn("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),await fu(t,i)}else if(e instanceof eo?t.Wo.ct(e):e instanceof io?t.Wo._t(e):t.Wo.ht(e),!i.isEqual(Gn.min()))try{const e=await wl(t.localStore);i.compareTo(e)>=0&&await function(t,e){const i=t.Wo.yt(e);return i.targetChanges.forEach(((i,r)=>{if(i.resumeToken.approximateByteSize()>0){const n=t.qo.get(r);n&&t.qo.set(r,n.withResumeToken(i.resumeToken,e))}})),i.targetMismatches.forEach((e=>{const i=t.qo.get(e);if(!i)return;t.qo.set(e,i.withResumeToken(Qn.EMPTY_BYTE_STRING,i.snapshotVersion)),su(t,e);const r=new ll(i.target,e,1,i.sequenceNumber);nu(t,r)})),t.remoteSyncer.applyRemoteEvent(i)}(t,i)}catch(e){Tn("RemoteStore","Failed to raise snapshot:",e),await fu(t,e)}}async function fu(t,e,i){if(!nl(e))throw e;t.Ko.add(1),await eu(t),t.Qo.set("Offline"),i||(i=()=>wl(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Tn("RemoteStore","Retrying IndexedDB access"),await i(),t.Ko.delete(1),await tu(t)}))}function gu(t,e){return e().catch((i=>fu(t,i,e)))}async function pu(t){const e=_n(t),i=Au(e);let r=e.Uo.length>0?e.Uo[e.Uo.length-1].batchId:-1;for(;mu(e);)try{const t=await Il(e.localStore,r);if(null===t){0===e.Uo.length&&i.ho();break}r=t.batchId,vu(e,t)}catch(t){await fu(e,t)}yu(e)&&Tu(e)}function mu(t){return lu(t)&&t.Uo.length<10}function vu(t,e){t.Uo.push(e);const i=Au(t);i.co()&&i.bo&&i.vo(e.mutations)}function yu(t){return lu(t)&&!Au(t).oo()&&t.Uo.length>0}function Tu(t){Au(t).start()}async function bu(t){Au(t).Do()}async function Eu(t){const e=Au(t);for(const i of t.Uo)e.vo(i.mutations)}async function Su(t,e,i){const r=t.Uo.shift(),n=al.from(r,e,i);await gu(t,(()=>t.remoteSyncer.applySuccessfulWrite(n))),await pu(t)}async function wu(t,e){e&&Au(t).bo&&await async function(t,e){if(function(t){switch(t){default:return wn();case An.CANCELLED:case An.UNKNOWN:case An.DEADLINE_EXCEEDED:case An.RESOURCE_EXHAUSTED:case An.INTERNAL:case An.UNAVAILABLE:case An.UNAUTHENTICATED:return!1;case An.INVALID_ARGUMENT:case An.NOT_FOUND:case An.ALREADY_EXISTS:case An.PERMISSION_DENIED:case An.FAILED_PRECONDITION:case An.ABORTED:case An.OUT_OF_RANGE:case An.UNIMPLEMENTED:case An.DATA_LOSS:return!0}}(i=e.code)&&i!==An.ABORTED){const i=t.Uo.shift();Au(t).ao(),await gu(t,(()=>t.remoteSyncer.rejectFailedWrite(i.batchId,e))),await pu(t)}var i}(t,e),yu(t)&&Tu(t)}async function Iu(t,e){const i=_n(t);i.asyncQueue.verifyOperationInProgress(),Tn("RemoteStore","RemoteStore received new credentials");const r=lu(i);i.Ko.add(3),await eu(i),r&&i.Qo.set("Unknown"),await i.remoteSyncer.handleCredentialChange(e),i.Ko.delete(3),await tu(i)}function _u(t){return t.zo||(t.zo=function(t,e,i){const r=_n(t);return r.No(),new $l(e,r.eo,r.authCredentials,r.appCheckCredentials,r.O,i)}(t.datastore,t.asyncQueue,{Pr:cu.bind(null,t),vr:hu.bind(null,t),To:du.bind(null,t)}),t.Go.push((async e=>{e?(t.zo.ao(),ou(t)?au(t):t.Qo.set("Unknown")):(await t.zo.stop(),uu(t))}))),t.zo}function Au(t){return t.Ho||(t.Ho=function(t,e,i){const r=_n(t);return r.No(),new Xl(e,r.eo,r.authCredentials,r.appCheckCredentials,r.O,i)}(t.datastore,t.asyncQueue,{Pr:bu.bind(null,t),vr:wu.bind(null,t),So:Eu.bind(null,t),Vo:Su.bind(null,t)}),t.Go.push((async e=>{e?(t.Ho.ao(),await pu(t)):(await t.Ho.stop(),t.Uo.length>0&&(Tn("RemoteStore",`Stopping write stream with ${t.Uo.length} pending writes`),t.Uo=[]))}))),t.Ho}class ku{constructor(t,e,i,r,n){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=i,this.op=r,this.removalCallback=n,this.deferred=new Dn,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,i,r,n){const s=Date.now()+i,a=new ku(t,e,s,r,n);return a.start(i),a}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new kn(An.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Du(t,e){if(bn("AsyncQueue",`${e}: ${t}`),nl(t))return new kn(An.UNAVAILABLE,`${e}: ${t}`);throw t}class Lu{constructor(t){this.comparator=t?(e,i)=>t(e,i)||us.comparator(e.key,i.key):(t,e)=>us.comparator(t.key,e.key),this.keyedMap=za(),this.sortedSet=new Ba(this.comparator)}static emptySet(t){return new Lu(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,i)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Lu))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),i=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=i.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const i=new Lu;return i.comparator=this.comparator,i.keyedMap=t,i.sortedSet=e,i}}class Ru{constructor(){this.Jo=new Ba(us.comparator)}track(t){const e=t.doc.key,i=this.Jo.get(e);i?0!==t.type&&3===i.type?this.Jo=this.Jo.insert(e,t):3===t.type&&1!==i.type?this.Jo=this.Jo.insert(e,{type:i.type,doc:t.doc}):2===t.type&&2===i.type?this.Jo=this.Jo.insert(e,{type:2,doc:t.doc}):2===t.type&&0===i.type?this.Jo=this.Jo.insert(e,{type:0,doc:t.doc}):1===t.type&&0===i.type?this.Jo=this.Jo.remove(e):1===t.type&&2===i.type?this.Jo=this.Jo.insert(e,{type:1,doc:i.doc}):0===t.type&&1===i.type?this.Jo=this.Jo.insert(e,{type:2,doc:t.doc}):wn():this.Jo=this.Jo.insert(e,t)}Yo(){const t=[];return this.Jo.inorderTraversal(((e,i)=>{t.push(i)})),t}}class Cu{constructor(t,e,i,r,n,s,a,o){this.query=t,this.docs=e,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=n,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o}static fromInitialDocuments(t,e,i,r){const n=[];return e.forEach((t=>{n.push({type:0,doc:t})})),new Cu(t,e,Lu.emptySet(e),n,i,r,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Js(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,i=t.docChanges;if(e.length!==i.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==i[t].type||!e[t].doc.isEqual(i[t].doc))return!1;return!0}}class Ou{constructor(){this.Xo=void 0,this.listeners=[]}}class Pu{constructor(){this.queries=new vl((t=>Zs(t)),Js),this.onlineState="Unknown",this.Zo=new Set}}function xu(t,e){const i=_n(t);let r=!1;for(const t of e){const e=t.query,n=i.queries.get(e);if(n){for(const e of n.listeners)e.ec(t)&&(r=!0);n.Xo=t}}r&&Mu(i)}function Nu(t,e,i){const r=_n(t),n=r.queries.get(e);if(n)for(const t of n.listeners)t.onError(i);r.queries.delete(e)}function Mu(t){t.Zo.forEach((t=>{t.next()}))}class Fu{constructor(t,e,i){this.query=t,this.nc=e,this.sc=!1,this.ic=null,this.onlineState="Unknown",this.options=i||{}}ec(t){if(!this.options.includeMetadataChanges){const e=[];for(const i of t.docChanges)3!==i.type&&e.push(i);t=new Cu(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.sc?this.rc(t)&&(this.nc.next(t),e=!0):this.oc(t,this.onlineState)&&(this.cc(t),e=!0),this.ic=t,e}onError(t){this.nc.error(t)}tc(t){this.onlineState=t;let e=!1;return this.ic&&!this.sc&&this.oc(this.ic,t)&&(this.cc(this.ic),e=!0),e}oc(t,e){if(!t.fromCache)return!0;const i="Offline"!==e;return!(this.options.uc&&i||t.docs.isEmpty()&&"Offline"!==e)}rc(t){if(t.docChanges.length>0)return!0;const e=this.ic&&this.ic.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}cc(t){t=Cu.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.sc=!0,this.nc.next(t)}}class Uu{constructor(t){this.key=t}}class Bu{constructor(t){this.key=t}}class Vu{constructor(t,e){this.query=t,this.dc=e,this._c=null,this.current=!1,this.wc=Xa(),this.mutatedKeys=Xa(),this.mc=ia(t),this.gc=new Lu(this.mc)}get yc(){return this.dc}Ic(t,e){const i=e?e.Ec:new Ru,r=e?e.gc:this.gc;let n=e?e.mutatedKeys:this.mutatedKeys,s=r,a=!1;const o=Ys(this.query)&&r.size===this.query.limit?r.last():null,l=$s(this.query)&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),c=ea(this.query,e)?e:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations);let f=!1;u&&c?u.data.isEqual(c.data)?h!==d&&(i.track({type:3,doc:c}),f=!0):this.Tc(u,c)||(i.track({type:2,doc:c}),f=!0,(o&&this.mc(c,o)>0||l&&this.mc(c,l)<0)&&(a=!0)):!u&&c?(i.track({type:0,doc:c}),f=!0):u&&!c&&(i.track({type:1,doc:u}),f=!0,(o||l)&&(a=!0)),f&&(c?(s=s.add(c),n=d?n.add(t):n.delete(t)):(s=s.delete(t),n=n.delete(t)))})),Ys(this.query)||$s(this.query))for(;s.size>this.query.limit;){const t=Ys(this.query)?s.last():s.first();s=s.delete(t.key),n=n.delete(t.key),i.track({type:1,doc:t})}return{gc:s,Ec:i,ks:a,mutatedKeys:n}}Tc(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,i){const r=this.gc;this.gc=t.gc,this.mutatedKeys=t.mutatedKeys;const n=t.Ec.Yo();n.sort(((t,e)=>function(t,e){const i=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return wn()}};return i(t)-i(e)}(t.type,e.type)||this.mc(t.doc,e.doc))),this.Ac(i);const s=e?this.Rc():[],a=0===this.wc.size&&this.current?1:0,o=a!==this._c;return this._c=a,0!==n.length||o?{snapshot:new Cu(this.query,t.gc,r,n,t.mutatedKeys,0===a,o,!1),Pc:s}:{Pc:s}}tc(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({gc:this.gc,Ec:new Ru,mutatedKeys:this.mutatedKeys,ks:!1},!1)):{Pc:[]}}bc(t){return!this.dc.has(t)&&!!this.gc.has(t)&&!this.gc.get(t).hasLocalMutations}Ac(t){t&&(t.addedDocuments.forEach((t=>this.dc=this.dc.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.dc=this.dc.delete(t))),this.current=t.current)}Rc(){if(!this.current)return[];const t=this.wc;this.wc=Xa(),this.gc.forEach((t=>{this.bc(t.key)&&(this.wc=this.wc.add(t.key))}));const e=[];return t.forEach((t=>{this.wc.has(t)||e.push(new Bu(t))})),this.wc.forEach((i=>{t.has(i)||e.push(new Uu(i))})),e}vc(t){this.dc=t.Ks,this.wc=Xa();const e=this.Ic(t.documents);return this.applyChanges(e,!0)}Vc(){return Cu.fromInitialDocuments(this.query,this.gc,this.mutatedKeys,0===this._c)}}class ju{constructor(t,e,i){this.query=t,this.targetId=e,this.view=i}}class Gu{constructor(t){this.key=t,this.Sc=!1}}class Ku{constructor(t,e,i,r,n,s){this.localStore=t,this.remoteStore=e,this.eventManager=i,this.sharedClientState=r,this.currentUser=n,this.maxConcurrentLimboResolutions=s,this.Dc={},this.Cc=new vl((t=>Zs(t)),Js),this.Nc=new Map,this.xc=new Set,this.kc=new Ba(us.comparator),this.Oc=new Map,this.Mc=new Ll,this.$c={},this.Fc=new Map,this.Bc=pl.Je(),this.onlineState="Unknown",this.Lc=void 0}get isPrimaryClient(){return!0===this.Lc}}async function Hu(t,e){const i=function(t){const e=_n(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Wu.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=ac.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Yu.bind(null,e),e.Dc.To=xu.bind(null,e.eventManager),e.Dc.qc=Nu.bind(null,e.eventManager),e}(t);let r,n;const s=i.Cc.get(e);if(s)r=s.targetId,i.sharedClientState.addLocalQueryTarget(r),n=s.view.Vc();else{const t=await function(t,e){const i=_n(t);return i.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return i.Un.getTargetData(t,e).next((n=>n?(r=n,rl.resolve(r)):i.Un.allocateTargetId(t).next((n=>(r=new ll(e,n,0,t.currentSequenceNumber),i.Un.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=i.Ms.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(i.Ms=i.Ms.insert(t.targetId,t),i.$s.set(e,t.targetId)),t}))}(i.localStore,Qs(e));i.isPrimaryClient&&iu(i.remoteStore,t);const s=i.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,n=await async function(t,e,i,r){t.Uc=(e,i,r)=>async function(t,e,i,r){let n=e.view.Ic(i);n.ks&&(n=await Al(t.localStore,e.query,!1).then((({documents:t})=>e.view.Ic(t,n))));const s=r&&r.targetChanges.get(e.targetId),a=e.view.applyChanges(n,t.isPrimaryClient,s);return ec(t,e.targetId,a.Pc),a.snapshot}(t,e,i,r);const n=await Al(t.localStore,e,!0),s=new Vu(e,n.Ks),a=s.Ic(n.documents),o=to.createSynthesizedTargetChangeForCurrentChange(i,r&&"Offline"!==t.onlineState),l=s.applyChanges(a,t.isPrimaryClient,o);ec(t,i,l.Pc);const u=new ju(e,i,s);return t.Cc.set(e,u),t.Nc.has(i)?t.Nc.get(i).push(e):t.Nc.set(i,[e]),l.snapshot}(i,e,r,"current"===s)}return n}async function qu(t,e){const i=_n(t),r=i.Cc.get(e),n=i.Nc.get(r.targetId);if(n.length>1)return i.Nc.set(r.targetId,n.filter((t=>!Js(t,e)))),void i.Cc.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(r.targetId),i.sharedClientState.isActiveQueryTarget(r.targetId)||await _l(i.localStore,r.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(r.targetId),ru(i.remoteStore,r.targetId),Zu(i,r.targetId)})).catch(ml)):(Zu(i,r.targetId),await _l(i.localStore,r.targetId,!0))}async function Wu(t,e){const i=_n(t);try{const t=await function(t,e){const i=_n(t),r=e.snapshotVersion;let n=i.Ms;return i.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=i.Bs.newChangeBuffer({trackRemovals:!0});n=i.Ms;const a=[];e.targetChanges.forEach(((s,o)=>{const l=n.get(o);if(!l)return;a.push(i.Un.removeMatchingKeys(t,s.removedDocuments,o).next((()=>i.Un.addMatchingKeys(t,s.addedDocuments,o))));let u=l.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(o)?u=u.withResumeToken(Qn.EMPTY_BYTE_STRING,Gn.min()).withLastLimboFreeSnapshotVersion(Gn.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),n=n.insert(o,u),function(t,e,i){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size>0}(l,u,s)&&a.push(i.Un.updateTargetData(t,u))}));let o=qa();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&a.push(i.persistence.referenceDelegate.updateLimboDocument(t,r))})),a.push(function(t,e,i){let r=Xa();return i.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=qa();return i.forEach(((i,n)=>{const s=t.get(i);n.isNoDocument()&&n.version.isEqual(Gn.min())?(e.removeEntry(i,n.readTime),r=r.insert(i,n)):!s.isValidDocument()||n.version.compareTo(s.version)>0||0===n.version.compareTo(s.version)&&s.hasPendingWrites?(e.addEntry(n),r=r.insert(i,n)):Tn("LocalStore","Ignoring outdated watch update for ",i,". Current version:",s.version," Watch version:",n.version)})),r}))}(t,s,e.documentUpdates).next((t=>{o=t}))),!r.isEqual(Gn.min())){const e=i.Un.getLastRemoteSnapshotVersion(t).next((e=>i.Un.setTargetsMetadata(t,t.currentSequenceNumber,r)));a.push(e)}return rl.waitFor(a).next((()=>s.apply(t))).next((()=>i.Us.Ts(t,o))).next((()=>o))})).then((t=>(i.Ms=n,t)))}(i.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=i.Oc.get(e);r&&(In(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.Sc=!0:t.modifiedDocuments.size>0?In(r.Sc):t.removedDocuments.size>0&&(In(r.Sc),r.Sc=!1))})),await nc(i,t,e)}catch(t){await ml(t)}}function zu(t,e,i){const r=_n(t);if(r.isPrimaryClient&&0===i||!r.isPrimaryClient&&1===i){const t=[];r.Cc.forEach(((i,r)=>{const n=r.view.tc(e);n.snapshot&&t.push(n.snapshot)})),function(t,e){const i=_n(t);i.onlineState=e;let r=!1;i.queries.forEach(((t,i)=>{for(const t of i.listeners)t.tc(e)&&(r=!0)})),r&&Mu(i)}(r.eventManager,e),t.length&&r.Dc.To(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Yu(t,e,i){const r=_n(t);r.sharedClientState.updateQueryState(e,"rejected",i);const n=r.Oc.get(e),s=n&&n.key;if(s){let t=new Ba(us.comparator);t=t.insert(s,As.newNoDocument(s,Gn.min()));const i=Xa().add(s),n=new Za(Gn.min(),new Map,new Ga(Bn),t,i);await Wu(r,n),r.kc=r.kc.remove(s),r.Oc.delete(e),rc(r)}else await _l(r.localStore,e,!1).then((()=>Zu(r,e,i))).catch(ml)}async function $u(t,e){const i=_n(t),r=e.batch.batchId;try{const t=await function(t,e){const i=_n(t);return i.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),n=i.Bs.newChangeBuffer({trackRemovals:!0});return function(t,e,i,r){const n=i.batch,s=n.keys();let a=rl.resolve();return s.forEach((t=>{a=a.next((()=>r.getEntry(e,t))).next((e=>{const s=i.docVersions.get(t);In(null!==s),e.version.compareTo(s)<0&&(n.applyToRemoteDocument(e,i),e.isValidDocument()&&(e.setReadTime(i.commitVersion),r.addEntry(e)))}))})),a.next((()=>t.gs.removeMutationBatch(e,n)))}(i,t,e,n).next((()=>n.apply(t))).next((()=>i.gs.performConsistencyCheck(t))).next((()=>i.Us.Es(t,r)))}))}(i.localStore,e);Ju(i,r,null),Qu(i,r),i.sharedClientState.updateMutationState(r,"acknowledged"),await nc(i,t)}catch(t){await ml(t)}}async function Xu(t,e,i){const r=_n(t);try{const t=await function(t,e){const i=_n(t);return i.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return i.gs.lookupMutationBatch(t,e).next((e=>(In(null!==e),r=e.keys(),i.gs.removeMutationBatch(t,e)))).next((()=>i.gs.performConsistencyCheck(t))).next((()=>i.Us.Es(t,r)))}))}(r.localStore,e);Ju(r,e,i),Qu(r,e),r.sharedClientState.updateMutationState(e,"rejected",i),await nc(r,t)}catch(i){await ml(i)}}function Qu(t,e){(t.Fc.get(e)||[]).forEach((t=>{t.resolve()})),t.Fc.delete(e)}function Ju(t,e,i){const r=_n(t);let n=r.$c[r.currentUser.toKey()];if(n){const t=n.get(e);t&&(i?t.reject(i):t.resolve(),n=n.remove(e)),r.$c[r.currentUser.toKey()]=n}}function Zu(t,e,i=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Nc.get(e))t.Cc.delete(r),i&&t.Dc.qc(r,i);t.Nc.delete(e),t.isPrimaryClient&&t.Mc.si(e).forEach((e=>{t.Mc.containsKey(e)||tc(t,e)}))}function tc(t,e){t.xc.delete(e.path.canonicalString());const i=t.kc.get(e);null!==i&&(ru(t.remoteStore,i),t.kc=t.kc.remove(e),t.Oc.delete(i),rc(t))}function ec(t,e,i){for(const r of i)r instanceof Uu?(t.Mc.addReference(r.key,e),ic(t,r)):r instanceof Bu?(Tn("SyncEngine","Document no longer in limbo: "+r.key),t.Mc.removeReference(r.key,e),t.Mc.containsKey(r.key)||tc(t,r.key)):wn()}function ic(t,e){const i=e.key,r=i.path.canonicalString();t.kc.get(i)||t.xc.has(r)||(Tn("SyncEngine","New document in limbo: "+i),t.xc.add(r),rc(t))}function rc(t){for(;t.xc.size>0&&t.kc.size<t.maxConcurrentLimboResolutions;){const e=t.xc.values().next().value;t.xc.delete(e);const i=new us(zn.fromString(e)),r=t.Bc.next();t.Oc.set(r,new Gu(i)),t.kc=t.kc.insert(i,r),iu(t.remoteStore,new ll(Qs(zs(i.path)),r,2,Mn.A))}}async function nc(t,e,i){const r=_n(t),n=[],s=[],a=[];r.Cc.isEmpty()||(r.Cc.forEach(((t,o)=>{a.push(r.Uc(o,e,i).then((t=>{if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(o.targetId,t.fromCache?"not-current":"current"),n.push(t);const e=Tl.Ss(o.targetId,t);s.push(e)}})))})),await Promise.all(a),r.Dc.To(n),await async function(t,e){const i=_n(t);try{await i.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>rl.forEach(e,(e=>rl.forEach(e.vs,(r=>i.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>rl.forEach(e.Vs,(r=>i.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!nl(t))throw t;Tn("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=i.Ms.get(e),r=t.snapshotVersion,n=t.withLastLimboFreeSnapshotVersion(r);i.Ms=i.Ms.insert(e,n)}}}(r.localStore,s))}async function sc(t,e){const i=_n(t);if(!i.currentUser.isEqual(e)){Tn("SyncEngine","User change. New user:",e.toKey());const t=await Sl(i.localStore,e);i.currentUser=e,function(t,e){t.Fc.forEach((t=>{t.forEach((t=>{t.reject(new kn(An.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Fc.clear()}(i),i.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await nc(i,t.qs)}}function ac(t,e){const i=_n(t),r=i.Oc.get(e);if(r&&r.Sc)return Xa().add(r.key);{let t=Xa();const r=i.Nc.get(e);if(!r)return t;for(const e of r){const r=i.Cc.get(e);t=t.unionWith(r.view.yc)}return t}}function oc(t){const e=_n(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=$u.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Xu.bind(null,e),e}class lc{constructor(){this.synchronizeTabs=!1}async initialize(t){this.O=Wl(t.databaseInfo.databaseId),this.sharedClientState=this.Gc(t),this.persistence=this.jc(t),await this.persistence.start(),this.gcScheduler=this.Qc(t),this.localStore=this.Wc(t)}Qc(t){return null}Wc(t){return function(t,e,i,r){return new El(t,e,i,r)}(this.persistence,new bl,t.initialUser,this.O)}jc(t){return new Nl(Fl.bi,this.O)}Gc(t){return new Bl}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class uc{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>zu(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=sc.bind(null,this.syncEngine),await async function(t,e){const i=_n(t);e?(i.Ko.delete(2),await tu(i)):e||(i.Ko.add(2),await eu(i),i.Qo.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Pu}createDatastore(t){const e=Wl(t.databaseInfo.databaseId),i=(r=t.databaseInfo,new Hl(r));var r;return function(t,e,i,r){return new Ql(t,e,i,r)}(t.authCredentials,t.appCheckCredentials,i,e)}createRemoteStore(t){return e=this.localStore,i=this.datastore,r=t.asyncQueue,n=t=>zu(this.syncEngine,t,0),s=jl.Vt()?new jl:new Vl,new Zl(e,i,r,n,s);var e,i,r,n,s}createSyncEngine(t,e){return function(t,e,i,r,n,s,a){const o=new Ku(t,e,i,r,n,s);return a&&(o.Lc=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=_n(t);Tn("RemoteStore","RemoteStore shutting down."),e.Ko.add(5),await eu(e),e.jo.shutdown(),e.Qo.set("Unknown")}(this.remoteStore)}}class cc{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Hc(this.observer.next,t)}error(t){this.observer.error?this.Hc(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Jc(){this.muted=!0}Hc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class hc{constructor(t,e,i,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=i,this.databaseInfo=r,this.user=pn.UNAUTHENTICATED,this.clientId=Un.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,(async t=>{Tn("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(i,(t=>(Tn("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new kn(An.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Dn;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const i=Du(e,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}async function dc(t,e){t.asyncQueue.verifyOperationInProgress();const i=await async function(t){return t.offlineComponents||(Tn("FirestoreClient","Using default OfflineComponentProvider"),await async function(t,e){t.asyncQueue.verifyOperationInProgress(),Tn("FirestoreClient","Initializing OfflineComponentProvider");const i=await t.getConfiguration();await e.initialize(i);let r=i.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Sl(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}(t,new lc)),t.offlineComponents}(t);Tn("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(i,r),t.setCredentialChangeListener((t=>Iu(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,i)=>Iu(e.remoteStore,i))),t.onlineComponents=e}async function fc(t){return t.onlineComponents||(Tn("FirestoreClient","Using default OnlineComponentProvider"),await dc(t,new uc)),t.onlineComponents}async function gc(t){const e=await fc(t),i=e.eventManager;return i.onListen=Hu.bind(null,e.syncEngine),i.onUnlisten=qu.bind(null,e.syncEngine),i}const pc=new Map;function mc(t,e,i){if(!i)throw new kn(An.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function vc(t){if(!us.isDocumentKey(t))throw new kn(An.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function yc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":wn()}function Tc(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new kn(An.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const i=yc(t);throw new kn(An.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${i}`)}}return t}class bc{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new kn(An.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new kn(An.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,function(t,e,i,r){if(!0===e&&!0===r)throw new kn(An.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")}(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Ec{constructor(t,e,i){this._authCredentials=e,this._appCheckCredentials=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new bc({}),this._settingsFrozen=!1,t instanceof as?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new kn(An.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new as(t.options.projectId)}(t))}get app(){if(!this._app)throw new kn(An.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new kn(An.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new bc(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Rn;switch(t.type){case"gapi":const e=t.client;return In(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Pn(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new kn(An.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=pc.get(t);e&&(Tn("ComponentProvider","Removing Datastore"),pc.delete(t),e.terminate())}(this),Promise.resolve()}}class Sc{constructor(t,e,i){this.converter=e,this._key=i,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ic(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Sc(this.firestore,t,this._key)}}class wc{constructor(t,e,i){this.converter=e,this._query=i,this.type="query",this.firestore=t}withConverter(t){return new wc(this.firestore,t,this._query)}}class Ic extends wc{constructor(t,e,i){super(t,e,zs(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Sc(this.firestore,null,new us(t))}withConverter(t){return new Ic(this.firestore,t,this._path)}}function _c(t,e,...i){if(t=b(t),1===arguments.length&&(e=Un.R()),mc("doc","path",e),t instanceof Ec){const r=zn.fromString(e,...i);return vc(r),new Sc(t,null,new us(r))}{if(!(t instanceof Sc||t instanceof Ic))throw new kn(An.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(zn.fromString(e,...i));return vc(r),new Sc(t.firestore,t instanceof Ic?t.converter:null,new us(r))}}class Ac{constructor(){this.hu=Promise.resolve(),this.lu=[],this.fu=!1,this.du=[],this._u=null,this.wu=!1,this.mu=!1,this.gu=[],this.ro=new zl(this,"async_queue_retry"),this.yu=()=>{const t=ql();t&&Tn("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ro.Yr()};const t=ql();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.yu)}get isShuttingDown(){return this.fu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.pu(),this.Iu(t)}enterRestrictedMode(t){if(!this.fu){this.fu=!0,this.mu=t||!1;const e=ql();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.yu)}}enqueue(t){if(this.pu(),this.fu)return new Promise((()=>{}));const e=new Dn;return this.Iu((()=>this.fu&&this.mu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.lu.push(t),this.Eu())))}async Eu(){if(0!==this.lu.length){try{await this.lu[0](),this.lu.shift(),this.ro.reset()}catch(t){if(!nl(t))throw t;Tn("AsyncQueue","Operation failed with retryable error: "+t)}this.lu.length>0&&this.ro.Hr((()=>this.Eu()))}}Iu(t){const e=this.hu.then((()=>(this.wu=!0,t().catch((t=>{this._u=t,this.wu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw bn("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.wu=!1,t))))));return this.hu=e,e}enqueueAfterDelay(t,e,i){this.pu(),this.gu.indexOf(t)>-1&&(e=0);const r=ku.createAndSchedule(this,t,e,i,(t=>this.Tu(t)));return this.du.push(r),r}pu(){this._u&&wn()}verifyOperationInProgress(){}async Au(){let t;do{t=this.hu,await t}while(t!==this.hu)}Ru(t){for(const e of this.du)if(e.timerId===t)return!0;return!1}Pu(t){return this.Au().then((()=>{this.du.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.du)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Au()}))}bu(t){this.gu.push(t)}Tu(t){const e=this.du.indexOf(t);this.du.splice(e,1)}}function kc(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const i=t;for(const t of["next","error","complete"])if(t in i&&"function"==typeof i[t])return!0;return!1}(t)}class Dc extends Ec{constructor(t,e,i){super(t,e,i),this.type="firestore",this._queue=new Ac,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Rc(this),this._firestoreClient.terminate()}}function Lc(t){return t._firestoreClient||Rc(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Rc(t){var e;const i=t._freezeSettings(),r=function(t,e,i,r){return new ss(t,e,i,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new hc(t._authCredentials,t._appCheckCredentials,t._queue,r)}class Cc{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new kn(An.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $n(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Oc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Oc(Qn.fromBase64String(t))}catch(t){throw new kn(An.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Oc(Qn.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Pc{constructor(t){this._methodName=t}}class xc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new kn(An.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new kn(An.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Bn(this._lat,t._lat)||Bn(this._long,t._long)}}const Nc=/^__.*__$/;class Mc{constructor(t,e,i){this.data=t,this.fieldMask=e,this.fieldTransforms=i}toMutation(t,e){return null!==this.fieldMask?new La(t,this.data,this.fieldMask,e,this.fieldTransforms):new Da(t,this.data,e,this.fieldTransforms)}}function Fc(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw wn()}}class Uc{constructor(t,e,i,r,n,s){this.settings=t,this.databaseId=e,this.O=i,this.ignoreUndefinedProperties=r,void 0===n&&this.vu(),this.fieldTransforms=n||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}Su(t){return new Uc(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.O,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Du(t){var e;const i=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Su({path:i,Cu:!1});return r.Nu(t),r}xu(t){var e;const i=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Su({path:i,Cu:!1});return r.vu(),r}ku(t){return this.Su({path:void 0,Cu:!0})}Ou(t){return $c(t,this.settings.methodName,this.settings.Mu||!1,this.path,this.settings.$u)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}vu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Nu(this.path.get(t))}Nu(t){if(0===t.length)throw this.Ou("Document fields must not be empty");if(Fc(this.Vu)&&Nc.test(t))throw this.Ou('Document fields cannot begin and end with "__"')}}class Bc{constructor(t,e,i){this.databaseId=t,this.ignoreUndefinedProperties=e,this.O=i||Wl(t)}Fu(t,e,i,r=!1){return new Uc({Vu:t,methodName:e,$u:i,path:$n.emptyPath(),Cu:!1,Mu:r},this.databaseId,this.O,this.ignoreUndefinedProperties)}}function Vc(t){const e=t._freezeSettings(),i=Wl(t._databaseId);return new Bc(t._databaseId,!!e.ignoreUndefinedProperties,i)}function jc(t,e,i,r,n,s={}){const a=t.Fu(s.merge||s.mergeFields?2:0,e,i,n);qc("Data must be an object, but it was:",a,r);const o=Kc(r,a);let l,u;if(s.merge)l=new Xn(a.fieldMask),u=a.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){const n=Wc(e,r,i);if(!a.contains(n))throw new kn(An.INVALID_ARGUMENT,`Field '${n}' is specified in your field mask but missing from your input data.`);Xc(t,n)||t.push(n)}l=new Xn(t),u=a.fieldTransforms.filter((t=>l.covers(t.field)))}else l=null,u=a.fieldTransforms;return new Mc(new Is(o),l,u)}function Gc(t,e){if(Hc(t=b(t)))return qc("Unsupported field value:",e,t),Kc(t,e);if(t instanceof Pc)return function(t,e){if(!Fc(e.Vu))throw e.Ou(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Ou(`${t._methodName}() is not currently supported inside arrays`);const i=t._toFieldTransform(e);i&&e.fieldTransforms.push(i)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Cu&&4!==e.Vu)throw e.Ou("Nested arrays are not supported");return function(t,e){const i=[];let r=0;for(const n of t){let t=Gc(n,e.ku(r));null==t&&(t={nullValue:"NULL_VALUE"}),i.push(t),r++}return{arrayValue:{values:i}}}(t,e)}return function(t,e){if(null===(t=b(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return aa(e.O,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const i=jn.fromDate(t);return{timestampValue:ho(e.O,i)}}if(t instanceof jn){const i=new jn(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ho(e.O,i)}}if(t instanceof xc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Oc)return{bytesValue:fo(e.O,t._byteString)};if(t instanceof Sc){const i=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(i))throw e.Ou(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:mo(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Ou(`Unsupported field value: ${yc(t)}`)}(t,e)}function Kc(t,e){const i={};return qn(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Hn(t,((t,r)=>{const n=Gc(r,e.Du(t));null!=n&&(i[t]=n)})),{mapValue:{fields:i}}}function Hc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof jn||t instanceof xc||t instanceof Oc||t instanceof Sc||t instanceof Pc)}function qc(t,e,i){if(!Hc(i)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(i)){const r=yc(i);throw"an object"===r?e.Ou(t+" a custom object"):e.Ou(t+" "+r)}}function Wc(t,e,i){if((e=b(e))instanceof Cc)return e._internalPath;if("string"==typeof e)return Yc(t,e);throw $c("Field path arguments must be of type string or ",t,!1,void 0,i)}const zc=new RegExp("[~\\*/\\[\\]]");function Yc(t,e,i){if(e.search(zc)>=0)throw $c(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,i);try{return new Cc(...e.split("."))._internalPath}catch(r){throw $c(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,i)}}function $c(t,e,i,r,n){const s=r&&!r.isEmpty(),a=void 0!==n;let o=`Function ${e}() called with invalid data`;i&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${r}`),a&&(l+=` in document ${n}`),l+=")"),new kn(An.INVALID_ARGUMENT,o+t+l)}function Xc(t,e){return t.some((t=>t.isEqual(e)))}class Qc{constructor(t,e,i,r,n){this._firestore=t,this._userDataWriter=e,this._key=i,this._document=r,this._converter=n}get id(){return this._key.path.lastSegment()}get ref(){return new Sc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Jc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Zc("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Jc extends Qc{data(){return super.data()}}function Zc(t,e){return"string"==typeof e?Yc(t,e):e instanceof Cc?e._internalPath:e._delegate._internalPath}class th{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class eh extends Qc{constructor(t,e,i,r,n,s){super(t,e,i,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=n}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new ih(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const i=this._document.data.field(Zc("DocumentSnapshot.get",t));if(null!==i)return this._userDataWriter.convertValue(i,e.serverTimestamps)}}}class ih extends eh{data(t={}){return super.data(t)}}class rh{constructor(t,e,i,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new th(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((i=>{t.call(e,new ih(this._firestore,this._userDataWriter,i.key,i,new th(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new kn(An.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((i=>({type:"added",doc:new ih(t._firestore,t._userDataWriter,i.doc.key,i.doc,new th(t._snapshot.mutatedKeys.has(i.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let i=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new ih(t._firestore,t._userDataWriter,e.doc.key,e.doc,new th(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let n=-1,s=-1;return 0!==e.type&&(n=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(i=i.add(e.doc),s=i.indexOf(e.doc.key)),{type:nh(e.type),doc:r,oldIndex:n,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function nh(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return wn()}}class sh extends class{convertValue(t,e="none"){switch(hs(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ts(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(es(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw wn()}}convertObject(t,e){const i={};return Hn(t.fields,((t,r)=>{i[t]=this.convertValue(r,e)})),i}convertGeoPoint(t){return new xc(ts(t.latitude),ts(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const i=rs(t);return null==i?null:this.convertValue(i,e);case"estimate":return this.convertTimestamp(ns(t));default:return null}}convertTimestamp(t){const e=Zn(t);return new jn(e.seconds,e.nanos)}convertDocumentKey(t,e){const i=zn.fromString(t);In(No(i));const r=new as(i.get(1),i.get(3)),n=new us(i.popFirst(5));return r.isEqual(e)||bn(`Document ${n} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),n}}{constructor(t){super(),this.firestore=t}convertBytes(t){return new Oc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Sc(this.firestore,null,e)}}function ah(t,e,i){t=Tc(t,Sc);const r=Tc(t.firestore,Dc),n=function(t,e,i){let r;return r=t?i&&(i.merge||i.mergeFields)?t.toFirestore(e,i):t.toFirestore(e):e,r}(t.converter,e,i);return function(t,e){return function(t,e){const i=new Dn;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,i){const r=oc(t);try{const t=await function(t,e){const i=_n(t),r=jn.now(),n=e.reduce(((t,e)=>t.add(e.key)),Xa());let s;return i.persistence.runTransaction("Locally write mutations","readwrite",(t=>i.Us.Es(t,n).next((n=>{s=n;const a=[];for(const t of e){const e=_a(t,s.get(t.key));null!=e&&a.push(new La(t.key,e,_s(e.value.mapValue),ba.exists(!0)))}return i.gs.addMutationBatch(t,r,a,e)})))).then((t=>(t.applyToLocalDocumentSet(s),{batchId:t.batchId,changes:s})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,i){let r=t.$c[t.currentUser.toKey()];r||(r=new Ba(Bn)),r=r.insert(e,i),t.$c[t.currentUser.toKey()]=r}(r,t.batchId,i),await nc(r,t.changes),await pu(r.remoteStore)}catch(t){const e=Du(t,"Failed to persist write");i.reject(e)}}(await function(t){return fc(t).then((t=>t.syncEngine))}(t),e,i))),i.promise}(Lc(t),e)}(r,[jc(Vc(r),"setDoc",t._key,n,null!==t.converter,i).toMutation(t._key,ba.none())])}function oh(t,e){var i={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(i[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(t);n<r.length;n++)e.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(t,r[n])&&(i[r[n]]=t[r[n]])}return i}!function(t,e=!0){mn="9.6.8",G(new E("firestore",((t,{options:i})=>{const r=t.getProvider("app").getImmediate(),n=new Dc(r,new Cn(t.getProvider("auth-internal")),new Nn(t.getProvider("app-check-internal")));return i=Object.assign({useFetchStreams:e},i),n._setSettings(i),n}),"PUBLIC")),Y(gn,"3.4.5",t),Y(gn,"3.4.5","esm2017")}(),Object.create,Object.create;const lh=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},uh=new h("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),ch=new O("@firebase/auth");function hh(t,...e){ch.logLevel<=A.ERROR&&ch.error(`Auth (9.6.8): ${t}`,...e)}function dh(t,...e){throw gh(t,...e)}function fh(t,...e){return gh(t,...e)}function gh(t,...e){if("string"!=typeof t){const i=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(i,...r)}return uh.create(t,...e)}function ph(t,e,...i){if(!t)throw gh(e,...i)}function mh(t){const e="INTERNAL ASSERTION FAILED: "+t;throw hh(e),new Error(e)}function vh(t,e){t||mh(e)}const yh=new Map;function Th(t){vh(t instanceof Function,"Expected a class definition");let e=yh.get(t);return e?(vh(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,yh.set(t,e),e)}function bh(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.href)||""}function Eh(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.protocol)||null}class Sh{constructor(t,e){this.shortDelay=t,this.longDelay=e,vh(e>t,"Short delay should be less than long delay!"),this.isMobile=a()||l()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Eh()||"https:"===Eh()||o()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function wh(t,e){vh(t.emulator,"Emulator should always be set here");const{url:i}=t.emulator;return e?`${i}${e.startsWith("/")?e.slice(1):e}`:i}class Ih{static initialize(t,e,i){this.fetchImpl=t,e&&(this.headersImpl=e),i&&(this.responseImpl=i)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void mh("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void mh("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void mh("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const _h={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Ah=new Sh(3e4,6e4);function kh(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Dh(t,e,i,r,n={}){return Lh(t,n,(async()=>{let n={},s={};r&&("GET"===e?s=r:n={body:JSON.stringify(r)});const a=p(Object.assign({key:t.config.apiKey},s)).slice(1),o=await t._getAdditionalHeaders();return o["Content-Type"]="application/json",t.languageCode&&(o["X-Firebase-Locale"]=t.languageCode),Ih.fetch()(Ch(t,t.config.apiHost,i,a),Object.assign({method:e,headers:o,referrerPolicy:"no-referrer"},n))}))}async function Lh(t,e,i){t._canInitEmulator=!1;const r=Object.assign(Object.assign({},_h),e);try{const e=new Oh(t),n=await Promise.race([i(),e.promise]);e.clearNetworkTimeout();const s=await n.json();if("needConfirmation"in s)throw Ph(t,"account-exists-with-different-credential",s);if(n.ok&&!("errorMessage"in s))return s;{const e=n.ok?s.errorMessage:s.error.message,[i,a]=e.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===i)throw Ph(t,"credential-already-in-use",s);if("EMAIL_EXISTS"===i)throw Ph(t,"email-already-in-use",s);const o=r[i]||i.toLowerCase().replace(/[_\s]+/g,"-");if(a)throw function(t,e,i){const r=Object.assign(Object.assign({},lh()),{[e]:i});return new h("auth","Firebase",r).create(e,{appName:t.name})}(t,o,a);dh(t,o)}}catch(e){if(e instanceof c)throw e;dh(t,"network-request-failed")}}async function Rh(t,e,i,r,n={}){const s=await Dh(t,e,i,r,n);return"mfaPendingCredential"in s&&dh(t,"multi-factor-auth-required",{_serverResponse:s}),s}function Ch(t,e,i,r){const n=`${e}${i}?${r}`;return t.config.emulator?wh(t.config,n):`${t.config.apiScheme}://${n}`}class Oh{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise(((t,e)=>{this.timer=setTimeout((()=>e(fh(this.auth,"network-request-failed"))),Ah.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ph(t,e,i){const r={appName:t.name};i.email&&(r.email=i.email),i.phoneNumber&&(r.phoneNumber=i.phoneNumber);const n=fh(t,e,r);return n.customData._tokenResponse=i,n}function xh(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch(t){}}function Nh(t){return 1e3*Number(t)}function Mh(t){const[i,r,n]=t.split(".");if(void 0===i||void 0===r||void 0===n)return hh("JWT malformed, contained fewer than 3 sections"),null;try{const t=function(t){try{return e.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(r);return t?JSON.parse(t):(hh("Failed to decode base64 JWT payload"),null)}catch(t){return hh("Caught error parsing JWT payload as JSON",t),null}}async function Fh(t,e,i=!1){if(i)return e;try{return await e}catch(e){throw e instanceof c&&function({code:t}){return"auth/user-disabled"===t||"auth/user-token-expired"===t}(e)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class Uh{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}{this.errorBackoff=3e4;const t=(null!==(e=this.user.stsTokenManager.expirationTime)&&void 0!==e?e:0)-Date.now()-3e5;return Math.max(0,t)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout((async()=>{await this.iteration()}),e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===t.code&&this.schedule(!0))}this.schedule()}}class Bh{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=xh(this.lastLoginAt),this.creationTime=xh(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Vh(t){var e;const i=t.auth,r=await t.getIdToken(),n=await Fh(t,async function(t,e){return Dh(t,"POST","/v1/accounts:lookup",e)}(i,{idToken:r}));ph(null==n?void 0:n.users.length,i,"internal-error");const s=n.users[0];t._notifyReloadListener(s);const a=(null===(e=s.providerUserInfo)||void 0===e?void 0:e.length)?s.providerUserInfo.map((t=>{var{providerId:e}=t,i=oh(t,["providerId"]);return{providerId:e,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})):[],o=(l=t.providerData,u=a,[...l.filter((t=>!u.some((e=>e.providerId===t.providerId)))),...u]);var l,u;const c=t.isAnonymous,h=!(t.email&&s.passwordHash||(null==o?void 0:o.length)),d=!!c&&h,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new Bh(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,f)}class jh{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){ph(t.idToken,"internal-error"),ph(void 0!==t.idToken,"internal-error"),ph(void 0!==t.refreshToken,"internal-error");const e="expiresIn"in t&&void 0!==t.expiresIn?Number(t.expiresIn):function(t){const e=Mh(t);return ph(e,"internal-error"),ph(void 0!==e.exp,"internal-error"),ph(void 0!==e.iat,"internal-error"),Number(e.exp)-Number(e.iat)}(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}async getToken(t,e=!1){return ph(!this.accessToken||this.refreshToken,t,"user-token-expired"),e||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:i,refreshToken:r,expiresIn:n}=await async function(t,e){const i=await Lh(t,{},(async()=>{const i=p({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:n}=t.config,s=Ch(t,r,"/v1/token",`key=${n}`),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Ih.fetch()(s,{method:"POST",headers:a,body:i})}));return{accessToken:i.access_token,expiresIn:i.expires_in,refreshToken:i.refresh_token}}(t,e);this.updateTokensAndExpiration(i,r,Number(n))}updateTokensAndExpiration(t,e,i){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+1e3*i}static fromJSON(t,e){const{refreshToken:i,accessToken:r,expirationTime:n}=e,s=new jh;return i&&(ph("string"==typeof i,"internal-error",{appName:t}),s.refreshToken=i),r&&(ph("string"==typeof r,"internal-error",{appName:t}),s.accessToken=r),n&&(ph("number"==typeof n,"internal-error",{appName:t}),s.expirationTime=n),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new jh,this.toJSON())}_performRefresh(){return mh("not implemented")}}function Gh(t,e){ph("string"==typeof t||void 0===t,"internal-error",{appName:e})}class Kh{constructor(t){var{uid:e,auth:i,stsTokenManager:r}=t,n=oh(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Uh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new Bh(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(t){const e=await Fh(this,this.stsTokenManager.getToken(this.auth,t));return ph(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return async function(t,e=!1){const i=b(t),r=await i.getIdToken(e),n=Mh(r);ph(n&&n.exp&&n.auth_time&&n.iat,i.auth,"internal-error");const s="object"==typeof n.firebase?n.firebase:void 0,a=null==s?void 0:s.sign_in_provider;return{claims:n,token:r,authTime:xh(Nh(n.auth_time)),issuedAtTime:xh(Nh(n.iat)),expirationTime:xh(Nh(n.exp)),signInProvider:a||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}(this,t)}reload(){return async function(t){const e=b(t);await Vh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}(this)}_assign(t){this!==t&&(ph(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map((t=>Object.assign({},t))),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){return new Kh(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(t){ph(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let i=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),i=!0),e&&await Vh(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){const t=await this.getIdToken();return await Fh(this,async function(t,e){return Dh(t,"POST","/v1/accounts:delete",e)}(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((t=>Object.assign({},t))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var i,r,n,s,a,o,l,u;const c=null!==(i=e.displayName)&&void 0!==i?i:void 0,h=null!==(r=e.email)&&void 0!==r?r:void 0,d=null!==(n=e.phoneNumber)&&void 0!==n?n:void 0,f=null!==(s=e.photoURL)&&void 0!==s?s:void 0,g=null!==(a=e.tenantId)&&void 0!==a?a:void 0,p=null!==(o=e._redirectEventId)&&void 0!==o?o:void 0,m=null!==(l=e.createdAt)&&void 0!==l?l:void 0,v=null!==(u=e.lastLoginAt)&&void 0!==u?u:void 0,{uid:y,emailVerified:T,isAnonymous:b,providerData:E,stsTokenManager:S}=e;ph(y&&S,t,"internal-error");const w=jh.fromJSON(this.name,S);ph("string"==typeof y,t,"internal-error"),Gh(c,t.name),Gh(h,t.name),ph("boolean"==typeof T,t,"internal-error"),ph("boolean"==typeof b,t,"internal-error"),Gh(d,t.name),Gh(f,t.name),Gh(g,t.name),Gh(p,t.name),Gh(m,t.name),Gh(v,t.name);const I=new Kh({uid:y,auth:t,email:h,emailVerified:T,displayName:c,isAnonymous:b,photoURL:f,phoneNumber:d,tenantId:g,stsTokenManager:w,createdAt:m,lastLoginAt:v});return E&&Array.isArray(E)&&(I.providerData=E.map((t=>Object.assign({},t)))),p&&(I._redirectEventId=p),I}static async _fromIdTokenResponse(t,e,i=!1){const r=new jh;r.updateFromServerResponse(e);const n=new Kh({uid:e.localId,auth:t,stsTokenManager:r,isAnonymous:i});return await Vh(n),n}}class Hh{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return void 0===e?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}Hh.type="NONE";const qh=Hh;function Wh(t,e,i){return`firebase:${t}:${e}:${i}`}class zh{constructor(t,e,i){this.persistence=t,this.auth=e,this.userKey=i;const{config:r,name:n}=this.auth;this.fullUserKey=Wh(this.userKey,r.apiKey,n),this.fullPersistenceKey=Wh("persistence",r.apiKey,n),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Kh._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=t,e?this.setCurrentUser(e):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,i="authUser"){if(!e.length)return new zh(Th(qh),t,i);const r=(await Promise.all(e.map((async t=>{if(await t._isAvailable())return t})))).filter((t=>t));let n=r[0]||Th(qh);const s=Wh(i,t.config.apiKey,t.name);let a=null;for(const i of e)try{const e=await i._get(s);if(e){const r=Kh._fromJSON(t,e);i!==n&&(a=r),n=i;break}}catch(t){}const o=r.filter((t=>t._shouldAllowMigration));return n._shouldAllowMigration&&o.length?(n=o[0],a&&await n._set(s,a.toJSON()),await Promise.all(e.map((async t=>{if(t!==n)try{await t._remove(s)}catch(t){}}))),new zh(n,t,i)):new zh(n,t,i)}}function Yh(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Jh(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if($h(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(td(e))return"Blackberry";if(ed(e))return"Webos";if(Xh(e))return"Safari";if((e.includes("chrome/")||Qh(e))&&!e.includes("edge/"))return"Chrome";if(Zh(e))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=t.match(e);if(2===(null==i?void 0:i.length))return i[1]}return"Other"}function $h(t=s()){return/firefox\//i.test(t)}function Xh(t=s()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Qh(t=s()){return/crios\//i.test(t)}function Jh(t=s()){return/iemobile/i.test(t)}function Zh(t=s()){return/android/i.test(t)}function td(t=s()){return/blackberry/i.test(t)}function ed(t=s()){return/webos/i.test(t)}function id(t=s()){return/iphone|ipad|ipod/i.test(t)}function rd(t=s()){return id(t)||Zh(t)||ed(t)||td(t)||/windows phone/i.test(t)||Jh(t)}function nd(t,e=[]){let i;switch(t){case"Browser":i=Yh(s());break;case"Worker":i=`${Yh(s())}-${t}`;break;default:i=t}return`${i}/JsCore/9.6.8/${e.length?e.join(","):"FirebaseCore-web"}`}class sd{constructor(t,e){this.app=t,this.config=e,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new od(this),this.idTokenSubscription=new od(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=uh,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=e.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=Th(e)),this._initializationPromise=this.queue((async()=>{var i,r;if(!this._deleted&&(this.persistenceManager=await zh.create(this,t),!this._deleted)){if(null===(i=this._popupRedirectResolver)||void 0===i?void 0:i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(t){}await this.initializeCurrentUser(e),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();return this.currentUser||t?this.currentUser&&t&&this.currentUser.uid===t.uid?(this._currentUser._assign(t),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(t):void 0}async initializeCurrentUser(t){var e;let i=await this.assertedPersistence.getCurrentUser();if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=null===(e=this.redirectUser)||void 0===e?void 0:e._redirectEventId,n=null==i?void 0:i._redirectEventId,s=await this.tryRedirectSignIn(t);r&&r!==n||!(null==s?void 0:s.user)||(i=s.user)}return i?i._redirectEventId?(ph(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)):this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch(t){await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await Vh(t)}catch(t){if("auth/network-request-failed"!==t.code)return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(t){const e=t?b(t):null;return e&&ph(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t){if(!this._deleted)return t&&ph(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),this.queue((async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()}))}async signOut(){return(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null)}setPersistence(t){return this.queue((async()=>{await this.assertedPersistence.setPersistence(Th(t))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new h("auth","Firebase",t())}onAuthStateChanged(t,e,i){return this.registerStateListener(this.authStateSubscription,t,e,i)}onIdTokenChanged(t,e,i){return this.registerStateListener(this.idTokenSubscription,t,e,i)}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(t=this._currentUser)||void 0===t?void 0:t.toJSON()}}async _setRedirectUser(t,e){const i=await this.getOrInitRedirectPersistenceManager(e);return null===t?i.removeCurrentUser():i.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&Th(t)||this._popupRedirectResolver;ph(e,this,"argument-error"),this.redirectPersistenceManager=await zh.create(this,[Th(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,i;return this._isInitialized&&await this.queue((async()=>{})),(null===(e=this._currentUser)||void 0===e?void 0:e._redirectEventId)===t?this._currentUser:(null===(i=this.redirectUser)||void 0===i?void 0:i._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(t)))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,i,r){if(this._deleted)return()=>{};const n="function"==typeof e?e:e.next.bind(e),s=this._isInitialized?Promise.resolve():this._initializationPromise;return ph(s,this,"internal-error"),s.then((()=>n(this.currentUser))),"function"==typeof e?t.addObserver(e,i,r):t.addObserver(e)}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&(this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh()),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return ph(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){t&&!this.frameworks.includes(t)&&(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=nd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const t={"X-Client-Version":this.clientVersion};return this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId),t}}function ad(t){return b(t)}class od{constructor(t){this.auth=t,this.observer=null,this.addObserver=function(t,e){const i=new y(t,void 0);return i.subscribe.bind(i)}((t=>this.observer=t))}get next(){return ph(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class ld{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return mh("not implemented")}_getIdTokenResponse(t){return mh("not implemented")}_linkToIdToken(t,e){return mh("not implemented")}_getReauthenticationResolver(t){return mh("not implemented")}}class ud extends ld{constructor(t,e,i,r=null){super("password",i),this._email=t,this._password=e,this._tenantId=r}static _fromEmailAndPassword(t,e){return new ud(t,e,"password")}static _fromEmailAndCode(t,e,i=null){return new ud(t,e,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t;if((null==e?void 0:e.email)&&(null==e?void 0:e.password)){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){switch(this.signInMethod){case"password":return async function(t,e){return Rh(t,"POST","/v1/accounts:signInWithPassword",kh(t,e))}(t,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(t,e){return Rh(t,"POST","/v1/accounts:signInWithEmailLink",kh(t,e))}(t,{email:this._email,oobCode:this._password});default:dh(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return async function(t,e){return Dh(t,"POST","/v1/accounts:update",e)}(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(t,e){return Rh(t,"POST","/v1/accounts:signInWithEmailLink",kh(t,e))}(t,{idToken:e,email:this._email,oobCode:this._password});default:dh(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}async function cd(t,e){return Rh(t,"POST","/v1/accounts:signInWithIdp",kh(t,e))}class hd extends ld{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new hd(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):dh("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t,{providerId:i,signInMethod:r}=e,n=oh(e,["providerId","signInMethod"]);if(!i||!r)return null;const s=new hd(i,r);return s.idToken=n.idToken||void 0,s.accessToken=n.accessToken||void 0,s.secret=n.secret,s.nonce=n.nonce,s.pendingToken=n.pendingToken||null,s}_getIdTokenResponse(t){return cd(t,this.buildRequest())}_linkToIdToken(t,e){const i=this.buildRequest();return i.idToken=e,cd(t,i)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,cd(t,e)}buildRequest(){const t={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=p(e)}return t}}const dd={USER_NOT_FOUND:"user-not-found"};class fd extends ld{constructor(t){super("phone","phone"),this.params=t}static _fromVerification(t,e){return new fd({verificationId:t,verificationCode:e})}static _fromTokenResponse(t,e){return new fd({phoneNumber:t,temporaryProof:e})}_getIdTokenResponse(t){return async function(t,e){return Rh(t,"POST","/v1/accounts:signInWithPhoneNumber",kh(t,e))}(t,this._makeVerificationRequest())}_linkToIdToken(t,e){return async function(t,e){const i=await Rh(t,"POST","/v1/accounts:signInWithPhoneNumber",kh(t,e));if(i.temporaryProof)throw Ph(t,"account-exists-with-different-credential",i);return i}(t,Object.assign({idToken:e},this._makeVerificationRequest()))}_getReauthenticationResolver(t){return async function(t,e){return Rh(t,"POST","/v1/accounts:signInWithPhoneNumber",kh(t,Object.assign(Object.assign({},e),{operation:"REAUTH"})),dd)}(t,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:t,phoneNumber:e,verificationId:i,verificationCode:r}=this.params;return t&&e?{temporaryProof:t,phoneNumber:e}:{sessionInfo:i,code:r}}toJSON(){const t={providerId:this.providerId};return this.params.phoneNumber&&(t.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(t.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(t.verificationCode=this.params.verificationCode),this.params.verificationId&&(t.verificationId=this.params.verificationId),t}static fromJSON(t){"string"==typeof t&&(t=JSON.parse(t));const{verificationId:e,verificationCode:i,phoneNumber:r,temporaryProof:n}=t;return i||e||r||n?new fd({verificationId:e,verificationCode:i,phoneNumber:r,temporaryProof:n}):null}}class gd{constructor(t){var e,i,r,n,s,a;const o=m(v(t)),l=null!==(e=o.apiKey)&&void 0!==e?e:null,u=null!==(i=o.oobCode)&&void 0!==i?i:null,c=function(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=o.mode)&&void 0!==r?r:null);ph(l&&u&&c,"argument-error"),this.apiKey=l,this.operation=c,this.code=u,this.continueUrl=null!==(n=o.continueUrl)&&void 0!==n?n:null,this.languageCode=null!==(s=o.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(a=o.tenantId)&&void 0!==a?a:null}static parseLink(t){const e=function(t){const e=m(v(t)).link,i=e?m(v(e)).deep_link_id:null,r=m(v(t)).deep_link_id;return(r?m(v(r)).link:null)||r||i||e||t}(t);try{return new gd(e)}catch(t){return null}}}class pd{constructor(){this.providerId=pd.PROVIDER_ID}static credential(t,e){return ud._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const i=gd.parseLink(e);return ph(i,"argument-error"),ud._fromEmailAndCode(t,i.code,i.tenantId)}}pd.PROVIDER_ID="password",pd.EMAIL_PASSWORD_SIGN_IN_METHOD="password",pd.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class md{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class vd extends md{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class yd extends vd{constructor(){super("facebook.com")}static credential(t){return hd._fromParams({providerId:yd.PROVIDER_ID,signInMethod:yd.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return yd.credentialFromTaggedObject(t)}static credentialFromError(t){return yd.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return yd.credential(t.oauthAccessToken)}catch(t){return null}}}yd.FACEBOOK_SIGN_IN_METHOD="facebook.com",yd.PROVIDER_ID="facebook.com";class Td extends vd{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return hd._fromParams({providerId:Td.PROVIDER_ID,signInMethod:Td.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return Td.credentialFromTaggedObject(t)}static credentialFromError(t){return Td.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:i}=t;if(!e&&!i)return null;try{return Td.credential(e,i)}catch(t){return null}}}Td.GOOGLE_SIGN_IN_METHOD="google.com",Td.PROVIDER_ID="google.com";class bd extends vd{constructor(){super("github.com")}static credential(t){return hd._fromParams({providerId:bd.PROVIDER_ID,signInMethod:bd.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return bd.credentialFromTaggedObject(t)}static credentialFromError(t){return bd.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return bd.credential(t.oauthAccessToken)}catch(t){return null}}}bd.GITHUB_SIGN_IN_METHOD="github.com",bd.PROVIDER_ID="github.com";class Ed extends vd{constructor(){super("twitter.com")}static credential(t,e){return hd._fromParams({providerId:Ed.PROVIDER_ID,signInMethod:Ed.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return Ed.credentialFromTaggedObject(t)}static credentialFromError(t){return Ed.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:i}=t;if(!e||!i)return null;try{return Ed.credential(e,i)}catch(t){return null}}}Ed.TWITTER_SIGN_IN_METHOD="twitter.com",Ed.PROVIDER_ID="twitter.com";class Sd{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,i,r=!1){const n=await Kh._fromIdTokenResponse(t,i,r),s=wd(i);return new Sd({user:n,providerId:s,_tokenResponse:i,operationType:e})}static async _forOperation(t,e,i){await t._updateTokensIfNecessary(i,!0);const r=wd(i);return new Sd({user:t,providerId:r,_tokenResponse:i,operationType:e})}}function wd(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class Id extends c{constructor(t,e,i,r){var n;super(e.code,e.message),this.operationType=i,this.user=r,Object.setPrototypeOf(this,Id.prototype),this.customData={appName:t.name,tenantId:null!==(n=t.tenantId)&&void 0!==n?n:void 0,_serverResponse:e.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(t,e,i,r){return new Id(t,e,i,r)}}function _d(t,e,i,r){return("reauthenticate"===e?i._getReauthenticationResolver(t):i._getIdTokenResponse(t)).catch((i=>{if("auth/multi-factor-auth-required"===i.code)throw Id._fromErrorAndOperation(t,i,e,r);throw i}))}async function Ad(t,e,i=!1){const r="signIn",n=await _d(t,r,e),s=await Sd._fromIdTokenResponse(t,r,n);return i||await t._updateCurrentUser(s.user),s}new WeakMap;const kd="__sak";class Dd{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(kd,"1"),this.storage.removeItem(kd),Promise.resolve(!0)):Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}class Ld extends Dd{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const t=s();return Xh(t)||id(t)}()&&function(){try{return!(!window||window===window.top)}catch(t){return!1}}(),this.fallbackToPolling=rd(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const i=this.storage.getItem(e),r=this.localCache[e];i!==r&&t(e,r,i)}}onStorageEvent(t,e=!1){if(!t.key)return void this.forAllChangedKeys(((t,e,i)=>{this.notifyListeners(t,i)}));const i=t.key;if(e?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(i);if(t.newValue!==r)null!==t.newValue?this.storage.setItem(i,t.newValue):this.storage.removeItem(i);else if(this.localCache[i]===t.newValue&&!e)return}const r=()=>{const t=this.storage.getItem(i);(e||this.localCache[i]!==t)&&this.notifyListeners(i,t)},n=this.storage.getItem(i);u()&&10===document.documentMode&&n!==t.newValue&&t.newValue!==t.oldValue?setTimeout(r,10):r()}notifyListeners(t,e){this.localCache[t]=e;const i=this.listeners[t];if(i)for(const t of Array.from(i))t(e?JSON.parse(e):e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((t,e,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:i}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}Ld.type="LOCAL";const Rd=Ld;class Cd extends Dd{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(t,e){}_removeListener(t,e){}}Cd.type="SESSION";const Od=Cd;class Pd{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find((e=>e.isListeningto(t)));if(e)return e;const i=new Pd(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:i,eventType:r,data:n}=e.data,s=this.handlersMap[r];if(!(null==s?void 0:s.size))return;e.ports[0].postMessage({status:"ack",eventId:i,eventType:r});const a=Array.from(s).map((async t=>t(e.origin,n))),o=await function(t){return Promise.all(t.map((async t=>{try{return{fulfilled:!0,value:await t}}catch(t){return{fulfilled:!1,reason:t}}})))}(a);e.ports[0].postMessage({status:"done",eventId:i,eventType:r,response:o})}_subscribe(t,e){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),e&&0!==this.handlersMap[t].size||delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function xd(t="",e=10){let i="";for(let t=0;t<e;t++)i+=Math.floor(10*Math.random());return t+i}Pd.receivers=[];class Nd{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,i=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let n,s;return new Promise(((a,o)=>{const l=xd("",20);r.port1.start();const u=setTimeout((()=>{o(new Error("unsupported_event"))}),i);s={messageChannel:r,onMessage(t){const e=t;if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(u),n=setTimeout((()=>{o(new Error("timeout"))}),3e3);break;case"done":clearTimeout(n),a(e.data.response);break;default:clearTimeout(u),clearTimeout(n),o(new Error("invalid_response"))}}},this.handlers.add(s),r.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:t,eventId:l,data:e},[r.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function Md(){return window}function Fd(){return void 0!==Md().WorkerGlobalScope&&"function"==typeof Md().importScripts}const Ud="firebaseLocalStorageDb",Bd="firebaseLocalStorage",Vd="fbase_key";class jd{constructor(t){this.request=t}toPromise(){return new Promise(((t,e)=>{this.request.addEventListener("success",(()=>{t(this.request.result)})),this.request.addEventListener("error",(()=>{e(this.request.error)}))}))}}function Gd(t,e){return t.transaction([Bd],e?"readwrite":"readonly").objectStore(Bd)}function Kd(){const t=indexedDB.open(Ud,1);return new Promise(((e,i)=>{t.addEventListener("error",(()=>{i(t.error)})),t.addEventListener("upgradeneeded",(()=>{const e=t.result;try{e.createObjectStore(Bd,{keyPath:Vd})}catch(t){i(t)}})),t.addEventListener("success",(async()=>{const i=t.result;i.objectStoreNames.contains(Bd)?e(i):(i.close(),await function(){const t=indexedDB.deleteDatabase(Ud);return new jd(t).toPromise()}(),e(await Kd()))}))}))}async function Hd(t,e,i){const r=Gd(t,!0).put({[Vd]:e,value:i});return new jd(r).toPromise()}function qd(t,e){const i=Gd(t,!0).delete(e);return new jd(i).toPromise()}class Wd{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Kd()),this.db}async _withRetries(t){let e=0;for(;;)try{const e=await this._openDb();return await t(e)}catch(t){if(e++>3)throw t;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Fd()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Pd._getInstance(Fd()?self:null),this.receiver._subscribe("keyChanged",(async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)}))),this.receiver._subscribe("ping",(async(t,e)=>["keyChanged"]))}async initializeSender(){var t,e;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new Nd(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&(null===(t=i[0])||void 0===t?void 0:t.fulfilled)&&(null===(e=i[0])||void 0===e?void 0:e.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(this.sender&&this.activeServiceWorker&&function(){var t;return(null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null}()===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await Kd();return await Hd(t,kd,"1"),await qd(t,kd),!0}catch(t){}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite((async()=>(await this._withRetries((i=>Hd(i,t,e))),this.localCache[t]=e,this.notifyServiceWorker(t))))}async _get(t){const e=await this._withRetries((e=>async function(t,e){const i=Gd(t,!1).get(e),r=await new jd(i).toPromise();return void 0===r?null:r.value}(e,t)));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite((async()=>(await this._withRetries((e=>qd(e,t))),delete this.localCache[t],this.notifyServiceWorker(t))))}async _poll(){const t=await this._withRetries((t=>{const e=Gd(t,!1).getAll();return new jd(e).toPromise()}));if(!t)return[];if(0!==this.pendingWrites)return[];const e=[],i=new Set;for(const{fbase_key:r,value:n}of t)i.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(n)&&(this.notifyListeners(r,n),e.push(r));for(const t of Object.keys(this.localCache))this.localCache[t]&&!i.has(t)&&(this.notifyListeners(t,null),e.push(t));return e}notifyListeners(t,e){this.localCache[t]=e;const i=this.listeners[t];if(i)for(const t of Array.from(i))t(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Wd.type="LOCAL";const zd=Wd;function Yd(t){return`__${t}${Math.floor(1e6*Math.random())}`}Yd("rcb"),new Sh(3e4,6e4);class $d{constructor(t){this.providerId=$d.PROVIDER_ID,this.auth=ad(t)}verifyPhoneNumber(t,e){return async function(t,e,i){var r;const n=await i.verify();try{let s;if(ph("string"==typeof n,t,"argument-error"),ph("recaptcha"===i.type,t,"argument-error"),s="string"==typeof e?{phoneNumber:e}:e,"session"in s){const e=s.session;if("phoneNumber"in s){ph("enroll"===e.type,t,"internal-error");const i=await function(t,e){return Dh(t,"POST","/v2/accounts/mfaEnrollment:start",kh(t,e))}(t,{idToken:e.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:n}});return i.phoneSessionInfo.sessionInfo}{ph("signin"===e.type,t,"internal-error");const i=(null===(r=s.multiFactorHint)||void 0===r?void 0:r.uid)||s.multiFactorUid;ph(i,t,"missing-multi-factor-info");const a=await function(t,e){return Dh(t,"POST","/v2/accounts/mfaSignIn:start",kh(t,e))}(t,{mfaPendingCredential:e.credential,mfaEnrollmentId:i,phoneSignInInfo:{recaptchaToken:n}});return a.phoneResponseInfo.sessionInfo}}{const{sessionInfo:e}=await async function(t,e){return Dh(t,"POST","/v1/accounts:sendVerificationCode",kh(t,e))}(t,{phoneNumber:s.phoneNumber,recaptchaToken:n});return e}}finally{i._reset()}}(this.auth,t,b(e))}static credential(t,e){return fd._fromVerification(t,e)}static credentialFromResult(t){const e=t;return $d.credentialFromTaggedObject(e)}static credentialFromError(t){return $d.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{phoneNumber:e,temporaryProof:i}=t;return e&&i?fd._fromTokenResponse(e,i):null}}$d.PROVIDER_ID="phone",$d.PHONE_SIGN_IN_METHOD="phone";class Xd extends ld{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return cd(t,this._buildIdpRequest())}_linkToIdToken(t,e){return cd(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return cd(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function Qd(t){return Ad(t.auth,new Xd(t),t.bypassAuthState)}function Jd(t){const{auth:e,user:i}=t;return ph(i,e,"internal-error"),async function(t,e,i=!1){const{auth:r}=t,n="reauthenticate";try{const s=await Fh(t,_d(r,n,e,t),i);ph(s.idToken,r,"internal-error");const a=Mh(s.idToken);ph(a,r,"internal-error");const{sub:o}=a;return ph(t.uid===o,r,"user-mismatch"),Sd._forOperation(t,n,s)}catch(t){throw"auth/user-not-found"===(null==t?void 0:t.code)&&dh(r,"user-mismatch"),t}}(i,new Xd(t),t.bypassAuthState)}async function Zd(t){const{auth:e,user:i}=t;return ph(i,e,"internal-error"),async function(t,e,i=!1){const r=await Fh(t,e._linkToIdToken(t.auth,await t.getIdToken()),i);return Sd._forOperation(t,"link",r)}(i,new Xd(t),t.bypassAuthState)}class tf{constructor(t,e,i,r,n=!1){this.auth=t,this.resolver=i,this.user=r,this.bypassAuthState=n,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(t){this.reject(t)}}))}async onAuthEvent(t){const{urlResponse:e,sessionId:i,postBody:r,tenantId:n,error:s,type:a}=t;if(s)return void this.reject(s);const o={auth:this.auth,requestUri:e,sessionId:i,tenantId:n||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(o))}catch(t){this.reject(t)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Qd;case"linkViaPopup":case"linkViaRedirect":return Zd;case"reauthViaPopup":case"reauthViaRedirect":return Jd;default:dh(this.auth,"internal-error")}}resolve(t){vh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){vh(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const ef=new Sh(2e3,1e4);class rf extends tf{constructor(t,e,i,r,n){super(t,e,r,n),this.provider=i,this.authWindow=null,this.pollId=null,rf.currentPopupAction&&rf.currentPopupAction.cancel(),rf.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return ph(t,this.auth,"internal-error"),t}async onExecution(){vh(1===this.filter.length,"Popup operations only handle one event");const t=xd();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch((t=>{this.reject(t)})),this.resolver._isIframeWebStorageSupported(this.auth,(t=>{t||this.reject(fh(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(fh(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,rf.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,i;(null===(i=null===(e=this.authWindow)||void 0===e?void 0:e.window)||void 0===i?void 0:i.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(fh(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(t,ef.get())};t()}}rf.currentPopupAction=null;const nf=new Map;class sf extends tf{constructor(t,e,i=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,i),this.eventId=null}async execute(){let t=nf.get(this.auth._key());if(!t){try{const e=await async function(t,e){const i=function(t){return Wh("pendingRedirect",t.config.apiKey,t.name)}(e),r=function(t){return Th(t._redirectPersistence)}(t);if(!await r._isAvailable())return!1;const n="true"===await r._get(i);return await r._remove(i),n}(this.resolver,this.auth),i=e?await super.execute():null;t=()=>Promise.resolve(i)}catch(e){t=()=>Promise.reject(e)}nf.set(this.auth._key(),t)}return this.bypassAuthState||nf.set(this.auth._key(),(()=>Promise.resolve(null))),t()}async onAuthEvent(t){if("signInViaRedirect"===t.type)return super.onAuthEvent(t);if("unknown"!==t.type){if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}async function af(t,e,i=!1){const r=ad(t),n=function(t,e){return e?Th(e):(ph(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}(r,e),s=new sf(r,n,i),a=await s.execute();return a&&!i&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}class of{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach((i=>{this.isEventForConsumer(t,i)&&(e=!0,this.sendToConsumer(t,i),this.saveEventToCache(t))})),this.hasHandledPotentialRedirect||!function(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return uf(t);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var i;if(t.error&&!uf(t)){const r=(null===(i=t.error.code)||void 0===i?void 0:i.split("auth/")[1])||"internal-error";e.onError(fh(this.auth,r))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const i=null===e.eventId||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&i}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(lf(t))}saveEventToCache(t){this.cachedEventUids.add(lf(t)),this.lastProcessedEventTime=Date.now()}}function lf(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter((t=>t)).join("-")}function uf({type:t,error:e}){return"unknown"===t&&"auth/no-auth-event"===(null==e?void 0:e.code)}const cf=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,hf=/^https?/;function df(t){const e=bh(),{protocol:i,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const n=new URL(t);return""===n.hostname&&""===r?"chrome-extension:"===i&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===i&&n.hostname===r}if(!hf.test(i))return!1;if(cf.test(t))return r===t;const n=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+n+"|"+n+")$","i").test(r)}const ff=new Sh(3e4,6e4);function gf(){const t=Md().___jsl;if(null==t?void 0:t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let pf=null;function mf(t){return pf=pf||function(t){return new Promise(((e,i)=>{var r,n,s,a;function o(){gf(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{gf(),i(fh(t,"network-request-failed"))},timeout:ff.get()})}if(null===(n=null===(r=Md().gapi)||void 0===r?void 0:r.iframes)||void 0===n?void 0:n.Iframe)e(gapi.iframes.getContext());else{if(!(null===(s=Md().gapi)||void 0===s?void 0:s.load)){const e=Yd("iframefcb");return Md()[e]=()=>{gapi.load?o():i(fh(t,"network-request-failed"))},(a=`https://apis.google.com/js/api.js?onload=${e}`,new Promise(((t,e)=>{const i=document.createElement("script");i.setAttribute("src",a),i.onload=t,i.onerror=t=>{const i=fh("internal-error");i.customData=t,e(i)},i.type="text/javascript",i.charset="UTF-8",function(){var t,e;return null!==(e=null===(t=document.getElementsByTagName("head"))||void 0===t?void 0:t[0])&&void 0!==e?e:document}().appendChild(i)}))).catch((t=>i(t)))}o()}})).catch((t=>{throw pf=null,t}))}(t),pf}const vf=new Sh(5e3,15e3),yf={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Tf=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function bf(t){const e=t.config;ph(e.authDomain,t,"auth-domain-config-required");const i=e.emulator?wh(e,"emulator/auth/iframe"):`https://${t.config.authDomain}/__/auth/iframe`,r={apiKey:e.apiKey,appName:t.name,v:W},n=Tf.get(t.config.apiHost);n&&(r.eid=n);const s=t._getFrameworks();return s.length&&(r.fw=s.join(",")),`${i}?${p(r).slice(1)}`}const Ef={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Sf{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}}function wf(t,e,i,r,n,s){ph(t.config.authDomain,t,"auth-domain-config-required"),ph(t.config.apiKey,t,"invalid-api-key");const a={apiKey:t.config.apiKey,appName:t.name,authType:i,redirectUrl:r,v:W,eventId:n};if(e instanceof md){e.setDefaultLanguage(t.languageCode),a.providerId=e.providerId||"",function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[t,e]of Object.entries(s||{}))a[t]=e}if(e instanceof vd){const t=e.getScopes().filter((t=>""!==t));t.length>0&&(a.scopes=t.join(","))}t.tenantId&&(a.tid=t.tenantId);const o=a;for(const t of Object.keys(o))void 0===o[t]&&delete o[t];return`${function({config:t}){return t.emulator?wh(t,"emulator/auth/handler"):`https://${t.authDomain}/__/auth/handler`}(t)}?${p(o).slice(1)}`}const If="webStorageSupport",_f=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Od,this._completeRedirectFn=af}async _openPopup(t,e,i,r){var n;return vh(null===(n=this.eventManagers[t._key()])||void 0===n?void 0:n.manager,"_initialize() not called before _openPopup()"),function(t,e,i,r=500,n=600){const a=Math.max((window.screen.availHeight-n)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const u=Object.assign(Object.assign({},Ef),{width:r.toString(),height:n.toString(),top:a,left:o}),c=s().toLowerCase();i&&(l=Qh(c)?"_blank":i),$h(c)&&(e=e||"http://localhost",u.scrollbars="yes");const h=Object.entries(u).reduce(((t,[e,i])=>`${t}${e}=${i},`),"");if(function(t=s()){var e;return id(t)&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(c)&&"_self"!==l)return function(t,e){const i=document.createElement("a");i.href=t,i.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),i.dispatchEvent(r)}(e||"",l),new Sf(null);const d=window.open(e||"",l,h);ph(d,t,"popup-blocked");try{d.focus()}catch(t){}return new Sf(d)}(t,wf(t,e,i,bh(),r),xd())}async _openRedirect(t,e,i,r){var n;return await this._originValidation(t),n=wf(t,e,i,bh(),r),Md().location.href=n,new Promise((()=>{}))}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:t,promise:i}=this.eventManagers[e];return t?Promise.resolve(t):(vh(i,"If manager is not set, promise should be"),i)}const i=this.initAndGetManager(t);return this.eventManagers[e]={promise:i},i.catch((()=>{delete this.eventManagers[e]})),i}async initAndGetManager(t){const e=await async function(t){const e=await mf(t),i=Md().gapi;return ph(i,t,"internal-error"),e.open({where:document.body,url:bf(t),messageHandlersFilter:i.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:yf,dontclear:!0},(e=>new Promise((async(i,r)=>{await e.restyle({setHideOnLeave:!1});const n=fh(t,"network-request-failed"),s=Md().setTimeout((()=>{r(n)}),vf.get());function a(){Md().clearTimeout(s),i(e)}e.ping(a).then(a,(()=>{r(n)}))}))))}(t),i=new of(t);return e.register("authEvent",(e=>(ph(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:i.onEvent(e.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:i},this.iframes[t._key()]=e,i}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(If,{type:If},(i=>{var r;const n=null===(r=null==i?void 0:i[0])||void 0===r?void 0:r.webStorageSupport;void 0!==n&&e(!!n),dh(t,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=async function(t){if(t.config.emulator)return;const{authorizedDomains:e}=await async function(t,e={}){return Dh(t,"GET","/v1/projects",e)}(t);for(const t of e)try{if(df(t))return}catch(t){}dh(t,"unauthorized-domain")}(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return rd()||Xh()||id()}};var Af,kf="@firebase/auth",Df="0.19.9";class Lf{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),(null===(t=this.auth.currentUser)||void 0===t?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged((e=>{var i;t((null===(i=e)||void 0===i?void 0:i.stsTokenManager.accessToken)||null)}));this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){ph(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}Af="Browser",G(new E("auth",((t,{options:e})=>{const i=t.getProvider("app").getImmediate(),{apiKey:r,authDomain:n}=i.options;return(t=>{ph(r&&!r.includes(":"),"invalid-api-key",{appName:t.name}),ph(!(null==n?void 0:n.includes(":")),"argument-error",{appName:t.name});const i={apiKey:r,authDomain:n,clientPlatform:Af,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nd(Af)},s=new sd(t,i);return function(t,e){const i=(null==e?void 0:e.persistence)||[],r=(Array.isArray(i)?i:[i]).map(Th);(null==e?void 0:e.errorMap)&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,null==e?void 0:e.popupRedirectResolver)}(s,e),s})(i)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((t,e,i)=>{t.getProvider("auth-internal").initialize()}))),G(new E("auth-internal",(t=>(t=>new Lf(t))(ad(t.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),Y(kf,Df,void 0),Y(kf,Df,"esm2017"),i(255);let Rf={},Cf={},Of=!1,Pf=!1;window.env={firebaseConfig:{apiKey:"AIzaSyA6KlSt8IQBSm7TiDszs29bhKaVev-e1Tw",authDomain:"mdm-qcrt-demo-1.firebaseapp.com",projectId:"mdm-qcrt-demo-1",storageBucket:"mdm-qcrt-demo-1.appspot.com",messagingSenderId:"1055119004226",appId:"1:1055119004226:web:1d17187e816f794b5713db"},region:"clinton"};const xf=function(t,e={}){"object"!=typeof e&&(e={name:e});const i=Object.assign({name:"[DEFAULT]",automaticDataCollectionEnabled:!1},e),r=i.name;if("string"!=typeof r||!r)throw H.create("bad-app-name",{appName:String(r)});const n=B.get(r);if(n){if(f(t,n.options)&&f(i,n.config))return n;throw H.create("duplicate-app",{appName:r})}const s=new I(r);for(const t of V.values())s.addComponent(t);const a=new q(t,i,s);return B.set(r,a),a}(window.env.firebaseConfig),Nf=function(t=z()){return K(t,"firestore").getImmediate()}(xf),Mf=_c(Nf,"Passages","Admin"),Ff=function(t=z()){const e=K(t,"auth");return e.isInitialized()?e.getImmediate():function(t,e){const i=K(t,"auth");if(i.isInitialized()){const t=i.getImmediate();if(f(i.getOptions(),null!=e?e:{}))return t;dh(t,"already-initialized")}return i.initialize({options:e})}(t,{popupRedirectResolver:_f,persistence:[zd,Rd,Od]})}(xf),Uf=document.getElementById("cameraA"),Bf=document.getElementById("cameraB"),Vf=document.getElementById("control-label"),jf=document.getElementById("control-text"),Gf=document.getElementById("audio-label"),Kf=document.getElementById("audio-text"),Hf=document.getElementById("trigger-label"),qf=document.getElementById("trigger-text"),Wf=document.getElementById("video-button"),zf=document.getElementById("audio-button"),Yf=document.getElementById("video-button-text"),$f=document.getElementById("audio-button-text"),Xf=document.getElementById("login-btn"),Qf=document.getElementById("logout-btn");function Jf(t){return Rf.adminUsers.length?(Pf=Rf.adminUsers.includes(t),Pf):(Pf=!1,Pf)}!function(t,...e){var i,r,n;t=b(t);let s={includeMetadataChanges:!1},a=0;"object"!=typeof e[a]||kc(e[a])||(s=e[a],a++);const o={includeMetadataChanges:s.includeMetadataChanges};if(kc(e[a])){const t=e[a];e[a]=null===(i=t.next)||void 0===i?void 0:i.bind(t),e[a+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[a+2]=null===(n=t.complete)||void 0===n?void 0:n.bind(t)}let l,u,c;if(t instanceof Sc)u=Tc(t.firestore,Dc),c=zs(t._key.path),l={next:i=>{e[a]&&e[a](function(t,e,i){const r=i.docs.get(e._key),n=new sh(t);return new eh(t,n,e._key,r,new th(i.hasPendingWrites,i.fromCache),e.converter)}(u,t,i))},error:e[a+1],complete:e[a+2]};else{const i=Tc(t,wc);u=Tc(i.firestore,Dc),c=i._query;const r=new sh(u);l={next:t=>{e[a]&&e[a](new rh(u,r,i,t))},error:e[a+1],complete:e[a+2]},function(t){if($s(t)&&0===t.explicitOrderBy.length)throw new kn(An.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query)}!function(t,e,i,r){const n=new cc(r),s=new Fu(e,n,i);t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const i=_n(t),r=e.query;let n=!1,s=i.queries.get(r);if(s||(n=!0,s=new Ou),n)try{s.Xo=await i.onListen(r)}catch(t){const i=Du(t,`Initialization of query '${ta(e.query)}' failed`);return void e.onError(i)}i.queries.set(r,s),s.listeners.push(e),e.tc(i.onlineState),s.Xo&&e.ec(s.Xo)&&Mu(i)}(await gc(t),s)))}(Lc(u),c,o,l)}(_c(Nf,"Passages","Admin"),(t=>{let e,i,r,n,s=t.data();Rf=Object.assign({},s),e=s.showClVideo,i=s.showClVideoOn,r=s.webcamNumCl,n=s.showClAudioOn,function(t,e,i,r){1==t?(Vf.innerText="Video Enabled",Vf.className="green",jf.innerText="The cabin webcams are enabled to go live if triggered by a server event. Press the button below to override server control.",Yf.innerText="Disable"):0==t&&(Vf.innerText="Video Disabled",Vf.className="red",jf.innerText="The cabin webcams are disabled from server control. No video broadcasts will be allowed until you enable them.",Yf.innerText="Enable"),1==e?(Gf.innerText="Audio Enabled",Gf.className="green",Kf.innerText="Cabin microphones are enabld. Audio will broadcast whenever the camera is streaming unless you press the button below.",$f.innerText="Disable"):0==e&&(Gf.innerText="Audio Disabled",Gf.className="red",Kf.innerText="Cabin microphones are disabled from server contorl. No audio will broadcast until you enable it.",$f.innerText="Enable"),1==i?(Hf.innerText="Trigger Activated",Hf.className="green",qf.innerText="A near-by vessel has triggered the cabin webcams to broadcast live."):0==i&&(Hf.innerText="Trigger Off",Hf.className="red",qf.innerText="The cabin webcams are not currently triggered by any vessels."),1==i&&1==t&&("A"==r&&(Uf.className="active",Bf.className="off"),"B"==r&&(Uf.className="off",Bf.className="active"))}(i,n,e,r)})),Wf.addEventListener("click",(function(){if(console.log("toggleWebcam()",Rf),!Pf&&!Of)return alert("User not authorized for webcam operation.");1==Rf.showClVideoOn?Rf.showClVideoOn=!1:Rf.showClVideoOn=!0,ah(Mf,Rf,{merge:!0})})),zf.addEventListener("click",(function(){if(console.log("toggleWebaudio()",Rf),!Pf&&!Of)return alert("User not authorized for webcam operation.");1==Rf.showClAudioOn?Rf.showClAudioOn=!1:Rf.showClAudioOn=!0,ah(Mf,Rf,{merge:!0})})),Xf.addEventListener("click",(async function(){await function(t,e,i){return async function(t,e){return Ad(ad(t),e)}(b(t),pd.credential("admin@clintonrivertraffic.com","SnoodleDog"))}(Ff).then((t=>{console.log("signInWithEmailAndPassword -> user",t),Jf(t.user.uid)&&(Of=!0),console.log("userIsAdmin =",Pf)})).catch((t=>{console.log("Login error",t)}))})),Qf.addEventListener("click",(function(){console.log("logging out now."),function(t){return b(t).signOut()}(Ff).then((()=>{})).catch((t=>{alert("There was a problem signing out:"+t)}))})),Uf.addEventListener("click",(function(){if(!Pf&&!Of)return alert("User not authorized for webcam operation.");Rf.webcamNumCl="A",ah(Mf,Rf,{merge:!0})})),Bf.addEventListener("click",(function(){if(!Pf&&!Of)return alert("User not authorized for webcam operation.");Rf.webcamNumCl="B",ah(Mf,Rf,{merge:!0})})),function(t,e,i,r){b(t).onAuthStateChanged((t=>{console.log("onAuthStateChanged u",t),t?(Cf=t,Jf(t.uid)&&(Qf.style="display: block")):(Of=!1,Pf=!1,Qf.style="visibility: hidden",console.log("User is logged out.")),console.log("user state changed",Cf)}),void 0,void 0)}(Ff)})()})();